<!DOCTYPE html>
<!-- saved from url=(0100)https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-a_micropost_model -->
<html id="custDomain" class="gr__learnenough_com wf-proximanova-n4-active wf-proximanova-n7-active wf-proximanova-n1-active wf-proximanova-i4-active wf-lust-n4-active wf-proximanova-i7-active wf-futurapt-n3-active wf-lust-i4-active wf-active fontawesome-i2svg-active fontawesome-i2svg-complete"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Analytics Here -->
<!-- Anti-flicker snippet (recommended)  -->
<style type="text/css">svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;-webkit-box-sizing:border-box;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.3333333333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}</style><style>.async-hide { opacity: 0 !important} </style><style id="dark-reader-style" type="text/css">@media screen {

/* Leading rule */
html {
  -webkit-filter: invert(100%) hue-rotate(180deg) brightness(110%) contrast(90%) grayscale(20%) sepia(10%) !important;
  filter: invert(100%) hue-rotate(180deg) brightness(110%) contrast(90%) grayscale(20%) sepia(10%) !important;
}

/* Reverse rule */
img,
video,
:not(object):not(body)>embed,
object,
svg image,
[style*="background:url"],
[style*="background-image:url"],
[style*="background: url"],
[style*="background-image: url"],
[background],
twitterwidget {
  -webkit-filter: invert(100%) hue-rotate(180deg) !important;
  filter: invert(100%) hue-rotate(180deg) !important;
}
[style*="background:url"] *,
[style*="background-image:url"] *,
[style*="background: url"] *,
[style*="background-image: url"] *,
input,
[background] *,
img[src^="https://s0.wp.com/latex.php"],
twitterwidget .NaturalImage-image {
  -webkit-filter: none !important;
  filter: none !important;
}
.compatibility-with-darkreader-below-4-3-3 {
  background: white !important;
}

/* Text contrast */
html {
  text-shadow: 0 0 0 !important;
}

/* Full screen */
:-webkit-full-screen, :-webkit-full-screen * {
  -webkit-filter: none !important;
  filter: none !important;
}
:-moz-full-screen, :-moz-full-screen * {
  -webkit-filter: none !important;
  filter: none !important;
}
:fullscreen, :fullscreen * {
  -webkit-filter: none !important;
  filter: none !important;
}

/* Page background */
html {
  background: rgb(13,13,12) !important;
}

/* Custom rules */
.compatibility-with-darkreader-below-4-3-3 {
    background: white !important;
}

}</style>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/nr-1130.min.js.下載"></script><script async="" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/fbevents.js.下載"></script><script type="text/javascript" async="" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/54eea5d20a23b37d87000040.js.下載"></script><script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;
h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;
})(window,document.documentElement,'async-hide','dataLayer',4000,
{'GTM-M9B6M8R':true});</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  
  gtag('config', 'UA-46858978-2', { 'optimize_id': 'GTM-M9B6M8R'});
  gtag('config', 'AW-951733091');
</script>
<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/54eea5d20a23b37d87000040.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>


<script type="text/javascript" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/6713.js.下載" async="async"></script>
<!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '120259081996654', {
    em: '',
  });
  fbq('track', 'PageView');
  fbq('track', 'ViewContent');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=120259081996654&ev=PageView&noscript=1"
/></noscript>
<!-- End Facebook Pixel Code -->



<script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"1310fd97f1","applicationID":"71497409","transactionName":"IVZWR0tbWF4BFxhWVw1SSxxYREReHTpUW1wHZldBZkZRUwA6VkZMC1pUVg==","queueTime":2,"applicationTime":534,"agent":""}</script>
<script>window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(3),u=e(4),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}catch(e){throw f.emit("fn-err",[arguments,this,e],t),e}finally{f.emit("fn-end",[c.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e,n){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now(),!1,n])}},{}],2:[function(e,n,t){function r(e,n){if(!o)return!1;if(e!==o)return!1;if(!n)return!0;if(!i)return!1;for(var t=i.split("."),r=n.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var o=null,i=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var u=navigator.userAgent,f=u.match(a);f&&u.indexOf("Chrome")===-1&&u.indexOf("Chromium")===-1&&(o="Safari",i=f[1])}n.exports={agent:o,version:i,match:r}},{}],3:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],4:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],5:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=v(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){h[e]=v(e).concat(n)}function m(e,n){var t=h[e];if(t)for(var r=0;r<t.length;r++)t[r]===n&&t.splice(r,1)}function v(e){return h[e]||[]}function g(e){return p[e]=p[e]||o(t)}function w(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:n,buffer:w,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(3),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!E++){var e=x.info=NREUM.info,n=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+x.offset],null,"api");var t=l.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===l.readyState&&i()}function i(){f("mark",["domContent",a()+x.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-x.offset}var u=(new Date).getTime(),f=e("handle"),c=e(3),s=e("ee"),p=e(2),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1130.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),x=n.exports={offset:u,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};e(1),l[m]?(l[m]("DOMContentLoaded",i,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",o),d[v]("onload",r)),f("mark",["firstbyte",u],null,"api");var E=0,O=e(5)},{}]},{},["loader"]);</script>
<title>Ruby on Rails Tutorial (Rails 5) |  Learn Enough to Be Dangerous</title>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/nbl5sqs.js.下載"></script>
<style type="text/css">.tk-proxima-nova{font-family:"proxima-nova",sans-serif;}.tk-futura-pt{font-family:"futura-pt",sans-serif;}.tk-lust{font-family:"lust",sans-serif;}</style><style type="text/css">@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/71f83c/00000000000000003b9b093b/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/71f83c/00000000000000003b9b093b/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/71f83c/00000000000000003b9b093b/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/86b539/00000000000000003b9b093a/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/86b539/00000000000000003b9b093a/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/86b539/00000000000000003b9b093a/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/ed0e78/00000000000000003b9b0931/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n1&v=3) format("woff2"),url(https://use.typekit.net/af/ed0e78/00000000000000003b9b0931/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n1&v=3) format("woff"),url(https://use.typekit.net/af/ed0e78/00000000000000003b9b0931/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n1&v=3) format("opentype");font-weight:100;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/4838bd/00000000000000003b9b0934/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/4838bd/00000000000000003b9b0934/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/4838bd/00000000000000003b9b0934/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/6aec08/00000000000000003b9b0935/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/6aec08/00000000000000003b9b0935/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/6aec08/00000000000000003b9b0935/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/ae4f6c/000000000000000000010096/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/ae4f6c/000000000000000000010096/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/ae4f6c/000000000000000000010096/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:lust;src:url(https://use.typekit.net/af/c46a9c/000000000000000000014313/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/c46a9c/000000000000000000014313/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/c46a9c/000000000000000000014313/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:lust;src:url(https://use.typekit.net/af/6a323f/000000000000000000014314/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/6a323f/000000000000000000014314/27/d?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/6a323f/000000000000000000014314/27/a?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}</style><script>
try{Typekit.load();}catch(e){}
</script>
<link href="https://www.learnenough.com/favicon-le.png" rel="icon">
<link href="https://www.learnenough.com/le/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed">
<link rel="stylesheet" media="screen" href="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/novo_le-939c905271655488fbf479733ef8930d6d67911a46b534f2177ddbe65154515c.css">

<meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="LjrdzluysLa6gdhYEyrCoPJoelkwLIFC9hSCYUcxInuMQPsTnBQDpRe3qLQq6IPNDuiQLpCDcB83cyX3R1vUtw==">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="https://www.softcover.io/books/28fdb94f/ruby_on_rails_tutorial_4th_edition" property="og:url">
<meta content="Ruby on Rails Tutorial (Rails 5)" property="og:title">
<meta content="Newly updated for Rails 5, the Ruby on Rails Tutorial book and screencast series teach you how to develop and deploy real, industrial-strength web applications with Ruby on Rails, the open-source web framework that powers top websites such as Twitter, Hulu, GitHub, and the Yellow Pages. The Ruby on Rails Tutorial book is available for free online and is available for purchase as an ebook (PDF, EPUB, and MOBI formats). The companion screencast series includes 14 individual lessons, one for each chapter of the Ruby on Rails Tutorial book." property="og:description">
<meta content="Softcover.io" property="og:site_name">
<meta content="https://softcover.s3.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/images/cover-web.png" property="og:image">
<meta content="https://softcover.s3.amazonaws.com/636/ruby_on_rails_tutorial_4th_edition/images/cover-web.png" property="og:image:secure_url">
<meta content="image/png" property="og:image:type">
<meta content="500" property="og:image:width">
<meta content="500" property="og:image:height">
<meta content="216" property="book_id">
<link href="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/video-js.css" rel="stylesheet">
<script>
  window.Config = {
    env: "production",
    bucket: "softcover",
    previewBucket: "softcover-cloud",
    userId: false
  }
</script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/jquery-2.0.3.min.js.下載" type="text/javascript"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/jquery.formalize.min.js.下載" type="text/javascript"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/underscore-min.js.下載" type="text/javascript"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/hammer.min.js.下載" type="text/javascript"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/saved_resource" type="text/javascript"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/jsapi" type="text/javascript"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/application-0263a9199ed0b5f0ddff0be26000263dbde99f3b744e7dfbedeb81048c6f7627.js.下載"></script>

<link href="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/jquery.qtip.min.css" rel="stylesheet">
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/jquery.qtip.min.js.下載" type="text/javascript"></script>
<meta content="on" name="twitter:widgets:csp">
<meta content="n4FYakgLVe1smRPU7gMdoXLgAUHVQDHevdSPlKGqLO4" name="google-site-verification">
<script async="true" id="xo-pptm" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/pptm.js.下載"></script><script type="text/javascript" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/jquery.min.js.下載"></script><script id="mathJaxJS" type="text/javascript" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/MathJax.js.下載"></script><style data-styled-components=""></style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body class="course side-menu-opened" data-gr-c-s-loaded="true" style=""><div id="MathJax_Message" style="display: none;"></div>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WG4J29S"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="container">
<div class="le_sidemenu checkout_sidemenu">
<div class="checkout-close">
<a onclick="$(&#39;.le_sidemenu&#39;).removeClass(&#39;open&#39;);$(&#39;.le_sidemenu-bg&#39;).removeClass(&#39;open&#39;);" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a></div>
<div class="page-form">
<div id="j_cartForm"><form id="j_checkoutForm" action="https://www.learnenough.com/cart/complete" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="LjrdzluysLa6gdhYEyrCoPJoelkwLIFC9hSCYUcxInuMQPsTnBQDpRe3qLQq6IPNDuiQLpCDcB83cyX3R1vUtw==">
<h5 class="header-with-link">
Create Account
<span>
(or
<a class="fancylink_stand-bg" href="https://www.learnenough.com/login?after=%2Fruby-on-rails-4th-edition-tutorial%2Fuser_microposts%23cart-checkout">log in</a>
)
</span>
</h5>
<div>
<label for="cart_new_user_email">Email</label>
<input type="email" name="cart[new_user_email]" id="cart_new_user_email" required="required" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAfBJREFUWAntVk1OwkAUZkoDKza4Utm61iP0AqyIDXahN2BjwiHYGU+gizap4QDuegWN7lyCbMSlCQjU7yO0TOlAi6GwgJc0fT/fzPfmzet0crmD7HsFBAvQbrcrw+Gw5fu+AfOYvgylJ4TwCoVCs1ardYTruqfj8fgV5OUMSVVT93VdP9dAzpVvm5wJHZFbg2LQ2pEYOlZ/oiDvwNcsFoseY4PBwMCrhaeCJyKWZU37KOJcYdi27QdhcuuBIb073BvTNL8ln4NeeR6NRi/wxZKQcGurQs5oNhqLshzVTMBewW/LMU3TTNlO0ieTiStjYhUIyi6DAp0xbEdgTt+LE0aCKQw24U4llsCs4ZRJrYopB6RwqnpA1YQ5NGFZ1YQ41Z5S8IQQdP5laEBRJcD4Vj5DEsW2gE6s6g3d/YP/g+BDnT7GNi2qCjTwGd6riBzHaaCEd3Js01vwCPIbmWBRx1nwAN/1ov+/drgFWIlfKpVukyYihtgkXNp4mABK+1GtVr+SBhJDbBIubVw+Cd/TDgKO2DPiN3YUo6y/nDCNEIsqTKH1en2tcwA9FKEItyDi3aIh8Gl1sRrVnSDzNFDJT1bAy5xpOYGn5fP5JuL95ZjMIn1ya7j5dPGfv0A5eAnpZUY3n5jXcoec5J67D9q+VuAPM47D3XaSeL4AAAAASUVORK5CYII=&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%;">
</div>
<div>
<label for="cart_new_user_username">Public Username</label>
<input type="text" name="cart[new_user_username]" id="cart_new_user_username" required="required">
</div>
<div>
<label for="cart_new_user_password">Password</label>
<input type="password" name="cart[new_user_password]" id="cart_new_user_password" required="required" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABKRJREFUWAnNl0tsVGUUxzvTTlslZUaCloZHY6BRFkp9sDBuqgINpaBp02dIDImwKDG6ICQ8jBYlhg0rxUBYEALTpulMgBlqOqHRDSikJkZdGG0CRqAGUuwDovQ1/s7NPTffnTu3zMxGvuT2vP7n8Z3vu+dOi4r+5xUoJH8sFquamZmpTqfTVeIfCARGQ6HQH83NzaP5xsu5gL6+vuVzc3NdJN1Kkhd8Ev1MMYni4uJjra2tt3wwLvUjCxgYGFg8Pj7+MV5dPOUub3/hX0zHIpFId0NDw6Q/jO4tZOzv76+Znp6+AOb5TBw7/YduWC2Hr4J/IhOD/GswGHy7vb39tyw2S+VbAC1/ZXZ29hKoiOE8RrIvaPE5WvyjoS8CX8sRvYPufYpZYtjGS0pKNoD/wdA5bNYCCLaMYMMEWq5IEn8ZDof3P6ql9pF9jp8cma6bFLGeIv5ShdISZUzKzqPIVnISp3l20caTJsaPtwvc3dPTIx06ziZkkyvY0FnoW5l+ng7guAWnpAI5w4MkP6yy0GQy+dTU1JToGm19sqKi4kBjY+PftmwRYn1ErEOq4+i2tLW1DagsNGgKNv+p6tj595nJxUbyOIF38AwipoSfnJyMqZ9SfD8jxlWV5+fnu5VX6iqgt7d3NcFeUiN0n8FbLEOoGkwdgY90dnbu7OjoeE94jG9wd1aZePRp5AOqw+9VMM+qLNRVABXKkLEWzn8S/FtbdAhnuVQE7LdVafBPq04pMYawO0OJ+6XHZkFcBQA0J1xKgyhlB0EChEWGX8RulsgjvOjEBu+5V+icWOSoFawuVwEordluG28oSCmXSs55SGSCHiXhmDzC25ghMHGbdwhJr6sAdpnyQl0FYIyoEX5CeYOuNHg/NhvGiUUxVgfV2VUAxjtqgPecp9oKoE4sNnbX9HcVgMH8nD5nAoWnKM/5ZmKyySRdq3pCmDncR4DxOwVC64eHh0OGLOcur1Vey46xUZ3IcVl5oa4OlJaWXgQwJwZyhUdGRjqE14VtSnk/mokhxnawiwUvsZmsX5u+rgKamprGMDoA5sKhRCLxpDowSpsJ8vpCj2AUPzg4uIiNfKIyNMkH6Z4hF3k+RgTYz6vVAEiKq2bsniZIC0nTtvMVMwBzoBT9tKkTHp8Ak1V8dTrOE+NgJs7VATESTH5WnVAgfHUqlXK6oHpJEI1G9zEZH/Du16leqHyS0UXBNKmeOMf5NvyislJPB8RAFz4g8IuwofLy8k319fUP1EEouw7L7mC3kUTO1nn3sb02MTFxFpsz87FfJuaH4pu5fF+reDz+DEfxkI44Q0ScSbyOpDGe1RqMBN08o+ha0L0JdeKi/6msrGwj98uZMeon1AGaSj+elr9LwK9IkO33n8cN7Hl2vp1N3PcYbUXOBbDz9bwV1/wCmXoS3+B128OPD/l2LLg8l9APXVlZKZfzfDY7ehlQv0PPQDez6zW5JJdYOXdAwHK2dGIv7GH4YtHJIvEOvvunLCHPPzl3QOLKTkl0hPbKaDUvlTU988xtwfMqQBPQ3m/4mf0yBVlDCSr/CRW0CipAMnGzb9XU1NSRvIX7kSgo++Pg9B8wltxxbHKPZgAAAABJRU5ErkJggg==&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%;">
</div>
<div>
<label for="cart_new_user_password_confirmation">Password Confirmation</label>
<input type="password" name="cart[new_user_password_confirmation]" id="cart_new_user_password_confirmation" required="required" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABKRJREFUWAnNl0tsVGUUxzvTTlslZUaCloZHY6BRFkp9sDBuqgINpaBp02dIDImwKDG6ICQ8jBYlhg0rxUBYEALTpulMgBlqOqHRDSikJkZdGG0CRqAGUuwDovQ1/s7NPTffnTu3zMxGvuT2vP7n8Z3vu+dOi4r+5xUoJH8sFquamZmpTqfTVeIfCARGQ6HQH83NzaP5xsu5gL6+vuVzc3NdJN1Kkhd8Ev1MMYni4uJjra2tt3wwLvUjCxgYGFg8Pj7+MV5dPOUub3/hX0zHIpFId0NDw6Q/jO4tZOzv76+Znp6+AOb5TBw7/YduWC2Hr4J/IhOD/GswGHy7vb39tyw2S+VbAC1/ZXZ29hKoiOE8RrIvaPE5WvyjoS8CX8sRvYPufYpZYtjGS0pKNoD/wdA5bNYCCLaMYMMEWq5IEn8ZDof3P6ql9pF9jp8cma6bFLGeIv5ShdISZUzKzqPIVnISp3l20caTJsaPtwvc3dPTIx06ziZkkyvY0FnoW5l+ng7guAWnpAI5w4MkP6yy0GQy+dTU1JToGm19sqKi4kBjY+PftmwRYn1ErEOq4+i2tLW1DagsNGgKNv+p6tj595nJxUbyOIF38AwipoSfnJyMqZ9SfD8jxlWV5+fnu5VX6iqgt7d3NcFeUiN0n8FbLEOoGkwdgY90dnbu7OjoeE94jG9wd1aZePRp5AOqw+9VMM+qLNRVABXKkLEWzn8S/FtbdAhnuVQE7LdVafBPq04pMYawO0OJ+6XHZkFcBQA0J1xKgyhlB0EChEWGX8RulsgjvOjEBu+5V+icWOSoFawuVwEordluG28oSCmXSs55SGSCHiXhmDzC25ghMHGbdwhJr6sAdpnyQl0FYIyoEX5CeYOuNHg/NhvGiUUxVgfV2VUAxjtqgPecp9oKoE4sNnbX9HcVgMH8nD5nAoWnKM/5ZmKyySRdq3pCmDncR4DxOwVC64eHh0OGLOcur1Vey46xUZ3IcVl5oa4OlJaWXgQwJwZyhUdGRjqE14VtSnk/mokhxnawiwUvsZmsX5u+rgKamprGMDoA5sKhRCLxpDowSpsJ8vpCj2AUPzg4uIiNfKIyNMkH6Z4hF3k+RgTYz6vVAEiKq2bsniZIC0nTtvMVMwBzoBT9tKkTHp8Ak1V8dTrOE+NgJs7VATESTH5WnVAgfHUqlXK6oHpJEI1G9zEZH/Du16leqHyS0UXBNKmeOMf5NvyislJPB8RAFz4g8IuwofLy8k319fUP1EEouw7L7mC3kUTO1nn3sb02MTFxFpsz87FfJuaH4pu5fF+reDz+DEfxkI44Q0ScSbyOpDGe1RqMBN08o+ha0L0JdeKi/6msrGwj98uZMeon1AGaSj+elr9LwK9IkO33n8cN7Hl2vp1N3PcYbUXOBbDz9bwV1/wCmXoS3+B128OPD/l2LLg8l9APXVlZKZfzfDY7ehlQv0PPQDez6zW5JJdYOXdAwHK2dGIv7GH4YtHJIvEOvvunLCHPPzl3QOLKTkl0hPbKaDUvlTU988xtwfMqQBPQ3m/4mf0yBVlDCSr/CRW0CipAMnGzb9XU1NSRvIX7kSgo++Pg9B8wltxxbHKPZgAAAABJRU5ErkJggg==&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%;">
</div>
<div class="cartNotFree" id="j_quickCheckout">
<h5>Quick Checkout</h5>
<div id="payment-request-button"></div>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/checkout.js.下載" data-version-4="" log-level="warn"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/client.min.js.下載"></script>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/paypal-checkout.min.js.下載"></script>
<div class="paypal-wr">
<div id="paypal-button"></div>
<div id="paypal-details" style="display:none">
<strong>Using PayPal Account:</strong>
<br>
<span id="paypal-name"></span>
(
<span id="paypal-email"></span>
)
<br>
<a href="javascript://" id="cancel-paypal-btn" onclick="Purchase.cancelPaypal()">Change</a>
</div>
</div>

<h5>or Pay by Credit Card</h5>
<div class="creditCardInput">
<div id="j_cc_form">
<div class="checkoutFull">
<label>Card Info</label>
<div class="card-element" id="card-element"></div>
<div id="card-errors"></div>
</div>
</div>
</div>
</div>
<div class="le_cart-errors userErrors"></div>
<div class="le_cart-errors purchaseErrors"></div>
<h5>Confirm</h5>
<div class="cart_lastconfirm">
<label>Total Today</label>
<div id="j_cartTotal">$0.00</div>
</div>
<div class="submitWr">
<button class="j_submitButton danger" onclick="return Cart.submitForm()">
Complete Checkout
</button>
</div>
<div class="payment-details">
<img class="payment-cards" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/payment-c898aa81b99b5cce157d57bcae74366490239d5a645551972ca1566e1d035bbc.png" alt="Payment">
<p>
Payments and credit card details are securely managed and protected by Learn Enough's payment processor, Stripe. More information on their site:
<br>
<a target="_blank" class="stripeLogo" href="https://www.stripe.com/"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/stripe-692a974689bf1d99f911348cbe184e3668a06f3223c515033b827cfc9f7b7b60.png" alt="Stripe"></a>
</p>
</div>
</form>

</div>
</div>
</div>
<div class="le_sidemenu cart_sidemenu">
<div class="checkout-close">
<a onclick="$(&#39;.le_sidemenu&#39;).removeClass(&#39;open&#39;);$(&#39;.le_sidemenu-bg&#39;).removeClass(&#39;open&#39;);" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a></div>
<div class="le_cart-full page-form" id="j_cart-contain">
<h5>CART</h5>
<div id="j_cart"><div class="j_leCart">
<div class="cart-items">
</div>
<h5>Total</h5>
<div>
<table class="subscription-total">
<tbody><tr>
<td>
<label>Total Today</label>
</td>
<td id="j_totalCartToday">$0.00</td>
</tr>
</tbody></table>
</div>
<script>
  (function() {
    $(function() {
      return Cart.init({
        availableBundles: [
          {
            "id": 11,
            "name": "Developer Fundamentals",
            "code": "developer_fundamentals",
            "price_in_dollars": 19,
            "book_ids": [164, 183, 191]
          }, {
            "id": 14,
            "name": "Application Development",
            "code": "application_development",
            "price_in_dollars": 29,
            "book_ids": [319, 216, 232]
          }, {
            "id": 10,
            "name": "All Access",
            "code": "all_access",
            "price_in_dollars": 49,
            "book_ids": [164, 183, 191, 234, 268, 301, 305, 216, 232, 319]
          }, {
            "id": 12,
            "name": "Web Basics",
            "code": "web_basics",
            "price_in_dollars": 19,
            "book_ids": [234, 268]
          }, {
            "id": 13,
            "name": "Beginning Development",
            "code": "beginning_development",
            "price_in_dollars": 19,
            "book_ids": [301, 305]
          }, {
            "id": 9,
            "name": "Learn Enough Action Cable to Be Dangerous",
            "code": "learn_enough_action_cable",
            "price_in_dollars": 9,
            "book_ids": [232]
          }, {
            "id": 8,
            "name": "Ruby on Rails Tutorial (Rails 5)",
            "code": "ruby_on_rails_tutorial_4th_edition",
            "price_in_dollars": 29,
            "book_ids": [216]
          }, {
            "id": 1,
            "name": "Learn Enough Command Line to Be Dangerous",
            "code": "learn_enough_command_line",
            "price_in_dollars": 9,
            "book_ids": [164]
          }, {
            "id": 2,
            "name": "Learn Enough Text Editor to Be Dangerous",
            "code": "learn_enough_text_editor",
            "price_in_dollars": 9,
            "book_ids": [183]
          }, {
            "id": 3,
            "name": "Learn Enough Git to Be Dangerous",
            "code": "learn_enough_git",
            "price_in_dollars": 9,
            "book_ids": [191]
          }, {
            "id": 4,
            "name": "Learn Enough HTML to Be Dangerous",
            "code": "learn_enough_html",
            "price_in_dollars": 9,
            "book_ids": [234]
          }, {
            "id": 5,
            "name": "Learn Enough CSS \u0026 Layout to Be Dangerous",
            "code": "learn_enough_css",
            "price_in_dollars": 15,
            "book_ids": [268]
          }, {
            "id": 6,
            "name": "Learn Enough JavaScript to Be Dangerous",
            "code": "learn_enough_javascript",
            "price_in_dollars": 15,
            "book_ids": [301]
          }, {
            "id": 7,
            "name": "Learn Enough Ruby to Be Dangerous",
            "code": "learn_enough_ruby",
            "price_in_dollars": 15,
            "book_ids": [305]
          }, {
            "id": 15,
            "name": "Ruby on Rails Tutorial (Rails 6)",
            "code": "ruby_on_rails_tutorial_6th_edition",
            "price_in_dollars": 29,
            "book_ids": [319]
          }
        ],
        stripeKey: "pk_live_Xn1p0BfxqKxkAxtEr03P7wmd",
        useCardOnFile: false,
        existingPaymentLabel: "",
        existingPaymentText: "",
        discount: false,
        data: {
          "courseBundles": [],
          "bookOptions": [],
          "subscriptionDiscount": null
        },
        braintreeToken: "eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiJhYTEwY2UzMWU3NjliZmUxY2Q1NDZhOGMxM2UyODI2ZjAwZDM3ZWI5MzQ0YTNmZDZkZDMzZTY5NGI3MmQwODQ3fGNyZWF0ZWRfYXQ9MjAxOS0wOS0wOVQwNzoyNDowMy42MTk1NzQ1MDIrMDAwMFx1MDAyNm1lcmNoYW50X2lkPTNmZmQzemJ3YnZobmNkMm1cdTAwMjZwdWJsaWNfa2V5PTR6eTRobmI2dDI3OHg2ZzUiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzLzNmZmQzemJ3YnZobmNkMm0vY2xpZW50X2FwaS92MS9jb25maWd1cmF0aW9uIiwiZ3JhcGhRTCI6eyJ1cmwiOiJodHRwczovL3BheW1lbnRzLmJyYWludHJlZS1hcGkuY29tL2dyYXBocWwiLCJkYXRlIjoiMjAxOC0wNS0wOCJ9LCJjaGFsbGVuZ2VzIjpbXSwiZW52aXJvbm1lbnQiOiJwcm9kdWN0aW9uIiwiY2xpZW50QXBpVXJsIjoiaHR0cHM6Ly9hcGkuYnJhaW50cmVlZ2F0ZXdheS5jb206NDQzL21lcmNoYW50cy8zZmZkM3pid2J2aG5jZDJtL2NsaWVudF9hcGkiLCJhc3NldHNVcmwiOiJodHRwczovL2Fzc2V0cy5icmFpbnRyZWVnYXRld2F5LmNvbSIsImF1dGhVcmwiOiJodHRwczovL2F1dGgudmVubW8uY29tIiwiYW5hbHl0aWNzIjp7InVybCI6Imh0dHBzOi8vY2xpZW50LWFuYWx5dGljcy5icmFpbnRyZWVnYXRld2F5LmNvbS8zZmZkM3pid2J2aG5jZDJtIn0sInRocmVlRFNlY3VyZUVuYWJsZWQiOmZhbHNlLCJwYXlwYWxFbmFibGVkIjp0cnVlLCJwYXlwYWwiOnsiZGlzcGxheU5hbWUiOiJMZWFybiBFbm91Z2giLCJjbGllbnRJZCI6IkFZRkJVbHYzR1BaSlE1emlvUlZrcnlYTjB5cW9jc0VleFRfOW9UcVFJQ29hbG51UmZRdjI2VFd0WlNIeFhSd2IxMFJCdGMtb3ptcEFLVVVXIiwicHJpdmFjeVVybCI6Imh0dHBzOi8vd3d3LmxlYXJuZW5vdWdoLmNvbS9sZWdhbCIsInVzZXJBZ3JlZW1lbnRVcmwiOiJodHRwczovL3d3dy5sZWFybmVub3VnaC5jb20vbGVnYWwiLCJiYXNlVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhc3NldHNVcmwiOiJodHRwczovL2NoZWNrb3V0LnBheXBhbC5jb20iLCJkaXJlY3RCYXNlVXJsIjpudWxsLCJhbGxvd0h0dHAiOmZhbHNlLCJlbnZpcm9ubWVudE5vTmV0d29yayI6ZmFsc2UsImVudmlyb25tZW50IjoibGl2ZSIsInVudmV0dGVkTWVyY2hhbnQiOmZhbHNlLCJicmFpbnRyZWVDbGllbnRJZCI6IkFSS3JZUkRoM0FHWER6VzdzT18zYlNrcS1VMUM3SEdfdVdOQy16NTdMallTRE5VT1NhT3RJYTlxNlZwVyIsImJpbGxpbmdBZ3JlZW1lbnRzRW5hYmxlZCI6dHJ1ZSwibWVyY2hhbnRBY2NvdW50SWQiOiJMZWFybkVub3VnaF9pbnN0YW50IiwiY3VycmVuY3lJc29Db2RlIjoiVVNEIn0sIm1lcmNoYW50SWQiOiIzZmZkM3pid2J2aG5jZDJtIiwidmVubW8iOiJvZmYifQ==",
        loggedIn: false,
        hasSubscription: false,
        currentMonthlyCost: 0,
        currentCourseBundleIds: [],
        authenticity_token: "ZzHi0j7sZ5/WuPAsNSmiemD68e+48j4sxJc6d9OuZxnFS8QP+UrUjHuOgMAM6+MXnHobmBhdz3EF8J3h08SR1Q=="
      });
    });
  
  }).call(this);
</script>
</div>
</div>
<div class="landing-pricing_cta">
<a onclick="Cart.sidebarCheckout()" href="javascript://"><button class="attention">Checkout Now</button>
</a></div>
</div>
<div class="le_cart-empty open page-form" id="j_cart-empty">
<img class="le_cart-empty_icon" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/cart_empty-2f8b210857d00f1f864d5660082133b24f9205d22db1ffc064c706272612b04d.png" alt="Cart empty">
<h3>Your Cart is Empty</h3>
<div class="le_cart-empty_cta">
<a href="https://www.learnenough.com/courses"><button class="btn-small attention">
See the Tutorials
</button>
</a></div>
</div>
</div>
<div class="le_sidemenu-bg" onclick="$(&#39;.le_sidemenu&#39;).removeClass(&#39;open&#39;);$(&#39;.le_sidemenu-bg&#39;).removeClass(&#39;open&#39;);"></div>
<div class="le_footermenu">
<div class="checkout-close">
<a onclick="$(&#39;.le_footermenu&#39;).removeClass(&#39;open&#39;)" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a></div>
<div class="le_footermenu_content le_footermenu_change">
<div class="le_footermenu_copy">
<div class="le_footermenu_cost-current">
<label>Current $ /mo</label>
<div class="j_currentMonthlyCost">
$30
</div>
</div>
<div class="le_footermenu_cost-new">
<label>New $ /mo</label>
<div class="j_newMonthlyCost">
$300
</div>
</div>
<div class="le_footermenu_cost-today j_costToday">
<label>Change</label>
<div class="j_newTodayCost">
$300
</div>
</div>
</div>
<div class="le_footermenu_cta">
<a onclick="Cart.footerCheckout()" href="javascript://"><button class="small attention btn-small">
<span id="j_footerCheckoutBtn">
Checkout Now / Update Subscription
</span>
</button>
</a><a onclick="Cart.cancel()" href="javascript://"><button class="small danger btn-small">
<span id="j_footerCheckoutBtn">
Cancel
</span>
</button>
</a></div>
</div>
<div class="le_footermenu_content le_footermenu_confirm">
<div class="le_footermenu_copy">
<div class="le_footermenu_cost-new">
<label>Just to confirm, new $ /mo</label>
<div class="j_newMonthlyCost">$XY</div>
</div>
<div class="le_footermenu_cost-new j_costToday">
<label class="j_costTodayLabel">Cost Today</label>
<div class="j_newTodayCost">$XY</div>
</div>
<div class="le_footermenu_cost-new j_existingPayment">
<label class="j_existingPaymentLabel">On card ending</label>
<div class="j_existingPaymentText">1234</div>
</div>
</div>
<div class="le_footermenu_cta">
<a onclick="Cart.footerConfirmChange()" href="javascript://"><button class="small menu_warning-btn btn-small">
<span id="j_footerConfirmChangeBtn">
Confirm Change
</span>
</button>
</a><a onclick="Cart.cancel()" href="javascript://"><button class="small menu_warning-btn danger btn-small">
<span id="j_footerCheckoutBtn">
Cancel
</span>
</button>
</a></div>
</div>
</div>

<div class="site-header">
<div class="side-menu-toggle">
<a class="side-menu-close" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a><a class="side-menu-open" href="javascript://"><svg class="svg-inline--fa fa-bars fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg><!-- <i class="fas fa-bars"></i> -->
</a></div>
<nav class="nav">
<a class="logoLink artLogo" href="https://www.learnenough.com/"><div class="svg le-logo"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 801 1041" style="enable-background:new 0 0 801 1041;" xml:space="preserve">
<path d="M569.9,478.6l3.5-3.5v-41.7l-1-2.5l-24.3-24.3l-2.5-1H410.5l-3.5,3.5v358.6l1,2.5l24.3,24.3l1.9,0.5l0.5,0.5h135.1l3.5-3.5v-41.7l-1-2.5l-24.3-24.3l-2.5-1H488v-89.9h77l3.5-3.5v-41.7l-1-2.5l-24.3-24.3l-2.5-1H488v-81H569.9z M544.2,412.6l17.3,17.3H436.2L419,412.6H544.2z M414,417.6l17.3,17.3v348.7L414,766.3V417.6z M544.2,729.5l17.3,17.3H488v-17.3H544.2z M539.2,566.6l17.3,17.3H488v-17.3H539.2z M484.5,471.6l-3.5,3.5v112.3l3.5,3.5h77v34.7h-77l-3.5,3.5v121.2l3.5,3.5h81.9v34.7H438.3V436.9h128.1v34.7H484.5z"></path>
<path d="M401.5,747.8l-24.3-24.3l-2.5-1h-55.7V433.4l-0.2-0.2l-0.8-2.3l-24.3-24.3l-2.5-1h-49.7l-3.5,3.5v358.6l1,2.5l24.3,24.3l1.9,0.5l0.6,0.6H399l3.5-3.5v-41.7L401.5,747.8z M373.3,729.5l17.3,17.3h-71.5v-17.3H373.3z M307.1,429.9h-39.8l-17.3-17.3h39.8L307.1,429.9z M245.1,417.6l17.3,17.3v348.7l-17.3-17.3V417.6z M395.5,788.5H269.4V436.9h42.7v313.4l3.5,3.5h79.9V788.5z"></path>
<path d="M691.8,600.3c0-77.2-30-149.7-84.6-204.3c-47.3-47.3-108.2-76.2-173.9-83c0.4-22.2,0.6-35.3,0.6-35.7l-2.6-3.8c-1.8-0.6-3.5-2.2-5.1-4.2l5.1,0c1.8,0.1,22.1,0.8,33.2-11.2c5.5-6,8.5-14,8.5-23.4l0.1-13.3l-3.5-3.5l-16-0.1l-3.5,3.5l-0.1,13.3c0,3.3-0.7,5.5-2.4,7.3c-3.7,4-12.4,4.9-15.4,4.9l-11.9,0c1.4-13.4,3.7-39.7,3.9-72.2c0.1-34.4-5.7-68.9-6.6-73.7c4.9-5.8,7.6-13.5,7.6-21.6C425.2,62,413,47.9,398,47.8c0,0-0.1,0-0.1,0c-15,0-27.2,14-27.3,31.2c0,8.1,2.6,15.8,7.5,21.7c-0.9,4.8-7,39.3-7.2,73.6c-0.1,32.5,2,58.9,3.3,72.3l-11.1,0c-1.8-0.1-22.1-0.8-33.2,11.2c-5.5,6-8.5,14-8.5,23.4l-0.1,13.3l3.5,3.5l16.2,0.1l3.5-3.5l0.1-13.3c0-3.3,0.7-5.5,2.4-7.3c3.7-4,12.3-4.9,15.3-4.9l5.9,0c-1.6,1.9-3.4,3.5-5.2,4.1l-2.6,3.8c0,0.5,0.2,14.2,0.6,37.4c-61.2,8.9-117.8,37.1-162.3,81.6C144.1,450.6,114,523.1,114,600.3s30,149.7,84.6,204.3c49,49,112.4,78.2,180.7,83.7c6.4,96.9,11.7,103.7,14.1,106.6l3.3,2.6l2.9-2.6c2.4-2.9,7.8-9.7,14.3-105.9c73-2.7,141.3-32.4,193.2-84.4C661.8,750,691.8,677.5,691.8,600.3z M377.6,79.1c0.1-13.4,9.1-24.2,20.3-24.2c0,0,0,0,0.1,0c7.7,0,14.5,5.3,17.8,13l-10.6-4.3c1.1,1.6,2.1,3.4,2.8,5.5l9.4,3.8c0.5,2,0.7,4.2,0.7,6.4c0,0.2,0,0.5,0,0.7l-8.4-3.4c0.1,0.8,0.1,1.7,0.1,2.5c0,0.6,0,1.2-0.1,1.8l8,3.2c-0.4,2.1-1,4.2-1.8,6.1l-7.3-2.9c-0.4,1.3-0.9,2.6-1.4,3.7l6.8,2.8c-0.6,1-1.3,1.9-2,2.8c-0.7,0.8-1.5,1.6-2.3,2.3l-0.8-0.3l-5.3-2.2c-1.1,1.2-2.3,2.1-3.6,2.9l5.7,2.3c-2.5,1.2-5.1,1.9-7.9,1.9c-5.3,0-10.3-2.5-14.1-7C379.8,91.9,377.6,85.7,377.6,79.1z M377.9,174.4c0.1-28.2,4.4-57,6.3-68.1c4.1,2.7,8.7,4.2,13.5,4.2c0,0,0.1,0,0.1,0c4.8,0,9.4-1.4,13.5-4.1c0.2,1.3,0.5,2.9,0.7,4.7l-2.1-0.9l-2.9,3.1l5.7,2.3c0.3,2.2,0.6,4.6,1,7.3l-17.4-7.1c0.2,1.4,0.4,3,0.6,4.6l17.3,7c0.3,2.3,0.5,4.7,0.8,7.2l-17.2-7c0.2,1.5,0.3,3,0.5,4.5l17.2,7c0.2,2.3,0.4,4.7,0.6,7.1l-19.6-8c-1.7,0.1-3.7-0.4-3.7-0.4s0.8,1.7,1.9,4l21.7,8.8c0.2,2.3,0.3,4.7,0.4,7l-18.3-7.4c0.9,2.1,1.5,3.9,1.7,5l16.8,6.8c0.1,2.3,0.1,4.6,0.2,6.9l-16.6-6.7c0.1,1.5,0.1,2.9,0.1,4.4l16.5,6.7c0,0.4,0,0.8,0,1.2c0,1.9,0,3.8,0,5.7l-16.7-6.8c-1.1,1.7-5.8-0.2-5.8-0.2s0.4,1,0.9,2.5l21.6,8.7c0,2.3-0.1,4.6-0.2,6.8l-18.6-7.5c0.6,1.8,1.2,3.6,1.6,5l16.9,6.8c-0.1,2.3-0.2,4.6-0.3,6.8l-16.2-6.6c0,1.5-0.1,2.9-0.2,4.3l16.2,6.6c-0.1,2.3-0.2,4.5-0.4,6.7l-16.1-6.5c0,0.7-0.1,1.4-0.1,2.1c0,0.9-0.4,1.4-0.8,1.8l16.8,6.8c-0.1,2.3-0.3,4.5-0.5,6.7l-20-8.1c0.3,1.4,0.7,3.1,1.1,4.7l18.6,7.6c-0.2,2.3-0.4,4.6-0.6,6.6l-16.6-6.8c0.3,1.8,0.4,3.3,0.4,4.1c0,0.1,0,0.2,0,0.3l15.9,6.5c-0.2,2.5-0.5,4.7-0.7,6.6l-15.9-6.4c-0.1,1.5-0.3,2.9-0.4,4.2l8,3.2l-23.7-0.1C380,233.6,377.8,207,377.9,174.4z M362.3,262.1c-1.4,0-14,0.2-20.4,7.1c-2.8,3-4.2,7-4.2,12l0,9.8l-9.2,0l0-9.8c0-7.5,2.3-14,6.6-18.6l0,0c9.1-9.8,27.6-9,27.8-9l69.2,0.2c1.4,0,14.1-0.2,20.6-7.1c2.8-3,4.2-7,4.2-12l0-9.8l9,0l0,9.8c0,7.5-2.3,14-6.6,18.6c-9.1,9.8-27.6,9-27.8,9L362.3,262.1z M407.6,348.5l1.1,0.4h-1.1L407.6,348.5z M403.6,348.9h-5.3l-3.5-79.8l17.2,0.1L403.6,348.9z M408.1,344.3l0.7-6.6l15.9,6.4c0,1.6-0.1,3.1-0.1,4.7h-5.2L408.1,344.3z M409.2,333.6l0.7-6.6l15,6.1c0,2.2-0.1,4.5-0.1,6.8L409.2,333.6z M410.3,322.9l0.7-6.6l14.1,5.7c0,2.2-0.1,4.5-0.1,6.8L410.3,322.9z M411.5,312.2l0.7-6.6l13.1,5.3c0,2.2-0.1,4.5-0.1,6.8L411.5,312.2z M412.6,301.4l0.7-6.6l12.2,4.9c0,2.1-0.1,4.4-0.1,6.8L412.6,301.4z M413.7,290.7l0.7-6.6l11.3,4.6c0,2-0.1,4.3-0.1,6.8L413.7,290.7z M414.9,280l0.7-6.6l5.5,2.2c1.5,1.6,3.1,3,4.8,4c0,1.2,0,2.8-0.1,4.8L414.9,280z M416,269.3L416,269.3l0.3,0c0,0.1,0.1,0.1,0.1,0.2L416,269.3z M390.3,348.9h-20.7c-0.7-36.5-1.1-61.7-1.2-69.5c3.9-2.4,7.2-6.4,9.6-10.3l8.8,0L390.3,348.9z M392.6,951.2c-2-18-4.2-44.3-6.4-82.7c-0.3-5.2-0.6-10.6-0.9-16.2h7.4l2.5,115.9L392.6,951.2z M400.7,959.3l-0.1-20.9l1,0.2C401.4,940.3,400.8,957.7,400.7,959.3z M401.6,934.5l-1-0.4v-6.9l1.7,0.7C402.1,930.2,401.8,932.4,401.6,934.5z M402.7,923.8l-2.2-0.9v-6.9l2.8,1.1C403.2,919.4,403,921.6,402.7,923.8z M403.8,913l-3.2-1.3l0-6.9l3.8,1.6C404.2,908.7,404,910.9,403.8,913z M404.8,902.3l-4.2-1.7v-6.9l4.8,1.9C405.2,897.8,405,900.1,404.8,902.3z M405.7,891.4l-5.1-2.1l0-6.9l5.6,2.3C406,887,405.9,889.2,405.7,891.4z M406.5,880.6l-5.9-2.4l0-6.9l6.4,2.6C406.8,876.1,406.6,878.4,406.5,880.6z M407.3,868.6c0,0.4,0,0.7-0.1,1.1l-6.6-2.7l0-6.9l7,2.8C407.5,864.9,407.4,866.8,407.3,868.6z M407.9,858.8l-7.3-2.9l0-3.5h7.6C408.1,854.5,408,856.6,407.9,858.8z M414.5,880.9c0.6-8.8,1.2-18.3,1.7-28.6h27v-7h-91v7h25c0.6,10,1.1,19.2,1.6,27.8c-66-5.6-127.2-33.9-174.6-81.2C151.2,745.9,122,675.3,122,600.3s29.2-145.6,82.3-198.6c43.1-43.1,97.6-70.4,156.8-79.2c0.1,7.9,0.3,16.8,0.5,26.4h-16.1v7h109.8v-7h-22.7c0.2-10.2,0.4-19.6,0.5-27.9c63.6,6.8,122.6,34.8,168.4,80.7c53.1,53.1,82.3,123.6,82.3,198.6s-29.2,145.6-82.3,198.6C551.2,849.2,485.2,878.1,414.5,880.9z"></path>
</svg>
</div>
<span>LEARN ENOUGH</span>
</a><ul class="headerMenu">
<li><a href="http://www.learnenough.com/courses">Courses</a></li>
<li><a href="http://www.learnenough.com/pricing">Pricing</a></li>
<li><a href="http://www.learnenough.com/ruby-on-rails-6th-edition">The Rails Tutorial</a></li>
<li><a href="http://www.learnenough.com/for-teams">For Teams</a></li>
<li><a href="http://www.learnenough.com/login">Log In</a></li>
<li class="header-cart">
<a onclick="Cart.openCart()" class="header-cart_link" href="javascript://"><svg class="svg-inline--fa fa-shopping-cart fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shopping-cart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M528.12 301.319l47.273-208C578.806 78.301 567.391 64 551.99 64H159.208l-9.166-44.81C147.758 8.021 137.93 0 126.529 0H24C10.745 0 0 10.745 0 24v16c0 13.255 10.745 24 24 24h69.883l70.248 343.435C147.325 417.1 136 435.222 136 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-15.674-6.447-29.835-16.824-40h209.647C430.447 426.165 424 440.326 424 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-22.172-12.888-41.332-31.579-50.405l5.517-24.276c3.413-15.018-8.002-29.319-23.403-29.319H218.117l-6.545-32h293.145c11.206 0 20.92-7.754 23.403-18.681z"></path></svg><!-- <i class="fas fa-shopping-cart"></i> -->
<span class="header-cart_label">Cart</span>
</a></li>
</ul>
<div class="side-menu">
<div class="le-side-buy">
<header class="free">&nbsp;</header>
<div class="articleMenu">
<div class="bookMenuActions j_downloadLinks">
<a onclick="$(&#39;#bookMenuEmail&#39;).toggleClass(&#39;open&#39;); return false" class="buttonStyle greyButton iEmailUpdate" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts"><svg class="svg-inline--fa fa-heart fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"></path></svg><!-- <i class="fas fa-heart"></i> -->
Mailing List
</a><a href="http://www.learnenough.com/ruby-on-rails-4th-edition"><svg class="svg-inline--fa fa-arrow-circle-right fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-circle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></svg><!-- <i class="fas fa-arrow-circle-right"></i> -->
Tutorial Features
</a><a href="http://www.learnenough.com/ruby-on-rails-4th-edition#landing-pricing"><svg class="svg-inline--fa fa-book-open fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book-open" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z"></path></svg><!-- <i class="fas fa-book-open"></i> -->
Subscribe to Course
</a><a href="http://www.learnenough.com/application-development"><svg class="svg-inline--fa fa-window-restore fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="window-restore" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M512 48v288c0 26.5-21.5 48-48 48h-48V176c0-44.1-35.9-80-80-80H128V48c0-26.5 21.5-48 48-48h288c26.5 0 48 21.5 48 48zM384 176v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48h288c26.5 0 48 21.5 48 48zm-68 28c0-6.6-5.4-12-12-12H76c-6.6 0-12 5.4-12 12v52h252v-52z"></path></svg><!-- <i class="fas fa-window-restore"></i> -->
Application Development
Bundle
</a><a href="http://www.learnenough.com/checkout/tutorial/ruby_on_rails_tutorial_4th_edition"><svg class="svg-inline--fa fa-plus-square fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="plus-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></svg><!-- <i class="fas fa-plus-square"></i> -->
Books &amp; Offline Videos
</a></div>
<div class="bookMenu-email" id="bookMenuEmail">
Follow author to receive email updates about new content
<div class="j_followBookForm"><div id="j_bookFollowForm">
<form action="http://www.learnenough.com/books/216/follow" accept-charset="UTF-8" data-remote="true" method="get"><input name="utf8" type="hidden" value="✓">
<!-- %input{name: "name", type: "text", placeholder: "YOUR NAME"} -->
<input name="email" placeholder="Your email address" type="text">
<input class="greyButton optClick_follow" data-disable-with="Submitting..." type="submit" value="Follow Author">
</form>

<p id="j_bookFollowNotice" style="display:none"></p>
</div>
</div>
</div>
</div>
</div>

<div class="">
</div>
<ul class="">
<li class="courseCh">
<a id="chapter-1919" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning">1. From zero to deploy
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-58" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-introduction"><span class="courseSec-num">1.1</span>
Introduction
</a><ul class="courseSub">
<li>
<a id="sub_section-78" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-prerequisites"><span class="courseSec-num">1.1.1</span>
Prerequisites
</a></li>
<li>
<a id="sub_section-79" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-conventions"><span class="courseSec-num">1.1.2</span>
Conventions used in this book
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-59" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-up_and_running"><span class="courseSec-num">1.2</span>
Up and running
</a><ul class="courseSub">
<li>
<a id="sub_section-80" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-development_environment"><span class="courseSec-num">1.2.1</span>
Development environment
</a></li>
<li>
<a id="sub_section-81" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-installing_rails"><span class="courseSec-num">1.2.2</span>
Installing Rails
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-60" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-the_hello_application"><span class="courseSec-num">1.3</span>
The first application
</a><ul class="courseSub">
<li>
<a id="sub_section-82" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-bundler"><span class="courseSec-num">1.3.1</span>
Bundler
</a></li>
<li>
<a id="sub_section-83" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-rails_server"><span class="courseSec-num">1.3.2</span>
rails server
</a></li>
<li>
<a id="sub_section-84" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-mvc"><span class="courseSec-num">1.3.3</span>
Model-View-Controller (MVC)
</a></li>
<li>
<a id="sub_section-85" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-hello_world"><span class="courseSec-num">1.3.4</span>
Hello, world!
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-61" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-version_control"><span class="courseSec-num">1.4</span>
Version control with Git
</a><ul class="courseSub">
<li>
<a id="sub_section-86" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-git_setup"><span class="courseSec-num">1.4.1</span>
Installation and setup
</a></li>
<li>
<a id="sub_section-148" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-what_good_does_git_do_you"><span class="courseSec-num">1.4.2</span>
What good does Git do you?
</a></li>
<li>
<a id="sub_section-88" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-bitbucket"><span class="courseSec-num">1.4.3</span>
Bitbucket
</a></li>
<li>
<a id="sub_section-89" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-git_commands"><span class="courseSec-num">1.4.4</span>
Branch, edit, commit, merge
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-62" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-deploying"><span class="courseSec-num">1.5</span>
Deploying
</a><ul class="courseSub">
<li>
<a id="sub_section-90" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-heroku_setup"><span class="courseSec-num">1.5.1</span>
Heroku setup
</a></li>
<li>
<a id="sub_section-91" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-heroku_step_one"><span class="courseSec-num">1.5.2</span>
Heroku deployment, step one
</a></li>
<li>
<a id="sub_section-92" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-heroku_step_two"><span class="courseSec-num">1.5.3</span>
Heroku deployment, step two
</a></li>
<li>
<a id="sub_section-93" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-heroku_commands"><span class="courseSec-num">1.5.4</span>
Heroku commands
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-63" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-beginning_conclusion"><span class="courseSec-num">1.6</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-94" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-beginning_what_we_learned_in_this_chapter"><span class="courseSec-num">1.6.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-1922" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app">2. A toy app
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-69" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-planning_the_application"><span class="courseSec-num">2.1</span>
Planning the application
</a><ul class="courseSub">
<li>
<a id="sub_section-106" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-modeling_demo_users"><span class="courseSec-num">2.1.1</span>
A toy model for users
</a></li>
<li>
<a id="sub_section-107" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-modeling_demo_microposts"><span class="courseSec-num">2.1.2</span>
A toy model for microposts
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-70" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-demo_users_resource"><span class="courseSec-num">2.2</span>
The Users resource
</a><ul class="courseSub">
<li>
<a id="sub_section-108" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-a_user_tour"><span class="courseSec-num">2.2.1</span>
A user tour
</a></li>
<li>
<a id="sub_section-109" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-mvc_in_action"><span class="courseSec-num">2.2.2</span>
MVC in action
</a></li>
<li>
<a id="sub_section-110" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-weaknesses_of_this_users_resource"><span class="courseSec-num">2.2.3</span>
Weaknesses of this Users resource
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-71" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-microposts_resource"><span class="courseSec-num">2.3</span>
The Microposts resource
</a><ul class="courseSub">
<li>
<a id="sub_section-111" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-a_micropost_microtour"><span class="courseSec-num">2.3.1</span>
A micropost microtour
</a></li>
<li>
<a id="sub_section-112" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-putting_the_micro_in_microposts"><span class="courseSec-num">2.3.2</span>
Putting the micro in microposts
</a></li>
<li>
<a id="sub_section-113" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-demo_user_has_many_microposts"><span class="courseSec-num">2.3.3</span>
A user hasmany microposts
</a></li>
<li>
<a id="sub_section-114" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-inheritance_hierarchies"><span class="courseSec-num">2.3.4</span>
Inheritance hierarchies
</a></li>
<li>
<a id="sub_section-115" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-deploying_the_toy_app"><span class="courseSec-num">2.3.5</span>
Deploying the toy app
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-72" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-toy_app_conclusion"><span class="courseSec-num">2.4</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-116" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-toy_app_what_we_learned_in_this_chapter"><span class="courseSec-num">2.4.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2024" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages">3. Mostly static pages
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-188" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-sample_app_setup"><span class="courseSec-num">3.1</span>
Sample app setup
</a></li>
<li class="courseSec">
<a id="chapter_section-189" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-static_pages"><span class="courseSec-num">3.2</span>
Static pages
</a><ul class="courseSub">
<li>
<a id="sub_section-825" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-generated_static_pages"><span class="courseSec-num">3.2.1</span>
Generated static pages
</a></li>
<li>
<a id="sub_section-826" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-custom_static_pages"><span class="courseSec-num">3.2.2</span>
Custom static pages
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-190" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-getting_started_with_testing"><span class="courseSec-num">3.3</span>
Getting started with testing
</a><ul class="courseSub">
<li>
<a id="sub_section-827" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-our_first_test"><span class="courseSec-num">3.3.1</span>
Our first test
</a></li>
<li>
<a id="sub_section-828" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-red"><span class="courseSec-num">3.3.2</span>
Red
</a></li>
<li>
<a id="sub_section-829" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-green"><span class="courseSec-num">3.3.3</span>
Green
</a></li>
<li>
<a id="sub_section-830" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-refactor"><span class="courseSec-num">3.3.4</span>
Refactor
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-191" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-slightly_dynamic_pages"><span class="courseSec-num">3.4</span>
Slightly dynamic pages
</a><ul class="courseSub">
<li>
<a id="sub_section-831" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-testing_titles"><span class="courseSec-num">3.4.1</span>
Testing titles (Red)
</a></li>
<li>
<a id="sub_section-832" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-adding_page_titles"><span class="courseSec-num">3.4.2</span>
Adding page titles (Green)
</a></li>
<li>
<a id="sub_section-833" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-layouts_and_embedded_ruby"><span class="courseSec-num">3.4.3</span>
Layouts and embedded Ruby (Refactor)
</a></li>
<li>
<a id="sub_section-834" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-setting_the_root_route"><span class="courseSec-num">3.4.4</span>
Setting the root route
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-192" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-static_pages_conclusion"><span class="courseSec-num">3.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-835" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-static_pages_what_we_learned_in_this_chapter"><span class="courseSec-num">3.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-193" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-advanced_testing_setup"><span class="courseSec-num">3.6</span>
Advanced testing setup
</a><ul class="courseSub">
<li>
<a id="sub_section-836" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-minitest_reporters"><span class="courseSec-num">3.6.1</span>
minitest reporters
</a></li>
<li>
<a id="sub_section-837" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-guard"><span class="courseSec-num">3.6.2</span>
Automated tests with Guard
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-1943" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby">4. Rails-flavored Ruby
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-81" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-motivation"><span class="courseSec-num">4.1</span>
Motivation
</a><ul class="courseSub">
<li>
<a id="sub_section-146" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-built_in_helpers"><span class="courseSec-num">4.1.1</span>
Built-in helpers
</a></li>
<li>
<a id="sub_section-147" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-custom_helpers"><span class="courseSec-num">4.1.2</span>
Custom helpers
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-82" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-strings_and_methods"><span class="courseSec-num">4.2</span>
Strings and methods
</a><ul class="courseSub">
<li>
<a id="sub_section-131" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-comments"><span class="courseSec-num">4.2.1</span>
Comments
</a></li>
<li>
<a id="sub_section-132" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-strings"><span class="courseSec-num">4.2.2</span>
Strings
</a></li>
<li>
<a id="sub_section-133" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-objects_and_message_passing"><span class="courseSec-num">4.2.3</span>
Objects and message passing
</a></li>
<li>
<a id="sub_section-134" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-method_definitions"><span class="courseSec-num">4.2.4</span>
Method definitions
</a></li>
<li>
<a id="sub_section-135" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-back_to_the_title_helper"><span class="courseSec-num">4.2.5</span>
Back to the title helper
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-83" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-other_data_structures"><span class="courseSec-num">4.3</span>
Other data structures
</a><ul class="courseSub">
<li>
<a id="sub_section-136" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-arrays_and_ranges"><span class="courseSec-num">4.3.1</span>
Arrays and ranges
</a></li>
<li>
<a id="sub_section-137" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-blocks"><span class="courseSec-num">4.3.2</span>
Blocks
</a></li>
<li>
<a id="sub_section-138" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-hashes_and_symbols"><span class="courseSec-num">4.3.3</span>
Hashes and symbols
</a></li>
<li>
<a id="sub_section-139" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-css_revisited"><span class="courseSec-num">4.3.4</span>
CSS revisited
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-84" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-ruby_classes"><span class="courseSec-num">4.4</span>
Ruby classes
</a><ul class="courseSub">
<li>
<a id="sub_section-140" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-constructors"><span class="courseSec-num">4.4.1</span>
Constructors
</a></li>
<li>
<a id="sub_section-141" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-a_class_of_our_own"><span class="courseSec-num">4.4.2</span>
Class inheritance
</a></li>
<li>
<a id="sub_section-142" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-modifying_built_in_classes"><span class="courseSec-num">4.4.3</span>
Modifying built-in classes
</a></li>
<li>
<a id="sub_section-143" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-a_controller_class"><span class="courseSec-num">4.4.4</span>
A controller class
</a></li>
<li>
<a id="sub_section-144" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-a_user_class"><span class="courseSec-num">4.4.5</span>
A user class
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-85" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-conclusion"><span class="courseSec-num">4.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-145" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-rails_flavored_ruby_what_we_learned_in_this_chapter"><span class="courseSec-num">4.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-1976" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout">5. Filling in the layout
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-99" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-structure"><span class="courseSec-num">5.1</span>
Adding some structure
</a><ul class="courseSub">
<li>
<a id="sub_section-149" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-adding_to_the_layout"><span class="courseSec-num">5.1.1</span>
Site navigation
</a></li>
<li>
<a id="sub_section-150" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-custom_css"><span class="courseSec-num">5.1.2</span>
Bootstrap and custom CSS
</a></li>
<li>
<a id="sub_section-151" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-partials"><span class="courseSec-num">5.1.3</span>
Partials
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-100" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-sass_and_the_asset_pipeline"><span class="courseSec-num">5.2</span>
Sass and the asset pipeline
</a><ul class="courseSub">
<li>
<a id="sub_section-152" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-the_asset_pipeline"><span class="courseSec-num">5.2.1</span>
The asset pipeline
</a></li>
<li>
<a id="sub_section-153" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-sass"><span class="courseSec-num">5.2.2</span>
Syntactically awesome stylesheets
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-101" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-layout_links"><span class="courseSec-num">5.3</span>
Layout links
</a><ul class="courseSub">
<li>
<a id="sub_section-154" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-contact_page"><span class="courseSec-num">5.3.1</span>
Contact page
</a></li>
<li>
<a id="sub_section-155" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-rails_routes"><span class="courseSec-num">5.3.2</span>
Rails routes
</a></li>
<li>
<a id="sub_section-156" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-named_routes"><span class="courseSec-num">5.3.3</span>
Using named routes
</a></li>
<li>
<a id="sub_section-157" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-layout_link_tests"><span class="courseSec-num">5.3.4</span>
Layout link tests
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-102" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-user_signup"><span class="courseSec-num">5.4</span>
User signup: A first step
</a><ul class="courseSub">
<li>
<a id="sub_section-158" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-users_controller"><span class="courseSec-num">5.4.1</span>
Users controller
</a></li>
<li>
<a id="sub_section-159" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-signup_url"><span class="courseSec-num">5.4.2</span>
Signup URL
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-103" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-layout_conclusion"><span class="courseSec-num">5.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-160" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#sec-filling_in_the_layout_what_we_learned_in_this_chapter"><span class="courseSec-num">5.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-1977" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users">6. Modeling users
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-105" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-user_model"><span class="courseSec-num">6.1</span>
User model
</a><ul class="courseSub">
<li>
<a id="sub_section-161" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-database_migrations"><span class="courseSec-num">6.1.1</span>
Database migrations
</a></li>
<li>
<a id="sub_section-162" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-the_model_file"><span class="courseSec-num">6.1.2</span>
The model file
</a></li>
<li>
<a id="sub_section-163" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-creating_user_objects"><span class="courseSec-num">6.1.3</span>
Creating user objects
</a></li>
<li>
<a id="sub_section-164" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-finding_user_objects"><span class="courseSec-num">6.1.4</span>
Finding user objects
</a></li>
<li>
<a id="sub_section-165" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-updating_user_objects"><span class="courseSec-num">6.1.5</span>
Updating user objects
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-106" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-user_validations"><span class="courseSec-num">6.2</span>
User validations
</a><ul class="courseSub">
<li>
<a id="sub_section-166" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-a_validity_test"><span class="courseSec-num">6.2.1</span>
A validity test
</a></li>
<li>
<a id="sub_section-167" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-presence_validation"><span class="courseSec-num">6.2.2</span>
Validating presence
</a></li>
<li>
<a id="sub_section-168" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-length_validation"><span class="courseSec-num">6.2.3</span>
Length validation
</a></li>
<li>
<a id="sub_section-169" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-format_validation"><span class="courseSec-num">6.2.4</span>
Format validation
</a></li>
<li>
<a id="sub_section-170" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-uniqueness_validation"><span class="courseSec-num">6.2.5</span>
Uniqueness validation
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-107" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-adding_a_secure_password"><span class="courseSec-num">6.3</span>
Adding a secure password
</a><ul class="courseSub">
<li>
<a id="sub_section-171" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-a_hashed_password"><span class="courseSec-num">6.3.1</span>
A hashed password
</a></li>
<li>
<a id="sub_section-172" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-has_secure_password"><span class="courseSec-num">6.3.2</span>
User has secure password
</a></li>
<li>
<a id="sub_section-173" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-minimum_password_standards"><span class="courseSec-num">6.3.3</span>
Minimum password standards
</a></li>
<li>
<a id="sub_section-174" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-creating_and_authenticating_a_user"><span class="courseSec-num">6.3.4</span>
Creating and authenticating a user
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-108" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-modeling_users_conclusion"><span class="courseSec-num">6.4</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-175" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-modeling_users_what_we_learned_in_this_chapter"><span class="courseSec-num">6.4.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2005" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up">7. Sign up
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-119" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-showing_users"><span class="courseSec-num">7.1</span>
Showing users
</a><ul class="courseSub">
<li>
<a id="sub_section-176" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-rails_environments"><span class="courseSec-num">7.1.1</span>
Debug and Rails environments
</a></li>
<li>
<a id="sub_section-177" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-a_users_resource"><span class="courseSec-num">7.1.2</span>
A Users resource
</a></li>
<li>
<a id="sub_section-178" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-debugger"><span class="courseSec-num">7.1.3</span>
Debugger
</a></li>
<li>
<a id="sub_section-179" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-a_gravatar_image"><span class="courseSec-num">7.1.4</span>
A Gravatar image and a sidebar
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-120" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-signup_form"><span class="courseSec-num">7.2</span>
Signup form
</a><ul class="courseSub">
<li>
<a id="sub_section-180" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-using_form_for"><span class="courseSec-num">7.2.1</span>
Using formfor
</a></li>
<li>
<a id="sub_section-181" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-the_form_html"><span class="courseSec-num">7.2.2</span>
Signup form HTML
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-121" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-unsuccessful_signups"><span class="courseSec-num">7.3</span>
Unsuccessful signups
</a><ul class="courseSub">
<li>
<a id="sub_section-182" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-a_working_form"><span class="courseSec-num">7.3.1</span>
A working form
</a></li>
<li>
<a id="sub_section-183" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-strong_parameters"><span class="courseSec-num">7.3.2</span>
Strong parameters
</a></li>
<li>
<a id="sub_section-184" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-signup_error_messages"><span class="courseSec-num">7.3.3</span>
Signup error messages
</a></li>
<li>
<a id="sub_section-185" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-a_test_for_invalid_submission"><span class="courseSec-num">7.3.4</span>
A test for invalid submission
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-122" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-successful_signups"><span class="courseSec-num">7.4</span>
Successful signups
</a><ul class="courseSub">
<li>
<a id="sub_section-186" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-the_finished_signup_form"><span class="courseSec-num">7.4.1</span>
The finished signup form
</a></li>
<li>
<a id="sub_section-187" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-the_flash"><span class="courseSec-num">7.4.2</span>
The flash
</a></li>
<li>
<a id="sub_section-188" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-the_first_signup"><span class="courseSec-num">7.4.3</span>
The first signup
</a></li>
<li>
<a id="sub_section-189" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-a_test_for_valid_submission"><span class="courseSec-num">7.4.4</span>
A test for valid submission
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-123" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-professional_grade_deployment"><span class="courseSec-num">7.5</span>
Professional-grade deployment
</a><ul class="courseSub">
<li>
<a id="sub_section-190" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-ssl_in_production"><span class="courseSec-num">7.5.1</span>
SSL in production
</a></li>
<li>
<a id="sub_section-191" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-production_webserver"><span class="courseSec-num">7.5.2</span>
Production webserver
</a></li>
<li>
<a id="sub_section-1318" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-production_database_configuration"><span class="courseSec-num">7.5.3</span>
Production database configuration
</a></li>
<li>
<a id="sub_section-194" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-production_deployment"><span class="courseSec-num">7.5.4</span>
Production deployment
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-124" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-sign_up_conclusion"><span class="courseSec-num">7.6</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-193" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-sign_up_what_we_learned_in_this_chapter"><span class="courseSec-num">7.6.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2006" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login">8. Basic login
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-126" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-sessions_and_failed_login"><span class="courseSec-num">8.1</span>
Sessions
</a><ul class="courseSub">
<li>
<a id="sub_section-195" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-sessions_controller"><span class="courseSec-num">8.1.1</span>
Sessions controller
</a></li>
<li>
<a id="sub_section-196" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-login_form"><span class="courseSec-num">8.1.2</span>
Login form
</a></li>
<li>
<a id="sub_section-197" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-finding_and_authenticating_a_user"><span class="courseSec-num">8.1.3</span>
Finding and authenticating a user
</a></li>
<li>
<a id="sub_section-198" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-rendering_with_a_flash_message"><span class="courseSec-num">8.1.4</span>
Rendering with a flash message
</a></li>
<li>
<a id="sub_section-199" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-a_flash_test"><span class="courseSec-num">8.1.5</span>
A flash test
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-127" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-logging_in"><span class="courseSec-num">8.2</span>
Logging in
</a><ul class="courseSub">
<li>
<a id="sub_section-200" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-a_working_log_in_method"><span class="courseSec-num">8.2.1</span>
The login method
</a></li>
<li>
<a id="sub_section-201" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-current_user"><span class="courseSec-num">8.2.2</span>
Current user
</a></li>
<li>
<a id="sub_section-202" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-changing_the_layout_links"><span class="courseSec-num">8.2.3</span>
Changing the layout links
</a></li>
<li>
<a id="sub_section-203" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-testing_layout_changes"><span class="courseSec-num">8.2.4</span>
Testing layout changes
</a></li>
<li>
<a id="sub_section-204" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-login_upon_signup"><span class="courseSec-num">8.2.5</span>
Login upon signup
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-128" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-logging_out"><span class="courseSec-num">8.3</span>
Logging out
</a></li>
<li class="courseSec">
<a id="chapter_section-129" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-basic_login_conclusion"><span class="courseSec-num">8.4</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-205" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-basic_login_what_we_learned_in_this_chapter"><span class="courseSec-num">8.4.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2007" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login">9. Advanced login
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-130" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-remember_me"><span class="courseSec-num">9.1</span>
Remember me
</a><ul class="courseSub">
<li>
<a id="sub_section-206" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-remember_token"><span class="courseSec-num">9.1.1</span>
Remember token and digest
</a></li>
<li>
<a id="sub_section-207" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-login_with_remembering"><span class="courseSec-num">9.1.2</span>
Login with remembering
</a></li>
<li>
<a id="sub_section-208" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-forgetting_users"><span class="courseSec-num">9.1.3</span>
Forgetting users
</a></li>
<li>
<a id="sub_section-209" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-two_subtle_bugs"><span class="courseSec-num">9.1.4</span>
Two subtle bugs
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-131" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-remember_me_checkbox"><span class="courseSec-num">9.2</span>
“Remember me” checkbox
</a></li>
<li class="courseSec">
<a id="chapter_section-132" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-remember_tests"><span class="courseSec-num">9.3</span>
Remember tests
</a><ul class="courseSub">
<li>
<a id="sub_section-210" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-testing_the_remember_me_box"><span class="courseSec-num">9.3.1</span>
Testing the “remember me” box
</a></li>
<li>
<a id="sub_section-211" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-testing_the_remember_branch"><span class="courseSec-num">9.3.2</span>
Testing the remember branch
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-133" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-advanced_login_conclusion"><span class="courseSec-num">9.4</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-212" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#sec-advanced_login_what_we_learned_in_this_chapter"><span class="courseSec-num">9.4.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2016" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users">10. Updating, showing, and deleting users
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-148" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-updating_users"><span class="courseSec-num">10.1</span>
Updating users
</a><ul class="courseSub">
<li>
<a id="sub_section-213" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-edit_form"><span class="courseSec-num">10.1.1</span>
Edit form
</a></li>
<li>
<a id="sub_section-214" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-unsuccessful_edits"><span class="courseSec-num">10.1.2</span>
Unsuccessful edits
</a></li>
<li>
<a id="sub_section-215" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-testing_unsuccessful_edits"><span class="courseSec-num">10.1.3</span>
Testing unsuccessful edits
</a></li>
<li>
<a id="sub_section-216" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-successful_edits"><span class="courseSec-num">10.1.4</span>
Successful edits (with TDD)
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-149" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-authorization"><span class="courseSec-num">10.2</span>
Authorization
</a><ul class="courseSub">
<li>
<a id="sub_section-217" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-requiring_logged_in_users"><span class="courseSec-num">10.2.1</span>
Requiring logged-in users
</a></li>
<li>
<a id="sub_section-218" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-requiring_the_right_user"><span class="courseSec-num">10.2.2</span>
Requiring the right user
</a></li>
<li>
<a id="sub_section-219" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-friendly_forwarding"><span class="courseSec-num">10.2.3</span>
Friendly forwarding
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-150" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-showing_all_users"><span class="courseSec-num">10.3</span>
Showing all users
</a><ul class="courseSub">
<li>
<a id="sub_section-220" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-users_index"><span class="courseSec-num">10.3.1</span>
Users index
</a></li>
<li>
<a id="sub_section-221" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-sample_users"><span class="courseSec-num">10.3.2</span>
Sample users
</a></li>
<li>
<a id="sub_section-222" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-pagination"><span class="courseSec-num">10.3.3</span>
Pagination
</a></li>
<li>
<a id="sub_section-223" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-users_index_test"><span class="courseSec-num">10.3.4</span>
Users index test
</a></li>
<li>
<a id="sub_section-224" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-partial_refactoring"><span class="courseSec-num">10.3.5</span>
Partial refactoring
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-151" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-deleting_users"><span class="courseSec-num">10.4</span>
Deleting users
</a><ul class="courseSub">
<li>
<a id="sub_section-225" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-administrative_users"><span class="courseSec-num">10.4.1</span>
Administrative users
</a></li>
<li>
<a id="sub_section-226" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-the_destroy_action"><span class="courseSec-num">10.4.2</span>
The destroy action
</a></li>
<li>
<a id="sub_section-227" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-user_destroy_tests"><span class="courseSec-num">10.4.3</span>
User destroy tests
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-152" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-updating_and_deleting_users_conclusion"><span class="courseSec-num">10.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-228" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-updating_what_we_learned_in_this_chapter"><span class="courseSec-num">10.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2017" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation">11. Account activation
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-154" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-account_activations_resource"><span class="courseSec-num">11.1</span>
Account activations resource
</a><ul class="courseSub">
<li>
<a id="sub_section-229" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-account_activations_controller"><span class="courseSec-num">11.1.1</span>
Account activations controller
</a></li>
<li>
<a id="sub_section-230" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-account_activation_data_model"><span class="courseSec-num">11.1.2</span>
Account activation data model
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-155" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-account_activation_emails"><span class="courseSec-num">11.2</span>
Account activation emails
</a><ul class="courseSub">
<li>
<a id="sub_section-231" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-mailer_templates"><span class="courseSec-num">11.2.1</span>
Mailer templates
</a></li>
<li>
<a id="sub_section-232" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-email_previews"><span class="courseSec-num">11.2.2</span>
Email previews
</a></li>
<li>
<a id="sub_section-233" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-email_tests"><span class="courseSec-num">11.2.3</span>
Email tests
</a></li>
<li>
<a id="sub_section-234" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-updating_create"><span class="courseSec-num">11.2.4</span>
Updating the Users create action
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-156" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activating_the_account"><span class="courseSec-num">11.3</span>
Activating the account
</a><ul class="courseSub">
<li>
<a id="sub_section-235" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-generalizing_the_authenticated_method"><span class="courseSec-num">11.3.1</span>
Generalizing the authenticated? method
</a></li>
<li>
<a id="sub_section-236" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_edit_action"><span class="courseSec-num">11.3.2</span>
Activation edit action
</a></li>
<li>
<a id="sub_section-237" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_test_and_refactoring"><span class="courseSec-num">11.3.3</span>
Activation test and refactoring
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-157" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_email_in_production"><span class="courseSec-num">11.4</span>
Email in production
</a></li>
<li class="courseSec">
<a id="chapter_section-158" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_conclusion"><span class="courseSec-num">11.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-238" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_what_we_learned_in_this_chapter"><span class="courseSec-num">11.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2018" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset">12. Password reset
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-159" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-password_resets_resource"><span class="courseSec-num">12.1</span>
Password resets resource
</a><ul class="courseSub">
<li>
<a id="sub_section-239" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-password_resets_controller"><span class="courseSec-num">12.1.1</span>
Password resets controller
</a></li>
<li>
<a id="sub_section-240" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-new_password_resets"><span class="courseSec-num">12.1.2</span>
New password resets
</a></li>
<li>
<a id="sub_section-241" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-password_reset_create_action"><span class="courseSec-num">12.1.3</span>
Password reset create action
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-181" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-password_reset_emails"><span class="courseSec-num">12.2</span>
Password reset emails
</a><ul class="courseSub">
<li>
<a id="sub_section-810" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-password_reset_mailer"><span class="courseSec-num">12.2.1</span>
Password reset mailer and templates
</a></li>
<li>
<a id="sub_section-811" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-reset_email_tests"><span class="courseSec-num">12.2.2</span>
Email tests
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-161" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-resetting_the_password"><span class="courseSec-num">12.3</span>
Resetting the password
</a><ul class="courseSub">
<li>
<a id="sub_section-244" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-reset_edit_action"><span class="courseSec-num">12.3.1</span>
Reset edit action
</a></li>
<li>
<a id="sub_section-245" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-updating_the_reset"><span class="courseSec-num">12.3.2</span>
Updating the reset
</a></li>
<li>
<a id="sub_section-246" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-password_reset_test"><span class="courseSec-num">12.3.3</span>
Password reset test
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-162" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-reset_email_in_production"><span class="courseSec-num">12.4</span>
Email in production (take two)
</a></li>
<li class="courseSec">
<a id="chapter_section-163" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-resets_conclusion"><span class="courseSec-num">12.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-247" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-activation_resets_what_we_learned_in_this_chapter"><span class="courseSec-num">12.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-164" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-expiration_proof"><span class="courseSec-num">12.6</span>
Proof of expiration comparison
</a></li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2026" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts" class="courseCurrent">13. User microposts
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-194" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-a_micropost_model"><span class="courseSec-num">13.1</span>
A Micropost model
</a><ul class="courseSub">
<li>
<a id="sub_section-838" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-the_basic_model"><span class="courseSec-num">13.1.1</span>
The basic model
</a></li>
<li>
<a id="sub_section-839" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_validations"><span class="courseSec-num">13.1.2</span>
Micropost validations
</a></li>
<li>
<a id="sub_section-840" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_micropost_associations"><span class="courseSec-num">13.1.3</span>
User/Micropost associations
</a></li>
<li>
<a id="sub_section-841" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-ordering_and_dependency"><span class="courseSec-num">13.1.4</span>
Micropost refinements
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-195" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-showing_microposts"><span class="courseSec-num">13.2</span>
Showing microposts
</a><ul class="courseSub">
<li>
<a id="sub_section-842" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-rendering_microposts"><span class="courseSec-num">13.2.1</span>
Rendering microposts
</a></li>
<li>
<a id="sub_section-843" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-sample_microposts"><span class="courseSec-num">13.2.2</span>
Sample microposts
</a></li>
<li>
<a id="sub_section-844" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-profile_micropost_tests"><span class="courseSec-num">13.2.3</span>
Profile micropost tests
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-196" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-manipulating_microposts"><span class="courseSec-num">13.3</span>
Manipulating microposts
</a><ul class="courseSub">
<li>
<a id="sub_section-845" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_access_control"><span class="courseSec-num">13.3.1</span>
Micropost access control
</a></li>
<li>
<a id="sub_section-846" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-creating_microposts"><span class="courseSec-num">13.3.2</span>
Creating microposts
</a></li>
<li>
<a id="sub_section-847" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-a_proto_feed"><span class="courseSec-num">13.3.3</span>
A proto-feed
</a></li>
<li>
<a id="sub_section-848" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-destroying_microposts"><span class="courseSec-num">13.3.4</span>
Destroying microposts
</a></li>
<li>
<a id="sub_section-849" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_tests"><span class="courseSec-num">13.3.5</span>
Micropost tests
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-197" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_images"><span class="courseSec-num">13.4</span>
Micropost images
</a><ul class="courseSub">
<li>
<a id="sub_section-850" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-basic_image_upload"><span class="courseSec-num">13.4.1</span>
Basic image upload
</a></li>
<li>
<a id="sub_section-851" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_validation"><span class="courseSec-num">13.4.2</span>
Image validation
</a></li>
<li>
<a id="sub_section-852" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_resizing"><span class="courseSec-num">13.4.3</span>
Image resizing
</a></li>
<li>
<a id="sub_section-853" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_upload_in_production"><span class="courseSec-num">13.4.4</span>
Image upload in production
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-198" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_microposts_conclusion"><span class="courseSec-num">13.5</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-854" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_microposts_what_we_learned_in_this_chapter"><span class="courseSec-num">13.5.1</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
<li class="courseCh">
<a id="chapter-2027" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users">14. Following users
</a><ul class="courseSecWr">
<li class="courseSec">
<a id="chapter_section-199" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-the_relationship_model"><span class="courseSec-num">14.1</span>
The Relationship model
</a><ul class="courseSub">
<li>
<a id="sub_section-855" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-a_problem_with_the_data_model"><span class="courseSec-num">14.1.1</span>
A problem with the data model (and a solution)
</a></li>
<li>
<a id="sub_section-856" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-relationship_user_associations"><span class="courseSec-num">14.1.2</span>
User/relationship associations
</a></li>
<li>
<a id="sub_section-857" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-relationship_validations"><span class="courseSec-num">14.1.3</span>
Relationship validations
</a></li>
<li>
<a id="sub_section-858" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-following"><span class="courseSec-num">14.1.4</span>
Followed users
</a></li>
<li>
<a id="sub_section-859" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-followers"><span class="courseSec-num">14.1.5</span>
Followers
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-200" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-a_web_interface_for_following_and_followers"><span class="courseSec-num">14.2</span>
A web interface for following users
</a><ul class="courseSub">
<li>
<a id="sub_section-860" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-sample_following_data"><span class="courseSec-num">14.2.1</span>
Sample following data
</a></li>
<li>
<a id="sub_section-861" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-stats_and_a_follow_form"><span class="courseSec-num">14.2.2</span>
Stats and a follow form
</a></li>
<li>
<a id="sub_section-862" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-following_and_followers_pages"><span class="courseSec-num">14.2.3</span>
Following and followers pages
</a></li>
<li>
<a id="sub_section-863" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-a_working_follow_button_the_standard_way"><span class="courseSec-num">14.2.4</span>
A working follow button the standard way
</a></li>
<li>
<a id="sub_section-864" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-a_working_follow_button_with_ajax"><span class="courseSec-num">14.2.5</span>
A working follow button with Ajax
</a></li>
<li>
<a id="sub_section-865" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-following_tests"><span class="courseSec-num">14.2.6</span>
Following tests
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-201" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-the_status_feed"><span class="courseSec-num">14.3</span>
The status feed
</a><ul class="courseSub">
<li>
<a id="sub_section-866" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-motivation_and_strategy"><span class="courseSec-num">14.3.1</span>
Motivation and strategy
</a></li>
<li>
<a id="sub_section-867" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-a_first_feed_implementation"><span class="courseSec-num">14.3.2</span>
A first feed implementation
</a></li>
<li>
<a id="sub_section-868" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-scopes_subselects_and_a_lambda"><span class="courseSec-num">14.3.3</span>
Subselects
</a></li>
</ul>
</li>
<li class="courseSec">
<a id="chapter_section-202" class="j_courseSection" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-following_conclusion"><span class="courseSec-num">14.4</span>
Conclusion
</a><ul class="courseSub">
<li>
<a id="sub_section-869" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-guide_to_further_resources"><span class="courseSec-num">14.4.1</span>
Guide to further resources
</a></li>
<li>
<a id="sub_section-870" href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-following_users_what_we_learned_in_this_chapter"><span class="courseSec-num">14.4.2</span>
What we learned in this chapter
</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

</nav>
<div id="dropBG"></div>
</div>

<div class="le-content">
<div class="header-push">
<div class="header-push-close" id="header-push-toggle">
<a class="push-close" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a><a class="push-open" href="javascript://"><svg class="svg-inline--fa fa-caret-square-down fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-square-down" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 80v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zM92.5 220.5l123 123c4.7 4.7 12.3 4.7 17 0l123-123c7.6-7.6 2.2-20.5-8.5-20.5H101c-10.7 0-16.1 12.9-8.5 20.5z"></path></svg><!-- <i class="fas fa-caret-square-down"></i> -->
</a></div>
<div class="header-push-content">
<div class="header-push-copy">
<div>
<h5>
Get Single Tutorial
<a href="http://www.learnenough.com/ruby-on-rails-4th-edition"><div class="btn btn-icon-reveal">
<span class="btn-tiny_text">MORE INFO</span>
<svg class="svg-inline--fa fa-arrow-circle-right fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-circle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></svg><!-- <i class="fas fa-arrow-circle-right"></i> -->
</div>
</a></h5>
<p><em>Ruby on Rails Tutorial (Rails 5)</em> is available as an ebook, an offline video series, and as a structured, self-paced online course. The course includes full online access to the book content, streaming videos, progress tracking, exercises, and community exercise answers.</p>
<div class="header-push-cta">
<a href="http://www.learnenough.com/ruby-on-rails-4th-edition#landing-pricing"><button class="btn-small btn-outline-yellow">See Options - Starting at $9</button>
</a></div>
</div>
<div>
<h5>
All Access Bundle
<a href="http://www.learnenough.com/all-access"><div class="btn btn-icon-reveal">
<span class="btn-tiny_text">MORE INFO</span>
<svg class="svg-inline--fa fa-arrow-circle-right fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-circle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></svg><!-- <i class="fas fa-arrow-circle-right"></i> -->
</div>
</a></h5>
<p>The Learn Enough All Access Bundle includes the entire Learn Enough introductory sequence and the full Ruby on Rails Tutorial. More than 2500 pages of book content and 53 hours of video that teach you to code from total beginner up to professional-grade web development.</p>
<div class="header-push-cta">
<a data-id="10" class="btn_addBundleToCart" href="javascript://"><button class="btn-small attention">
<svg class="svg-inline--fa fa-shopping-cart fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shopping-cart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M528.12 301.319l47.273-208C578.806 78.301 567.391 64 551.99 64H159.208l-9.166-44.81C147.758 8.021 137.93 0 126.529 0H24C10.745 0 0 10.745 0 24v16c0 13.255 10.745 24 24 24h69.883l70.248 343.435C147.325 417.1 136 435.222 136 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-15.674-6.447-29.835-16.824-40h209.647C430.447 426.165 424 440.326 424 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-22.172-12.888-41.332-31.579-50.405l5.517-24.276c3.413-15.018-8.002-29.319-23.403-29.319H218.117l-6.545-32h293.145c11.206 0 20.92-7.754 23.403-18.681z"></path></svg><!-- <i class="fas fa-shopping-cart"></i> -->
Add to Cart :
<sup>$</sup>
49
<sub>/mo</sub>
</button>
</a></div>
</div>
</div>
</div>
<div class="header-push-content-closed">
Sign up for the course and get access to the full tutorial and streaming screencasts!
</div>
</div>

<div class="mainWr">
<div id="book">
<div class="j_sectionContent" data-html="&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/REC-html40/loose.dtd&quot;&gt;
&lt;html&gt;&lt;body&gt;
&lt;div id=&quot;cha-user_microposts&quot; data-tralics-id=&quot;cid73&quot; class=&quot;chapter&quot; data-number=&quot;13&quot; data-chapter=&quot;user_microposts&quot;&gt;
&lt;h1&gt;&lt;a href=&quot;user_microposts_fragment.html#cha-user_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;Chapter 13 &lt;/span&gt;User microposts&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt; &lt;span class=&quot;free&quot;&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In the course of developing the core sample application, we’ve now encountered four resources—users, sessions, account activations, and password resets—but only the first of these is backed by an Active Record model with a table in the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The time has finally come to add a second such resource: user &lt;em&gt;microposts&lt;/em&gt;, which are short messages associated with a particular user.&lt;sup id=&quot;cha-13_footnote-ref-1&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We first saw microposts in larval form in &lt;a href=&quot;toy_app_fragment.html#cha-a_toy_app&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;2&lt;/span&gt;&lt;/a&gt;, and in this chapter we will make a full-strength version of the sketch from &lt;a href=&quot;toy_app_fragment.html#sec-microposts_resource&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;2.3&lt;/span&gt;&lt;/a&gt; by constructing the Micropost data model, associating it with the User model using the &lt;code&gt;has_many&lt;/code&gt; and &lt;code&gt;belongs_to&lt;/code&gt; methods, and then making the forms and partials needed to manipulate and display the results (including, in &lt;a href=&quot;user_microposts_fragment.html#sec-micropost_images&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt;, uploaded images).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In &lt;a href=&quot;following_users_fragment.html#cha-following_users&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;14&lt;/span&gt;&lt;/a&gt;, we’ll complete our tiny Twitter clone by adding the notion of &lt;em&gt;following&lt;/em&gt; users in order to receive a &lt;em&gt;feed&lt;/em&gt; of their microposts.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&quot;cha-13_footnotes&quot;&gt;
  &lt;div class=&quot;footnotes&quot;&gt;
    &lt;div id=&quot;cha-13_footnote-1&quot; class=&quot;footnote&quot;&gt; The name is motivated by the common description of Twitter as a &lt;em&gt;microblog&lt;/em&gt;; since blogs have posts, microblogs should have microposts.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-2&quot; class=&quot;footnote&quot;&gt; www.postgresql.org/docs/9.1/static/datatype-character.html&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-3&quot; class=&quot;footnote&quot;&gt; The foreign key reference is a database-level constraint indicating that the user id in the microposts table refers to the id column in the users table.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This detail will never be important in this tutorial, and the foreign key constraint isn’t even supported by all databases.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (It’s supported by PostgreSQL, which we use in production, but not by the development SQLite database adapter.)&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll learn more about foreign keys in &lt;a href=&quot;following_users_fragment.html#sec-relationship_user_associations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;14.1.2&lt;/span&gt;&lt;/a&gt;.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-4&quot; class=&quot;footnote&quot;&gt; We briefly encountered a similar issue in &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-updating_and_deleting_users_conclusion&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.5&lt;/span&gt;&lt;/a&gt; in the context of the users index.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-5&quot; class=&quot;footnote&quot;&gt; SQL is case-insensitive, but it is conventional to write SQL keywords (such as &lt;code&gt;DESC&lt;/code&gt;) in all-caps.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-6&quot; class=&quot;footnote&quot;&gt; &lt;code&gt;Faker::Lorem.sentence&lt;/code&gt; returns &lt;em&gt;lorem ipsum&lt;/em&gt; text; as noted in &lt;a href=&quot;modeling_users_fragment.html#cha-modeling_users&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;6&lt;/span&gt;&lt;/a&gt;, &lt;em&gt;lorem ipsum&lt;/em&gt; has a &lt;a href=&quot;http://www.straightdope.com/columns/read/2290/what-does-the-filler-text-lorem-ipsum-mean&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;fascinating back story&lt;/a&gt;.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-7&quot; class=&quot;footnote&quot;&gt; By design, the Faker gem’s &lt;em&gt;lorem ipsum&lt;/em&gt; text is randomized, so the contents of your sample microposts will differ.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-8&quot; class=&quot;footnote&quot;&gt; For convenience, &lt;a href=&quot;user_microposts_fragment.html#code-micropost_css&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.26&lt;/span&gt;&lt;/a&gt; actually has &lt;em&gt;all&lt;/em&gt; the CSS needed for this chapter.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-9&quot; class=&quot;footnote&quot;&gt; If you’d like to refactor other tests to use &lt;code&gt;full_title&lt;/code&gt; (such as those in &lt;a href=&quot;static_pages_fragment.html#code-base_title_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;3.30&lt;/span&gt;&lt;/a&gt;), you should include the Application Helper in &lt;code&gt;test_helper.rb&lt;/code&gt; instead.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-10&quot; class=&quot;footnote&quot;&gt; Note that, unlike the behavior in languages like Java or C++, private methods in Ruby &lt;a href=&quot;http://stackoverflow.com/questions/3534449/why-does-ruby-have-both-private-and-protected-methods/3534581#3534581&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;can be called&lt;/a&gt; from derived classes.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Thanks to reader Vishal Antony for bringing this difference to my attention.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-11&quot; class=&quot;footnote&quot;&gt; See the Rails Guide on the &lt;a href=&quot;http://guides.rubyonrails.org/active_record_querying.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Active Record Query Interface&lt;/a&gt; for more on &lt;code&gt;where&lt;/code&gt; and related methods.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-12&quot; class=&quot;footnote&quot;&gt; This corresponds to &lt;code class=&quot;tt&quot;&gt;HTTP_REFERER&lt;/code&gt;, as defined by the specification for HTTP.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note that “referer” is not a typo—the word is actually misspelled in the spec.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Rails corrects this error by writing “referrer” instead.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-13&quot; class=&quot;footnote&quot;&gt; I didn’t remember offhand how to get this URL inside a Rails application, so I Googled “rails request previous url” and found a &lt;a href=&quot;http://stackoverflow.com/questions/4652084/ruby-on-rails-how-do-you-get-the-previous-url&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Stack Overflow thread&lt;/a&gt; with the answer.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-14&quot; class=&quot;footnote&quot;&gt; Image retrieved from https://www.flickr.com/photos/grungepunk/14026922186 on 2014-09-19.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Copyright © 2014 by Jussie D. Brito and used unaltered under the terms of the &lt;a href=&quot;https://creativecommons.org/licenses/by-sa/2.0/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Creative Commons Attribution-ShareAlike 2.0 Generic&lt;/a&gt; license.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-15&quot; class=&quot;footnote&quot;&gt; As always, you should use the version numbers listed at &lt;a href=&quot;https://gemfiles-4th-ed.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;gemfiles-4th-ed.railstutorial.org&lt;/a&gt; instead of the ones listed here.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-16&quot; class=&quot;footnote&quot;&gt; Initially, I called the new attribute &lt;code&gt;image&lt;/code&gt;, but that name was so generic it ended up being confusing.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-17&quot; class=&quot;footnote&quot;&gt; When using &lt;code&gt;form_tag&lt;/code&gt; (discussed briefly in &lt;a href=&quot;basic_login_fragment.html#sec-login_form&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;8.1.2&lt;/span&gt;&lt;/a&gt;), it’s necessary to add the option &lt;code&gt;html: { multipart: true }&lt;/code&gt; to handle file uploads, but when using &lt;code&gt;form_for&lt;/code&gt; the necessary &lt;a href=&quot;http://stackoverflow.com/questions/4526273/what-does-enctype-multipart-form-data-mean&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;multipart form-data encoding type&lt;/a&gt; is &lt;a href=&quot;http://stackoverflow.com/a/26320725&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;automatically added&lt;/a&gt; by Rails.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Thanks to reader Alan Cruz for bringing this detail to my attention.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-18&quot; class=&quot;footnote&quot;&gt; Windows users should add a &lt;code&gt;:binary&lt;/code&gt; parameter: &lt;code&gt;fixture_file_upload(file, type, :binary)&lt;/code&gt;.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-19&quot; class=&quot;footnote&quot;&gt; To learn how to do things like this, you can do what I did: Google around for things like “javascript maximum file size” until you find something on Stack Overflow.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-20&quot; class=&quot;footnote&quot;&gt; More advanced users of jQuery would probably put the size check in its own JavaScript function, but since this isn’t a JavaScript tutorial the code in &lt;a href=&quot;user_microposts_fragment.html#code-jquery_file_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.66&lt;/span&gt;&lt;/a&gt; is fine for our purposes.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-21&quot; class=&quot;footnote&quot;&gt; It’s possible to constrain the &lt;em&gt;display&lt;/em&gt; size with CSS, but this doesn’t change the image size.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, large images would still take a while to load.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (You’ve probably visited websites where “small” images seemingly take forever to load.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This is why.)&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-22&quot; class=&quot;footnote&quot;&gt; If you’re not using the cloud IDE or an equivalent Linux system, do a Google search for “imagemagick &amp;lt;your platform&amp;gt;”.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; On macOS, &lt;code&gt;brew install imagemagick&lt;/code&gt; should work if you have &lt;a href=&quot;http://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Homebrew&lt;/a&gt; installed.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-23&quot; class=&quot;footnote&quot;&gt; Among other things, file storage on Heroku is temporary, so uploaded images will be deleted every time you deploy.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-24&quot; class=&quot;footnote&quot;&gt; This is a challenging section and can be skipped without loss of continuity.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-25&quot; class=&quot;footnote&quot;&gt; S3 is a paid service, but the storage needed to set up and test the Rails Tutorial sample application costs less than a cent per month.&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-26&quot; class=&quot;footnote&quot;&gt; aws.amazon.com/documentation/s3/&lt;/div&gt;
    &lt;div id=&quot;cha-13_footnote-27&quot; class=&quot;footnote&quot;&gt; As always, you should use the version numbers listed at &lt;a href=&quot;https://gemfiles-4th-ed.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;gemfiles-4th-ed.railstutorial.org&lt;/a&gt; instead of the ones listed here.&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;&lt;/html&gt;"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book">

<div id="cha-user_microposts" data-tralics-id="cid73" class="chapter" data-number="13" data-chapter="user_microposts">
<h1><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-user_microposts" class="heading hyperref"><span class="number">Chapter 13 </span>User microposts</a></h1>
<p> <span class="free"></span></p>
<p>In the course of developing the core sample application, we’ve now encountered four resources—users, sessions, account activations, and password resets—but only the first of these is backed by an Active Record model with a table in the database.<span class="intersentencespace"></span> The time has finally come to add a second such resource: user <em>microposts</em>, which are short messages associated with a particular user.<sup id="cha-13_footnote-ref-1" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-1" data-hasqtip="0">1</a></sup><span class="intersentencespace"></span> We first saw microposts in larval form in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#cha-a_toy_app" class="hyperref">Chapter&nbsp;<span class="ref">2</span></a>, and in this chapter we will make a full-strength version of the sketch from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-microposts_resource" class="hyperref">Section&nbsp;<span class="ref">2.3</span></a> by constructing the Micropost data model, associating it with the User model using the <code>has_many</code> and <code>belongs_to</code> methods, and then making the forms and partials needed to manipulate and display the results (including, in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_images" class="hyperref">Section&nbsp;<span class="ref">13.4</span></a>, uploaded images).<span class="intersentencespace"></span> In <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#cha-following_users" class="hyperref">Chapter&nbsp;<span class="ref">14</span></a>, we’ll complete our tiny Twitter clone by adding the notion of <em>following</em> users in order to receive a <em>feed</em> of their microposts.</p>
</div>
<div id="cha-13_footnotes">
  <div class="footnotes" style="display: none;">
    <div id="cha-13_footnote-1" class="footnote"> The name is motivated by the common description of Twitter as a <em>microblog</em>; since blogs have posts, microblogs should have microposts.</div>
    <div id="cha-13_footnote-2" class="footnote"> www.postgresql.org/docs/9.1/static/datatype-character.html</div>
    <div id="cha-13_footnote-3" class="footnote"> The foreign key reference is a database-level constraint indicating that the user id in the microposts table refers to the id column in the users table.<span class="intersentencespace"></span> This detail will never be important in this tutorial, and the foreign key constraint isn’t even supported by all databases.<span class="intersentencespace"></span> (It’s supported by PostgreSQL, which we use in production, but not by the development SQLite database adapter.)<span class="intersentencespace"></span> We’ll learn more about foreign keys in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-relationship_user_associations" class="hyperref">Section&nbsp;<span class="ref">14.1.2</span></a>.</div>
    <div id="cha-13_footnote-4" class="footnote"> We briefly encountered a similar issue in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-updating_and_deleting_users_conclusion" class="hyperref">Section&nbsp;<span class="ref">10.5</span></a> in the context of the users index.</div>
    <div id="cha-13_footnote-5" class="footnote"> SQL is case-insensitive, but it is conventional to write SQL keywords (such as <code>DESC</code>) in all-caps.</div>
    <div id="cha-13_footnote-6" class="footnote"> <code>Faker::Lorem.sentence</code> returns <em>lorem ipsum</em> text; as noted in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#cha-modeling_users" class="hyperref">Chapter&nbsp;<span class="ref">6</span></a>, <em>lorem ipsum</em> has a <a href="http://www.straightdope.com/columns/read/2290/what-does-the-filler-text-lorem-ipsum-mean" target="_blank" rel="noopener">fascinating back story</a>.</div>
    <div id="cha-13_footnote-7" class="footnote"> By design, the Faker gem’s <em>lorem ipsum</em> text is randomized, so the contents of your sample microposts will differ.</div>
    <div id="cha-13_footnote-8" class="footnote"> For convenience, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_css" class="hyperref">Listing&nbsp;<span class="ref">13.26</span></a> actually has <em>all</em> the CSS needed for this chapter.</div>
    <div id="cha-13_footnote-9" class="footnote"> If you’d like to refactor other tests to use <code>full_title</code> (such as those in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#code-base_title_test" class="hyperref">Listing&nbsp;<span class="ref">3.30</span></a>), you should include the Application Helper in <code>test_helper.rb</code> instead.</div>
    <div id="cha-13_footnote-10" class="footnote"> Note that, unlike the behavior in languages like Java or C++, private methods in Ruby <a href="http://stackoverflow.com/questions/3534449/why-does-ruby-have-both-private-and-protected-methods/3534581#3534581" target="_blank" rel="noopener">can be called</a> from derived classes.<span class="intersentencespace"></span> Thanks to reader Vishal Antony for bringing this difference to my attention.</div>
    <div id="cha-13_footnote-11" class="footnote"> See the Rails Guide on the <a href="http://guides.rubyonrails.org/active_record_querying.html" target="_blank" rel="noopener">Active Record Query Interface</a> for more on <code>where</code> and related methods.</div>
    <div id="cha-13_footnote-12" class="footnote"> This corresponds to <code class="tt">HTTP_REFERER</code>, as defined by the specification for HTTP.<span class="intersentencespace"></span> Note that “referer” is not a typo—the word is actually misspelled in the spec.<span class="intersentencespace"></span> Rails corrects this error by writing “referrer” instead.</div>
    <div id="cha-13_footnote-13" class="footnote"> I didn’t remember offhand how to get this URL inside a Rails application, so I Googled “rails request previous url” and found a <a href="http://stackoverflow.com/questions/4652084/ruby-on-rails-how-do-you-get-the-previous-url" target="_blank" rel="noopener">Stack Overflow thread</a> with the answer.</div>
    <div id="cha-13_footnote-14" class="footnote"> Image retrieved from https://www.flickr.com/photos/grungepunk/14026922186 on 2014-09-19.<span class="intersentencespace"></span> Copyright © 2014 by Jussie D.&nbsp;Brito and used unaltered under the terms of the <a href="https://creativecommons.org/licenses/by-sa/2.0/" target="_blank" rel="noopener">Creative Commons Attribution-ShareAlike 2.0 Generic</a> license.</div>
    <div id="cha-13_footnote-15" class="footnote"> As always, you should use the version numbers listed at <a href="https://gemfiles-4th-ed.railstutorial.org/" target="_blank" rel="noopener">gemfiles-4th-ed.railstutorial.org</a> instead of the ones listed here.</div>
    <div id="cha-13_footnote-16" class="footnote"> Initially, I called the new attribute <code>image</code>, but that name was so generic it ended up being confusing.</div>
    <div id="cha-13_footnote-17" class="footnote"> When using <code>form_tag</code> (discussed briefly in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/basic_login#sec-login_form" class="hyperref">Section&nbsp;<span class="ref">8.1.2</span></a>), it’s necessary to add the option <code>html: { multipart: true }</code> to handle file uploads, but when using <code>form_for</code> the necessary <a href="http://stackoverflow.com/questions/4526273/what-does-enctype-multipart-form-data-mean" target="_blank" rel="noopener">multipart form-data encoding type</a> is <a href="http://stackoverflow.com/a/26320725" target="_blank" rel="noopener">automatically added</a> by Rails.<span class="intersentencespace"></span> Thanks to reader Alan Cruz for bringing this detail to my attention.</div>
    <div id="cha-13_footnote-18" class="footnote"> Windows users should add a <code>:binary</code> parameter: <code>fixture_file_upload(file, type, :binary)</code>.</div>
    <div id="cha-13_footnote-19" class="footnote"> To learn how to do things like this, you can do what I did: Google around for things like “javascript maximum file size” until you find something on Stack Overflow.</div>
    <div id="cha-13_footnote-20" class="footnote"> More advanced users of jQuery would probably put the size check in its own JavaScript function, but since this isn’t a JavaScript tutorial the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-jquery_file_test" class="hyperref">Listing&nbsp;<span class="ref">13.66</span></a> is fine for our purposes.</div>
    <div id="cha-13_footnote-21" class="footnote"> It’s possible to constrain the <em>display</em> size with CSS, but this doesn’t change the image size.<span class="intersentencespace"></span> In particular, large images would still take a while to load.<span class="intersentencespace"></span> (You’ve probably visited websites where “small” images seemingly take forever to load.<span class="intersentencespace"></span> This is why.)</div>
    <div id="cha-13_footnote-22" class="footnote"> If you’re not using the cloud IDE or an equivalent Linux system, do a Google search for “imagemagick &lt;your platform&gt;”.<span class="intersentencespace"></span> On macOS, <code>brew install imagemagick</code> should work if you have <a href="http://brew.sh/" target="_blank" rel="noopener">Homebrew</a> installed.</div>
    <div id="cha-13_footnote-23" class="footnote"> Among other things, file storage on Heroku is temporary, so uploaded images will be deleted every time you deploy.</div>
    <div id="cha-13_footnote-24" class="footnote"> This is a challenging section and can be skipped without loss of continuity.</div>
    <div id="cha-13_footnote-25" class="footnote"> S3 is a paid service, but the storage needed to set up and test the Rails Tutorial sample application costs less than a cent per month.</div>
    <div id="cha-13_footnote-26" class="footnote"> aws.amazon.com/documentation/s3/</div>
    <div id="cha-13_footnote-27" class="footnote"> As always, you should use the version numbers listed at <a href="https://gemfiles-4th-ed.railstutorial.org/" target="_blank" rel="noopener">gemfiles-4th-ed.railstutorial.org</a> instead of the ones listed here.</div>
  </div>
</div>
</div></div></div>
<div class="j_sectionContent" data-html="&lt;div id=&quot;sec-a_micropost_model&quot; data-tralics-id=&quot;cid74&quot; class=&quot;section&quot; data-number=&quot;13.1&quot;&gt;
&lt;h2&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-a_micropost_model&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.1 &lt;/span&gt;A Micropost model&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We begin the Microposts resource by creating a Micropost model, which captures the essential characteristics of microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What follows builds on the work from &lt;a href=&quot;toy_app_fragment.html#sec-microposts_resource&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;2.3&lt;/span&gt;&lt;/a&gt;; as with the model in that section, our new Micropost model will include data validations and an association with the User model.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Unlike that model, the present Micropost model will be fully tested, and will also have a default &lt;em&gt;ordering&lt;/em&gt; and automatic &lt;em&gt;destruction&lt;/em&gt; if its parent user is destroyed.&lt;/p&gt;
&lt;p&gt;If you’re using Git for version control, I suggest making a topic branch at this time:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; git checkout -b user-microposts
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;



&lt;/div&gt;"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-a_micropost_model" data-tralics-id="cid74" class="section" data-number="13.1">
<h2><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-a_micropost_model" class="heading hyperref"><span class="number">13.1 </span>A Micropost model</a></h2>
<p>We begin the Microposts resource by creating a Micropost model, which captures the essential characteristics of microposts.<span class="intersentencespace"></span> What follows builds on the work from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-microposts_resource" class="hyperref">Section&nbsp;<span class="ref">2.3</span></a>; as with the model in that section, our new Micropost model will include data validations and an association with the User model.<span class="intersentencespace"></span> Unlike that model, the present Micropost model will be fully tested, and will also have a default <em>ordering</em> and automatic <em>destruction</em> if its parent user is destroyed.</p>
<p>If you’re using Git for version control, I suggest making a topic branch at this time:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b user-microposts
</pre></div></div>



</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-the_basic_model&quot; data-tralics-id=&quot;uid1569&quot; class=&quot;subsection&quot; data-number=&quot;13.1.1&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-the_basic_model&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.1.1 &lt;/span&gt;The basic model&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The Micropost model needs only two attributes: a &lt;code&gt;content&lt;/code&gt; attribute to hold the micropost’s content and a &lt;code&gt;user_id&lt;/code&gt; to associate a micropost with a particular user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result is a Micropost model with the structure shown in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_model&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_model&quot; data-tralics-id=&quot;uid1570&quot; data-number=&quot;13.1&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/micropost_model_3rd_edition.png&quot; alt=&quot;images/figures/micropost_model_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.1: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Micropost data model.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;It’s worth noting that the model in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_model&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt; uses the &lt;code&gt;text&lt;/code&gt; data type for micropost content (instead of &lt;code&gt;string&lt;/code&gt;), which is capable of storing an arbitrary amount of text.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Even though the content will be restricted to fewer than 140 characters (&lt;a href=&quot;user_microposts_fragment.html#sec-micropost_validations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.1.2&lt;/span&gt;&lt;/a&gt;) and hence would fit inside the 255-character &lt;code&gt;string&lt;/code&gt; type, using &lt;code&gt;text&lt;/code&gt; better expresses the nature of microposts, which are more naturally thought of as blocks of text.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Indeed, in &lt;a href=&quot;user_microposts_fragment.html#sec-creating_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.3.2&lt;/span&gt;&lt;/a&gt; we’ll use a text &lt;em&gt;area&lt;/em&gt; instead of a text field for submitting microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In addition, using &lt;code&gt;text&lt;/code&gt; gives us greater flexibility should we wish to increase the length limit at a future date (as part of internationalization, for example).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Finally, using the &lt;code&gt;text&lt;/code&gt; type results in &lt;a href=&quot;http://www.postgresql.org/docs/9.1/static/datatype-character.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;no performance difference&lt;/a&gt; in production,&lt;sup id=&quot;cha-13_footnote-ref-2&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-2&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; so it costs us nothing to use it here.&lt;/p&gt;
&lt;p&gt;As with the case of the User model (&lt;a href=&quot;modeling_users_fragment.html#code-generate_user_model&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;6.1&lt;/span&gt;&lt;/a&gt;), we generate the Micropost model using &lt;code&gt;generate model&lt;/code&gt; (&lt;a href=&quot;user_microposts_fragment.html#code-generate_micropost_model&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-generate_micropost_model&quot; data-tralics-id=&quot;uid1572&quot; data-number=&quot;13.1&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.1:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Generating the Micropost model.&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails generate model Micropost content:text user:references
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This migration leads to the creation of the Micropost model shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_model&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.2&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In addition to inheriting from &lt;code&gt;ApplicationRecord&lt;/code&gt; as usual (&lt;a href=&quot;modeling_users_fragment.html#sec-the_model_file&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;6.1.2&lt;/span&gt;&lt;/a&gt;), the generated model includes a line indicating that a micropost &lt;code&gt;belongs_to&lt;/code&gt; a user, which is included as a result of the &lt;code&gt;user:references&lt;/code&gt; argument in &lt;a href=&quot;user_microposts_fragment.html#code-generate_micropost_model&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll explore the implications of this line in &lt;a href=&quot;user_microposts_fragment.html#sec-user_micropost_associations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.1.3&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_model&quot; data-tralics-id=&quot;uid1573&quot; data-number=&quot;13.2&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.2:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The generated Micropost model.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;generate&lt;/code&gt; command in &lt;a href=&quot;user_microposts_fragment.html#code-generate_micropost_model&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt; also produces a migration to create a &lt;code&gt;microposts&lt;/code&gt; table in the database (&lt;a href=&quot;user_microposts_fragment.html#code-micropost_migration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.3&lt;/span&gt;&lt;/a&gt;); compare it to the analogous migration for the &lt;code&gt;users&lt;/code&gt; table from &lt;a href=&quot;modeling_users_fragment.html#code-users_migration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;6.2&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The biggest difference is the use of &lt;code&gt;references&lt;/code&gt;, which automatically adds a &lt;code&gt;user_id&lt;/code&gt; column (along with an index and a foreign key reference)&lt;sup id=&quot;cha-13_footnote-ref-3&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-3&quot;&gt;3&lt;/a&gt;&lt;/sup&gt; for use in the user/micropost association.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As with the User model, the Micropost model migration automatically includes the &lt;code&gt;t.timestamps&lt;/code&gt; line, which (as mentioned in &lt;a href=&quot;modeling_users_fragment.html#sec-database_migrations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;6.1.1&lt;/span&gt;&lt;/a&gt;) adds the magic &lt;code&gt;created_at&lt;/code&gt; and &lt;code&gt;updated_at&lt;/code&gt; columns shown in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_model&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (We’ll put the &lt;code&gt;created_at&lt;/code&gt; column to work starting in &lt;a href=&quot;user_microposts_fragment.html#sec-ordering_and_dependency&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.1.4&lt;/span&gt;&lt;/a&gt;.)&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_migration&quot; data-tralics-id=&quot;uid1575&quot; data-number=&quot;13.3&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.3:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The Micropost migration with added index.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;db/migrate/[timestamp]_create_microposts.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateMicroposts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;create_table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:microposts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;references&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;foreign_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamps&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:created_at&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Because we expect to retrieve all the microposts associated with a given user id in reverse order of creation, &lt;a href=&quot;user_microposts_fragment.html#code-micropost_migration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.3&lt;/span&gt;&lt;/a&gt; adds an index (&lt;a href=&quot;modeling_users_fragment.html#aside-database_indices&quot; class=&quot;hyperref&quot;&gt;Box &lt;span class=&quot;ref&quot;&gt;6.2&lt;/span&gt;&lt;/a&gt;) on the &lt;code&gt;user_id&lt;/code&gt; and &lt;code&gt;created_at&lt;/code&gt; columns:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;add_index&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:created_at&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;By including both the &lt;code&gt;user_id&lt;/code&gt; and &lt;code&gt;created_at&lt;/code&gt; columns as an array, we arrange for Rails to create a &lt;em&gt;multiple key index&lt;/em&gt;, which means that Active Record uses &lt;em&gt;both&lt;/em&gt; keys at the same time.&lt;/p&gt;
&lt;p&gt;With the migration in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_migration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.3&lt;/span&gt;&lt;/a&gt;, we can update the database as usual:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails db:migrate
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div id=&quot;sec-exercises_the_basic_model&quot; data-tralics-id=&quot;uid1576&quot; class=&quot;subsubsection&quot; data-number=&quot;13.1.1.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_the_basic_model&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Using &lt;code&gt;Micropost.new&lt;/code&gt; in the console, instantiate a new Micropost object called &lt;code&gt;micropost&lt;/code&gt; with content “Lorem ipsum” and user id equal to the id of the first user in the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What are the values of the magic columns &lt;code&gt;created_at&lt;/code&gt; and &lt;code&gt;updated_at&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-e34987&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;What is &lt;code&gt;micropost.user&lt;/code&gt; for the micropost in the previous exercise?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What about &lt;code&gt;micropost.user.name&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-4d1441&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Save the micropost to the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What are the values of the magic columns now? &lt;span class=&quot;exercise&quot; id=&quot;ex-7d471e&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="838"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-the_basic_model" data-tralics-id="uid1569" class="subsection" data-number="13.1.1">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-the_basic_model" class="heading hyperref"><span class="number">13.1.1 </span>The basic model</a></h3>
<p>The Micropost model needs only two attributes: a <code>content</code> attribute to hold the micropost’s content and a <code>user_id</code> to associate a micropost with a particular user.<span class="intersentencespace"></span> The result is a Micropost model with the structure shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_model" class="hyperref">Figure&nbsp;<span class="ref">13.1</span></a>.</p>
<div class="center figure" id="fig-micropost_model" data-tralics-id="uid1570" data-number="13.1">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/micropost_model_3rd_edition.png" alt="images/figures/micropost_model_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.1: </span><span class="description">The Micropost data model.
</span>
</div>
</div>
<p>It’s worth noting that the model in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_model" class="hyperref">Figure&nbsp;<span class="ref">13.1</span></a> uses the <code>text</code> data type for micropost content (instead of <code>string</code>), which is capable of storing an arbitrary amount of text.<span class="intersentencespace"></span> Even though the content will be restricted to fewer than 140 characters (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_validations" class="hyperref">Section&nbsp;<span class="ref">13.1.2</span></a>) and hence would fit inside the 255-character <code>string</code> type, using <code>text</code> better expresses the nature of microposts, which are more naturally thought of as blocks of text.<span class="intersentencespace"></span> Indeed, in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-creating_microposts" class="hyperref">Section&nbsp;<span class="ref">13.3.2</span></a> we’ll use a text <em>area</em> instead of a text field for submitting microposts.<span class="intersentencespace"></span> In addition, using <code>text</code> gives us greater flexibility should we wish to increase the length limit at a future date (as part of internationalization, for example).<span class="intersentencespace"></span> Finally, using the <code>text</code> type results in <a href="http://www.postgresql.org/docs/9.1/static/datatype-character.html" target="_blank" rel="noopener">no performance difference</a> in production,<sup id="cha-13_footnote-ref-2" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-2" data-hasqtip="9">2</a></sup> so it costs us nothing to use it here.</p>
<p>As with the case of the User model (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#code-generate_user_model" class="hyperref">Listing&nbsp;<span class="ref">6.1</span></a>), we generate the Micropost model using <code>generate model</code> (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-generate_micropost_model" class="hyperref">Listing&nbsp;<span class="ref">13.1</span></a>).</p>
<div class="codelisting" id="code-generate_micropost_model" data-tralics-id="uid1572" data-number="13.1">
<div class="heading">
<span class="number">Listing 13.1:</span> 

<span class="description">Generating the Micropost model.</span>
</div>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate model Micropost content:text user:references
</pre></div></div>
</div>
<p>This migration leads to the creation of the Micropost model shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_model" class="hyperref">Listing&nbsp;<span class="ref">13.2</span></a>.<span class="intersentencespace"></span> In addition to inheriting from <code>ApplicationRecord</code> as usual (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-the_model_file" class="hyperref">Section&nbsp;<span class="ref">6.1.2</span></a>), the generated model includes a line indicating that a micropost <code>belongs_to</code> a user, which is included as a result of the <code>user:references</code> argument in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-generate_micropost_model" class="hyperref">Listing&nbsp;<span class="ref">13.1</span></a>.<span class="intersentencespace"></span> We’ll explore the implications of this line in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_micropost_associations" class="hyperref">Section&nbsp;<span class="ref">13.1.3</span></a>.</p>
<div class="codelisting" id="code-micropost_model" data-tralics-id="uid1573" data-number="13.2">
<div class="heading">
<span class="number">Listing 13.2:</span> 

<span class="description">The generated Micropost model.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
   <span class="n">belongs_to</span> <span class="ss">:user</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>The <code>generate</code> command in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-generate_micropost_model" class="hyperref">Listing&nbsp;<span class="ref">13.1</span></a> also produces a migration to create a <code>microposts</code> table in the database (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_migration" class="hyperref">Listing&nbsp;<span class="ref">13.3</span></a>); compare it to the analogous migration for the <code>users</code> table from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#code-users_migration" class="hyperref">Listing&nbsp;<span class="ref">6.2</span></a>.<span class="intersentencespace"></span> The biggest difference is the use of <code>references</code>, which automatically adds a <code>user_id</code> column (along with an index and a foreign key reference)<sup id="cha-13_footnote-ref-3" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-3" data-hasqtip="10">3</a></sup> for use in the user/micropost association.<span class="intersentencespace"></span> As with the User model, the Micropost model migration automatically includes the <code>t.timestamps</code> line, which (as mentioned in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-database_migrations" class="hyperref">Section&nbsp;<span class="ref">6.1.1</span></a>) adds the magic <code>created_at</code> and <code>updated_at</code> columns shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_model" class="hyperref">Figure&nbsp;<span class="ref">13.1</span></a>.<span class="intersentencespace"></span> (We’ll put the <code>created_at</code> column to work starting in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-ordering_and_dependency" class="hyperref">Section&nbsp;<span class="ref">13.1.4</span></a>.)</p>
<div class="codelisting" id="code-micropost_migration" data-tralics-id="uid1575" data-number="13.3">
<div class="heading">
<span class="number">Listing 13.3:</span> 

<span class="description">The Micropost migration with added index.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">db/migrate/[timestamp]_create_microposts.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CreateMicroposts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="o">[</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:microposts</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:content</span>
      <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">foreign_key</span><span class="p">:</span> <span class="kp">true</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>
<span class="hll">    <span class="n">add_index</span> <span class="ss">:microposts</span><span class="p">,</span> <span class="o">[</span><span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:created_at</span><span class="o">]</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Because we expect to retrieve all the microposts associated with a given user&nbsp;id in reverse order of creation, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_migration" class="hyperref">Listing&nbsp;<span class="ref">13.3</span></a> adds an index (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#aside-database_indices" class="hyperref">Box&nbsp;<span class="ref">6.2</span></a>) on the <code>user_id</code> and <code>created_at</code> columns:</p>
<div class="code"><div class="highlight"><pre><span class="n">add_index</span> <span class="ss">:microposts</span><span class="p">,</span> <span class="o">[</span><span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:created_at</span><span class="o">]</span>
</pre></div></div>
<p>By including both the <code>user_id</code> and <code>created_at</code> columns as an array, we arrange for Rails to create a <em>multiple key index</em>, which means that Active Record uses <em>both</em> keys at the same time.</p>
<p>With the migration in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_migration" class="hyperref">Listing&nbsp;<span class="ref">13.3</span></a>, we can update the database as usual:</p>
<div class="code"><div class="highlight"><pre>$ rails db:migrate
</pre></div></div>
<div id="sec-exercises_the_basic_model" data-tralics-id="uid1576" class="subsubsection" data-number="13.1.1.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_the_basic_model" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Using <code>Micropost.new</code> in the console, instantiate a new Micropost object called <code>micropost</code> with content “Lorem ipsum” and user&nbsp;id equal to the id of the first user in the database.<span class="intersentencespace"></span> What are the values of the magic columns <code>created_at</code> and <code>updated_at</code>? <span class="exercise" id="ex-e34987"></span>
</li>
<li>What is <code>micropost.user</code> for the micropost in the previous exercise?<span class="intersentencespace"></span> What about <code>micropost.user.name</code>? <span class="exercise" id="ex-4d1441"></span>
</li>
<li>Save the micropost to the database.<span class="intersentencespace"></span> What are the values of the magic columns now? <span class="exercise" id="ex-7d471e"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-micropost_validations&quot; data-tralics-id=&quot;uid1580&quot; class=&quot;subsection&quot; data-number=&quot;13.1.2&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-micropost_validations&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.1.2 &lt;/span&gt;Micropost validations&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Now that we’ve created the basic model, we’ll add some validations to enforce the desired design constraints.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; One of the necessary aspects of the Micropost model is the presence of a user id to indicate which user made the micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The idiomatically correct way to do this is to use Active Record &lt;em&gt;associations&lt;/em&gt;, which we’ll implement in &lt;a href=&quot;user_microposts_fragment.html#sec-user_micropost_associations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.1.3&lt;/span&gt;&lt;/a&gt;, but for now we’ll work with the &lt;code&gt;Micropost&lt;/code&gt; model directly.&lt;/p&gt;
&lt;p&gt;The initial micropost tests parallel those for the User model (&lt;a href=&quot;modeling_users_fragment.html#code-name_presence_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;6.7&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In the &lt;code&gt;setup&lt;/code&gt; step, we create a new micropost while associating it with a valid user from the fixtures, and then check that the result is valid.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Because every micropost should have a user id, we’ll add a test for a &lt;code&gt;user_id&lt;/code&gt; presence validation.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Putting these elements together yields the test in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_validity_test&quot; data-tralics-id=&quot;uid1581&quot; data-number=&quot;13.4&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.4:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Tests for the validity of a new micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/models/micropost_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TestCase&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# This code is not idiomatically correct.&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should be valid&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;user id should be present&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_not&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;As indicated by the comment in the &lt;code&gt;setup&lt;/code&gt; method, the code to create the micropost is not idiomatically correct, which we’ll fix in &lt;a href=&quot;user_microposts_fragment.html#sec-user_micropost_associations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.1.3&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;As with the original User model test (&lt;a href=&quot;modeling_users_fragment.html#code-valid_user_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;6.5&lt;/span&gt;&lt;/a&gt;), the first test in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt; is just a reality check, but the second is a test of the presence of the user id, for which we’ll add the presence validation shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_user_id_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.5&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_user_id_validation&quot; data-tralics-id=&quot;uid1582&quot; data-number=&quot;13.5&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.5:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A validation for the micropost’s &lt;code&gt;user_id&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;By the way, as of Rails 5 the tests in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt; actually pass without the validation in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_user_id_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.5&lt;/span&gt;&lt;/a&gt;, but only when using the idiomatically incorrect line highlighted in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The user id presence validation is necessary after switching to the idiomatically correct code in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test_idiomatic&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.12&lt;/span&gt;&lt;/a&gt;, so we include it here for convenience.&lt;/p&gt;
&lt;p&gt;With the code in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_user_id_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.5&lt;/span&gt;&lt;/a&gt; the tests should (still) be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1583&quot; data-tralics-id=&quot;uid1583&quot; data-number=&quot;13.6&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.6:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test:models
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Next, we’ll add validations for the micropost’s &lt;code&gt;content&lt;/code&gt; attribute (following the example from &lt;a href=&quot;toy_app_fragment.html#sec-putting_the_micro_in_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;2.3.2&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As with the &lt;code&gt;user_id&lt;/code&gt;, the &lt;code&gt;content&lt;/code&gt; attribute must be present, and it is further constrained to be no longer than 140 characters (which is what puts the &lt;em&gt;micro&lt;/em&gt; in micropost).&lt;/p&gt;
&lt;p&gt;As with the User model validations (&lt;a href=&quot;modeling_users_fragment.html#sec-user_validations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;6.2&lt;/span&gt;&lt;/a&gt;), we’ll add the micropost content validations using test-driven development.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The resulting tests generally follow the examples from the User model validation tests, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validations_tests&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.7&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_validations_tests&quot; data-tralics-id=&quot;uid1584&quot; data-number=&quot;13.7&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.7:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Tests for the Micropost model validations.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/models/micropost_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TestCase&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should be valid&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;user id should be present&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_not&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;content should be present&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;   &quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;assert_not&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;content should be at most 140 characters&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;141&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;assert_not&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;As in &lt;a href=&quot;modeling_users_fragment.html#sec-user_validations&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;6.2&lt;/span&gt;&lt;/a&gt;, the code in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validations_tests&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.7&lt;/span&gt;&lt;/a&gt; uses string multiplication to test the micropost length validation:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails console
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&lt;/span&gt;&amp;gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt; * 10
&lt;span class=&quot;go&quot;&gt;=&amp;gt; &quot;aaaaaaaaaa&quot;&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&lt;/span&gt;&amp;gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt; * 141
&lt;span class=&quot;go&quot;&gt;=&amp;gt; &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The corresponding application code is virtually identical to the &lt;code&gt;name&lt;/code&gt; validation for users (&lt;a href=&quot;modeling_users_fragment.html#code-length_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;6.16&lt;/span&gt;&lt;/a&gt;), as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validations&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.8&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_validations&quot; data-tralics-id=&quot;uid1585&quot; data-number=&quot;13.8&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.8:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The Micropost model validations.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;maximum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, the full test suite should be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1586&quot; data-tralics-id=&quot;uid1586&quot; data-number=&quot;13.9&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.9:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_micropost_validations&quot; data-tralics-id=&quot;uid1587&quot; class=&quot;subsubsection&quot; data-number=&quot;13.1.2.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_micropost_validations&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;At the console, instantiate a micropost with no user id and blank content.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Is it valid?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What are the full error messages? &lt;span class=&quot;exercise&quot; id=&quot;ex-0b976b&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;At the console, instantiate a second micropost with no user id and content that’s too long.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Is it valid?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What are the full error messages? &lt;span class=&quot;exercise&quot; id=&quot;ex-9e9f2b&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="839"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-micropost_validations" data-tralics-id="uid1580" class="subsection" data-number="13.1.2">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_validations" class="heading hyperref"><span class="number">13.1.2 </span>Micropost validations</a></h3>
<p>Now that we’ve created the basic model, we’ll add some validations to enforce the desired design constraints.<span class="intersentencespace"></span> One of the necessary aspects of the Micropost model is the presence of a user id to indicate which user made the micropost.<span class="intersentencespace"></span> The idiomatically correct way to do this is to use Active Record <em>associations</em>, which we’ll implement in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_micropost_associations" class="hyperref">Section&nbsp;<span class="ref">13.1.3</span></a>, but for now we’ll work with the <code>Micropost</code> model directly.</p>
<p>The initial micropost tests parallel those for the User model (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#code-name_presence_test" class="hyperref">Listing&nbsp;<span class="ref">6.7</span></a>).<span class="intersentencespace"></span> In the <code>setup</code> step, we create a new micropost while associating it with a valid user from the fixtures, and then check that the result is valid.<span class="intersentencespace"></span> Because every micropost should have a user id, we’ll add a test for a <code>user_id</code> presence validation.<span class="intersentencespace"></span> Putting these elements together yields the test in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test" class="hyperref">Listing&nbsp;<span class="ref">13.4</span></a>.</p>
<div class="codelisting" id="code-micropost_validity_test" data-tralics-id="uid1581" data-number="13.4">
<div class="heading">
<span class="number">Listing 13.4:</span> 

<span class="description">Tests for the validity of a new micropost.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/models/micropost_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
<span class="hll">    <span class="c1"># This code is not idiomatically correct.</span>
</span><span class="hll">    <span class="vi">@micropost</span> <span class="o">=</span> <span class="no">Micropost</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span>  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should be valid"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"user id should be present"</span> <span class="k">do</span>
    <span class="vi">@micropost</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">assert_not</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>As indicated by the comment in the <code>setup</code> method, the code to create the micropost is not idiomatically correct, which we’ll fix in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_micropost_associations" class="hyperref">Section&nbsp;<span class="ref">13.1.3</span></a>.</p>
<p>As with the original User model test (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#code-valid_user_test" class="hyperref">Listing&nbsp;<span class="ref">6.5</span></a>), the first test in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test" class="hyperref">Listing&nbsp;<span class="ref">13.4</span></a> is just a reality check, but the second is a test of the presence of the user&nbsp;id, for which we’ll add the presence validation shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_user_id_validation" class="hyperref">Listing&nbsp;<span class="ref">13.5</span></a>.</p>
<div class="codelisting" id="code-micropost_user_id_validation" data-tralics-id="uid1582" data-number="13.5">
<div class="heading">
<span class="number">Listing 13.5:</span> 

<span class="description">A validation for the micropost’s <code>user_id</code>.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
<span class="hll">  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p>By the way, as of Rails&nbsp;5 the tests in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test" class="hyperref">Listing&nbsp;<span class="ref">13.4</span></a> actually pass without the validation in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_user_id_validation" class="hyperref">Listing&nbsp;<span class="ref">13.5</span></a>, but only when using the idiomatically incorrect line highlighted in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test" class="hyperref">Listing&nbsp;<span class="ref">13.4</span></a>.<span class="intersentencespace"></span> The user&nbsp;id presence validation is necessary after switching to the idiomatically correct code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test_idiomatic" class="hyperref">Listing&nbsp;<span class="ref">13.12</span></a>, so we include it here for convenience.</p>
<p>With the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_user_id_validation" class="hyperref">Listing&nbsp;<span class="ref">13.5</span></a> the tests should (still) be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1583" data-tralics-id="uid1583" data-number="13.6">
<div class="heading">
<span class="number">Listing 13.6:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test:models
</pre></div></div>
</div>
<p>Next, we’ll add validations for the micropost’s <code>content</code> attribute (following the example from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-putting_the_micro_in_microposts" class="hyperref">Section&nbsp;<span class="ref">2.3.2</span></a>).<span class="intersentencespace"></span> As with the <code>user_id</code>, the <code>content</code> attribute must be present, and it is further constrained to be no longer than 140 characters (which is what puts the <em>micro</em> in micropost).</p>
<p>As with the User model validations (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-user_validations" class="hyperref">Section&nbsp;<span class="ref">6.2</span></a>), we’ll add the micropost content validations using test-driven development.<span class="intersentencespace"></span> The resulting tests generally follow the examples from the User model validation tests, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validations_tests" class="hyperref">Listing&nbsp;<span class="ref">13.7</span></a>.</p>
<div class="codelisting" id="code-micropost_validations_tests" data-tralics-id="uid1584" data-number="13.7">
<div class="heading">
<span class="number">Listing 13.7:</span> 

<span class="description">Tests for the Micropost model validations.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/models/micropost_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
    <span class="vi">@micropost</span> <span class="o">=</span> <span class="no">Micropost</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should be valid"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"user id should be present"</span> <span class="k">do</span>
    <span class="vi">@micropost</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">assert_not</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

<span class="hll">  <span class="nb">test</span> <span class="s2">"content should be present"</span> <span class="k">do</span>
</span><span class="hll">    <span class="vi">@micropost</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s2">"   "</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="hll">  <span class="nb">test</span> <span class="s2">"content should be at most 140 characters"</span> <span class="k">do</span>
</span><span class="hll">    <span class="vi">@micropost</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">141</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p>As in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-user_validations" class="hyperref">Section&nbsp;<span class="ref">6.2</span></a>, the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validations_tests" class="hyperref">Listing&nbsp;<span class="ref">13.7</span></a> uses string multiplication to test the micropost length validation:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails console
<span class="gp">&gt;</span>&gt; <span class="s2">"a"</span> * 10
<span class="go">=&gt; "aaaaaaaaaa"</span>
<span class="gp">&gt;</span>&gt; <span class="s2">"a"</span> * 141
<span class="go">=&gt; "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>
<span class="go">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"</span>
</pre></div></div>
<p>The corresponding application code is virtually identical to the <code>name</code> validation for users (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#code-length_validation" class="hyperref">Listing&nbsp;<span class="ref">6.16</span></a>), as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validations" class="hyperref">Listing&nbsp;<span class="ref">13.8</span></a>.</p>
<div class="codelisting" id="code-micropost_validations" data-tralics-id="uid1585" data-number="13.8">
<div class="heading">
<span class="number">Listing 13.8:</span> 

<span class="description">The Micropost model validations.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="hll">  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">140</span> <span class="p">}</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p>At this point, the full test suite should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1586" data-tralics-id="uid1586" data-number="13.9">
<div class="heading">
<span class="number">Listing 13.9:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
<div id="sec-exercises_micropost_validations" data-tralics-id="uid1587" class="subsubsection" data-number="13.1.2.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_micropost_validations" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>At the console, instantiate a micropost with no user&nbsp;id and blank content.<span class="intersentencespace"></span> Is it valid?<span class="intersentencespace"></span> What are the full error messages? <span class="exercise" id="ex-0b976b"></span>
</li>
<li>At the console, instantiate a second micropost with no user&nbsp;id and content that’s too long.<span class="intersentencespace"></span> Is it valid?<span class="intersentencespace"></span> What are the full error messages? <span class="exercise" id="ex-9e9f2b"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-user_micropost_associations&quot; data-tralics-id=&quot;uid1590&quot; class=&quot;subsection&quot; data-number=&quot;13.1.3&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-user_micropost_associations&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.1.3 &lt;/span&gt;User/Micropost associations&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;When constructing data models for web applications, it is essential to be able to make &lt;em&gt;associations&lt;/em&gt; between individual models.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In the present case, each micropost is associated with one user, and each user is associated with (potentially) many microposts—a relationship seen briefly in &lt;a href=&quot;toy_app_fragment.html#sec-demo_user_has_many_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;2.3.3&lt;/span&gt;&lt;/a&gt; and shown schematically in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_belongs_to_user&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.2&lt;/span&gt;&lt;/a&gt; and &lt;a href=&quot;user_microposts_fragment.html#fig-user_has_many_microposts&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.3&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As part of implementing these associations, we’ll write tests for the Micropost model and add a couple of tests to the User model.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_belongs_to_user&quot; data-tralics-id=&quot;uid1591&quot; data-number=&quot;13.2&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/micropost_belongs_to_user.png&quot; alt=&quot;images/figures/micropost_belongs_to_user&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.2: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The &lt;code&gt;belongs_to&lt;/code&gt; relationship between a micropost and its associated user.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-user_has_many_microposts&quot; data-tralics-id=&quot;uid1592&quot; data-number=&quot;13.3&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/user_has_many_microposts.png&quot; alt=&quot;images/figures/user_has_many_microposts&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.3: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The &lt;code&gt;has_many&lt;/code&gt; relationship between a user and its microposts.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Using the &lt;code&gt;belongs_to&lt;/code&gt;/&lt;code&gt;has_many&lt;/code&gt; association defined in this section, Rails constructs the methods shown in &lt;a href=&quot;user_microposts_fragment.html#table-association_methods&quot; class=&quot;hyperref&quot;&gt;Table &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note from &lt;a href=&quot;user_microposts_fragment.html#table-association_methods&quot; class=&quot;hyperref&quot;&gt;Table &lt;span class=&quot;ref&quot;&gt;13.1&lt;/span&gt;&lt;/a&gt; that instead of&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create!&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we have&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create!&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These latter methods constitute the idiomatically correct way to make a micropost, namely, &lt;em&gt;through&lt;/em&gt; its association with a user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; When a new micropost is made in this way, its &lt;code&gt;user_id&lt;/code&gt; is automatically set to the right value.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, we can replace the code&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# This code is not idiomatically correct.&lt;/span&gt;
&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;from &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt; with this:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(As with &lt;code&gt;new&lt;/code&gt;, &lt;code&gt;build&lt;/code&gt; returns an object in memory but doesn’t modify the database.)&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Once we define the proper associations, the resulting &lt;code&gt;@micropost&lt;/code&gt; variable will automatically have a &lt;code&gt;user_id&lt;/code&gt; attribute equal to its associated user’s id.&lt;/p&gt;
&lt;div class=&quot;table&quot; id=&quot;table-association_methods&quot; data-tralics-id=&quot;uid1593&quot; data-number=&quot;13.1&quot;&gt;
&lt;table class=&quot;tabular&quot;&gt;
&lt;tbody&gt;
&lt;tr class=&quot;bottom_border&quot;&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;strong&gt;Method&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;strong&gt;Purpose&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;micropost.user&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;Returns the User object associated with the micropost&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;user.microposts&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;Returns a collection of the user’s microposts&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;user.microposts.create(arg)&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;Creates a micropost associated with &lt;code&gt;user&lt;/code&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;user.microposts.create!(arg)&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;Creates a micropost associated with &lt;code&gt;user&lt;/code&gt; (exception on failure)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;user.microposts.build(arg)&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;Returns a new Micropost object associated with &lt;code&gt;user&lt;/code&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;user.microposts.find_by(id: 1)&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;Finds the micropost with id &lt;code&gt;1&lt;/code&gt; and &lt;code&gt;user_id&lt;/code&gt; equal to &lt;code&gt;user.id&lt;/code&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Table 13.1: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A summary of user/micropost association methods.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;To get code like &lt;code&gt;@user.microposts.build&lt;/code&gt; to work, we need to update the User and Micropost models with code to associate them.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The first of these was included automatically by the migration in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_migration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.3&lt;/span&gt;&lt;/a&gt; via &lt;code&gt;belongs_to :user&lt;/code&gt;, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_belongs_to_user&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.10&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The second half of the association, &lt;code&gt;has_many :microposts&lt;/code&gt;, needs to be added by hand, as shown in (&lt;a href=&quot;user_microposts_fragment.html#code-user_has_many_microposts&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.11&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_belongs_to_user&quot; data-tralics-id=&quot;uid1594&quot; data-number=&quot;13.10&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.10:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A micropost &lt;code&gt;belongs_to&lt;/code&gt; a user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;maximum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-user_has_many_microposts&quot; data-tralics-id=&quot;uid1595&quot; data-number=&quot;13.11&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.11:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A user &lt;code&gt;has_many&lt;/code&gt; microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/user.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:microposts&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;With the association thus made, we can update the &lt;code&gt;setup&lt;/code&gt; method in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt; with the idiomatically correct way to build a new micropost, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test_idiomatic&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.12&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_validity_test_idiomatic&quot; data-tralics-id=&quot;uid1596&quot; data-number=&quot;13.12&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.12:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Using idiomatically correct code to build a micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/models/micropost_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TestCase&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should be valid&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;user id should be present&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_not&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;valid?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Of course, after this minor refactoring the test suite should still be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1597&quot; data-tralics-id=&quot;uid1597&quot; data-number=&quot;13.13&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.13:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_user_micropost_associations&quot; data-tralics-id=&quot;uid1598&quot; class=&quot;subsubsection&quot; data-number=&quot;13.1.3.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_user_micropost_associations&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Set &lt;code&gt;user&lt;/code&gt; to the first user in the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What happens when you execute the command &lt;code&gt;micropost = user.microposts.create(content: &quot;Lorem ipsum&quot;)&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-e4a0bb&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;The previous exercise should have created a micropost in the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Confirm this by running &lt;code&gt;user.microposts.find(micropost.id)&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What if you write &lt;code&gt;micropost&lt;/code&gt; instead of &lt;code&gt;micropost.id&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-481476&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;What is the value of &lt;code&gt;user == micropost.user&lt;/code&gt;?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; How about &lt;code&gt;user.microposts.first == micropost&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-90cee5&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="840"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-user_micropost_associations" data-tralics-id="uid1590" class="subsection" data-number="13.1.3">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_micropost_associations" class="heading hyperref"><span class="number">13.1.3 </span>User/Micropost associations</a></h3>
<p>When constructing data models for web applications, it is essential to be able to make <em>associations</em> between individual models.<span class="intersentencespace"></span> In the present case, each micropost is associated with one user, and each user is associated with (potentially) many microposts—a relationship seen briefly in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#sec-demo_user_has_many_microposts" class="hyperref">Section&nbsp;<span class="ref">2.3.3</span></a> and shown schematically in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_belongs_to_user" class="hyperref">Figure&nbsp;<span class="ref">13.2</span></a> and <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_has_many_microposts" class="hyperref">Figure&nbsp;<span class="ref">13.3</span></a>.<span class="intersentencespace"></span> As part of implementing these associations, we’ll write tests for the Micropost model and add a couple of tests to the User model.</p>
<div class="center figure" id="fig-micropost_belongs_to_user" data-tralics-id="uid1591" data-number="13.2">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/micropost_belongs_to_user.png" alt="images/figures/micropost_belongs_to_user"></div>
<div class="caption">
<span class="header">Figure 13.2: </span><span class="description">The <code>belongs_to</code> relationship between a micropost and its associated user.
</span>
</div>
</div>
<div class="center figure" id="fig-user_has_many_microposts" data-tralics-id="uid1592" data-number="13.3">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/user_has_many_microposts.png" alt="images/figures/user_has_many_microposts"></div>
<div class="caption">
<span class="header">Figure 13.3: </span><span class="description">The <code>has_many</code> relationship between a user and its microposts.
</span>
</div>
</div>
<p>Using the <code>belongs_to</code>/<code>has_many</code> association defined in this section, Rails constructs the methods shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#table-association_methods" class="hyperref">Table&nbsp;<span class="ref">13.1</span></a>.<span class="intersentencespace"></span> Note from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#table-association_methods" class="hyperref">Table&nbsp;<span class="ref">13.1</span></a> that instead of</p>
<div class="code"><div class="highlight"><pre><span class="no">Micropost</span><span class="o">.</span><span class="n">create</span>
<span class="no">Micropost</span><span class="o">.</span><span class="n">create!</span>
<span class="no">Micropost</span><span class="o">.</span><span class="n">new</span>
</pre></div></div>
<p>we have</p>
<div class="code"><div class="highlight"><pre><span class="n">user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">create</span>
<span class="n">user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">create!</span>
<span class="n">user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span>
</pre></div></div>
<p>These latter methods constitute the idiomatically correct way to make a micropost, namely, <em>through</em> its association with a user.<span class="intersentencespace"></span> When a new micropost is made in this way, its <code>user_id</code> is automatically set to the right value.<span class="intersentencespace"></span> In particular, we can replace the code</p>
<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
<span class="c1"># This code is not idiomatically correct.</span>
<span class="vi">@micropost</span> <span class="o">=</span> <span class="no">Micropost</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div></div>
<p>from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test" class="hyperref">Listing&nbsp;<span class="ref">13.4</span></a> with this:</p>
<div class="code"><div class="highlight"><pre><span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
<span class="vi">@micropost</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">)</span>
</pre></div></div>
<p>(As with <code>new</code>, <code>build</code> returns an object in memory but doesn’t modify the database.)<span class="intersentencespace"></span> Once we define the proper associations, the resulting <code>@micropost</code> variable will automatically have a <code>user_id</code> attribute equal to its associated user’s id.</p>
<div class="table" id="table-association_methods" data-tralics-id="uid1593" data-number="13.1">
<table class="tabular">
<tbody>
<tr class="bottom_border">
<td class="align_left"><strong>Method</strong></td>
<td class="align_left"><strong>Purpose</strong></td>
</tr>
<tr>
<td class="align_left"><code>micropost.user</code></td>
<td class="align_left">Returns the User object associated with the micropost</td>
</tr>
<tr>
<td class="align_left"><code>user.microposts</code></td>
<td class="align_left">Returns a collection of the user’s microposts</td>
</tr>
<tr>
<td class="align_left"><code>user.microposts.create(arg)</code></td>
<td class="align_left">Creates a micropost associated with <code>user</code>
</td>
</tr>
<tr>
<td class="align_left"><code>user.microposts.create!(arg)</code></td>
<td class="align_left">Creates a micropost associated with <code>user</code> (exception on failure)</td>
</tr>
<tr>
<td class="align_left"><code>user.microposts.build(arg)</code></td>
<td class="align_left">Returns a new Micropost object associated with <code>user</code>
</td>
</tr>
<tr>
<td class="align_left"><code>user.microposts.find_by(id: 1)</code></td>
<td class="align_left">Finds the micropost with id&nbsp;<code>1</code> and <code>user_id</code> equal to <code>user.id</code>
</td>
</tr>
</tbody>
</table>
<div class="caption">
<span class="header">Table 13.1: </span><span class="description">A summary of user/micropost association methods.
</span>
</div>
</div>
<p>To get code like <code>@user.microposts.build</code> to work, we need to update the User and Micropost models with code to associate them.<span class="intersentencespace"></span> The first of these was included automatically by the migration in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_migration" class="hyperref">Listing&nbsp;<span class="ref">13.3</span></a> via <code>belongs_to :user</code>, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_belongs_to_user" class="hyperref">Listing&nbsp;<span class="ref">13.10</span></a>.<span class="intersentencespace"></span> The second half of the association, <code>has_many :microposts</code>, needs to be added by hand, as shown in (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_has_many_microposts" class="hyperref">Listing&nbsp;<span class="ref">13.11</span></a>).</p>
<div class="codelisting" id="code-micropost_belongs_to_user" data-tralics-id="uid1594" data-number="13.10">
<div class="heading">
<span class="number">Listing 13.10:</span> 

<span class="description">A micropost <code>belongs_to</code> a user.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="hll">  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span>  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-user_has_many_microposts" data-tralics-id="uid1595" data-number="13.11">
<div class="heading">
<span class="number">Listing 13.11:</span> 

<span class="description">A user <code>has_many</code> microposts.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/models/user.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:microposts</span>
</span>  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>With the association thus made, we can update the <code>setup</code> method in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test" class="hyperref">Listing&nbsp;<span class="ref">13.4</span></a> with the idiomatically correct way to build a new micropost, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test_idiomatic" class="hyperref">Listing&nbsp;<span class="ref">13.12</span></a>.</p>
<div class="codelisting" id="code-micropost_validity_test_idiomatic" data-tralics-id="uid1596" data-number="13.12">
<div class="heading">
<span class="number">Listing 13.12:</span> 

<span class="description">Using idiomatically correct code to build a micropost.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/models/micropost_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
<span class="hll">    <span class="vi">@micropost</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">)</span>
</span>  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should be valid"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"user id should be present"</span> <span class="k">do</span>
    <span class="vi">@micropost</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">assert_not</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Of course, after this minor refactoring the test suite should still be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1597" data-tralics-id="uid1597" data-number="13.13">
<div class="heading">
<span class="number">Listing 13.13:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
<div id="sec-exercises_user_micropost_associations" data-tralics-id="uid1598" class="subsubsection" data-number="13.1.3.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_user_micropost_associations" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Set <code>user</code> to the first user in the database.<span class="intersentencespace"></span> What happens when you execute the command <code>micropost = user.microposts.create(content: "Lorem ipsum")</code>? <span class="exercise" id="ex-e4a0bb"></span>
</li>
<li>The previous exercise should have created a micropost in the database.<span class="intersentencespace"></span> Confirm this by running <code>user.microposts.find(micropost.id)</code>.<span class="intersentencespace"></span> What if you write <code>micropost</code> instead of <code>micropost.id</code>? <span class="exercise" id="ex-481476"></span>
</li>
<li>What is the value of <code>user == micropost.user</code>?<span class="intersentencespace"></span> How about <code>user.microposts.first == micropost</code>? <span class="exercise" id="ex-90cee5"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-ordering_and_dependency&quot; data-tralics-id=&quot;uid1602&quot; class=&quot;subsection&quot; data-number=&quot;13.1.4&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-ordering_and_dependency&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.1.4 &lt;/span&gt;Micropost refinements&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;In this section, we’ll add a couple of refinements to the user/micropost association.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, we’ll arrange for a user’s microposts to be retrieved in a specific &lt;em&gt;order&lt;/em&gt;, and we’ll also make microposts &lt;em&gt;dependent&lt;/em&gt; on users so that they will be automatically destroyed if their associated user is destroyed.&lt;/p&gt;
&lt;div id=&quot;sec-default_scope&quot; data-tralics-id=&quot;uid1603&quot; class=&quot;subsubsection&quot; data-number=&quot;13.1.4.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-default_scope&quot; class=&quot;heading&quot;&gt;Default scope&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;By default, the &lt;code&gt;user.microposts&lt;/code&gt; method makes no guarantees about the order of the posts, but (following the convention of blogs and Twitter) we want the microposts to come out in reverse order of when they were created so that the most recent post is first.&lt;sup id=&quot;cha-13_footnote-ref-4&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-4&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll arrange for this to happen using a &lt;em&gt;default scope&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;This is exactly the sort of feature that could easily lead to a spurious passing test (i.e., a test that would pass even if the application code were wrong), so we’ll proceed using test-driven development to be sure we’re testing the right thing.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, let’s write a test to verify that the first micropost in the database is the same as a fixture micropost we’ll call &lt;code&gt;most_recent&lt;/code&gt;, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_order_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.14&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_order_test&quot; data-tralics-id=&quot;uid1605&quot; data-number=&quot;13.14&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.14:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Testing the micropost order.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/models/micropost_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TestCase&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;order should be most recent first&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_equal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:most_recent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;user_microposts_fragment.html#code-micropost_order_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.14&lt;/span&gt;&lt;/a&gt; relies on having some micropost fixtures, which we define as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_fixtures&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.15&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_fixtures&quot; data-tralics-id=&quot;uid1606&quot; data-number=&quot;13.15&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.15:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Micropost fixtures.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/fixtures/microposts.yml&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;orange&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;I&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;just&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ate&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;an&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;orange!&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 10.minutes.ago %&amp;gt;&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;tau_manifesto&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Check&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;the&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@tauday&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@mhartl:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://tauday.com&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 3.years.ago %&amp;gt;&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;cat_video&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Sad&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;cats&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;are&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sad:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://youtu.be/PKffm2uI4dk&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 2.hours.ago %&amp;gt;&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;most_recent&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Writing&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;short&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;test&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= Time.zone.now %&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Note that we have explicitly set the &lt;code&gt;created_at&lt;/code&gt; column using embedded Ruby.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Because it’s a “magic” column automatically updated by Rails, setting it by hand isn’t ordinarily possible, but it is possible in fixtures.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In practice this might not be necessary, and in fact on many systems the fixtures are created in order.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In this case, the final fixture in the file is created last (and hence is most recent), but it would be foolish to rely on this behavior, which is brittle and probably system-dependent.&lt;/p&gt;
&lt;p&gt;With the code in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_order_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.14&lt;/span&gt;&lt;/a&gt; and &lt;a href=&quot;user_microposts_fragment.html#code-micropost_fixtures&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.15&lt;/span&gt;&lt;/a&gt;, the test suite should be &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1607&quot; data-tralics-id=&quot;uid1607&quot; data-number=&quot;13.16&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.16:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test test/models/micropost_test.rb
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We’ll get the test to pass using a Rails method called &lt;code&gt;default_scope&lt;/code&gt;, which among other things can be used to set the default order in which elements are retrieved from the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To enforce a particular order, we’ll include the &lt;code&gt;order&lt;/code&gt; argument in &lt;code&gt;default_scope&lt;/code&gt;, which lets us order by the &lt;code&gt;created_at&lt;/code&gt; column as follows:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Unfortunately, this orders the results in &lt;em&gt;ascending&lt;/em&gt; order from smallest to biggest, which means that the oldest microposts come out first.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To pull them out in reverse order, we can push down one level deeper and include a string with some raw SQL:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;created_at DESC&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here &lt;code&gt;DESC&lt;/code&gt; is SQL for “descending”, i.e., in descending order from newest to oldest.&lt;sup id=&quot;cha-13_footnote-ref-5&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-5&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In older versions of Rails, using this raw SQL used to be the only option to get the desired behavior, but as of Rails 4.0 we can use a more natural pure-Ruby syntax as well:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Adding this in a default scope for the Micropost model gives &lt;a href=&quot;user_microposts_fragment.html#code-micropost_ordering&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.17&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_ordering&quot; data-tralics-id=&quot;uid1609&quot; data-number=&quot;13.17&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.17:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Ordering the microposts with &lt;code&gt;default_scope&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;default_scope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;maximum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;user_microposts_fragment.html#code-micropost_ordering&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.17&lt;/span&gt;&lt;/a&gt; introduces the “stabby lambda” syntax for an object called a &lt;em&gt;Proc&lt;/em&gt; (procedure) or &lt;em&gt;lambda&lt;/em&gt;, which is an &lt;em&gt;anonymous function&lt;/em&gt; (a function created without a name).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The stabby lambda &lt;code&gt;-&amp;gt;&lt;/code&gt; takes in a block (&lt;a href=&quot;rails_flavored_ruby_fragment.html#sec-blocks&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;4.3.2&lt;/span&gt;&lt;/a&gt;) and returns a Proc, which can then be evaluated with the &lt;code&gt;call&lt;/code&gt; method.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We can see how it works at the console:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;&amp;gt;&lt;/span&gt;&amp;gt; -&amp;gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; puts &lt;span class=&quot;s2&quot;&gt;&quot;foo&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;=&amp;gt; #&amp;lt;Proc:0x007fab938d0108@(irb):1 (lambda)&amp;gt;&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&lt;/span&gt;&amp;gt; -&amp;gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; puts &lt;span class=&quot;s2&quot;&gt;&quot;foo&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;.call
&lt;span class=&quot;go&quot;&gt;foo&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;=&amp;gt; nil&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(This is a somewhat advanced Ruby topic, so don’t worry if it doesn’t make sense right away.)&lt;/p&gt;
&lt;p&gt;With the code in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_ordering&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.17&lt;/span&gt;&lt;/a&gt;, the tests should be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1610&quot; data-tralics-id=&quot;uid1610&quot; data-number=&quot;13.18&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.18:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-dependent_destroy&quot; data-tralics-id=&quot;uid1611&quot; class=&quot;subsubsection&quot; data-number=&quot;13.1.4.2&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-dependent_destroy&quot; class=&quot;heading&quot;&gt;Dependent: destroy&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Apart from proper ordering, there is a second refinement we’d like to add to microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Recall from &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-deleting_users&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.4&lt;/span&gt;&lt;/a&gt; that site administrators have the power to &lt;em&gt;destroy&lt;/em&gt; users.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; It stands to reason that, if a user is destroyed, the user’s microposts should be destroyed as well.&lt;/p&gt;
&lt;p&gt;We can arrange for this behavior by passing an option to the &lt;code&gt;has_many&lt;/code&gt; association method, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_dependency&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.19&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_dependency&quot; data-tralics-id=&quot;uid1612&quot; data-number=&quot;13.19&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.19:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Ensuring that a user’s microposts are destroyed along with the user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/user.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;dependent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Here the option &lt;code&gt;dependent: :destroy&lt;/code&gt; arranges for the dependent microposts to be destroyed when the user itself is destroyed.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This prevents userless microposts from being stranded in the database when admins choose to remove users from the system.&lt;/p&gt;
&lt;p&gt;We can verify that &lt;a href=&quot;user_microposts_fragment.html#code-micropost_dependency&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.19&lt;/span&gt;&lt;/a&gt; is working with a test for the User model.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; All we need to do is save the user (so it gets an id) and create an associated micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Then we check that destroying the user reduces the micropost count by 1.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result appears in &lt;a href=&quot;user_microposts_fragment.html#code-dependent_destroy_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.20&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (Compare to the integration test for “delete” links in &lt;a href=&quot;updating_and_deleting_users_fragment.html#code-delete_link_integration_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.62&lt;/span&gt;&lt;/a&gt;.)&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-dependent_destroy_test&quot; data-tralics-id=&quot;uid1613&quot; data-number=&quot;13.20&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.20:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A test of &lt;code&gt;dependent: :destroy&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/models/user_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UserTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TestCase&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Example User&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;user@example.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;ss&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;foobar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;foobar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;associated microposts should be destroyed&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destroy&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;If the code in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_dependency&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.19&lt;/span&gt;&lt;/a&gt; is working correctly, the test suite should still be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1614&quot; data-tralics-id=&quot;uid1614&quot; data-number=&quot;13.21&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.21:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_ordering_and_dependency&quot; data-tralics-id=&quot;uid1615&quot; class=&quot;subsubsection&quot; data-number=&quot;13.1.4.3&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_ordering_and_dependency&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;How does the value of &lt;code&gt;Micropost.first.created_at&lt;/code&gt; compare to &lt;code&gt;Micropost.last.created_at&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-3816f5&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;What are the SQL queries for Micropost.first and Micropost.last?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;em&gt;Hint&lt;/em&gt;: They are printed out by the console. &lt;span class=&quot;exercise&quot; id=&quot;ex-e34fbc&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Let &lt;code&gt;user&lt;/code&gt; be the first user in the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What is the id of its first micropost?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Destroy the first user in the database using the &lt;code&gt;destroy&lt;/code&gt; method, then confirm using &lt;code&gt;Micropost.find&lt;/code&gt; that the user’s first micropost was also destroyed. &lt;span class=&quot;exercise&quot; id=&quot;ex-ec2e6b&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="841"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-ordering_and_dependency" data-tralics-id="uid1602" class="subsection" data-number="13.1.4">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-ordering_and_dependency" class="heading hyperref"><span class="number">13.1.4 </span>Micropost refinements</a></h3>
<p>In this section, we’ll add a couple of refinements to the user/micropost association.<span class="intersentencespace"></span> In particular, we’ll arrange for a user’s microposts to be retrieved in a specific <em>order</em>, and we’ll also make microposts <em>dependent</em> on users so that they will be automatically destroyed if their associated user is destroyed.</p>
<div id="sec-default_scope" data-tralics-id="uid1603" class="subsubsection" data-number="13.1.4.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-default_scope" class="heading">Default scope</a></h4>
<p>By default, the <code>user.microposts</code> method makes no guarantees about the order of the posts, but (following the convention of blogs and Twitter) we want the microposts to come out in reverse order of when they were created so that the most recent post is first.<sup id="cha-13_footnote-ref-4" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-4" data-hasqtip="11">4</a></sup><span class="intersentencespace"></span> We’ll arrange for this to happen using a <em>default scope</em>.</p>
<p>This is exactly the sort of feature that could easily lead to a spurious passing test (i.e., a test that would pass even if the application code were wrong), so we’ll proceed using test-driven development to be sure we’re testing the right thing.<span class="intersentencespace"></span> In particular, let’s write a test to verify that the first micropost in the database is the same as a fixture micropost we’ll call <code>most_recent</code>, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_order_test" class="hyperref">Listing&nbsp;<span class="ref">13.14</span></a>.</p>
<div class="codelisting" id="code-micropost_order_test" data-tralics-id="uid1605" data-number="13.14">
<div class="heading">
<span class="number">Listing 13.14:</span> 

<span class="description">Testing the micropost order.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/models/micropost_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"order should be most recent first"</span> <span class="k">do</span>
    <span class="n">assert_equal</span> <span class="n">microposts</span><span class="p">(</span><span class="ss">:most_recent</span><span class="p">),</span> <span class="no">Micropost</span><span class="o">.</span><span class="n">first</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_order_test" class="hyperref">Listing&nbsp;<span class="ref">13.14</span></a> relies on having some micropost fixtures, which we define as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_fixtures" class="hyperref">Listing&nbsp;<span class="ref">13.15</span></a>.</p>
<div class="codelisting" id="code-micropost_fixtures" data-tralics-id="uid1606" data-number="13.15">
<div class="heading">
<span class="number">Listing 13.15:</span> 

<span class="description">Micropost fixtures.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/fixtures/microposts.yml</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="l-Scalar-Plain">orange</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"I</span><span class="nv"> </span><span class="s">just</span><span class="nv"> </span><span class="s">ate</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">orange!"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 10.minutes.ago %&gt;</span>

<span class="l-Scalar-Plain">tau_manifesto</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Check</span><span class="nv"> </span><span class="s">out</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">@tauday</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">@mhartl:</span><span class="nv"> </span><span class="s">http://tauday.com"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 3.years.ago %&gt;</span>

<span class="l-Scalar-Plain">cat_video</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Sad</span><span class="nv"> </span><span class="s">cats</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">sad:</span><span class="nv"> </span><span class="s">http://youtu.be/PKffm2uI4dk"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 2.hours.ago %&gt;</span>

<span class="l-Scalar-Plain">most_recent</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Writing</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">short</span><span class="nv"> </span><span class="s">test"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= Time.zone.now %&gt;</span>
</pre></div></div>
</div>
<p>Note that we have explicitly set the <code>created_at</code> column using embedded Ruby.<span class="intersentencespace"></span> Because it’s a “magic” column automatically updated by Rails, setting it by hand isn’t ordinarily possible, but it is possible in fixtures.<span class="intersentencespace"></span> In practice this might not be necessary, and in fact on many systems the fixtures are created in order.<span class="intersentencespace"></span> In this case, the final fixture in the file is created last (and hence is most recent), but it would be foolish to rely on this behavior, which is brittle and probably system-dependent.</p>
<p>With the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_order_test" class="hyperref">Listing&nbsp;<span class="ref">13.14</span></a> and <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_fixtures" class="hyperref">Listing&nbsp;<span class="ref">13.15</span></a>, the test suite should be <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1607" data-tralics-id="uid1607" data-number="13.16">
<div class="heading">
<span class="number">Listing 13.16:</span> <span class="description"><span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test test/models/micropost_test.rb
</pre></div></div>
</div>
<p>We’ll get the test to pass using a Rails method called <code>default_scope</code>, which among other things can be used to set the default order in which elements are retrieved from the database.<span class="intersentencespace"></span> To enforce a particular order, we’ll include the <code>order</code> argument in <code>default_scope</code>, which lets us order by the <code>created_at</code> column as follows:</p>
<div class="code"><div class="highlight"><pre><span class="n">order</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span>
</pre></div></div>
<p>Unfortunately, this orders the results in <em>ascending</em> order from smallest to biggest, which means that the oldest microposts come out first.<span class="intersentencespace"></span> To pull them out in reverse order, we can push down one level deeper and include a string with some raw SQL:</p>
<div class="code"><div class="highlight"><pre><span class="n">order</span><span class="p">(</span><span class="s1">'created_at DESC'</span><span class="p">)</span>
</pre></div></div>
<p>Here <code>DESC</code> is SQL for “descending”, i.e., in descending order from newest to oldest.<sup id="cha-13_footnote-ref-5" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-5" data-hasqtip="12">5</a></sup><span class="intersentencespace"></span> In older versions of Rails, using this raw SQL used to be the only option to get the desired behavior, but as of Rails&nbsp;4.0 we can use a more natural pure-Ruby syntax as well:</p>
<div class="code"><div class="highlight"><pre><span class="n">order</span><span class="p">(</span><span class="ss">created_at</span><span class="p">:</span> <span class="ss">:desc</span><span class="p">)</span>
</pre></div></div>
<p>Adding this in a default scope for the Micropost model gives <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_ordering" class="hyperref">Listing&nbsp;<span class="ref">13.17</span></a>.</p>
<div class="codelisting" id="code-micropost_ordering" data-tralics-id="uid1609" data-number="13.17">
<div class="heading">
<span class="number">Listing 13.17:</span> 

<span class="description">Ordering the microposts with <code>default_scope</code>.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
<span class="hll">  <span class="n">default_scope</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">created_at</span><span class="p">:</span> <span class="ss">:desc</span><span class="p">)</span> <span class="p">}</span>
</span>  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_ordering" class="hyperref">Listing&nbsp;<span class="ref">13.17</span></a> introduces the “stabby lambda” syntax for an object called a <em>Proc</em> (procedure) or <em>lambda</em>, which is an <em>anonymous function</em> (a function created without a name).<span class="intersentencespace"></span> The stabby lambda <code>-&gt;</code> takes in a block (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-blocks" class="hyperref">Section&nbsp;<span class="ref">4.3.2</span></a>) and returns a Proc, which can then be evaluated with the <code>call</code> method.<span class="intersentencespace"></span> We can see how it works at the console:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;</span>&gt; -&gt; <span class="o">{</span> puts <span class="s2">"foo"</span> <span class="o">}</span>
<span class="go">=&gt; #&lt;Proc:0x007fab938d0108@(irb):1 (lambda)&gt;</span>
<span class="gp">&gt;</span>&gt; -&gt; <span class="o">{</span> puts <span class="s2">"foo"</span> <span class="o">}</span>.call
<span class="go">foo</span>
<span class="go">=&gt; nil</span>
</pre></div></div>
<p>(This is a somewhat advanced Ruby topic, so don’t worry if it doesn’t make sense right away.)</p>
<p>With the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_ordering" class="hyperref">Listing&nbsp;<span class="ref">13.17</span></a>, the tests should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1610" data-tralics-id="uid1610" data-number="13.18">
<div class="heading">
<span class="number">Listing 13.18:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
</div>
<div id="sec-dependent_destroy" data-tralics-id="uid1611" class="subsubsection" data-number="13.1.4.2">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-dependent_destroy" class="heading">Dependent: destroy</a></h4>
<p>Apart from proper ordering, there is a second refinement we’d like to add to microposts.<span class="intersentencespace"></span> Recall from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-deleting_users" class="hyperref">Section&nbsp;<span class="ref">10.4</span></a> that site administrators have the power to <em>destroy</em> users.<span class="intersentencespace"></span> It stands to reason that, if a user is destroyed, the user’s microposts should be destroyed as well.</p>
<p>We can arrange for this behavior by passing an option to the <code>has_many</code> association method, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_dependency" class="hyperref">Listing&nbsp;<span class="ref">13.19</span></a>.</p>
<div class="codelisting" id="code-micropost_dependency" data-tralics-id="uid1612" data-number="13.19">
<div class="heading">
<span class="number">Listing 13.19:</span> 

<span class="description">Ensuring that a user’s microposts are destroyed along with the user.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/user.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="hll">  <span class="n">has_many</span> <span class="ss">:microposts</span><span class="p">,</span> <span class="ss">dependent</span><span class="p">:</span> <span class="ss">:destroy</span>
</span>  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Here the option <code>dependent: :destroy</code> arranges for the dependent microposts to be destroyed when the user itself is destroyed.<span class="intersentencespace"></span> This prevents userless microposts from being stranded in the database when admins choose to remove users from the system.</p>
<p>We can verify that <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_dependency" class="hyperref">Listing&nbsp;<span class="ref">13.19</span></a> is working with a test for the User model.<span class="intersentencespace"></span> All we need to do is save the user (so it gets an id) and create an associated micropost.<span class="intersentencespace"></span> Then we check that destroying the user reduces the micropost count by 1.<span class="intersentencespace"></span> The result appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-dependent_destroy_test" class="hyperref">Listing&nbsp;<span class="ref">13.20</span></a>.<span class="intersentencespace"></span> (Compare to the integration test for “delete” links in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-delete_link_integration_test" class="hyperref">Listing&nbsp;<span class="ref">10.62</span></a>.)</p>
<div class="codelisting" id="code-dependent_destroy_test" data-tralics-id="uid1613" data-number="13.20">
<div class="heading">
<span class="number">Listing 13.20:</span> 

<span class="description">A test of <code>dependent: :destroy</code>.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/models/user_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">,</span>
                     <span class="ss">password</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"associated microposts should be destroyed"</span> <span class="k">do</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">)</span>
    <span class="n">assert_difference</span> <span class="s1">'Micropost.count'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">do</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">destroy</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>If the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_dependency" class="hyperref">Listing&nbsp;<span class="ref">13.19</span></a> is working correctly, the test suite should still be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1614" data-tralics-id="uid1614" data-number="13.21">
<div class="heading">
<span class="number">Listing 13.21:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
</div>
<div id="sec-exercises_ordering_and_dependency" data-tralics-id="uid1615" class="subsubsection" data-number="13.1.4.3">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_ordering_and_dependency" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>How does the value of <code>Micropost.first.created_at</code> compare to <code>Micropost.last.created_at</code>? <span class="exercise" id="ex-3816f5"></span>
</li>
<li>What are the SQL queries for Micropost.first and Micropost.last?<span class="intersentencespace"></span> <em>Hint</em>: They are printed out by the console. <span class="exercise" id="ex-e34fbc"></span>
</li>
<li>Let <code>user</code> be the first user in the database.<span class="intersentencespace"></span> What is the id of its first micropost?<span class="intersentencespace"></span> Destroy the first user in the database using the <code>destroy</code> method, then confirm using <code>Micropost.find</code> that the user’s first micropost was also destroyed. <span class="exercise" id="ex-ec2e6b"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent" data-html="&lt;div id=&quot;sec-showing_microposts&quot; data-tralics-id=&quot;cid75&quot; class=&quot;section&quot; data-number=&quot;13.2&quot;&gt;
&lt;h2&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-showing_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.2 &lt;/span&gt;Showing microposts&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Although we don’t yet have a way to create microposts through the web—that comes in &lt;a href=&quot;user_microposts_fragment.html#sec-creating_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.3.2&lt;/span&gt;&lt;/a&gt;—this won’t stop us from displaying them (and testing that display).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Following Twitter’s lead, we’ll plan to display a user’s microposts not on a separate microposts &lt;code&gt;index&lt;/code&gt; page but rather directly on the user &lt;code&gt;show&lt;/code&gt; page itself, as mocked up in &lt;a href=&quot;user_microposts_fragment.html#fig-user_microposts_mockup&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll start with fairly simple ERb templates for adding a micropost display to the user profile, and then we’ll add microposts to the seed data from &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-sample_users&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.3.2&lt;/span&gt;&lt;/a&gt; so that we have something to display.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-user_microposts_mockup&quot; data-tralics-id=&quot;uid1619&quot; data-number=&quot;13.4&quot;&gt;
&lt;div class=&quot;graphics image box&quot;&gt;&lt;img src=&quot;images/figures/user_microposts_mockup_3rd_edition.png&quot; alt=&quot;images/figures/user_microposts_mockup_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.4: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A mockup of a profile page with microposts.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;/div&gt;"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-showing_microposts" data-tralics-id="cid75" class="section" data-number="13.2">
<h2><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-showing_microposts" class="heading hyperref"><span class="number">13.2 </span>Showing microposts</a></h2>
<p>Although we don’t yet have a way to create microposts through the web—that comes in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-creating_microposts" class="hyperref">Section&nbsp;<span class="ref">13.3.2</span></a>—this won’t stop us from displaying them (and testing that display).<span class="intersentencespace"></span> Following Twitter’s lead, we’ll plan to display a user’s microposts not on a separate microposts <code>index</code> page but rather directly on the user <code>show</code> page itself, as mocked up in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_microposts_mockup" class="hyperref">Figure&nbsp;<span class="ref">13.4</span></a>.<span class="intersentencespace"></span> We’ll start with fairly simple ERb templates for adding a micropost display to the user profile, and then we’ll add microposts to the seed data from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-sample_users" class="hyperref">Section&nbsp;<span class="ref">10.3.2</span></a> so that we have something to display.</p>
<div class="center figure" id="fig-user_microposts_mockup" data-tralics-id="uid1619" data-number="13.4">
<div class="graphics image box"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/user_microposts_mockup_3rd_edition.png" alt="images/figures/user_microposts_mockup_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.4: </span><span class="description">A mockup of a profile page with microposts.
</span>
</div>
</div>


</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-rendering_microposts&quot; data-tralics-id=&quot;uid1620&quot; class=&quot;subsection&quot; data-number=&quot;13.2.1&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-rendering_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.2.1 &lt;/span&gt;Rendering microposts&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Our plan is to display the microposts for each user on their respective profile page (&lt;code&gt;show.html.erb&lt;/code&gt;), together with a running count of how many microposts they’ve made.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As we’ll see, many of the ideas are similar to our work in &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-showing_all_users&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.3&lt;/span&gt;&lt;/a&gt; on showing all users.&lt;/p&gt;
&lt;p&gt;In case you’ve added some microposts in the exercises, it’s a good idea to reset and reseed the database at this time:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails db:migrate:reset
$ rails db:seed
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Although we won’t need the Microposts controller until &lt;a href=&quot;user_microposts_fragment.html#sec-manipulating_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.3&lt;/span&gt;&lt;/a&gt;, we will need the views directory in just a moment, so let’s generate the controller now:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails generate controller Microposts
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Our primary purpose in this section is to render all the microposts for each user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We saw in &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-partial_refactoring&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.3.5&lt;/span&gt;&lt;/a&gt; that the code&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;ul&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@users&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;automatically renders each of the users in the &lt;code&gt;@users&lt;/code&gt; variable using the &lt;code&gt;_user.html.erb&lt;/code&gt; partial.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll define an analogous &lt;code&gt;_micropost.html.erb&lt;/code&gt; partial so that we can use the same technique on a collection of microposts as follows:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;ol&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;microposts&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@microposts&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ol&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that we’ve used the &lt;em&gt;ordered list&lt;/em&gt; tag &lt;code&gt;ol&lt;/code&gt; (as opposed to an unordered list &lt;code&gt;ul&lt;/code&gt;) because microposts are listed in a particular order (reverse-chronological).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The corresponding partial appears in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.22&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_partial&quot; data-tralics-id=&quot;uid1621&quot; data-number=&quot;13.22&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.22:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A partial for showing a single micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/microposts/_micropost.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;li&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;micropost-&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gravatar_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Posted &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_ago_in_words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt; ago.
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This uses the awesome &lt;code&gt;time_ago_in_words&lt;/code&gt; helper method, whose meaning is probably clear and whose effect we will see in &lt;a href=&quot;user_microposts_fragment.html#sec-sample_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.2.2&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.22&lt;/span&gt;&lt;/a&gt; also adds a CSS id for each micropost using&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;li&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;micropost-&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a generally good practice, as it opens up the possibility of manipulating individual microposts at a future date (using JavaScript, for example).&lt;/p&gt;
&lt;p&gt;The next step is to address the difficulty of displaying a potentially large number of microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll solve this problem the same way we solved it for users in &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-pagination&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.3.3&lt;/span&gt;&lt;/a&gt;, namely, using pagination.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As before, we’ll use the &lt;code&gt;will_paginate&lt;/code&gt; method:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;will_paginate&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@microposts&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you compare this with the analogous line on the user index page, &lt;a href=&quot;updating_and_deleting_users_fragment.html#code-will_paginate_index_view&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.45&lt;/span&gt;&lt;/a&gt;, you’ll see that before we had just&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;will_paginate&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This worked because, in the context of the Users controller, &lt;code&gt;will_paginate&lt;/code&gt; &lt;em&gt;assumes&lt;/em&gt; the existence of an instance variable called &lt;code&gt;@users&lt;/code&gt; (which, as we saw in &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-pagination&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.3.3&lt;/span&gt;&lt;/a&gt;, should be of class &lt;code&gt;ActiveRecord::Relation&lt;/code&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In the present case, since we are still in the Users controller but want to paginate &lt;em&gt;microposts&lt;/em&gt; instead, we’ll pass an explicit &lt;code&gt;@microposts&lt;/code&gt; variable to &lt;code&gt;will_paginate&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Of course, this means that we will have to define such a variable in the user &lt;code&gt;show&lt;/code&gt; action (&lt;a href=&quot;user_microposts_fragment.html#code-user_show_microposts_instance&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.23&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-user_show_microposts_instance&quot; data-tralics-id=&quot;uid1622&quot; data-number=&quot;13.23&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.23:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding an &lt;code&gt;@microposts&lt;/code&gt; instance variable to the user &lt;code&gt;show&lt;/code&gt; action.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/users_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UsersController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;show&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@microposts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paginate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Notice here how clever &lt;code&gt;paginate&lt;/code&gt; is—it even works &lt;em&gt;through&lt;/em&gt; the microposts association, reaching into the &lt;code class=&quot;tt&quot;&gt;microposts&lt;/code&gt; table and pulling out the desired page of microposts.&lt;/p&gt;
&lt;p&gt;Our final task is to display the number of microposts for each user, which we can do with the &lt;code&gt;count&lt;/code&gt; method:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As with &lt;code&gt;paginate&lt;/code&gt;, we can use the &lt;code&gt;count&lt;/code&gt; method through the association.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, &lt;code&gt;count&lt;/code&gt; does &lt;em&gt;not&lt;/em&gt; pull all the microposts out of the database and then call &lt;code&gt;length&lt;/code&gt; on the resulting array, as this would become inefficient as the number of microposts grew.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Instead, it performs the calculation directly in the database, asking the database to count the microposts with the given &lt;code&gt;user_id&lt;/code&gt; (an operation for which all databases are highly optimized).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (In the unlikely event that finding the count is still a bottleneck in your application, you can make it even faster using a &lt;a href=&quot;http://railscasts.com/episodes/23-counter-cache-column&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;em&gt;counter cache&lt;/em&gt;&lt;/a&gt;.)&lt;/p&gt;
&lt;p&gt;Putting all the elements above together, we are now in a position to add microposts to the profile page, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-user_show_microposts&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.24&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note the use of &lt;code&gt;if @user.microposts.any?&lt;/code&gt; (a construction we saw before in &lt;a href=&quot;sign_up_fragment.html#code-errors_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;7.21&lt;/span&gt;&lt;/a&gt;), which makes sure that an empty list won’t be displayed when the user has no microposts.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-user_show_microposts&quot; data-tralics-id=&quot;uid1623&quot; data-number=&quot;13.24&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.24:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding microposts to the user &lt;code&gt;show&lt;/code&gt; page.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/users/show.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;provide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;aside&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-4&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;section&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user_info&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gravatar_for&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/section&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/aside&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;any?&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Microposts (&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;lt;ol&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;microposts&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@microposts&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ol&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;will_paginate&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@microposts&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, we can get a look at our updated user profile page in &lt;a href=&quot;user_microposts_fragment.html#fig-user_profile_no_microposts&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.5&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; It’s rather…disappointing.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Of course, this is because there are not currently any microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; It’s time to change that.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-user_profile_no_microposts&quot; data-tralics-id=&quot;uid1624&quot; data-number=&quot;13.5&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/user_profile_no_microposts_3rd_edition.png&quot; alt=&quot;images/figures/user_profile_no_microposts_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.5: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The user profile page with code for microposts—but no microposts.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_rendering_microposts&quot; data-tralics-id=&quot;uid1625&quot; class=&quot;subsubsection&quot; data-number=&quot;13.2.1.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_rendering_microposts&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;As mentioned briefly in &lt;a href=&quot;sign_up_fragment.html#sec-signup_error_messages&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;7.3.3&lt;/span&gt;&lt;/a&gt;, helper methods like &lt;code&gt;time_ago_in_words&lt;/code&gt; are available in the Rails console via the &lt;code&gt;helper&lt;/code&gt; object.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Using &lt;code&gt;helper&lt;/code&gt;, apply &lt;code&gt;time_ago_in_words&lt;/code&gt; to &lt;code&gt;3.weeks.ago&lt;/code&gt; and &lt;code&gt;6.months.ago&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;What is the result of &lt;code&gt;helper.time_ago_in_words(1.year.ago)&lt;/code&gt;? &lt;span class=&quot;exercise&quot; id=&quot;ex-15ca47&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;What is the Ruby class for a page of microposts?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;em&gt;Hint&lt;/em&gt;: Use the code in &lt;a href=&quot;user_microposts_fragment.html#code-user_show_microposts_instance&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.23&lt;/span&gt;&lt;/a&gt; as your model, and call the &lt;code&gt;class&lt;/code&gt; method on &lt;code&gt;paginate&lt;/code&gt; with the argument &lt;code&gt;page: nil&lt;/code&gt;. &lt;span class=&quot;exercise&quot; id=&quot;ex-df8fbd&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="842"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-rendering_microposts" data-tralics-id="uid1620" class="subsection" data-number="13.2.1">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-rendering_microposts" class="heading hyperref"><span class="number">13.2.1 </span>Rendering microposts</a></h3>
<p>Our plan is to display the microposts for each user on their respective profile page (<code>show.html.erb</code>), together with a running count of how many microposts they’ve made.<span class="intersentencespace"></span> As we’ll see, many of the ideas are similar to our work in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-showing_all_users" class="hyperref">Section&nbsp;<span class="ref">10.3</span></a> on showing all users.</p>
<p>In case you’ve added some microposts in the exercises, it’s a good idea to reset and reseed the database at this time:</p>
<div class="code"><div class="highlight"><pre>$ rails db:migrate:reset
$ rails db:seed
</pre></div></div>
<p>Although we won’t need the Microposts controller until <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-manipulating_microposts" class="hyperref">Section&nbsp;<span class="ref">13.3</span></a>, we will need the views directory in just a moment, so let’s generate the controller now:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Microposts
</pre></div></div>
<p>Our primary purpose in this section is to render all the microposts for each user.<span class="intersentencespace"></span> We saw in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-partial_refactoring" class="hyperref">Section&nbsp;<span class="ref">10.3.5</span></a> that the code</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"users"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@users</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div></div>
<p>automatically renders each of the users in the <code>@users</code> variable using the <code>_user.html.erb</code> partial.<span class="intersentencespace"></span> We’ll define an analogous <code>_micropost.html.erb</code> partial so that we can use the same technique on a collection of microposts as follows:</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;ol</span> <span class="na">class=</span><span class="s">"microposts"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@microposts</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
</pre></div></div>
<p>Note that we’ve used the <em>ordered list</em> tag&nbsp;<code>ol</code> (as opposed to an unordered list&nbsp;<code>ul</code>) because microposts are listed in a particular order (reverse-chronological).<span class="intersentencespace"></span> The corresponding partial appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial" class="hyperref">Listing&nbsp;<span class="ref">13.22</span></a>.</p>
<div class="codelisting" id="code-micropost_partial" data-tralics-id="uid1621" data-number="13.22">
<div class="heading">
<span class="number">Listing 13.22:</span> 

<span class="description">A partial for showing a single micropost.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/microposts/_micropost.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">"micropost-</span><span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">gravatar_for</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="ss">size</span><span class="p">:</span> <span class="mi">50</span><span class="p">),</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"user"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"timestamp"</span><span class="nt">&gt;</span>
    Posted <span class="cp">&lt;%=</span> <span class="n">time_ago_in_words</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="cp">%&gt;</span> ago.
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</pre></div></div>
</div>
<p>This uses the awesome <code>time_ago_in_words</code> helper method, whose meaning is probably clear and whose effect we will see in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-sample_microposts" class="hyperref">Section&nbsp;<span class="ref">13.2.2</span></a>.<span class="intersentencespace"></span> <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial" class="hyperref">Listing&nbsp;<span class="ref">13.22</span></a> also adds a CSS&nbsp;id for each micropost using</p>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">"micropost-</span><span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
</pre></div></div>
<p>This is a generally good practice, as it opens up the possibility of manipulating individual microposts at a future date (using JavaScript, for example).</p>
<p>The next step is to address the difficulty of displaying a potentially large number of microposts.<span class="intersentencespace"></span> We’ll solve this problem the same way we solved it for users in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-pagination" class="hyperref">Section&nbsp;<span class="ref">10.3.3</span></a>, namely, using pagination.<span class="intersentencespace"></span> As before, we’ll use the <code>will_paginate</code> method:</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">will_paginate</span> <span class="vi">@microposts</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p>If you compare this with the analogous line on the user index page, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-will_paginate_index_view" class="hyperref">Listing&nbsp;<span class="ref">10.45</span></a>, you’ll see that before we had just</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">will_paginate</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p>This worked because, in the context of the Users controller, <code>will_paginate</code> <em>assumes</em> the existence of an instance variable called <code>@users</code> (which, as we saw in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-pagination" class="hyperref">Section&nbsp;<span class="ref">10.3.3</span></a>, should be of class <code>ActiveRecord::Relation</code>).<span class="intersentencespace"></span> In the present case, since we are still in the Users controller but want to paginate <em>microposts</em> instead, we’ll pass an explicit <code>@microposts</code> variable to <code>will_paginate</code>.<span class="intersentencespace"></span> Of course, this means that we will have to define such a variable in the user <code>show</code> action (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_show_microposts_instance" class="hyperref">Listing&nbsp;<span class="ref">13.23</span></a>).</p>
<div class="codelisting" id="code-user_show_microposts_instance" data-tralics-id="uid1622" data-number="13.23">
<div class="heading">
<span class="number">Listing 13.23:</span> 

<span class="description">Adding an <code>@microposts</code> instance variable to the user <code>show</code> action.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/users_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
<span class="hll">    <span class="vi">@microposts</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">page</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
</span>  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Notice here how clever <code>paginate</code> is—it even works <em>through</em> the microposts association, reaching into the <code class="tt">microposts</code> table and pulling out the desired page of microposts.</p>
<p>Our final task is to display the number of microposts for each user, which we can do with the <code>count</code> method:</p>
<div class="code"><div class="highlight"><pre><span class="n">user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">count</span>
</pre></div></div>
<p>As with <code>paginate</code>, we can use the <code>count</code> method through the association.<span class="intersentencespace"></span> In particular, <code>count</code> does <em>not</em> pull all the microposts out of the database and then call <code>length</code> on the resulting array, as this would become inefficient as the number of microposts grew.<span class="intersentencespace"></span> Instead, it performs the calculation directly in the database, asking the database to count the microposts with the given <code>user_id</code> (an operation for which all databases are highly optimized).<span class="intersentencespace"></span> (In the unlikely event that finding the count is still a bottleneck in your application, you can make it even faster using a <a href="http://railscasts.com/episodes/23-counter-cache-column" target="_blank" rel="noopener"><em>counter cache</em></a>.)</p>
<p>Putting all the elements above together, we are now in a position to add microposts to the profile page, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_show_microposts" class="hyperref">Listing&nbsp;<span class="ref">13.24</span></a>.<span class="intersentencespace"></span> Note the use of <code>if @user.microposts.any?</code> (a construction we saw before in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#code-errors_partial" class="hyperref">Listing&nbsp;<span class="ref">7.21</span></a>), which makes sure that an empty list won’t be displayed when the user has no microposts.</p>
<div class="codelisting" id="code-user_show_microposts" data-tralics-id="uid1623" data-number="13.24">
<div class="heading">
<span class="number">Listing 13.24:</span> 

<span class="description">Adding microposts to the user <code>show</code> page.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/users/show.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;aside</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"user_info"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h1&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">gravatar_for</span> <span class="vi">@user</span> <span class="cp">%&gt;</span>
        <span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;/aside&gt;</span>
<span class="hll">  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-8"</span><span class="nt">&gt;</span>
</span><span class="hll">    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">any?</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="nt">&lt;h3&gt;</span>Microposts (<span class="cp">&lt;%=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">count</span> <span class="cp">%&gt;</span>)<span class="nt">&lt;/h3&gt;</span>
</span><span class="hll">      <span class="nt">&lt;ol</span> <span class="na">class=</span><span class="s">"microposts"</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@microposts</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="nt">&lt;/ol&gt;</span>
</span><span class="hll">      <span class="cp">&lt;%=</span> <span class="n">will_paginate</span> <span class="vi">@microposts</span> <span class="cp">%&gt;</span>
</span><span class="hll">    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</span><span class="hll">  <span class="nt">&lt;/div&gt;</span>
</span><span class="nt">&lt;/div&gt;</span>
</pre></div></div>
</div>
<p>At this point, we can get a look at our updated user profile page in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_profile_no_microposts" class="hyperref">Figure&nbsp;<span class="ref">13.5</span></a>.<span class="intersentencespace"></span> It’s rather…disappointing.<span class="intersentencespace"></span> Of course, this is because there are not currently any microposts.<span class="intersentencespace"></span> It’s time to change that.</p>
<div class="center figure" id="fig-user_profile_no_microposts" data-tralics-id="uid1624" data-number="13.5">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/user_profile_no_microposts_3rd_edition.png" alt="images/figures/user_profile_no_microposts_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.5: </span><span class="description">The user profile page with code for microposts—but no microposts.
</span>
</div>
</div>
<div id="sec-exercises_rendering_microposts" data-tralics-id="uid1625" class="subsubsection" data-number="13.2.1.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_rendering_microposts" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>As mentioned briefly in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-signup_error_messages" class="hyperref">Section&nbsp;<span class="ref">7.3.3</span></a>, helper methods like <code>time_ago_in_words</code> are available in the Rails console via the <code>helper</code> object.<span class="intersentencespace"></span> Using <code>helper</code>, apply <code>time_ago_in_words</code> to <code>3.weeks.ago</code> and <code>6.months.ago</code>.<span class="intersentencespace"></span>
</li>
<li>What is the result of <code>helper.time_ago_in_words(1.year.ago)</code>? <span class="exercise" id="ex-15ca47"></span>
</li>
<li>What is the Ruby class for a page of microposts?<span class="intersentencespace"></span> <em>Hint</em>: Use the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_show_microposts_instance" class="hyperref">Listing&nbsp;<span class="ref">13.23</span></a> as your model, and call the <code>class</code> method on <code>paginate</code> with the argument <code>page: nil</code>. <span class="exercise" id="ex-df8fbd"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-sample_microposts&quot; data-tralics-id=&quot;uid1629&quot; class=&quot;subsection&quot; data-number=&quot;13.2.2&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-sample_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.2.2 &lt;/span&gt;Sample microposts&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;With all the work making templates for user microposts in &lt;a href=&quot;user_microposts_fragment.html#sec-rendering_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.2.1&lt;/span&gt;&lt;/a&gt;, the ending was rather anticlimactic.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We can rectify this sad situation by adding microposts to the seed data from &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-sample_users&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.3.2&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Adding sample microposts for &lt;em&gt;all&lt;/em&gt; the users actually takes a rather long time, so first we’ll select just the first six users (i.e., the five users with custom Gravatars, and one with the default Gravatar) using the &lt;code&gt;take&lt;/code&gt; method:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The call to &lt;code&gt;order&lt;/code&gt; ensures that we find the first six users that were created.&lt;/p&gt;
&lt;p&gt;For each of the selected users, we’ll make 50 microposts (plenty to overflow the pagination limit of 30).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To generate sample content for each micropost, we’ll use the Faker gem’s handy &lt;a href=&quot;http://rubydoc.info/gems/faker/1.3.0/Faker/Lorem&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code class=&quot;tt&quot;&gt;Lorem.sentence&lt;/code&gt;&lt;/a&gt; method.&lt;sup id=&quot;cha-13_footnote-ref-6&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-6&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result is the new seed data method shown in &lt;a href=&quot;user_microposts_fragment.html#code-sample_microposts&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.25&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (The reason for the order of the loops in &lt;a href=&quot;user_microposts_fragment.html#code-sample_microposts&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.25&lt;/span&gt;&lt;/a&gt; is to intermix the microposts for use in the status feed (&lt;a href=&quot;following_users_fragment.html#sec-the_status_feed&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;14.3&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Looping over the users first gives feeds with big runs of microposts from the same user, which is visually unappealing.)&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-sample_microposts&quot; data-tralics-id=&quot;uid1631&quot; data-number=&quot;13.25&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.25:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding microposts to the sample data.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;db/seeds.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;users&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;times&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Faker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Lorem&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sentence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, we can reseed the development database as usual:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails db:migrate:reset
$ rails db:seed
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You should also quit and restart the Rails development server.&lt;/p&gt;
&lt;p&gt;With that, we are in a position to enjoy the fruits of our &lt;a href=&quot;user_microposts_fragment.html#sec-rendering_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.2.1&lt;/span&gt;&lt;/a&gt; labors by displaying information for each micropost.&lt;sup id=&quot;cha-13_footnote-ref-7&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-7&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The preliminary results appear in &lt;a href=&quot;user_microposts_fragment.html#fig-user_profile_microposts_no_styling&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.6&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-user_profile_microposts_no_styling&quot; data-tralics-id=&quot;uid1633&quot; data-number=&quot;13.6&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/user_profile_microposts_no_styling_3rd_edition.png&quot; alt=&quot;images/figures/user_profile_microposts_no_styling_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.6: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The user profile with unstyled microposts.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The page shown in &lt;a href=&quot;user_microposts_fragment.html#fig-user_profile_microposts_no_styling&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.6&lt;/span&gt;&lt;/a&gt; has no micropost-specific styling, so let’s add some (&lt;a href=&quot;user_microposts_fragment.html#code-micropost_css&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.26&lt;/span&gt;&lt;/a&gt;) and take a look at the resulting pages.&lt;sup id=&quot;cha-13_footnote-ref-8&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-8&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_css&quot; data-tralics-id=&quot;uid1635&quot; data-number=&quot;13.26&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.26:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The CSS for microposts (including all the CSS for this chapter).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/assets/stylesheets/custom.scss&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;/*&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;microposts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*/&lt;/span&gt;

&lt;span class=&quot;nc&quot;&gt;.microposts&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;list-style&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;none&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;li&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;border-top&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;solid&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;#e8e8e8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nc&quot;&gt;.user&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;margin-top&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;em&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;padding-top&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nc&quot;&gt;.content&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;margin-left&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;img&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;padding&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nc&quot;&gt;.timestamp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$gray-light&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;margin-left&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nc&quot;&gt;.gravatar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;margin-right&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;margin-top&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;aside&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;textarea&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;margin-bottom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;span&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;.picture&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;margin-top&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;px&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;border&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;user_microposts_fragment.html#fig-user_profile_with_microposts&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.7&lt;/span&gt;&lt;/a&gt; shows the user profile page for the first user, while &lt;a href=&quot;user_microposts_fragment.html#fig-other_profile_with_microposts&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.8&lt;/span&gt;&lt;/a&gt; shows the profile for a second user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Finally, &lt;a href=&quot;user_microposts_fragment.html#fig-user_profile_microposts&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.9&lt;/span&gt;&lt;/a&gt; shows the &lt;em&gt;second&lt;/em&gt; page of microposts for the first user, along with the pagination links at the bottom of the display.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In all three cases, observe that each micropost display indicates the time since it was created (e.g., “Posted 1 minute ago.”); this is the work of the &lt;code&gt;time_ago_in_words&lt;/code&gt; method from &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.22&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; If you wait a couple of minutes and reload the pages, you’ll see how the text gets automatically updated based on the new time.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-user_profile_with_microposts&quot; data-tralics-id=&quot;uid1636&quot; data-number=&quot;13.7&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/user_profile_with_microposts_3rd_edition.png&quot; alt=&quot;images/figures/user_profile_with_microposts_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.7: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The user profile with microposts (/users/1).
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-other_profile_with_microposts&quot; data-tralics-id=&quot;uid1637&quot; data-number=&quot;13.8&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/other_profile_with_microposts_3rd_edition.png&quot; alt=&quot;images/figures/other_profile_with_microposts_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.8: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The profile of a different user, also with microposts (/users/5).
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-user_profile_microposts&quot; data-tralics-id=&quot;uid1638&quot; data-number=&quot;13.9&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/user_profile_microposts_page_2_3rd_edition.png&quot; alt=&quot;images/figures/user_profile_microposts_page_2_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.9: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;Micropost pagination links (/users/1?page=2).
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_sample_microposts&quot; data-tralics-id=&quot;uid1639&quot; class=&quot;subsubsection&quot; data-number=&quot;13.2.2.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_sample_microposts&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;See if you can guess the result of running &lt;code&gt;(1..10).to_a.take(6)&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Check at the console to see if your guess is right. &lt;span class=&quot;exercise&quot; id=&quot;ex-fd82f0&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Is the &lt;code&gt;to_a&lt;/code&gt; method in the previous exercise necessary? &lt;span class=&quot;exercise&quot; id=&quot;ex-a83797&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Faker has a huge number of occasionally amusing applications.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; By consulting the &lt;a href=&quot;https://github.com/stympy/faker&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Faker documentation&lt;/a&gt;, learn how to print out a fake &lt;a href=&quot;https://github.com/stympy/faker#fakeruniversity&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;university name&lt;/a&gt;, a fake &lt;a href=&quot;https://github.com/stympy/faker#fakerphonenumber&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;phone number&lt;/a&gt;, a fake &lt;a href=&quot;https://github.com/stympy/faker#fakerhipster&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hipster Ipsum&lt;/a&gt; sentence, and a fake &lt;a href=&quot;https://github.com/stympy/faker#fakerchucknorris&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Chuck Norris&lt;/a&gt; fact. &lt;span class=&quot;exercise&quot; id=&quot;ex-c6f975&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="843"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-sample_microposts" data-tralics-id="uid1629" class="subsection" data-number="13.2.2">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-sample_microposts" class="heading hyperref"><span class="number">13.2.2 </span>Sample microposts</a></h3>
<p>With all the work making templates for user microposts in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-rendering_microposts" class="hyperref">Section&nbsp;<span class="ref">13.2.1</span></a>, the ending was rather anticlimactic.<span class="intersentencespace"></span> We can rectify this sad situation by adding microposts to the seed data from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-sample_users" class="hyperref">Section&nbsp;<span class="ref">10.3.2</span></a>.</p>
<p>Adding sample microposts for <em>all</em> the users actually takes a rather long time, so first we’ll select just the first six users (i.e., the five users with custom Gravatars, and one with the default Gravatar) using the <code>take</code> method:</p>
<div class="code"><div class="highlight"><pre><span class="no">User</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div></div>
<p>The call to <code>order</code> ensures that we find the first six users that were created.</p>
<p>For each of the selected users, we’ll make 50 microposts (plenty to overflow the pagination limit of&nbsp;30).<span class="intersentencespace"></span> To generate sample content for each micropost, we’ll use the Faker gem’s handy <a href="http://rubydoc.info/gems/faker/1.3.0/Faker/Lorem" target="_blank" rel="noopener"><code class="tt">Lorem.sentence</code></a> method.<sup id="cha-13_footnote-ref-6" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-6" data-hasqtip="13">6</a></sup><span class="intersentencespace"></span> The result is the new seed data method shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-sample_microposts" class="hyperref">Listing&nbsp;<span class="ref">13.25</span></a>.<span class="intersentencespace"></span> (The reason for the order of the loops in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-sample_microposts" class="hyperref">Listing&nbsp;<span class="ref">13.25</span></a> is to intermix the microposts for use in the status feed (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#sec-the_status_feed" class="hyperref">Section&nbsp;<span class="ref">14.3</span></a>).<span class="intersentencespace"></span> Looping over the users first gives feeds with big runs of microposts from the same user, which is visually unappealing.)</p>
<div class="codelisting" id="code-sample_microposts" data-tralics-id="uid1631" data-number="13.25">
<div class="heading">
<span class="number">Listing 13.25:</span> 

<span class="description">Adding microposts to the sample data.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">db/seeds.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="ss">:created_at</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="mi">50</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
  <span class="n">content</span> <span class="o">=</span> <span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="o">.</span><span class="n">sentence</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="n">users</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="n">user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="n">content</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>At this point, we can reseed the development database as usual:</p>
<div class="code"><div class="highlight"><pre>$ rails db:migrate:reset
$ rails db:seed
</pre></div></div>
<p>You should also quit and restart the Rails development server.</p>
<p>With that, we are in a position to enjoy the fruits of our <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-rendering_microposts" class="hyperref">Section&nbsp;<span class="ref">13.2.1</span></a> labors by displaying information for each micropost.<sup id="cha-13_footnote-ref-7" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-7" data-hasqtip="14">7</a></sup><span class="intersentencespace"></span> The preliminary results appear in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_profile_microposts_no_styling" class="hyperref">Figure&nbsp;<span class="ref">13.6</span></a>.</p>
<div class="center figure" id="fig-user_profile_microposts_no_styling" data-tralics-id="uid1633" data-number="13.6">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/user_profile_microposts_no_styling_3rd_edition.png" alt="images/figures/user_profile_microposts_no_styling_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.6: </span><span class="description">The user profile with unstyled microposts.
</span>
</div>
</div>
<p>The page shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_profile_microposts_no_styling" class="hyperref">Figure&nbsp;<span class="ref">13.6</span></a> has no micropost-specific styling, so let’s add some (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_css" class="hyperref">Listing&nbsp;<span class="ref">13.26</span></a>) and take a look at the resulting pages.<sup id="cha-13_footnote-ref-8" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-8" data-hasqtip="15">8</a></sup></p>
<div class="codelisting" id="code-micropost_css" data-tralics-id="uid1635" data-number="13.26">
<div class="heading">
<span class="number">Listing 13.26:</span> 

<span class="description">The CSS for microposts (including all the CSS for this chapter).<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/assets/stylesheets/custom.scss</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="o">/*</span> <span class="nt">microposts</span> <span class="o">*/</span>

<span class="nc">.microposts</span> <span class="p">{</span>
  <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="na">padding</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nt">li</span> <span class="p">{</span>
    <span class="na">padding</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#e8e8e8</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nc">.user</span> <span class="p">{</span>
    <span class="na">margin-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">em</span><span class="p">;</span>
    <span class="na">padding-top</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nc">.content</span> <span class="p">{</span>
    <span class="na">display</span><span class="o">:</span> <span class="no">block</span><span class="p">;</span>
    <span class="na">margin-left</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
    <span class="nt">img</span> <span class="p">{</span>
      <span class="na">display</span><span class="o">:</span> <span class="no">block</span><span class="p">;</span>
      <span class="na">padding</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nc">.timestamp</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nv">$gray-light</span><span class="p">;</span>
    <span class="na">display</span><span class="o">:</span> <span class="no">block</span><span class="p">;</span>
    <span class="na">margin-left</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nc">.gravatar</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
    <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="na">margin-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nt">aside</span> <span class="p">{</span>
  <span class="nt">textarea</span> <span class="p">{</span>
    <span class="na">height</span><span class="o">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nt">span</span><span class="nc">.picture</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="nt">input</span> <span class="p">{</span>
    <span class="na">border</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>
</div>
<p><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_profile_with_microposts" class="hyperref">Figure&nbsp;<span class="ref">13.7</span></a> shows the user profile page for the first user, while <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-other_profile_with_microposts" class="hyperref">Figure&nbsp;<span class="ref">13.8</span></a> shows the profile for a second user.<span class="intersentencespace"></span> Finally, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-user_profile_microposts" class="hyperref">Figure&nbsp;<span class="ref">13.9</span></a> shows the <em>second</em> page of microposts for the first user, along with the pagination links at the bottom of the display.<span class="intersentencespace"></span> In all three cases, observe that each micropost display indicates the time since it was created (e.g., “Posted 1 minute ago.”); this is the work of the <code>time_ago_in_words</code> method from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial" class="hyperref">Listing&nbsp;<span class="ref">13.22</span></a>.<span class="intersentencespace"></span> If you wait a couple of minutes and reload the pages, you’ll see how the text gets automatically updated based on the new time.</p>
<div class="center figure" id="fig-user_profile_with_microposts" data-tralics-id="uid1636" data-number="13.7">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/user_profile_with_microposts_3rd_edition.png" alt="images/figures/user_profile_with_microposts_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.7: </span><span class="description">The user profile with microposts (/users/1).
</span>
</div>
</div>
<div class="center figure" id="fig-other_profile_with_microposts" data-tralics-id="uid1637" data-number="13.8">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/other_profile_with_microposts_3rd_edition.png" alt="images/figures/other_profile_with_microposts_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.8: </span><span class="description">The profile of a different user, also with microposts (/users/5).
</span>
</div>
</div>
<div class="center figure" id="fig-user_profile_microposts" data-tralics-id="uid1638" data-number="13.9">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/user_profile_microposts_page_2_3rd_edition.png" alt="images/figures/user_profile_microposts_page_2_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.9: </span><span class="description">Micropost pagination links (/users/1?page=2).
</span>
</div>
</div>
<div id="sec-exercises_sample_microposts" data-tralics-id="uid1639" class="subsubsection" data-number="13.2.2.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_sample_microposts" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>See if you can guess the result of running <code>(1..10).to_a.take(6)</code>.<span class="intersentencespace"></span> Check at the console to see if your guess is right. <span class="exercise" id="ex-fd82f0"></span>
</li>
<li>Is the <code>to_a</code> method in the previous exercise necessary? <span class="exercise" id="ex-a83797"></span>
</li>
<li>Faker has a huge number of occasionally amusing applications.<span class="intersentencespace"></span> By consulting the <a href="https://github.com/stympy/faker" target="_blank" rel="noopener">Faker documentation</a>, learn how to print out a fake <a href="https://github.com/stympy/faker#fakeruniversity" target="_blank" rel="noopener">university name</a>, a fake <a href="https://github.com/stympy/faker#fakerphonenumber" target="_blank" rel="noopener">phone number</a>, a fake <a href="https://github.com/stympy/faker#fakerhipster" target="_blank" rel="noopener">Hipster Ipsum</a> sentence, and a fake <a href="https://github.com/stympy/faker#fakerchucknorris" target="_blank" rel="noopener">Chuck Norris</a> fact. <span class="exercise" id="ex-c6f975"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-profile_micropost_tests&quot; data-tralics-id=&quot;uid1643&quot; class=&quot;subsection&quot; data-number=&quot;13.2.3&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-profile_micropost_tests&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.2.3 &lt;/span&gt;Profile micropost tests&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Because newly activated users get redirected to their profile pages, we already have a test that the profile page renders correctly (&lt;a href=&quot;account_activation_fragment.html#code-signup_with_account_activation_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;11.33&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In this section, we’ll write a short integration test for some of the other elements on the profile page, including the work from this section.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll start by generating an integration test for the profiles of our site’s users:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails generate integration_test users_profile
&lt;span class=&quot;go&quot;&gt;      invoke  test_unit&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;      create    test/integration/users_profile_test.rb&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To test the micropost display on the profile, we need to associate the fixture microposts with a user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Rails includes a convenient way to build associations in fixtures, like this:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;orange&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;I&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;just&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ate&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;an&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;orange!&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 10.minutes.ago %&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;By identifying the &lt;code&gt;user&lt;/code&gt; as &lt;code&gt;michael&lt;/code&gt;, we tell Rails to associate this micropost with the corresponding user in the users fixture:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;Michael Example&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael@example.com&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To test micropost pagination, we’ll also generate some additional micropost fixtures using the same embedded Ruby technique we used to make additional users in &lt;a href=&quot;updating_and_deleting_users_fragment.html#code-users_fixtures_extra_users&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.47&lt;/span&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;% 30.times do |n| %&amp;gt;&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;micropost_&amp;lt;%= n %&amp;gt;&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= Faker::Lorem.sentence(5) %&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 42.days.ago %&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;% end %&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Putting all this together gives the updated micropost fixtures in &lt;a href=&quot;user_microposts_fragment.html#code-updated_micropost_fixtures&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.27&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-updated_micropost_fixtures&quot; data-tralics-id=&quot;uid1644&quot; data-number=&quot;13.27&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.27:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Micropost fixtures with user associations.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/fixtures/microposts.yml&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;orange&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;I&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;just&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ate&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;an&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;orange!&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 10.minutes.ago %&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;tau_manifesto&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Check&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;the&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@tauday&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;site&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@mhartl:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://tauday.com&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 3.years.ago %&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;cat_video&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Sad&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;cats&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;are&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sad:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;http://youtu.be/PKffm2uI4dk&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 2.hours.ago %&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;most_recent&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Writing&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;short&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;test&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= Time.zone.now %&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;% 30.times do |n| %&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;micropost_&amp;lt;%= n %&amp;gt;&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= Faker::Lorem.sentence(5) %&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 42.days.ago %&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;michael&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;% end %&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;With the test data thus prepared, the test itself is fairly straightforward: we visit the user profile page and check for the page title and the user’s name, Gravatar, micropost count, and paginated microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result appears in &lt;a href=&quot;user_microposts_fragment.html#code-user_profile_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.28&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note the use of the &lt;code&gt;full_title&lt;/code&gt; helper from &lt;a href=&quot;rails_flavored_ruby_fragment.html#code-title_helper&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;4.2&lt;/span&gt;&lt;/a&gt; to test the page’s title, which we gain access to by including the Application Helper module into the test.&lt;sup id=&quot;cha-13_footnote-ref-9&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-9&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-user_profile_test&quot; data-tralics-id=&quot;uid1646&quot; data-number=&quot;13.28&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.28:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A test for the user profile.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/integration/users_profile_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UsersProfileTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionDispatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IntegrationTest&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;kp&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationHelper&lt;/span&gt;
&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;profile display&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_template&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;users/show&#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;title&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;full_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;h1&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;h1&amp;gt;img.gravatar&#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;div.pagination&#39;&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paginate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The micropost count assertion in &lt;a href=&quot;user_microposts_fragment.html#code-user_profile_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.28&lt;/span&gt;&lt;/a&gt; uses &lt;code&gt;response.body&lt;/code&gt;, which we saw briefly in the &lt;a href=&quot;password_reset_fragment.html#cha-password_reset&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;12&lt;/span&gt;&lt;/a&gt; exercises (&lt;a href=&quot;password_reset_fragment.html#sec-exercises_password_reset_test&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;12.3.3.1&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Despite its name, &lt;code&gt;response.body&lt;/code&gt; contains the full HTML source of the page (and not just the page’s body).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This means that if all we care about is that the number of microposts appears &lt;em&gt;somewhere&lt;/em&gt; on the page, we can look for a match as follows:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a much less specific assertion than &lt;code&gt;assert_select&lt;/code&gt;; in particular, unlike &lt;code&gt;assert_select&lt;/code&gt;, using &lt;code&gt;assert_match&lt;/code&gt; in this context doesn’t require us to indicate which HTML tag we’re looking for.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;user_microposts_fragment.html#code-user_profile_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.28&lt;/span&gt;&lt;/a&gt; also introduces the nesting syntax for &lt;code&gt;assert_select&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;h1&amp;gt;img.gravatar&#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This checks for an &lt;code&gt;img&lt;/code&gt; tag with class &lt;code&gt;gravatar&lt;/code&gt; &lt;em&gt;inside&lt;/em&gt; a top-level heading tag (&lt;code&gt;h1&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Because the application code was working, the test suite should be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1647&quot; data-tralics-id=&quot;uid1647&quot; data-number=&quot;13.29&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.29:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_profile_micropost_tests&quot; data-tralics-id=&quot;uid1648&quot; class=&quot;subsubsection&quot; data-number=&quot;13.2.3.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_profile_micropost_tests&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Comment out the application code needed to change the two &lt;code&gt;&#39;h1&#39;&lt;/code&gt; lines in &lt;a href=&quot;user_microposts_fragment.html#code-user_profile_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.28&lt;/span&gt;&lt;/a&gt; from &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt; to &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;. &lt;span class=&quot;exercise&quot; id=&quot;ex-339c33&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Update &lt;a href=&quot;user_microposts_fragment.html#code-user_profile_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.28&lt;/span&gt;&lt;/a&gt; to test that &lt;code&gt;will_paginate&lt;/code&gt; appears only &lt;em&gt;once&lt;/em&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;em&gt;Hint&lt;/em&gt;: Refer to &lt;a href=&quot;filling_in_the_layout_fragment.html#table-assert_select&quot; class=&quot;hyperref&quot;&gt;Table &lt;span class=&quot;ref&quot;&gt;5.2&lt;/span&gt;&lt;/a&gt;. &lt;span class=&quot;exercise&quot; id=&quot;ex-7c1373&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="844"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-profile_micropost_tests" data-tralics-id="uid1643" class="subsection" data-number="13.2.3">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-profile_micropost_tests" class="heading hyperref"><span class="number">13.2.3 </span>Profile micropost tests</a></h3>
<p>Because newly activated users get redirected to their profile pages, we already have a test that the profile page renders correctly (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#code-signup_with_account_activation_test" class="hyperref">Listing&nbsp;<span class="ref">11.33</span></a>).<span class="intersentencespace"></span> In this section, we’ll write a short integration test for some of the other elements on the profile page, including the work from this section.<span class="intersentencespace"></span> We’ll start by generating an integration test for the profiles of our site’s users:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test users_profile
<span class="go">      invoke  test_unit</span>
<span class="go">      create    test/integration/users_profile_test.rb</span>
</pre></div></div>
<p>To test the micropost display on the profile, we need to associate the fixture microposts with a user.<span class="intersentencespace"></span> Rails includes a convenient way to build associations in fixtures, like this:</p>
<div class="code"><div class="highlight"><pre><span class="l-Scalar-Plain">orange</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"I</span><span class="nv"> </span><span class="s">just</span><span class="nv"> </span><span class="s">ate</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">orange!"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 10.minutes.ago %&gt;</span>
<span class="hll">  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
</span></pre></div></div>
<p>By identifying the <code>user</code> as <code>michael</code>, we tell Rails to associate this micropost with the corresponding user in the users fixture:</p>
<div class="code"><div class="highlight"><pre><span class="hll"><span class="l-Scalar-Plain">michael</span><span class="p-Indicator">:</span>
</span>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Michael Example</span>
  <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael@example.com</span>
  <span class="l-Scalar-Plain">.</span>
  <span class="l-Scalar-Plain">.</span>
  <span class="l-Scalar-Plain">.</span>
</pre></div></div>
<p>To test micropost pagination, we’ll also generate some additional micropost fixtures using the same embedded Ruby technique we used to make additional users in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-users_fixtures_extra_users" class="hyperref">Listing&nbsp;<span class="ref">10.47</span></a>:</p>
<div class="code"><div class="highlight"><pre><span class="l-Scalar-Plain">&lt;% 30.times do |n| %&gt;</span>
<span class="l-Scalar-Plain">micropost_&lt;%= n %&gt;</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= Faker::Lorem.sentence(5) %&gt;</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 42.days.ago %&gt;</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
<span class="l-Scalar-Plain">&lt;% end %&gt;</span>
</pre></div></div>
<p>Putting all this together gives the updated micropost fixtures in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-updated_micropost_fixtures" class="hyperref">Listing&nbsp;<span class="ref">13.27</span></a>.</p>
<div class="codelisting" id="code-updated_micropost_fixtures" data-tralics-id="uid1644" data-number="13.27">
<div class="heading">
<span class="number">Listing 13.27:</span> 

<span class="description">Micropost fixtures with user associations.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/fixtures/microposts.yml</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="l-Scalar-Plain">orange</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"I</span><span class="nv"> </span><span class="s">just</span><span class="nv"> </span><span class="s">ate</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">orange!"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 10.minutes.ago %&gt;</span>
<span class="hll">  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
</span>
<span class="l-Scalar-Plain">tau_manifesto</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Check</span><span class="nv"> </span><span class="s">out</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">@tauday</span><span class="nv"> </span><span class="s">site</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">@mhartl:</span><span class="nv"> </span><span class="s">http://tauday.com"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 3.years.ago %&gt;</span>
<span class="hll">  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
</span>
<span class="l-Scalar-Plain">cat_video</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Sad</span><span class="nv"> </span><span class="s">cats</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">sad:</span><span class="nv"> </span><span class="s">http://youtu.be/PKffm2uI4dk"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 2.hours.ago %&gt;</span>
<span class="hll">  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
</span>
<span class="l-Scalar-Plain">most_recent</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Writing</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">short</span><span class="nv"> </span><span class="s">test"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= Time.zone.now %&gt;</span>
<span class="hll">  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
</span>
<span class="hll"><span class="l-Scalar-Plain">&lt;% 30.times do |n| %&gt;</span>
</span><span class="hll"><span class="l-Scalar-Plain">micropost_&lt;%= n %&gt;</span><span class="p-Indicator">:</span>
</span><span class="hll">  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= Faker::Lorem.sentence(5) %&gt;</span>
</span><span class="hll">  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 42.days.ago %&gt;</span>
</span><span class="hll">  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">michael</span>
</span><span class="hll"><span class="l-Scalar-Plain">&lt;% end %&gt;</span>
</span></pre></div></div>
</div>
<p>With the test data thus prepared, the test itself is fairly straightforward: we visit the user profile page and check for the page title and the user’s name, Gravatar, micropost count, and paginated microposts.<span class="intersentencespace"></span> The result appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_profile_test" class="hyperref">Listing&nbsp;<span class="ref">13.28</span></a>.<span class="intersentencespace"></span> Note the use of the <code>full_title</code> helper from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#code-title_helper" class="hyperref">Listing&nbsp;<span class="ref">4.2</span></a> to test the page’s title, which we gain access to by including the Application Helper module into the test.<sup id="cha-13_footnote-ref-9" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-9" data-hasqtip="16">9</a></sup></p>
<div class="codelisting" id="code-user_profile_test" data-tralics-id="uid1646" data-number="13.28">
<div class="heading">
<span class="number">Listing 13.28:</span> 

<span class="description">A test for the user profile.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/integration/users_profile_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UsersProfileTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>
<span class="hll">  <span class="kp">include</span> <span class="no">ApplicationHelper</span>
</span>
  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"profile display"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="n">user_path</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">assert_template</span> <span class="s1">'users/show'</span>
    <span class="n">assert_select</span> <span class="s1">'title'</span><span class="p">,</span> <span class="n">full_title</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">assert_select</span> <span class="s1">'h1'</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">name</span>
    <span class="n">assert_select</span> <span class="s1">'h1&gt;img.gravatar'</span>
    <span class="n">assert_match</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
    <span class="n">assert_select</span> <span class="s1">'div.pagination'</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">page</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">micropost</span><span class="o">|</span>
      <span class="n">assert_match</span> <span class="n">micropost</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>The micropost count assertion in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_profile_test" class="hyperref">Listing&nbsp;<span class="ref">13.28</span></a> uses <code>response.body</code>, which we saw briefly in the <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#cha-password_reset" class="hyperref">Chapter&nbsp;<span class="ref">12</span></a> exercises (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-exercises_password_reset_test" class="hyperref">Section&nbsp;<span class="ref">12.3.3.1</span></a>).<span class="intersentencespace"></span> Despite its name, <code>response.body</code> contains the full HTML source of the page (and not just the page’s body).<span class="intersentencespace"></span> This means that if all we care about is that the number of microposts appears <em>somewhere</em> on the page, we can look for a match as follows:</p>
<div class="code"><div class="highlight"><pre><span class="n">assert_match</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">count</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
</pre></div></div>
<p>This is a much less specific assertion than <code>assert_select</code>; in particular, unlike <code>assert_select</code>, using <code>assert_match</code> in this context doesn’t require us to indicate which HTML tag we’re looking for.</p>
<p><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_profile_test" class="hyperref">Listing&nbsp;<span class="ref">13.28</span></a> also introduces the nesting syntax for <code>assert_select</code>:</p>
<div class="code"><div class="highlight"><pre><span class="n">assert_select</span> <span class="s1">'h1&gt;img.gravatar'</span>
</pre></div></div>
<p>This checks for an <code>img</code> tag with class <code>gravatar</code> <em>inside</em> a top-level heading tag (<code>h1</code>).</p>
<p>Because the application code was working, the test suite should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1647" data-tralics-id="uid1647" data-number="13.29">
<div class="heading">
<span class="number">Listing 13.29:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
<div id="sec-exercises_profile_micropost_tests" data-tralics-id="uid1648" class="subsubsection" data-number="13.2.3.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_profile_micropost_tests" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Comment out the application code needed to change the two <code>'h1'</code> lines in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_profile_test" class="hyperref">Listing&nbsp;<span class="ref">13.28</span></a> from <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span> to <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>. <span class="exercise" id="ex-339c33"></span>
</li>
<li>Update <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_profile_test" class="hyperref">Listing&nbsp;<span class="ref">13.28</span></a> to test that <code>will_paginate</code> appears only <em>once</em>.<span class="intersentencespace"></span> <em>Hint</em>: Refer to <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#table-assert_select" class="hyperref">Table&nbsp;<span class="ref">5.2</span></a>. <span class="exercise" id="ex-7c1373"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent" data-html="&lt;div id=&quot;sec-manipulating_microposts&quot; data-tralics-id=&quot;cid76&quot; class=&quot;section&quot; data-number=&quot;13.3&quot;&gt;
&lt;h2&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-manipulating_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.3 &lt;/span&gt;Manipulating microposts&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Having finished both the data modeling and display templates for microposts, we now turn our attention to the interface for creating them through the web.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In this section, we’ll also see the first hint of a &lt;em&gt;status feed&lt;/em&gt;—a notion brought to full fruition in &lt;a href=&quot;following_users_fragment.html#cha-following_users&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;14&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Finally, as with users, we’ll make it possible to destroy microposts through the web.&lt;/p&gt;
&lt;p&gt;There is one break with past convention worth noting: the interface to the Microposts resource will run principally through the Profile and Home pages, so we won’t need actions like &lt;code&gt;new&lt;/code&gt; or &lt;code&gt;edit&lt;/code&gt; in the Microposts controller; we’ll need only &lt;code&gt;create&lt;/code&gt; and &lt;code&gt;destroy&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This leads to the routes for the Microposts resource shown in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_resource&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.30&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The code in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_resource&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.30&lt;/span&gt;&lt;/a&gt; leads in turn to the RESTful routes shown in &lt;a href=&quot;user_microposts_fragment.html#table-RESTful_microposts&quot; class=&quot;hyperref&quot;&gt;Table &lt;span class=&quot;ref&quot;&gt;13.2&lt;/span&gt;&lt;/a&gt;, which is a small subset of the full set of routes seen in &lt;a href=&quot;toy_app_fragment.html#table-demo_RESTful_microposts&quot; class=&quot;hyperref&quot;&gt;Table &lt;span class=&quot;ref&quot;&gt;2.3&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Of course, this simplicity is a sign of being &lt;em&gt;more&lt;/em&gt; advanced, not less—we’ve come a long way since our reliance on scaffolding in &lt;a href=&quot;toy_app_fragment.html#cha-a_toy_app&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;2&lt;/span&gt;&lt;/a&gt;, and we no longer need most of its complexity.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_resource&quot; data-tralics-id=&quot;uid1651&quot; data-number=&quot;13.30&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.30:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Routes for the Microposts resource.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;config/routes.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;routes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;draw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;&#39;static_pages#home&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;    &lt;span class=&quot;s1&quot;&gt;&#39;/help&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;    &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;static_pages#help&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;    &lt;span class=&quot;s1&quot;&gt;&#39;/about&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;static_pages#about&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;    &lt;span class=&quot;s1&quot;&gt;&#39;/contact&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;static_pages#contact&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;    &lt;span class=&quot;s1&quot;&gt;&#39;/signup&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;users#new&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;    &lt;span class=&quot;s1&quot;&gt;&#39;/login&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;sessions#new&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;&#39;/login&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;sessions#create&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;/logout&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;ss&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;sessions#destroy&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:users&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:account_activations&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:edit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_resets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:update&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;table&quot; id=&quot;table-RESTful_microposts&quot; data-tralics-id=&quot;uid1652&quot; data-number=&quot;13.2&quot;&gt;
&lt;table class=&quot;tabular&quot;&gt;
&lt;tbody&gt;
&lt;tr class=&quot;bottom_border&quot;&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;strong&gt;HTTP request&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;strong&gt;Action&lt;/strong&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;strong&gt;Named route&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code class=&quot;tt&quot;&gt;POST&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;/microposts&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;create&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;microposts_path&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code class=&quot;tt&quot;&gt;DELETE&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;/microposts/1&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;destroy&lt;/code&gt;&lt;/td&gt;
&lt;td class=&quot;align_left&quot;&gt;&lt;code&gt;micropost_path(micropost)&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Table 13.2: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;RESTful routes provided by the Microposts resource in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_resource&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.30&lt;/span&gt;&lt;/a&gt;.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;




&lt;/div&gt;"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-manipulating_microposts" data-tralics-id="cid76" class="section" data-number="13.3">
<h2><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-manipulating_microposts" class="heading hyperref"><span class="number">13.3 </span>Manipulating microposts</a></h2>
<p>Having finished both the data modeling and display templates for microposts, we now turn our attention to the interface for creating them through the web.<span class="intersentencespace"></span> In this section, we’ll also see the first hint of a <em>status feed</em>—a notion brought to full fruition in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#cha-following_users" class="hyperref">Chapter&nbsp;<span class="ref">14</span></a>.<span class="intersentencespace"></span> Finally, as with users, we’ll make it possible to destroy microposts through the web.</p>
<p>There is one break with past convention worth noting: the interface to the Microposts resource will run principally through the Profile and Home pages, so we won’t need actions like <code>new</code> or <code>edit</code> in the Microposts controller; we’ll need only <code>create</code> and <code>destroy</code>.<span class="intersentencespace"></span> This leads to the routes for the Microposts resource shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_resource" class="hyperref">Listing&nbsp;<span class="ref">13.30</span></a>.<span class="intersentencespace"></span> The code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_resource" class="hyperref">Listing&nbsp;<span class="ref">13.30</span></a> leads in turn to the RESTful routes shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#table-RESTful_microposts" class="hyperref">Table&nbsp;<span class="ref">13.2</span></a>, which is a small subset of the full set of routes seen in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#table-demo_RESTful_microposts" class="hyperref">Table&nbsp;<span class="ref">2.3</span></a>.<span class="intersentencespace"></span> Of course, this simplicity is a sign of being <em>more</em> advanced, not less—we’ve come a long way since our reliance on scaffolding in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/toy_app#cha-a_toy_app" class="hyperref">Chapter&nbsp;<span class="ref">2</span></a>, and we no longer need most of its complexity.</p>
<div class="codelisting" id="code-microposts_resource" data-tralics-id="uid1651" data-number="13.30">
<div class="heading">
<span class="number">Listing 13.30:</span> 

<span class="description">Routes for the Microposts resource.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">config/routes.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span>   <span class="s1">'static_pages#home'</span>
  <span class="n">get</span>    <span class="s1">'/help'</span><span class="p">,</span>    <span class="ss">to</span><span class="p">:</span> <span class="s1">'static_pages#help'</span>
  <span class="n">get</span>    <span class="s1">'/about'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'static_pages#about'</span>
  <span class="n">get</span>    <span class="s1">'/contact'</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">'static_pages#contact'</span>
  <span class="n">get</span>    <span class="s1">'/signup'</span><span class="p">,</span>  <span class="ss">to</span><span class="p">:</span> <span class="s1">'users#new'</span>
  <span class="n">get</span>    <span class="s1">'/login'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'sessions#new'</span>
  <span class="n">post</span>   <span class="s1">'/login'</span><span class="p">,</span>   <span class="ss">to</span><span class="p">:</span> <span class="s1">'sessions#create'</span>
  <span class="n">delete</span> <span class="s1">'/logout'</span><span class="p">,</span>  <span class="ss">to</span><span class="p">:</span> <span class="s1">'sessions#destroy'</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="n">resources</span> <span class="ss">:account_activations</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="o">]</span>
  <span class="n">resources</span> <span class="ss">:password_resets</span><span class="p">,</span>     <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
<span class="hll">  <span class="n">resources</span> <span class="ss">:microposts</span><span class="p">,</span>          <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<div class="table" id="table-RESTful_microposts" data-tralics-id="uid1652" data-number="13.2">
<table class="tabular">
<tbody>
<tr class="bottom_border">
<td class="align_left"><strong>HTTP request</strong></td>
<td class="align_left"><strong>URL</strong></td>
<td class="align_left"><strong>Action</strong></td>
<td class="align_left"><strong>Named route</strong></td>
</tr>
<tr>
<td class="align_left"><code class="tt">POST</code></td>
<td class="align_left">/microposts</td>
<td class="align_left"><code>create</code></td>
<td class="align_left"><code>microposts_path</code></td>
</tr>
<tr>
<td class="align_left"><code class="tt">DELETE</code></td>
<td class="align_left">/microposts/1</td>
<td class="align_left"><code>destroy</code></td>
<td class="align_left"><code>micropost_path(micropost)</code></td>
</tr>
</tbody>
</table>
<div class="caption">
<span class="header">Table 13.2: </span><span class="description">RESTful routes provided by the Microposts resource in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_resource" class="hyperref">Listing&nbsp;<span class="ref">13.30</span></a>.
</span>
</div>
</div>




</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-micropost_access_control&quot; data-tralics-id=&quot;uid1653&quot; class=&quot;subsection&quot; data-number=&quot;13.3.1&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-micropost_access_control&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.3.1 &lt;/span&gt;Micropost access control&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;We begin our development of the Microposts resource with some access control in the Microposts controller.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, because we access microposts through their associated users, both the &lt;code&gt;create&lt;/code&gt; and &lt;code&gt;destroy&lt;/code&gt; actions must require users to be logged in.&lt;/p&gt;
&lt;p&gt;Tests to enforce logged-in status mirror those for the Users controller (&lt;a href=&quot;updating_and_deleting_users_fragment.html#code-edit_update_redirect_tests&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.20&lt;/span&gt;&lt;/a&gt; and &lt;a href=&quot;updating_and_deleting_users_fragment.html#code-action_tests_admin&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.61&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We simply issue the correct request to each action and confirm that the micropost count is unchanged and the result is redirected to the login URL, as seen in &lt;a href=&quot;user_microposts_fragment.html#code-create_destroy_micropost_tests&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.31&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-create_destroy_micropost_tests&quot; data-tralics-id=&quot;uid1654&quot; data-number=&quot;13.31&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.31:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Authorization tests for the Microposts controller.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/controllers/microposts_controller_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsControllerTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionDispatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IntegrationTest&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:orange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should redirect create when not logged in&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_no_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_redirected_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login_url&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should redirect destroy when not logged in&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_no_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_redirected_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login_url&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Writing the application code needed to get the tests in &lt;a href=&quot;user_microposts_fragment.html#code-create_destroy_micropost_tests&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.31&lt;/span&gt;&lt;/a&gt; to pass requires a little refactoring first.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Recall from &lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-requiring_logged_in_users&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.2.1&lt;/span&gt;&lt;/a&gt; that we enforced the login requirement using a before filter that called the &lt;code&gt;logged_in_user&lt;/code&gt; method (&lt;a href=&quot;updating_and_deleting_users_fragment.html#code-authorize_before_filter&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.15&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; At the time, we needed that method only in the Users controller, but now we find that we need it in the Microposts controller as well, so we’ll move it into the Application controller, which is the base class of all controllers (&lt;a href=&quot;rails_flavored_ruby_fragment.html#sec-a_controller_class&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;4.4.4&lt;/span&gt;&lt;/a&gt;).&lt;sup id=&quot;cha-13_footnote-ref-10&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-10&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result appears in &lt;a href=&quot;user_microposts_fragment.html#code-sessions_helper_authenticate&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.32&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-sessions_helper_authenticate&quot; data-tralics-id=&quot;uid1656&quot; data-number=&quot;13.32&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.32:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Moving the &lt;code&gt;logged_in_user&lt;/code&gt; method into the Application controller.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/application_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ApplicationController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionController&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;protect_from_forgery&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:exception&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;SessionsHelper&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# Confirms a logged-in user.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;logged_in_user&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;store_location&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;flash&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:danger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Please log in.&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login_url&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;To avoid code repetition, you should also remove &lt;code&gt;logged_in_user&lt;/code&gt; from the Users controller at this time (&lt;a href=&quot;user_microposts_fragment.html#code-users_controller_remove_logged_in_filter&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.33&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-users_controller_remove_logged_in_filter&quot; data-tralics-id=&quot;uid1657&quot; data-number=&quot;13.33&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.33:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The Users controller with the logged-in user filter removed.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/users_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UsersController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:logged_in_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;user_params&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                   &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# Before filters&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# Confirms the correct user.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;correct_user&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# Confirms an admin user.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;admin_user&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;admin?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;With the code in &lt;a href=&quot;user_microposts_fragment.html#code-sessions_helper_authenticate&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.32&lt;/span&gt;&lt;/a&gt;, the &lt;code&gt;logged_in_user&lt;/code&gt; method is now available in the Microposts controller, which means that we can add &lt;code&gt;create&lt;/code&gt; and &lt;code&gt;destroy&lt;/code&gt; actions and then restrict access to them using a before filter, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_controller_access_control&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.34&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_controller_access_control&quot; data-tralics-id=&quot;uid1658&quot; data-number=&quot;13.34&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.34:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding authorization to the Microposts controller actions.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/microposts_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:logged_in_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;destroy&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, the tests should pass:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1659&quot; data-tralics-id=&quot;uid1659&quot; data-number=&quot;13.35&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.35:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_access_control&quot; data-tralics-id=&quot;uid1660&quot; class=&quot;subsubsection&quot; data-number=&quot;13.3.1.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_access_control&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Why is it a bad idea to leave a copy of &lt;code&gt;logged_in_user&lt;/code&gt; in the Users controller? &lt;span class=&quot;exercise&quot; id=&quot;ex-12f331&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="845"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-micropost_access_control" data-tralics-id="uid1653" class="subsection" data-number="13.3.1">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_access_control" class="heading hyperref"><span class="number">13.3.1 </span>Micropost access control</a></h3>
<p>We begin our development of the Microposts resource with some access control in the Microposts controller.<span class="intersentencespace"></span> In particular, because we access microposts through their associated users, both the <code>create</code> and <code>destroy</code> actions must require users to be logged in.</p>
<p>Tests to enforce logged-in status mirror those for the Users controller (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-edit_update_redirect_tests" class="hyperref">Listing&nbsp;<span class="ref">10.20</span></a> and <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-action_tests_admin" class="hyperref">Listing&nbsp;<span class="ref">10.61</span></a>).<span class="intersentencespace"></span> We simply issue the correct request to each action and confirm that the micropost count is unchanged and the result is redirected to the login URL, as seen in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-create_destroy_micropost_tests" class="hyperref">Listing&nbsp;<span class="ref">13.31</span></a>.</p>
<div class="codelisting" id="code-create_destroy_micropost_tests" data-tralics-id="uid1654" data-number="13.31">
<div class="heading">
<span class="number">Listing 13.31:</span> 

<span class="description">Authorization tests for the Microposts controller.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/controllers/microposts_controller_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostsControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">microposts</span><span class="p">(</span><span class="ss">:orange</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should redirect create when not logged in"</span> <span class="k">do</span>
    <span class="n">assert_no_difference</span> <span class="s1">'Micropost.count'</span> <span class="k">do</span>
      <span class="n">post</span> <span class="n">microposts_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">micropost</span><span class="p">:</span> <span class="p">{</span> <span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">end</span>
    <span class="n">assert_redirected_to</span> <span class="n">login_url</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should redirect destroy when not logged in"</span> <span class="k">do</span>
    <span class="n">assert_no_difference</span> <span class="s1">'Micropost.count'</span> <span class="k">do</span>
      <span class="n">delete</span> <span class="n">micropost_path</span><span class="p">(</span><span class="vi">@micropost</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">assert_redirected_to</span> <span class="n">login_url</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Writing the application code needed to get the tests in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-create_destroy_micropost_tests" class="hyperref">Listing&nbsp;<span class="ref">13.31</span></a> to pass requires a little refactoring first.<span class="intersentencespace"></span> Recall from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-requiring_logged_in_users" class="hyperref">Section&nbsp;<span class="ref">10.2.1</span></a> that we enforced the login requirement using a before filter that called the <code>logged_in_user</code> method (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-authorize_before_filter" class="hyperref">Listing&nbsp;<span class="ref">10.15</span></a>).<span class="intersentencespace"></span> At the time, we needed that method only in the Users controller, but now we find that we need it in the Microposts controller as well, so we’ll move it into the Application controller, which is the base class of all controllers (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/rails_flavored_ruby#sec-a_controller_class" class="hyperref">Section&nbsp;<span class="ref">4.4.4</span></a>).<sup id="cha-13_footnote-ref-10" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-10" data-hasqtip="17">10</a></sup><span class="intersentencespace"></span> The result appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-sessions_helper_authenticate" class="hyperref">Listing&nbsp;<span class="ref">13.32</span></a>.</p>
<div class="codelisting" id="code-sessions_helper_authenticate" data-tralics-id="uid1656" data-number="13.32">
<div class="heading">
<span class="number">Listing 13.32:</span> 

<span class="description">Moving the <code>logged_in_user</code> method into the Application controller.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/controllers/application_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">protect_from_forgery</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">:exception</span>
  <span class="kp">include</span> <span class="no">SessionsHelper</span>

  <span class="kp">private</span>

    <span class="c1"># Confirms a logged-in user.</span>
    <span class="k">def</span> <span class="nf">logged_in_user</span>
      <span class="k">unless</span> <span class="n">logged_in?</span>
        <span class="n">store_location</span>
        <span class="n">flash</span><span class="o">[</span><span class="ss">:danger</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Please log in."</span>
        <span class="n">redirect_to</span> <span class="n">login_url</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>To avoid code repetition, you should also remove <code>logged_in_user</code> from the Users controller at this time (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-users_controller_remove_logged_in_filter" class="hyperref">Listing&nbsp;<span class="ref">13.33</span></a>).</p>
<div class="codelisting" id="code-users_controller_remove_logged_in_filter" data-tralics-id="uid1657" data-number="13.33">
<div class="heading">
<span class="number">Listing 13.33:</span> 

<span class="description">The Users controller with the logged-in user filter removed.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/controllers/users_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:logged_in_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">user_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span>
                                   <span class="ss">:password_confirmation</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Before filters</span>

    <span class="c1"># Confirms the correct user.</span>
    <span class="k">def</span> <span class="nf">correct_user</span>
      <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
      <span class="n">redirect_to</span><span class="p">(</span><span class="n">root_url</span><span class="p">)</span> <span class="k">unless</span> <span class="n">current_user?</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Confirms an admin user.</span>
    <span class="k">def</span> <span class="nf">admin_user</span>
      <span class="n">redirect_to</span><span class="p">(</span><span class="n">root_url</span><span class="p">)</span> <span class="k">unless</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin?</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>With the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-sessions_helper_authenticate" class="hyperref">Listing&nbsp;<span class="ref">13.32</span></a>, the <code>logged_in_user</code> method is now available in the Microposts controller, which means that we can add <code>create</code> and <code>destroy</code> actions and then restrict access to them using a before filter, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_controller_access_control" class="hyperref">Listing&nbsp;<span class="ref">13.34</span></a>.</p>
<div class="codelisting" id="code-microposts_controller_access_control" data-tralics-id="uid1658" data-number="13.34">
<div class="heading">
<span class="number">Listing 13.34:</span> 

<span class="description">Adding authorization to the Microposts controller actions.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/controllers/microposts_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:logged_in_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">create</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>At this point, the tests should pass:</p>
<div class="codelisting" id="uid1659" data-tralics-id="uid1659" data-number="13.35">
<div class="heading">
<span class="number">Listing 13.35:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
<div id="sec-exercises_access_control" data-tralics-id="uid1660" class="subsubsection" data-number="13.3.1.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_access_control" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Why is it a bad idea to leave a copy of <code>logged_in_user</code> in the Users controller? <span class="exercise" id="ex-12f331"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-creating_microposts&quot; data-tralics-id=&quot;uid1662&quot; class=&quot;subsection&quot; data-number=&quot;13.3.2&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-creating_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.3.2 &lt;/span&gt;Creating microposts&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;In &lt;a href=&quot;sign_up_fragment.html#cha-sign_up&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;7&lt;/span&gt;&lt;/a&gt;, we implemented user signup by making an HTML form that issued an HTTP &lt;code class=&quot;tt&quot;&gt;POST&lt;/code&gt; request to the &lt;code&gt;create&lt;/code&gt; action in the Users controller.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The implementation of micropost creation is similar; the main difference is that, rather than using a separate page at /microposts/new, we will put the form on the Home page itself (i.e., the root path /), as mocked up in &lt;a href=&quot;user_microposts_fragment.html#fig-home_page_with_micropost_form_mockup&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.10&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-home_page_with_micropost_form_mockup&quot; data-tralics-id=&quot;uid1663&quot; data-number=&quot;13.10&quot;&gt;
&lt;div class=&quot;graphics image box&quot;&gt;&lt;img src=&quot;images/figures/home_page_with_micropost_form_mockup_bootstrap.png&quot; alt=&quot;images/figures/home_page_with_micropost_form_mockup_bootstrap&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.10: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A mockup of the Home page with a form for creating microposts.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When we last left the Home page, it appeared as in &lt;a href=&quot;filling_in_the_layout_fragment.html#fig-sample_app_logo&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;5.8&lt;/span&gt;&lt;/a&gt;—that is, it had a “Sign up now!”&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; button in the middle.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Since a micropost creation form makes sense only in the context of a particular logged-in user, one goal of this section will be to serve different versions of the Home page depending on a visitor’s login status.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll implement this in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_home_page&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.37&lt;/span&gt;&lt;/a&gt; below.&lt;/p&gt;
&lt;p&gt;We’ll start with the &lt;code&gt;create&lt;/code&gt; action for microposts, which is similar to its user analogue (&lt;a href=&quot;sign_up_fragment.html#code-user_create_action&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;7.28&lt;/span&gt;&lt;/a&gt;); the principal difference lies in using the user/micropost association to &lt;code&gt;build&lt;/code&gt; the new micropost, as seen in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_create_action&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.36&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note the use of strong parameters via &lt;code&gt;micropost_params&lt;/code&gt;, which permits only the micropost’s &lt;code&gt;content&lt;/code&gt; attribute to be modified through the web.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_create_action&quot; data-tralics-id=&quot;uid1664&quot; data-number=&quot;13.36&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.36:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The Microposts controller &lt;code&gt;create&lt;/code&gt; action.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/microposts_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:logged_in_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;flash&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:success&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Micropost created!&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;static_pages/home&#39;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;destroy&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;micropost_params&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;To build a form for creating microposts, we use the code in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_home_page&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.37&lt;/span&gt;&lt;/a&gt;, which serves up different HTML based on whether the site visitor is logged in or not.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_home_page&quot; data-tralics-id=&quot;uid1665&quot; data-number=&quot;13.37&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.37:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding microposts creation to the Home page (/).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/static_pages/home.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;aside&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-4&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;section&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user_info&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/user_info&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;section&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;micropost_form&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/micropost_form&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;aside&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;center jumbotron&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;h1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;Welcome to the Sample App&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;h1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
      This is the home page for the
      &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.railstutorial.org/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;Ruby on Rails Tutorial&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
      sample application.
    &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;h2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Sign up now!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signup_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-lg btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;div&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image_tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rails.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Rails logo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
              &lt;span class=&quot;s1&quot;&gt;&#39;http://rubyonrails.org/&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;(Having so much code in each branch of the &lt;code&gt;if&lt;/code&gt;-&lt;code&gt;else&lt;/code&gt; conditional is a bit messy, and cleaning it up using partials is left as an exercise (&lt;a href=&quot;user_microposts_fragment.html#sec-exercises_creating_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.3.2.1&lt;/span&gt;&lt;/a&gt;).)&lt;/p&gt;
&lt;p&gt;To get the page defined in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_home_page&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.37&lt;/span&gt;&lt;/a&gt; working, we need to create and fill in a couple of partials.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The first is the new Home page sidebar, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-user_info&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.38&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-user_info&quot; data-tralics-id=&quot;uid1666&quot; data-number=&quot;13.38&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.38:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The partial for the user info sidebar.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/shared/_user_info.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gravatar_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;span&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;view my profile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;span&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pluralize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;micropost&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Note that, as in the profile sidebar (&lt;a href=&quot;user_microposts_fragment.html#code-user_show_microposts&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.24&lt;/span&gt;&lt;/a&gt;), the user info in &lt;a href=&quot;user_microposts_fragment.html#code-user_info&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.38&lt;/span&gt;&lt;/a&gt; displays the total number of microposts for the user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; There’s a slight difference in the display, though; in the profile sidebar, “Microposts” is a label, and showing “Microposts (1)” makes sense.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In the present case, though, saying “1 microposts” is ungrammatical, so we arrange to display “1 micropost” and “2 microposts” using the &lt;code&gt;pluralize&lt;/code&gt; method we saw in &lt;a href=&quot;sign_up_fragment.html#sec-signup_error_messages&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;7.3.3&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We next define the form for creating microposts (&lt;a href=&quot;user_microposts_fragment.html#code-micropost_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.39&lt;/span&gt;&lt;/a&gt;), which is similar to the signup form in &lt;a href=&quot;sign_up_fragment.html#code-signup_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;7.15&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_form&quot; data-tralics-id=&quot;uid1667&quot; data-number=&quot;13.39&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.39:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The form partial for creating microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/shared/_micropost_form.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_area&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;placeholder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Compose new micropost...&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Post&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We need to make two changes before the form in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.39&lt;/span&gt;&lt;/a&gt; will work.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; First, we need to define &lt;code&gt;@micropost&lt;/code&gt;, which (as before) we do through the association:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result appears in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_instance_variable&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.40&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_instance_variable&quot; data-tralics-id=&quot;uid1668&quot; data-number=&quot;13.40&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.40:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding a micropost instance variable to the &lt;code&gt;home&lt;/code&gt; action.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/static_pages_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StaticPagesController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;home&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;help&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;about&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;contact&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Of course, &lt;code&gt;current_user&lt;/code&gt; exists only if the user is logged in, so the &lt;code&gt;@micropost&lt;/code&gt; variable should only be defined in this case.&lt;/p&gt;
&lt;p&gt;The second change needed to get &lt;a href=&quot;user_microposts_fragment.html#code-micropost_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.39&lt;/span&gt;&lt;/a&gt; to work is to redefine the error-messages partial so the following code from &lt;a href=&quot;user_microposts_fragment.html#code-micropost_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.39&lt;/span&gt;&lt;/a&gt; works:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You may recall from &lt;a href=&quot;sign_up_fragment.html#code-f_error_messages&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;7.20&lt;/span&gt;&lt;/a&gt; that the error-messages partial references the &lt;code&gt;@user&lt;/code&gt; variable explicitly, but in the present case we have an &lt;code&gt;@micropost&lt;/code&gt; variable instead.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To unify these cases, we can pass the form variable &lt;code&gt;f&lt;/code&gt; to the partial and access the associated object through &lt;code&gt;f.object&lt;/code&gt;, so that in&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;f.object&lt;/code&gt; is &lt;code&gt;@user&lt;/code&gt;, and in&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;f.object&lt;/code&gt; is &lt;code&gt;@micropost&lt;/code&gt;, etc.&lt;/p&gt;
&lt;p&gt;To pass the object to the partial, we use a hash with value equal to the object and key equal to the desired name of the variable in the partial, which is what the second line in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.39&lt;/span&gt;&lt;/a&gt; accomplishes.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In other words, &lt;code&gt;object: f.object&lt;/code&gt; creates a variable called &lt;code&gt;object&lt;/code&gt; in the &lt;code&gt;error_messages&lt;/code&gt; partial, and we can use it to construct a customized error message, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-updated_error_messages_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.41&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-updated_error_messages_partial&quot; data-tralics-id=&quot;uid1669&quot; data-number=&quot;13.41&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.41:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Error messages that work with other objects.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/shared/_error_messages.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;any?&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;error_explanation&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;alert alert-danger&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      The form contains &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pluralize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;.
&lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ul&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;full_messages&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;lt;li&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ul&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, you should verify that the test suite is &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1670&quot; data-tralics-id=&quot;uid1670&quot; data-number=&quot;13.42&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.42:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is a hint that we need to update the other occurrences of the error-messages partial, which we used when signing up users (&lt;a href=&quot;sign_up_fragment.html#code-f_error_messages&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;7.20&lt;/span&gt;&lt;/a&gt;), resetting passwords (&lt;a href=&quot;password_reset_fragment.html#code-password_reset_form&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;12.14&lt;/span&gt;&lt;/a&gt;), and editing users (&lt;a href=&quot;updating_and_deleting_users_fragment.html#code-user_edit_view&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.2&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The updated versions are shown in &lt;a href=&quot;user_microposts_fragment.html#code-signup_errors_updated&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.43&lt;/span&gt;&lt;/a&gt;, &lt;a href=&quot;user_microposts_fragment.html#code-password_reset_updated&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.45&lt;/span&gt;&lt;/a&gt;, and &lt;a href=&quot;user_microposts_fragment.html#code-edit_errors_updated&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.44&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-signup_errors_updated&quot; data-tralics-id=&quot;uid1671&quot; data-number=&quot;13.43&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.43:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Updating the rendering of user signup errors.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/users/new.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;provide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Sign up&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Sign up&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-6 col-md-offset-3&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Confirmation&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Create my account&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-edit_errors_updated&quot; data-tralics-id=&quot;uid1672&quot; data-number=&quot;13.44&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.44:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Updating the errors for editing users.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/users/edit.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;provide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Edit user&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Update your profile&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-6 col-md-offset-3&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Confirmation&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Save changes&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;gravatar_edit&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gravatar_for&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://gravatar.com/emails&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;change&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-password_reset_updated&quot; data-tralics-id=&quot;uid1673&quot; data-number=&quot;13.45&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.45:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Updating the errors for password resets.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/password_resets/edit.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;provide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Reset password&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Password reset&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-6 col-md-offset-3&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password_reset_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_field_tag&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Confirmation&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password_confirmation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;form-control&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Update password&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, all the tests should be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Additionally, all the HTML in this section should render properly, showing the form as in &lt;a href=&quot;user_microposts_fragment.html#fig-home_with_form&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.11&lt;/span&gt;&lt;/a&gt;, and a form with a submission error as in &lt;a href=&quot;user_microposts_fragment.html#fig-home_form_errors&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.12&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-home_with_form&quot; data-tralics-id=&quot;uid1674&quot; data-number=&quot;13.11&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/home_with_form_3rd_edition.png&quot; alt=&quot;images/figures/home_with_form_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.11: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Home page with a new micropost form.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-home_form_errors&quot; data-tralics-id=&quot;uid1675&quot; data-number=&quot;13.12&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/home_form_errors_3rd_edition.png&quot; alt=&quot;images/figures/home_form_errors_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.12: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Home page with a form error.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_creating_microposts&quot; data-tralics-id=&quot;uid1676&quot; class=&quot;subsubsection&quot; data-number=&quot;13.3.2.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_creating_microposts&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Refactor the Home page to use separate partials for the two branches of the &lt;code&gt;if&lt;/code&gt;-&lt;code&gt;else&lt;/code&gt; statement. &lt;span class=&quot;exercise&quot; id=&quot;ex-9fa8e4&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="846"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-creating_microposts" data-tralics-id="uid1662" class="subsection" data-number="13.3.2">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-creating_microposts" class="heading hyperref"><span class="number">13.3.2 </span>Creating microposts</a></h3>
<p>In <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#cha-sign_up" class="hyperref">Chapter&nbsp;<span class="ref">7</span></a>, we implemented user signup by making an HTML form that issued an HTTP <code class="tt">POST</code> request to the <code>create</code> action in the Users controller.<span class="intersentencespace"></span> The implementation of micropost creation is similar; the main difference is that, rather than using a separate page at /microposts/new, we will put the form on the Home page itself (i.e., the root path&nbsp;/), as mocked up in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-home_page_with_micropost_form_mockup" class="hyperref">Figure&nbsp;<span class="ref">13.10</span></a>.</p>
<div class="center figure" id="fig-home_page_with_micropost_form_mockup" data-tralics-id="uid1663" data-number="13.10">
<div class="graphics image box"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/home_page_with_micropost_form_mockup_bootstrap.png" alt="images/figures/home_page_with_micropost_form_mockup_bootstrap"></div>
<div class="caption">
<span class="header">Figure 13.10: </span><span class="description">A mockup of the Home page with a form for creating microposts.
</span>
</div>
</div>
<p>When we last left the Home page, it appeared as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/filling_in_the_layout#fig-sample_app_logo" class="hyperref">Figure&nbsp;<span class="ref">5.8</span></a>—that is, it had a “Sign up now!”<span class="intersentencespace"></span> button in the middle.<span class="intersentencespace"></span> Since a micropost creation form makes sense only in the context of a particular logged-in user, one goal of this section will be to serve different versions of the Home page depending on a visitor’s login status.<span class="intersentencespace"></span> We’ll implement this in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_home_page" class="hyperref">Listing&nbsp;<span class="ref">13.37</span></a> below.</p>
<p>We’ll start with the <code>create</code> action for microposts, which is similar to its user analogue (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#code-user_create_action" class="hyperref">Listing&nbsp;<span class="ref">7.28</span></a>); the principal difference lies in using the user/micropost association to <code>build</code> the new micropost, as seen in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_create_action" class="hyperref">Listing&nbsp;<span class="ref">13.36</span></a>.<span class="intersentencespace"></span> Note the use of strong parameters via <code>micropost_params</code>, which permits only the micropost’s <code>content</code> attribute to be modified through the web.</p>
<div class="codelisting" id="code-microposts_create_action" data-tralics-id="uid1664" data-number="13.36">
<div class="heading">
<span class="number">Listing 13.36:</span> 

<span class="description">The Microposts controller <code>create</code> action.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/microposts_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:logged_in_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">micropost_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">save</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Micropost created!"</span>
      <span class="n">redirect_to</span> <span class="n">root_url</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'static_pages/home'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">micropost_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:micropost</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:content</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>To build a form for creating microposts, we use the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_home_page" class="hyperref">Listing&nbsp;<span class="ref">13.37</span></a>, which serves up different HTML based on whether the site visitor is logged in or not.</p>
<div class="codelisting" id="code-microposts_home_page" data-tralics-id="uid1665" data-number="13.37">
<div class="heading">
<span class="number">Listing 13.37:</span> 

<span class="description">Adding microposts creation to the Home page (/).<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/static_pages/home.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">logged_in?</span> <span class="cp">%&gt;</span>
</span><span class="hll">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
</span><span class="hll">    <span class="p">&lt;</span><span class="nt">aside</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-md-4"</span><span class="p">&gt;</span>
</span><span class="hll">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">"user_info"</span><span class="p">&gt;</span>
</span><span class="hll">        <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/user_info'</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span class="hll">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">"micropost_form"</span><span class="p">&gt;</span>
</span><span class="hll">        <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/micropost_form'</span> <span class="cp">%&gt;</span>
</span><span class="hll">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span class="hll">    <span class="p">&lt;/</span><span class="nt">aside</span><span class="p">&gt;</span>
</span><span class="hll">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll"><span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
</span>  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"center jumbotron"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to the Sample App<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>
      This is the home page for the
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://www.railstutorial.org/"</span><span class="p">&gt;</span>Ruby on Rails Tutorial<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      sample application.
    <span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Sign up now!"</span><span class="p">,</span> <span class="n">signup_path</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-lg btn-primary"</span> <span class="cp">%&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">"rails.png"</span><span class="p">,</span> <span class="ss">alt</span><span class="p">:</span> <span class="s2">"Rails logo"</span><span class="p">),</span>
              <span class="s1">'http://rubyonrails.org/'</span> <span class="cp">%&gt;</span>
<span class="hll"><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</span></pre></div></div>
</div>
<p>(Having so much code in each branch of the <code>if</code>-<code>else</code> conditional is a bit messy, and cleaning it up using partials is left as an exercise (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_creating_microposts" class="hyperref">Section&nbsp;<span class="ref">13.3.2.1</span></a>).)</p>
<p>To get the page defined in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_home_page" class="hyperref">Listing&nbsp;<span class="ref">13.37</span></a> working, we need to create and fill in a couple of partials.<span class="intersentencespace"></span> The first is the new Home page sidebar, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_info" class="hyperref">Listing&nbsp;<span class="ref">13.38</span></a>.</p>
<div class="codelisting" id="code-user_info" data-tralics-id="uid1666" data-number="13.38">
<div class="heading">
<span class="number">Listing 13.38:</span> 

<span class="description">The partial for the user info sidebar.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/shared/_user_info.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">gravatar_for</span><span class="p">(</span><span class="n">current_user</span><span class="p">,</span> <span class="ss">size</span><span class="p">:</span> <span class="mi">50</span><span class="p">),</span> <span class="n">current_user</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"view my profile"</span><span class="p">,</span> <span class="n">current_user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="s2">"micropost"</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
</pre></div></div>
</div>
<p>Note that, as in the profile sidebar (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_show_microposts" class="hyperref">Listing&nbsp;<span class="ref">13.24</span></a>), the user info in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-user_info" class="hyperref">Listing&nbsp;<span class="ref">13.38</span></a> displays the total number of microposts for the user.<span class="intersentencespace"></span> There’s a slight difference in the display, though; in the profile sidebar, “Microposts” is a label, and showing “Microposts (1)” makes sense.<span class="intersentencespace"></span> In the present case, though, saying “1 microposts” is ungrammatical, so we arrange to display “1 micropost” and “2 microposts” using the <code>pluralize</code> method we saw in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#sec-signup_error_messages" class="hyperref">Section&nbsp;<span class="ref">7.3.3</span></a>.</p>
<p>We next define the form for creating microposts (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_form" class="hyperref">Listing&nbsp;<span class="ref">13.39</span></a>), which is similar to the signup form in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#code-signup_form" class="hyperref">Listing&nbsp;<span class="ref">7.15</span></a>.</p>
<div class="codelisting" id="code-micropost_form" data-tralics-id="uid1667" data-number="13.39">
<div class="heading">
<span class="number">Listing 13.39:</span> 

<span class="description">The form partial for creating microposts.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/shared/_micropost_form.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@micropost</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"Compose new micropost..."</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Post"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<p>We need to make two changes before the form in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_form" class="hyperref">Listing&nbsp;<span class="ref">13.39</span></a> will work.<span class="intersentencespace"></span> First, we need to define <code>@micropost</code>, which (as before) we do through the association:</p>
<div class="code"><div class="highlight"><pre><span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span>
</pre></div></div>
<p>The result appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_instance_variable" class="hyperref">Listing&nbsp;<span class="ref">13.40</span></a>.</p>
<div class="codelisting" id="code-micropost_instance_variable" data-tralics-id="uid1668" data-number="13.40">
<div class="heading">
<span class="number">Listing 13.40:</span> 

<span class="description">Adding a micropost instance variable to the <code>home</code> action.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/static_pages_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
<span class="hll">    <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span> <span class="k">if</span> <span class="n">logged_in?</span>
</span>  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">help</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Of course, <code>current_user</code> exists only if the user is logged in, so the <code>@micropost</code> variable should only be defined in this case.</p>
<p>The second change needed to get <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_form" class="hyperref">Listing&nbsp;<span class="ref">13.39</span></a> to work is to redefine the error-messages partial so the following code from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_form" class="hyperref">Listing&nbsp;<span class="ref">13.39</span></a> works:</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p>You may recall from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#code-f_error_messages" class="hyperref">Listing&nbsp;<span class="ref">7.20</span></a> that the error-messages partial references the <code>@user</code> variable explicitly, but in the present case we have an <code>@micropost</code> variable instead.<span class="intersentencespace"></span> To unify these cases, we can pass the form variable&nbsp;<code>f</code> to the partial and access the associated object through <code>f.object</code>, so that in</p>
<div class="code"><div class="highlight"><pre><span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</pre></div></div>
<p><code>f.object</code> is <code>@user</code>, and in</p>
<div class="code"><div class="highlight"><pre><span class="n">form_for</span><span class="p">(</span><span class="vi">@micropost</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</pre></div></div>
<p><code>f.object</code> is <code>@micropost</code>, etc.</p>
<p>To pass the object to the partial, we use a hash with value equal to the object and key equal to the desired name of the variable in the partial, which is what the second line in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_form" class="hyperref">Listing&nbsp;<span class="ref">13.39</span></a> accomplishes.<span class="intersentencespace"></span> In other words, <code>object: f.object</code> creates a variable called <code>object</code> in the <code>error_messages</code> partial, and we can use it to construct a customized error message, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-updated_error_messages_partial" class="hyperref">Listing&nbsp;<span class="ref">13.41</span></a>.</p>
<div class="codelisting" id="code-updated_error_messages_partial" data-tralics-id="uid1669" data-number="13.41">
<div class="heading">
<span class="number">Listing 13.41:</span> 

<span class="description">Error messages that work with other objects.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">app/views/shared/_error_messages.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="hll"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">object</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span> <span class="cp">%&gt;</span>
</span>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span><span class="nt">&gt;</span>
<span class="hll">      The form contains <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="n">object</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span>.
</span>    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
<span class="hll">    <span class="cp">&lt;%</span> <span class="n">object</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
</span>      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<p>At this point, you should verify that the test suite is <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1670" data-tralics-id="uid1670" data-number="13.42">
<div class="heading">
<span class="number">Listing 13.42:</span> <span class="description"><span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
<p>This is a hint that we need to update the other occurrences of the error-messages partial, which we used when signing up users (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#code-f_error_messages" class="hyperref">Listing&nbsp;<span class="ref">7.20</span></a>), resetting passwords (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#code-password_reset_form" class="hyperref">Listing&nbsp;<span class="ref">12.14</span></a>), and editing users (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-user_edit_view" class="hyperref">Listing&nbsp;<span class="ref">10.2</span></a>).<span class="intersentencespace"></span> The updated versions are shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-signup_errors_updated" class="hyperref">Listing&nbsp;<span class="ref">13.43</span></a>, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-password_reset_updated" class="hyperref">Listing&nbsp;<span class="ref">13.45</span></a>, and <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-edit_errors_updated" class="hyperref">Listing&nbsp;<span class="ref">13.44</span></a>.</p>
<div class="codelisting" id="code-signup_errors_updated" data-tralics-id="uid1671" data-number="13.43">
<div class="heading">
<span class="number">Listing 13.43:</span> 

<span class="description">Updating the rendering of user signup errors.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/users/new.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Sign up'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
</span>      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">"Confirmation"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Create my account"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-edit_errors_updated" data-tralics-id="uid1672" data-number="13.44">
<div class="heading">
<span class="number">Listing 13.44:</span> 

<span class="description">Updating the errors for editing users.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/users/edit.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s2">"Edit user"</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Update your profile<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:email</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">email_field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">"Confirmation"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Save changes"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"gravatar_edit"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">gravatar_for</span> <span class="vi">@user</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://gravatar.com/emails"</span><span class="nt">&gt;</span>change<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-password_reset_updated" data-tralics-id="uid1673" data-number="13.45">
<div class="heading">
<span class="number">Listing 13.45:</span> 

<span class="description">Updating the errors for password resets.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/password_resets/edit.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">'Reset password'</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Password reset<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6 col-md-offset-3"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@user</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">password_reset_path</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
</span>
      <span class="cp">&lt;%=</span> <span class="n">hidden_field_tag</span> <span class="ss">:email</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="s2">"Confirmation"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">password_field</span> <span class="ss">:password_confirmation</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">'form-control'</span> <span class="cp">%&gt;</span>

      <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Update password"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div></div>
</div>
<p>At this point, all the tests should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
<p>Additionally, all the HTML in this section should render properly, showing the form as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-home_with_form" class="hyperref">Figure&nbsp;<span class="ref">13.11</span></a>, and a form with a submission error as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-home_form_errors" class="hyperref">Figure&nbsp;<span class="ref">13.12</span></a>.</p>
<div class="center figure" id="fig-home_with_form" data-tralics-id="uid1674" data-number="13.11">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/home_with_form_3rd_edition.png" alt="images/figures/home_with_form_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.11: </span><span class="description">The Home page with a new micropost form.
</span>
</div>
</div>
<div class="center figure" id="fig-home_form_errors" data-tralics-id="uid1675" data-number="13.12">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/home_form_errors_3rd_edition.png" alt="images/figures/home_form_errors_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.12: </span><span class="description">The Home page with a form error.
</span>
</div>
</div>
<div id="sec-exercises_creating_microposts" data-tralics-id="uid1676" class="subsubsection" data-number="13.3.2.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_creating_microposts" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Refactor the Home page to use separate partials for the two branches of the <code>if</code>-<code>else</code> statement. <span class="exercise" id="ex-9fa8e4"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-a_proto_feed&quot; data-tralics-id=&quot;uid1678&quot; class=&quot;subsection&quot; data-number=&quot;13.3.3&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-a_proto_feed&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.3.3 &lt;/span&gt;A proto-feed&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Although the micropost form is actually now working, users can’t immediately see the results of a successful submission because the current Home page doesn’t display any microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; If you like, you can verify that the form shown in &lt;a href=&quot;user_microposts_fragment.html#fig-home_with_form&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.11&lt;/span&gt;&lt;/a&gt; is working by submitting a valid entry and then navigating to the profile page to see the post, but that’s rather cumbersome.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; It would be far better to have a &lt;em&gt;feed&lt;/em&gt; of microposts that includes the user’s own posts, as mocked up in &lt;a href=&quot;user_microposts_fragment.html#fig-proto_feed_mockup&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.13&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (In &lt;a href=&quot;following_users_fragment.html#cha-following_users&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;14&lt;/span&gt;&lt;/a&gt;, we’ll generalize this feed to include the microposts of users being &lt;em&gt;followed&lt;/em&gt; by the current user, à la Twitter.)&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-proto_feed_mockup&quot; data-tralics-id=&quot;uid1679&quot; data-number=&quot;13.13&quot;&gt;
&lt;div class=&quot;graphics image box&quot;&gt;&lt;img src=&quot;images/figures/proto_feed_mockup_3rd_edition.png&quot; alt=&quot;images/figures/proto_feed_mockup_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.13: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A mockup of the Home page with a proto-feed.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Since each user should have a feed, we are led naturally to a &lt;code&gt;feed&lt;/code&gt; method in the User model, which will initially just select all the microposts belonging to the current user.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll accomplish this using the &lt;code&gt;where&lt;/code&gt; method on the &lt;code&gt;Micropost&lt;/code&gt; model (seen briefly before in &lt;a href=&quot;account_activation_fragment.html#sec-exercises_activation_test_and_refactoring&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;11.3.3.1&lt;/span&gt;&lt;/a&gt;), as shown in &lt;a href=&quot;user_microposts_fragment.html#code-proto_status_feed&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.46&lt;/span&gt;&lt;/a&gt;.&lt;sup id=&quot;cha-13_footnote-ref-11&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-11&quot;&gt;11&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-proto_status_feed&quot; data-tralics-id=&quot;uid1681&quot; data-number=&quot;13.46&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.46:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A preliminary implementation for the micropost status feed.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/user.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Defines a proto-feed.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# See &quot;Following users&quot; for the full implementation.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;feed&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user_id = ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The question mark in&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;no&quot;&gt;Micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user_id = ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ensures that &lt;code&gt;id&lt;/code&gt; is properly &lt;em&gt;escaped&lt;/em&gt; before being included in the underlying SQL query, thereby avoiding a serious security hole called &lt;a href=&quot;https://en.wikipedia.org/wiki/SQL_injection&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;em&gt;SQL injection&lt;/em&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The &lt;code&gt;id&lt;/code&gt; attribute here is just an integer (i.e., &lt;code&gt;self.id&lt;/code&gt;, the unique ID of the user), so there is no danger of SQL injection in this case, but it does no harm, and &lt;em&gt;always&lt;/em&gt; escaping variables injected into SQL statements is a good habit to cultivate.&lt;/p&gt;
&lt;p&gt;Alert readers might note at this point that the code in &lt;a href=&quot;user_microposts_fragment.html#code-proto_status_feed&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.46&lt;/span&gt;&lt;/a&gt; is essentially equivalent to writing&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;feed&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We’ve used the code in &lt;a href=&quot;user_microposts_fragment.html#code-proto_status_feed&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.46&lt;/span&gt;&lt;/a&gt; instead because it generalizes much more naturally to the full status feed needed in &lt;a href=&quot;following_users_fragment.html#cha-following_users&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;14&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To use the feed in the sample application, we add an &lt;code&gt;@feed_items&lt;/code&gt; instance variable for the current user’s (paginated) feed, as in &lt;a href=&quot;user_microposts_fragment.html#code-feed_instance_variable&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.47&lt;/span&gt;&lt;/a&gt;, and then add a status feed partial (&lt;a href=&quot;user_microposts_fragment.html#code-feed_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.48&lt;/span&gt;&lt;/a&gt;) to the Home page (&lt;a href=&quot;user_microposts_fragment.html#code-home_with_feed&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.49&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note that, now that there are two lines that need to be run when the user is logged in, &lt;a href=&quot;user_microposts_fragment.html#code-feed_instance_variable&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.47&lt;/span&gt;&lt;/a&gt; changes&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;from &lt;a href=&quot;user_microposts_fragment.html#code-micropost_instance_variable&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.40&lt;/span&gt;&lt;/a&gt; to&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;feed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paginate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;thereby moving the conditional from the end of the line to an if-end statement.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-feed_instance_variable&quot; data-tralics-id=&quot;uid1682&quot; data-number=&quot;13.47&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.47:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding a feed instance variable to the &lt;code&gt;home&lt;/code&gt; action.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/static_pages_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StaticPagesController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;home&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;feed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paginate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;help&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;about&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;contact&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-feed_partial&quot; data-tralics-id=&quot;uid1683&quot; data-number=&quot;13.48&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.48:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The status feed partial.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/shared/_feed.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;any?&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;ol&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;microposts&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ol&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;will_paginate&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The status feed partial defers the rendering to the micropost partial defined in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.22&lt;/span&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here Rails knows to call the micropost partial because each element of &lt;code&gt;@feed_items&lt;/code&gt; has class &lt;code&gt;Micropost&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This causes Rails to look for a partial with the corresponding name in the views directory of the given resource:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;go&quot;&gt;app/views/microposts/_micropost.html.erb&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can add the feed to the Home page by rendering the feed partial as usual (&lt;a href=&quot;user_microposts_fragment.html#code-home_with_feed&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.49&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result is a display of the feed on the Home page, as required (&lt;a href=&quot;user_microposts_fragment.html#fig-home_with_proto_feed&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.14&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-home_with_feed&quot; data-tralics-id=&quot;uid1684&quot; data-number=&quot;13.49&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.49:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding a status feed to the Home page.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/static_pages/home.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;logged_in?&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;row&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;aside&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-4&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;section&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user_info&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/user_info&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/section&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;section&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;micropost_form&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/micropost_form&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/section&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/aside&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;col-md-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Micropost Feed&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/feed&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  .
  .
  .
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-home_with_proto_feed&quot; data-tralics-id=&quot;uid1685&quot; data-number=&quot;13.14&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/home_with_proto_feed_3rd_edition.png&quot; alt=&quot;images/figures/home_with_proto_feed_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.14: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Home page with a proto-feed.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;At this point, creating a new micropost works as expected, as seen in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_created&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.15&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; There is one subtlety, though: on &lt;em&gt;failed&lt;/em&gt; micropost submission, the Home page expects an &lt;code&gt;@feed_items&lt;/code&gt; instance variable, so failed submissions currently break.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The easiest solution is to suppress the feed entirely by assigning it an empty array, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_create_action_with_feed&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.50&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (Unfortunately, returning a paginated feed doesn’t work in this case.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Implement it and click on a pagination link to see why.)&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_created&quot; data-tralics-id=&quot;uid1686&quot; data-number=&quot;13.15&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/micropost_created_3rd_edition.png&quot; alt=&quot;images/figures/micropost_created_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.15: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Home page after creating a new micropost.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_create_action_with_feed&quot; data-tralics-id=&quot;uid1687&quot; data-number=&quot;13.50&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.50:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding an (empty) &lt;code&gt;@feed_items&lt;/code&gt; instance variable to the &lt;code&gt;create&lt;/code&gt; action.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/microposts_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:logged_in_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;flash&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:success&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Micropost created!&quot;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;vi&quot;&gt;@feed_items&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt;
&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;static_pages/home&#39;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;destroy&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;micropost_params&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_a_proto_feed&quot; data-tralics-id=&quot;uid1688&quot; class=&quot;subsubsection&quot; data-number=&quot;13.3.3.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_a_proto_feed&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Use the newly created micropost UI to create the first real micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What are the contents of the &lt;code&gt;INSERT&lt;/code&gt; command in the server log? &lt;span class=&quot;exercise&quot; id=&quot;ex-31697d&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;In the console, set &lt;code&gt;user&lt;/code&gt; to the first user in the database.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Confirm that the values of &lt;code&gt;Micropost.where(&quot;user_id = ?&quot;, user.id)&lt;/code&gt;, &lt;code&gt;user.microposts&lt;/code&gt;, and &lt;code&gt;user.feed&lt;/code&gt; are all the same.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;em&gt;Hint&lt;/em&gt;: It’s probably easiest to compare directly using &lt;code&gt;==&lt;/code&gt;. &lt;span class=&quot;exercise&quot; id=&quot;ex-e4ef4b&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="847"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-a_proto_feed" data-tralics-id="uid1678" class="subsection" data-number="13.3.3">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-a_proto_feed" class="heading hyperref"><span class="number">13.3.3 </span>A proto-feed</a></h3>
<p>Although the micropost form is actually now working, users can’t immediately see the results of a successful submission because the current Home page doesn’t display any microposts.<span class="intersentencespace"></span> If you like, you can verify that the form shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-home_with_form" class="hyperref">Figure&nbsp;<span class="ref">13.11</span></a> is working by submitting a valid entry and then navigating to the profile page to see the post, but that’s rather cumbersome.<span class="intersentencespace"></span> It would be far better to have a <em>feed</em> of microposts that includes the user’s own posts, as mocked up in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-proto_feed_mockup" class="hyperref">Figure&nbsp;<span class="ref">13.13</span></a>.<span class="intersentencespace"></span> (In <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#cha-following_users" class="hyperref">Chapter&nbsp;<span class="ref">14</span></a>, we’ll generalize this feed to include the microposts of users being <em>followed</em> by the current user, à la Twitter.)</p>
<div class="center figure" id="fig-proto_feed_mockup" data-tralics-id="uid1679" data-number="13.13">
<div class="graphics image box"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/proto_feed_mockup_3rd_edition.png" alt="images/figures/proto_feed_mockup_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.13: </span><span class="description">A mockup of the Home page with a proto-feed.
</span>
</div>
</div>
<p>Since each user should have a feed, we are led naturally to a <code>feed</code> method in the User model, which will initially just select all the microposts belonging to the current user.<span class="intersentencespace"></span> We’ll accomplish this using the <code>where</code> method on the <code>Micropost</code> model (seen briefly before in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-exercises_activation_test_and_refactoring" class="hyperref">Section&nbsp;<span class="ref">11.3.3.1</span></a>), as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-proto_status_feed" class="hyperref">Listing&nbsp;<span class="ref">13.46</span></a>.<sup id="cha-13_footnote-ref-11" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-11" data-hasqtip="18">11</a></sup></p>
<div class="codelisting" id="code-proto_status_feed" data-tralics-id="uid1681" data-number="13.46">
<div class="heading">
<span class="number">Listing 13.46:</span> 

<span class="description">A preliminary implementation for the micropost status feed.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/user.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># Defines a proto-feed.</span>
  <span class="c1"># See "Following users" for the full implementation.</span>
  <span class="k">def</span> <span class="nf">feed</span>
<span class="hll">    <span class="no">Micropost</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">"user_id = ?"</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</span>  <span class="k">end</span>

    <span class="kp">private</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>The question mark in</p>
<div class="code"><div class="highlight"><pre><span class="no">Micropost</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">"user_id = ?"</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</pre></div></div>
<p>ensures that <code>id</code>&nbsp;is properly <em>escaped</em> before being included in the underlying SQL query, thereby avoiding a serious security hole called <a href="https://en.wikipedia.org/wiki/SQL_injection" target="_blank" rel="noopener"><em>SQL injection</em></a>.<span class="intersentencespace"></span> The <code>id</code> attribute here is just an integer (i.e., <code>self.id</code>, the unique ID of the user), so there is no danger of SQL injection in this case, but it does no harm, and <em>always</em> escaping variables injected into SQL statements is a good habit to cultivate.</p>
<p>Alert readers might note at this point that the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-proto_status_feed" class="hyperref">Listing&nbsp;<span class="ref">13.46</span></a> is essentially equivalent to writing</p>
<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">feed</span>
  <span class="n">microposts</span>
<span class="k">end</span>
</pre></div></div>
<p>We’ve used the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-proto_status_feed" class="hyperref">Listing&nbsp;<span class="ref">13.46</span></a> instead because it generalizes much more naturally to the full status feed needed in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#cha-following_users" class="hyperref">Chapter&nbsp;<span class="ref">14</span></a>.</p>
<p>To use the feed in the sample application, we add an <code>@feed_items</code> instance variable for the current user’s (paginated) feed, as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-feed_instance_variable" class="hyperref">Listing&nbsp;<span class="ref">13.47</span></a>, and then add a status feed partial (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-feed_partial" class="hyperref">Listing&nbsp;<span class="ref">13.48</span></a>) to the Home page (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-home_with_feed" class="hyperref">Listing&nbsp;<span class="ref">13.49</span></a>).<span class="intersentencespace"></span> Note that, now that there are two lines that need to be run when the user is logged in, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-feed_instance_variable" class="hyperref">Listing&nbsp;<span class="ref">13.47</span></a> changes</p>
<div class="code"><div class="highlight"><pre><span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span> <span class="k">if</span> <span class="n">logged_in?</span>
</pre></div></div>
<p>from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_instance_variable" class="hyperref">Listing&nbsp;<span class="ref">13.40</span></a> to</p>
<div class="code"><div class="highlight"><pre>  <span class="k">if</span> <span class="n">logged_in?</span>
    <span class="vi">@micropost</span>  <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span>
    <span class="vi">@feed_items</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">page</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
</pre></div></div>
<p>thereby moving the conditional from the end of the line to an if-end statement.</p>
<div class="codelisting" id="code-feed_instance_variable" data-tralics-id="uid1682" data-number="13.47">
<div class="heading">
<span class="number">Listing 13.47:</span> 

<span class="description">Adding a feed instance variable to the <code>home</code> action.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/static_pages_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
<span class="hll">    <span class="k">if</span> <span class="n">logged_in?</span>
</span><span class="hll">      <span class="vi">@micropost</span>  <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span>
</span><span class="hll">      <span class="vi">@feed_items</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">page</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">    <span class="k">end</span>
</span>  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">help</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="codelisting" id="code-feed_partial" data-tralics-id="uid1683" data-number="13.48">
<div class="heading">
<span class="number">Listing 13.48:</span> 

<span class="description">The status feed partial.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/shared/_feed.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@feed_items</span><span class="o">.</span><span class="n">any?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;ol</span> <span class="na">class=</span><span class="s">"microposts"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@feed_items</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/ol&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">will_paginate</span> <span class="vi">@feed_items</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<p>The status feed partial defers the rendering to the micropost partial defined in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial" class="hyperref">Listing&nbsp;<span class="ref">13.22</span></a>:</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@feed_items</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p>Here Rails knows to call the micropost partial because each element of <code>@feed_items</code> has class <code>Micropost</code>.<span class="intersentencespace"></span> This causes Rails to look for a partial with the corresponding name in the views directory of the given resource:</p>
<div class="code"><div class="highlight"><pre><span class="go">app/views/microposts/_micropost.html.erb</span>
</pre></div></div>
<p>We can add the feed to the Home page by rendering the feed partial as usual (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-home_with_feed" class="hyperref">Listing&nbsp;<span class="ref">13.49</span></a>).<span class="intersentencespace"></span> The result is a display of the feed on the Home page, as required (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-home_with_proto_feed" class="hyperref">Figure&nbsp;<span class="ref">13.14</span></a>).</p>
<div class="codelisting" id="code-home_with_feed" data-tralics-id="uid1684" data-number="13.49">
<div class="heading">
<span class="number">Listing 13.49:</span> 

<span class="description">Adding a status feed to the Home page.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/static_pages/home.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">logged_in?</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;aside</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"user_info"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/user_info'</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/section&gt;</span>
      <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"micropost_form"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/micropost_form'</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/section&gt;</span>
    <span class="nt">&lt;/aside&gt;</span>
<span class="hll">    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-8"</span><span class="nt">&gt;</span>
</span><span class="hll">      <span class="nt">&lt;h3&gt;</span>Micropost Feed<span class="nt">&lt;/h3&gt;</span>
</span><span class="hll">      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/feed'</span> <span class="cp">%&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/div&gt;</span>
</span>  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">else</span> <span class="cp">%&gt;</span>
  .
  .
  .
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<div class="center figure" id="fig-home_with_proto_feed" data-tralics-id="uid1685" data-number="13.14">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/home_with_proto_feed_3rd_edition.png" alt="images/figures/home_with_proto_feed_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.14: </span><span class="description">The Home page with a proto-feed.
</span>
</div>
</div>
<p>At this point, creating a new micropost works as expected, as seen in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_created" class="hyperref">Figure&nbsp;<span class="ref">13.15</span></a>.<span class="intersentencespace"></span> There is one subtlety, though: on <em>failed</em> micropost submission, the Home page expects an <code>@feed_items</code> instance variable, so failed submissions currently break.<span class="intersentencespace"></span> The easiest solution is to suppress the feed entirely by assigning it an empty array, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_create_action_with_feed" class="hyperref">Listing&nbsp;<span class="ref">13.50</span></a>.<span class="intersentencespace"></span> (Unfortunately, returning a paginated feed doesn’t work in this case.<span class="intersentencespace"></span> Implement it and click on a pagination link to see why.)</p>
<div class="center figure" id="fig-micropost_created" data-tralics-id="uid1686" data-number="13.15">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/micropost_created_3rd_edition.png" alt="images/figures/micropost_created_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.15: </span><span class="description">The Home page after creating a new micropost.
</span>
</div>
</div>
<div class="codelisting" id="code-microposts_create_action_with_feed" data-tralics-id="uid1687" data-number="13.50">
<div class="heading">
<span class="number">Listing 13.50:</span> 

<span class="description">Adding an (empty) <code>@feed_items</code> instance variable to the <code>create</code> action.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/microposts_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:logged_in_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">micropost_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">save</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Micropost created!"</span>
      <span class="n">redirect_to</span> <span class="n">root_url</span>
    <span class="k">else</span>
<span class="hll">      <span class="vi">@feed_items</span> <span class="o">=</span> <span class="o">[]</span>
</span>      <span class="n">render</span> <span class="s1">'static_pages/home'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">micropost_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:micropost</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:content</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div id="sec-exercises_a_proto_feed" data-tralics-id="uid1688" class="subsubsection" data-number="13.3.3.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_a_proto_feed" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Use the newly created micropost UI to create the first real micropost.<span class="intersentencespace"></span> What are the contents of the <code>INSERT</code> command in the server log? <span class="exercise" id="ex-31697d"></span>
</li>
<li>In the console, set <code>user</code> to the first user in the database.<span class="intersentencespace"></span> Confirm that the values of <code>Micropost.where("user_id = ?", user.id)</code>, <code>user.microposts</code>, and <code>user.feed</code> are all the same.<span class="intersentencespace"></span> <em>Hint</em>: It’s probably easiest to compare directly using <code>==</code>. <span class="exercise" id="ex-e4ef4b"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-destroying_microposts&quot; data-tralics-id=&quot;uid1691&quot; class=&quot;subsection&quot; data-number=&quot;13.3.4&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-destroying_microposts&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.3.4 &lt;/span&gt;Destroying microposts&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The last piece of functionality to add to the Microposts resource is the ability to destroy posts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As with user deletion (&lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-the_destroy_action&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.4.2&lt;/span&gt;&lt;/a&gt;), we accomplish this with “delete” links, as mocked up in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_delete_links_mockup&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.16&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Unlike that case, which restricted user destruction to admin users, the delete links will work only for microposts created by the current user.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_delete_links_mockup&quot; data-tralics-id=&quot;uid1692&quot; data-number=&quot;13.16&quot;&gt;
&lt;div class=&quot;graphics image box&quot;&gt;&lt;img src=&quot;images/figures/micropost_delete_links_mockup_3rd_edition.png&quot; alt=&quot;images/figures/micropost_delete_links_mockup_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.16: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A mockup of the proto-feed with micropost delete links.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Our first step is to add a delete link to the micropost partial as in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.22&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result appears in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial_with_delete&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.51&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_partial_with_delete&quot; data-tralics-id=&quot;uid1693&quot; data-number=&quot;13.51&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.51:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding a delete link to the micropost partial.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/microposts/_micropost.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;li&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gravatar_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Posted &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_ago_in_words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt; ago.
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;delete&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;                                       &lt;span class=&quot;ss&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;confirm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;You sure?&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The next step is to define a &lt;code&gt;destroy&lt;/code&gt; action in the Microposts controller, which is analogous to the user case in &lt;a href=&quot;updating_and_deleting_users_fragment.html#code-admin_destroy_before_filter&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;10.59&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The main difference is that, rather than using an &lt;code&gt;@user&lt;/code&gt; variable with an &lt;code&gt;admin_user&lt;/code&gt; before filter, we’ll find the micropost through the association, which will automatically fail if a user tries to delete another user’s micropost.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll put the resulting &lt;code&gt;find&lt;/code&gt; inside a &lt;code&gt;correct_user&lt;/code&gt; before filter, which checks that the current user actually has a micropost with the given id.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result appears in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_destroy_action&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.52&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_destroy_action&quot; data-tralics-id=&quot;uid1694&quot; data-number=&quot;13.52&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.52:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The Microposts controller &lt;code&gt;destroy&lt;/code&gt; action.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/microposts_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:logged_in_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:correct_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;destroy&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destroy&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;flash&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:success&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Micropost deleted&quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;referrer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;micropost_params&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;correct_user&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find_by&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil?&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Note that the &lt;code&gt;destroy&lt;/code&gt; method in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_destroy_action&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.52&lt;/span&gt;&lt;/a&gt; redirects to the URL&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;referrer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This uses the &lt;code&gt;request.referrer&lt;/code&gt; method,&lt;sup id=&quot;cha-13_footnote-ref-12&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-12&quot;&gt;12&lt;/a&gt;&lt;/sup&gt; which is related to the &lt;code&gt;request.original_url&lt;/code&gt; variable used in friendly forwarding (&lt;a href=&quot;updating_and_deleting_users_fragment.html#sec-friendly_forwarding&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;10.2.3&lt;/span&gt;&lt;/a&gt;), and is just the previous URL (in this case, the Home page).&lt;sup id=&quot;cha-13_footnote-ref-13&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-13&quot;&gt;13&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This is convenient because microposts appear on both the Home page and on the user’s profile page, so by using &lt;code&gt;request.referrer&lt;/code&gt; we arrange to redirect back to the page issuing the delete request in both cases.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; If the referring URL is &lt;code&gt;nil&lt;/code&gt; (as is the case inside some tests), &lt;a href=&quot;user_microposts_fragment.html#code-microposts_destroy_action&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.52&lt;/span&gt;&lt;/a&gt; sets the &lt;code&gt;root_url&lt;/code&gt; as the default using the &lt;code&gt;||&lt;/code&gt; operator.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (Compare to the default options defined in &lt;a href=&quot;advanced_login_fragment.html#code-test_helper_log_in&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;9.24&lt;/span&gt;&lt;/a&gt;.)&lt;/p&gt;
&lt;p&gt;With the code as above, the result of destroying the second-most recent post appears in &lt;a href=&quot;user_microposts_fragment.html#fig-home_post_delete&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.17&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-home_post_delete&quot; data-tralics-id=&quot;uid1697&quot; data-number=&quot;13.17&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/home_post_delete_3rd_edition.png&quot; alt=&quot;images/figures/home_post_delete_3rd_edition&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.17: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Home page after deleting the second-most-recent micropost.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_destroying_microposts&quot; data-tralics-id=&quot;uid1698&quot; class=&quot;subsubsection&quot; data-number=&quot;13.3.4.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_destroying_microposts&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Create a new micropost and then delete it.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; What are the contents of the &lt;code&gt;DELETE&lt;/code&gt; command in the server log? &lt;span class=&quot;exercise&quot; id=&quot;ex-48d333&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Confirm directly in the browser that the line &lt;code&gt;redirect_to request.referrer || root_url&lt;/code&gt; can be replaced with the line &lt;code&gt;redirect_back(fallback_location: root_url)&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (This method was added in Rails 5.) &lt;span class=&quot;exercise&quot; id=&quot;ex-f7f907&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="848"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-destroying_microposts" data-tralics-id="uid1691" class="subsection" data-number="13.3.4">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-destroying_microposts" class="heading hyperref"><span class="number">13.3.4 </span>Destroying microposts</a></h3>
<p>The last piece of functionality to add to the Microposts resource is the ability to destroy posts.<span class="intersentencespace"></span> As with user deletion (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-the_destroy_action" class="hyperref">Section&nbsp;<span class="ref">10.4.2</span></a>), we accomplish this with “delete” links, as mocked up in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_delete_links_mockup" class="hyperref">Figure&nbsp;<span class="ref">13.16</span></a>.<span class="intersentencespace"></span> Unlike that case, which restricted user destruction to admin users, the delete links will work only for microposts created by the current user.</p>
<div class="center figure" id="fig-micropost_delete_links_mockup" data-tralics-id="uid1692" data-number="13.16">
<div class="graphics image box"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/micropost_delete_links_mockup_3rd_edition.png" alt="images/figures/micropost_delete_links_mockup_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.16: </span><span class="description">A mockup of the proto-feed with micropost delete links.
</span>
</div>
</div>
<p>Our first step is to add a delete link to the micropost partial as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial" class="hyperref">Listing&nbsp;<span class="ref">13.22</span></a>.<span class="intersentencespace"></span> The result appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial_with_delete" class="hyperref">Listing&nbsp;<span class="ref">13.51</span></a>.</p>
<div class="codelisting" id="code-micropost_partial_with_delete" data-tralics-id="uid1693" data-number="13.51">
<div class="heading">
<span class="number">Listing 13.51:</span> 

<span class="description">Adding a delete link to the micropost partial.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/microposts/_micropost.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">gravatar_for</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="ss">size</span><span class="p">:</span> <span class="mi">50</span><span class="p">),</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"user"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"timestamp"</span><span class="nt">&gt;</span>
    Posted <span class="cp">&lt;%=</span> <span class="n">time_ago_in_words</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="cp">%&gt;</span> ago.
    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user?</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="hll">      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"delete"</span><span class="p">,</span> <span class="n">micropost</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span>
</span><span class="hll">                                       <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s2">"You sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</span>    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</pre></div></div>
</div>
<p>The next step is to define a <code>destroy</code> action in the Microposts controller, which is analogous to the user case in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#code-admin_destroy_before_filter" class="hyperref">Listing&nbsp;<span class="ref">10.59</span></a>.<span class="intersentencespace"></span> The main difference is that, rather than using an <code>@user</code> variable with an <code>admin_user</code> before filter, we’ll find the micropost through the association, which will automatically fail if a user tries to delete another user’s micropost.<span class="intersentencespace"></span> We’ll put the resulting <code>find</code> inside a <code>correct_user</code> before filter, which checks that the current user actually has a micropost with the given id.<span class="intersentencespace"></span> The result appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_destroy_action" class="hyperref">Listing&nbsp;<span class="ref">13.52</span></a>.</p>
<div class="codelisting" id="code-microposts_destroy_action" data-tralics-id="uid1694" data-number="13.52">
<div class="heading">
<span class="number">Listing 13.52:</span> 

<span class="description">The Microposts controller <code>destroy</code> action.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/microposts_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:logged_in_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
<span class="hll">  <span class="n">before_action</span> <span class="ss">:correct_user</span><span class="p">,</span>   <span class="ss">only</span><span class="p">:</span> <span class="ss">:destroy</span>
</span>  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">destroy</span>
<span class="hll">    <span class="vi">@micropost</span><span class="o">.</span><span class="n">destroy</span>
</span><span class="hll">    <span class="n">flash</span><span class="o">[</span><span class="ss">:success</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Micropost deleted"</span>
</span><span class="hll">    <span class="n">redirect_to</span> <span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="o">||</span> <span class="n">root_url</span>
</span>  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">micropost_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:micropost</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:content</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">correct_user</span>
<span class="hll">      <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class="hll">      <span class="n">redirect_to</span> <span class="n">root_url</span> <span class="k">if</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">nil?</span>
</span>    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Note that the <code>destroy</code> method in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_destroy_action" class="hyperref">Listing&nbsp;<span class="ref">13.52</span></a> redirects to the URL</p>
<div class="code"><div class="highlight"><pre><span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="o">||</span> <span class="n">root_url</span>
</pre></div></div>
<p>This uses the <code>request.referrer</code> method,<sup id="cha-13_footnote-ref-12" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-12" data-hasqtip="19">12</a></sup> which is related to the <code>request.original_url</code> variable used in friendly forwarding (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/updating_and_deleting_users#sec-friendly_forwarding" class="hyperref">Section&nbsp;<span class="ref">10.2.3</span></a>), and is just the previous URL (in this case, the Home page).<sup id="cha-13_footnote-ref-13" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-13" data-hasqtip="20">13</a></sup><span class="intersentencespace"></span> This is convenient because microposts appear on both the Home page and on the user’s profile page, so by using <code>request.referrer</code> we arrange to redirect back to the page issuing the delete request in both cases.<span class="intersentencespace"></span> If the referring URL is <code>nil</code> (as is the case inside some tests), <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_destroy_action" class="hyperref">Listing&nbsp;<span class="ref">13.52</span></a> sets the <code>root_url</code> as the default using the <code>||</code> operator.<span class="intersentencespace"></span> (Compare to the default options defined in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#code-test_helper_log_in" class="hyperref">Listing&nbsp;<span class="ref">9.24</span></a>.)</p>
<p>With the code as above, the result of destroying the second-most recent post appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-home_post_delete" class="hyperref">Figure&nbsp;<span class="ref">13.17</span></a>.</p>
<div class="center figure" id="fig-home_post_delete" data-tralics-id="uid1697" data-number="13.17">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/home_post_delete_3rd_edition.png" alt="images/figures/home_post_delete_3rd_edition"></div>
<div class="caption">
<span class="header">Figure 13.17: </span><span class="description">The Home page after deleting the second-most-recent micropost.
</span>
</div>
</div>
<div id="sec-exercises_destroying_microposts" data-tralics-id="uid1698" class="subsubsection" data-number="13.3.4.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_destroying_microposts" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Create a new micropost and then delete it.<span class="intersentencespace"></span> What are the contents of the <code>DELETE</code> command in the server log? <span class="exercise" id="ex-48d333"></span>
</li>
<li>Confirm directly in the browser that the line <code>redirect_to request.referrer || root_url</code> can be replaced with the line <code>redirect_back(fallback_location: root_url)</code>.<span class="intersentencespace"></span> (This method was added in Rails&nbsp;5.) <span class="exercise" id="ex-f7f907"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-micropost_tests&quot; data-tralics-id=&quot;uid1701&quot; class=&quot;subsection&quot; data-number=&quot;13.3.5&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-micropost_tests&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.3.5 &lt;/span&gt;Micropost tests&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;With the code in &lt;a href=&quot;user_microposts_fragment.html#sec-destroying_microposts&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.3.4&lt;/span&gt;&lt;/a&gt;, the Micropost model and interface are complete.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; All that’s left is writing a short Microposts controller test to check authorization and a micropost integration test to tie it all together.&lt;/p&gt;
&lt;p&gt;We’ll start by adding a few microposts with different owners to the micropost fixtures, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-add_micropost_different_owner&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.53&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (We’ll be using only one for now, but we’ve put in the others for future reference.)&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-add_micropost_different_owner&quot; data-tralics-id=&quot;uid1702&quot; data-number=&quot;13.53&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.53:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding a micropost with a different owner.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/fixtures/microposts.yml&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;l-Scalar-Plain&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;l-Scalar-Plain&quot;&gt;ants&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Oh,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;that&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;what&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;you&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;want?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Because&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;that&#39;s&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;how&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;you&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;ants!&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 2.years.ago %&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;archer&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;zone&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Danger&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;zone!&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 3.days.ago %&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;archer&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;tone&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;I&#39;m&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sorry.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Your&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;made&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sense,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;but&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;your&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sarcastic&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;tone&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;did&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;not.&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 10.minutes.ago %&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;lana&lt;/span&gt;

&lt;span class=&quot;l-Scalar-Plain&quot;&gt;van&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Dude,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;van&#39;s,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;like,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;rolling&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;probable&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;cause.&quot;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;&amp;lt;%= 4.hours.ago %&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;l-Scalar-Plain&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l-Scalar-Plain&quot;&gt;lana&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We next write a short test to make sure one user can’t delete the microposts of a different user, and we also check for the proper redirect, as seen in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_user_mismatch_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.54&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_user_mismatch_test&quot; data-tralics-id=&quot;uid1703&quot; data-number=&quot;13.54&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.54:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Testing micropost deletion with a user mismatch.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/controllers/microposts_controller_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsControllerTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionDispatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IntegrationTest&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:orange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should redirect create when not logged in&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_no_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Lorem ipsum&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_redirected_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login_url&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should redirect destroy when not logged in&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_no_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_redirected_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login_url&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should redirect destroy for wrong micropost&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;log_in_as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:ants&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;assert_no_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;assert_redirected_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Finally, we’ll write an integration test to log in, check the micropost pagination, make an invalid submission, make a valid submission, delete a post, and then visit a second user’s page to make sure there are no “delete” links.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We start by generating a test as usual:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails generate integration_test microposts_interface
&lt;span class=&quot;go&quot;&gt;      invoke  test_unit&lt;/span&gt;
&lt;span class=&quot;go&quot;&gt;      create    test/integration/microposts_interface_test.rb&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The test appears in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_interface_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.55&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; See if you can connect the lines in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_validity_test_idiomatic&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.12&lt;/span&gt;&lt;/a&gt; to the steps mentioned above.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-microposts_interface_test&quot; data-tralics-id=&quot;uid1704&quot; data-number=&quot;13.55&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.55:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;An integration test for the micropost interface.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/integration/microposts_interface_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsInterfaceTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionDispatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IntegrationTest&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;micropost interface&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log_in_as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_path&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;div.pagination&#39;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Invalid submission&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_no_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;div#error_explanation&#39;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Valid submission&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;This micropost really ties the room together&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_redirected_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;follow_redirect!&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Delete post&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;a&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;delete&#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;first_micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paginate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Visit different user (no delete links)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:archer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;a&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;delete&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Because we wrote working application code first, the test suite should be &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;uid1705&quot; data-tralics-id=&quot;uid1705&quot; data-number=&quot;13.56&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.56:&lt;/span&gt; &lt;span class=&quot;description&quot;&gt;&lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_micropost_tests&quot; data-tralics-id=&quot;uid1706&quot; class=&quot;subsubsection&quot; data-number=&quot;13.3.5.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_micropost_tests&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;For each of the four scenarios indicated by comments in &lt;a href=&quot;user_microposts_fragment.html#code-microposts_interface_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.55&lt;/span&gt;&lt;/a&gt; (starting with “Invalid submission”), comment out application code to get the corresponding test to &lt;span style=&quot;color: red&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;red&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;, then uncomment to get back to &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;. &lt;span class=&quot;exercise&quot; id=&quot;ex-6a791b&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Add tests for the sidebar micropost count (including proper pluralization).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;a href=&quot;user_microposts_fragment.html#code-sidebar_micropost_count&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.57&lt;/span&gt;&lt;/a&gt; will help get you started. &lt;span class=&quot;exercise&quot; id=&quot;ex-0a7044&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-sidebar_micropost_count&quot; data-tralics-id=&quot;uid1709&quot; data-number=&quot;13.57&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.57:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A template for the sidebar micropost count test.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/integration/microposts_interface_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostInterfaceTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionDispatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IntegrationTest&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;micropost sidebar count&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log_in_as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_path&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FILL_IN&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; microposts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# User with zero microposts&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;other_user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:malory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log_in_as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_path&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0 microposts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;other_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;A micropost&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_path&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;FILL_IN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="849"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-micropost_tests" data-tralics-id="uid1701" class="subsection" data-number="13.3.5">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_tests" class="heading hyperref"><span class="number">13.3.5 </span>Micropost tests</a></h3>
<p>With the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-destroying_microposts" class="hyperref">Section&nbsp;<span class="ref">13.3.4</span></a>, the Micropost model and interface are complete.<span class="intersentencespace"></span> All that’s left is writing a short Microposts controller test to check authorization and a micropost integration test to tie it all together.</p>
<p>We’ll start by adding a few microposts with different owners to the micropost fixtures, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-add_micropost_different_owner" class="hyperref">Listing&nbsp;<span class="ref">13.53</span></a>.<span class="intersentencespace"></span> (We’ll be using only one for now, but we’ve put in the others for future reference.)</p>
<div class="codelisting" id="code-add_micropost_different_owner" data-tralics-id="uid1702" data-number="13.53">
<div class="heading">
<span class="number">Listing 13.53:</span> 

<span class="description">Adding a micropost with a different owner.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/fixtures/microposts.yml</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="l-Scalar-Plain">.</span>
<span class="l-Scalar-Plain">.</span>
<span class="l-Scalar-Plain">.</span>
<span class="l-Scalar-Plain">ants</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Oh,</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">what</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">want?</span><span class="nv"> </span><span class="s">Because</span><span class="nv"> </span><span class="s">that's</span><span class="nv"> </span><span class="s">how</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">get</span><span class="nv"> </span><span class="s">ants!"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 2.years.ago %&gt;</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">archer</span>

<span class="l-Scalar-Plain">zone</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Danger</span><span class="nv"> </span><span class="s">zone!"</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 3.days.ago %&gt;</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">archer</span>

<span class="l-Scalar-Plain">tone</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"I'm</span><span class="nv"> </span><span class="s">sorry.</span><span class="nv"> </span><span class="s">Your</span><span class="nv"> </span><span class="s">words</span><span class="nv"> </span><span class="s">made</span><span class="nv"> </span><span class="s">sense,</span><span class="nv"> </span><span class="s">but</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">sarcastic</span><span class="nv"> </span><span class="s">tone</span><span class="nv"> </span><span class="s">did</span><span class="nv"> </span><span class="s">not."</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 10.minutes.ago %&gt;</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lana</span>

<span class="l-Scalar-Plain">van</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">content</span><span class="p-Indicator">:</span> <span class="s">"Dude,</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">van's,</span><span class="nv"> </span><span class="s">like,</span><span class="nv"> </span><span class="s">rolling</span><span class="nv"> </span><span class="s">probable</span><span class="nv"> </span><span class="s">cause."</span>
  <span class="l-Scalar-Plain">created_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%= 4.hours.ago %&gt;</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lana</span>
</pre></div></div>
</div>
<p>We next write a short test to make sure one user can’t delete the microposts of a different user, and we also check for the proper redirect, as seen in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_user_mismatch_test" class="hyperref">Listing&nbsp;<span class="ref">13.54</span></a>.</p>
<div class="codelisting" id="code-micropost_user_mismatch_test" data-tralics-id="uid1703" data-number="13.54">
<div class="heading">
<span class="number">Listing 13.54:</span> 

<span class="description">Testing micropost deletion with a user mismatch.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/controllers/microposts_controller_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostsControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">microposts</span><span class="p">(</span><span class="ss">:orange</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should redirect create when not logged in"</span> <span class="k">do</span>
    <span class="n">assert_no_difference</span> <span class="s1">'Micropost.count'</span> <span class="k">do</span>
      <span class="n">post</span> <span class="n">microposts_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">micropost</span><span class="p">:</span> <span class="p">{</span> <span class="ss">content</span><span class="p">:</span> <span class="s2">"Lorem ipsum"</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">end</span>
    <span class="n">assert_redirected_to</span> <span class="n">login_url</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should redirect destroy when not logged in"</span> <span class="k">do</span>
    <span class="n">assert_no_difference</span> <span class="s1">'Micropost.count'</span> <span class="k">do</span>
      <span class="n">delete</span> <span class="n">micropost_path</span><span class="p">(</span><span class="vi">@micropost</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">assert_redirected_to</span> <span class="n">login_url</span>
  <span class="k">end</span>

<span class="hll">  <span class="nb">test</span> <span class="s2">"should redirect destroy for wrong micropost"</span> <span class="k">do</span>
</span><span class="hll">    <span class="n">log_in_as</span><span class="p">(</span><span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">))</span>
</span><span class="hll">    <span class="n">micropost</span> <span class="o">=</span> <span class="n">microposts</span><span class="p">(</span><span class="ss">:ants</span><span class="p">)</span>
</span><span class="hll">    <span class="n">assert_no_difference</span> <span class="s1">'Micropost.count'</span> <span class="k">do</span>
</span><span class="hll">      <span class="n">delete</span> <span class="n">micropost_path</span><span class="p">(</span><span class="n">micropost</span><span class="p">)</span>
</span><span class="hll">    <span class="k">end</span>
</span><span class="hll">    <span class="n">assert_redirected_to</span> <span class="n">root_url</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p>Finally, we’ll write an integration test to log in, check the micropost pagination, make an invalid submission, make a valid submission, delete a post, and then visit a second user’s page to make sure there are no “delete” links.<span class="intersentencespace"></span> We start by generating a test as usual:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test microposts_interface
<span class="go">      invoke  test_unit</span>
<span class="go">      create    test/integration/microposts_interface_test.rb</span>
</pre></div></div>
<p>The test appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_interface_test" class="hyperref">Listing&nbsp;<span class="ref">13.55</span></a>.<span class="intersentencespace"></span> See if you can connect the lines in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_validity_test_idiomatic" class="hyperref">Listing&nbsp;<span class="ref">13.12</span></a> to the steps mentioned above.</p>
<div class="codelisting" id="code-microposts_interface_test" data-tralics-id="uid1704" data-number="13.55">
<div class="heading">
<span class="number">Listing 13.55:</span> 

<span class="description">An integration test for the micropost interface.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <code class="filepath">test/integration/microposts_interface_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostsInterfaceTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"micropost interface"</span> <span class="k">do</span>
    <span class="n">log_in_as</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_select</span> <span class="s1">'div.pagination'</span>
    <span class="c1"># Invalid submission</span>
    <span class="n">assert_no_difference</span> <span class="s1">'Micropost.count'</span> <span class="k">do</span>
      <span class="n">post</span> <span class="n">microposts_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">micropost</span><span class="p">:</span> <span class="p">{</span> <span class="ss">content</span><span class="p">:</span> <span class="s2">""</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">end</span>
    <span class="n">assert_select</span> <span class="s1">'div#error_explanation'</span>
    <span class="c1"># Valid submission</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s2">"This micropost really ties the room together"</span>
    <span class="n">assert_difference</span> <span class="s1">'Micropost.count'</span><span class="p">,</span> <span class="mi">1</span> <span class="k">do</span>
      <span class="n">post</span> <span class="n">microposts_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">micropost</span><span class="p">:</span> <span class="p">{</span> <span class="ss">content</span><span class="p">:</span> <span class="n">content</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">end</span>
    <span class="n">assert_redirected_to</span> <span class="n">root_url</span>
    <span class="n">follow_redirect!</span>
    <span class="n">assert_match</span> <span class="n">content</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
    <span class="c1"># Delete post</span>
    <span class="n">assert_select</span> <span class="s1">'a'</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s1">'delete'</span>
    <span class="n">first_micropost</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">page</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
    <span class="n">assert_difference</span> <span class="s1">'Micropost.count'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">do</span>
      <span class="n">delete</span> <span class="n">micropost_path</span><span class="p">(</span><span class="n">first_micropost</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="c1"># Visit different user (no delete links)</span>
    <span class="n">get</span> <span class="n">user_path</span><span class="p">(</span><span class="n">users</span><span class="p">(</span><span class="ss">:archer</span><span class="p">))</span>
    <span class="n">assert_select</span> <span class="s1">'a'</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s1">'delete'</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Because we wrote working application code first, the test suite should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div class="codelisting" id="uid1705" data-tralics-id="uid1705" data-number="13.56">
<div class="heading">
<span class="number">Listing 13.56:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ rails test
</pre></div></div>
</div>
<div id="sec-exercises_micropost_tests" data-tralics-id="uid1706" class="subsubsection" data-number="13.3.5.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_micropost_tests" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>For each of the four scenarios indicated by comments in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-microposts_interface_test" class="hyperref">Listing&nbsp;<span class="ref">13.55</span></a> (starting with “Invalid submission”), comment out application code to get the corresponding test to <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>, then uncomment to get back to <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>. <span class="exercise" id="ex-6a791b"></span>
</li>
<li>Add tests for the sidebar micropost count (including proper pluralization).<span class="intersentencespace"></span> <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-sidebar_micropost_count" class="hyperref">Listing&nbsp;<span class="ref">13.57</span></a> will help get you started. <span class="exercise" id="ex-0a7044"></span>
</li>
</ol>
<div class="codelisting" id="code-sidebar_micropost_count" data-tralics-id="uid1709" data-number="13.57">
<div class="heading">
<span class="number">Listing 13.57:</span> 

<span class="description">A template for the sidebar micropost count test.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/integration/microposts_interface_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostInterfaceTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"micropost sidebar count"</span> <span class="k">do</span>
    <span class="n">log_in_as</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_match</span> <span class="s2">"</span><span class="si">#{</span><span class="no">FILL_IN</span><span class="si">}</span><span class="s2"> microposts"</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
    <span class="c1"># User with zero microposts</span>
    <span class="n">other_user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:malory</span><span class="p">)</span>
    <span class="n">log_in_as</span><span class="p">(</span><span class="n">other_user</span><span class="p">)</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_match</span> <span class="s2">"0 microposts"</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
    <span class="n">other_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">content</span><span class="p">:</span> <span class="s2">"A micropost"</span><span class="p">)</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_match</span> <span class="no">FILL_IN</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
</div>
</div></div></div></div>
<div class="j_sectionContent" data-html="&lt;div id=&quot;sec-micropost_images&quot; data-tralics-id=&quot;cid77&quot; class=&quot;section&quot; data-number=&quot;13.4&quot;&gt;
&lt;h2&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-micropost_images&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.4 &lt;/span&gt;Micropost images&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now that we’ve added support for all relevant micropost actions, in this section we’ll make it possible for microposts to include images as well as text.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll start with a basic version good enough for development use, and then add a series of enhancements to make image upload production-ready.&lt;/p&gt;
&lt;p&gt;Adding image upload involves two main visible elements: a form field for uploading an image and the micropost images themselves.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; A mockup of the resulting “Upload image” button and micropost photo appears in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_image_mockup&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.18&lt;/span&gt;&lt;/a&gt;.&lt;sup id=&quot;cha-13_footnote-ref-14&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-14&quot;&gt;14&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_image_mockup&quot; data-tralics-id=&quot;uid1711&quot; data-number=&quot;13.18&quot;&gt;
&lt;div class=&quot;graphics image box&quot;&gt;&lt;img src=&quot;images/figures/micropost_image_mockup.png&quot; alt=&quot;images/figures/micropost_image_mockup&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.18: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A mockup of micropost image upload (with an uploaded image).
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;



&lt;/div&gt;"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-micropost_images" data-tralics-id="cid77" class="section" data-number="13.4">
<h2><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_images" class="heading hyperref"><span class="number">13.4 </span>Micropost images</a></h2>
<p>Now that we’ve added support for all relevant micropost actions, in this section we’ll make it possible for microposts to include images as well as text.<span class="intersentencespace"></span> We’ll start with a basic version good enough for development use, and then add a series of enhancements to make image upload production-ready.</p>
<p>Adding image upload involves two main visible elements: a form field for uploading an image and the micropost images themselves.<span class="intersentencespace"></span> A mockup of the resulting “Upload image” button and micropost photo appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_image_mockup" class="hyperref">Figure&nbsp;<span class="ref">13.18</span></a>.<sup id="cha-13_footnote-ref-14" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-14" data-hasqtip="21">14</a></sup></p>
<div class="center figure" id="fig-micropost_image_mockup" data-tralics-id="uid1711" data-number="13.18">
<div class="graphics image box"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/micropost_image_mockup.png" alt="images/figures/micropost_image_mockup"></div>
<div class="caption">
<span class="header">Figure 13.18: </span><span class="description">A mockup of micropost image upload (with an uploaded image).
</span>
</div>
</div>



</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-basic_image_upload&quot; data-tralics-id=&quot;uid1712&quot; class=&quot;subsection&quot; data-number=&quot;13.4.1&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-basic_image_upload&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.4.1 &lt;/span&gt;Basic image upload&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;To handle an uploaded image and associate it with the Micropost model, we’ll use the &lt;a href=&quot;https://github.com/carrierwaveuploader/carrierwave&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CarrierWave&lt;/a&gt; image uploader.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To get started, we need to include the &lt;code class=&quot;tt&quot;&gt;carrierwave&lt;/code&gt; and &lt;code class=&quot;tt&quot;&gt;mini_magick&lt;/code&gt; gems in the &lt;code&gt;Gemfile&lt;/code&gt; (&lt;a href=&quot;user_microposts_fragment.html#code-gemfile_carrierwave&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.58&lt;/span&gt;&lt;/a&gt;).&lt;sup id=&quot;cha-13_footnote-ref-15&quot; class=&quot;footnote intersentence&quot;&gt;&lt;a href=&quot;#cha-13_footnote-15&quot;&gt;15&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; For completeness, &lt;a href=&quot;user_microposts_fragment.html#code-gemfile_carrierwave&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.58&lt;/span&gt;&lt;/a&gt; also includes the &lt;code class=&quot;tt&quot;&gt;fog&lt;/code&gt; gem needed for image upload in production (&lt;a href=&quot;user_microposts_fragment.html#sec-image_upload_in_production&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.4&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-gemfile_carrierwave&quot; data-tralics-id=&quot;uid1714&quot; data-number=&quot;13.58&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.58:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding CarrierWave to the &lt;code&gt;Gemfile&lt;/code&gt;.&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;https://rubygems.org&#39;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;rails&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                   &lt;span class=&quot;s1&quot;&gt;&#39;5.1.6&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bcrypt&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                  &lt;span class=&quot;s1&quot;&gt;&#39;3.1.12&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;faker&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                   &lt;span class=&quot;s1&quot;&gt;&#39;1.7.3&#39;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;carrierwave&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;             &lt;span class=&quot;s1&quot;&gt;&#39;1.2.2&#39;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;mini_magick&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;             &lt;span class=&quot;s1&quot;&gt;&#39;4.7.0&#39;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;will_paginate&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;s1&quot;&gt;&#39;3.1.6&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bootstrap-will_paginate&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;1.0.0&#39;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:production&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;pg&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s1&quot;&gt;&#39;0.20.0&#39;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;fog&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;1.42&#39;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Then we install as usual:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; bundle install
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;CarrierWave adds a Rails generator for creating an image uploader, which we’ll use to make an uploader for an image called &lt;code&gt;picture&lt;/code&gt;:&lt;sup id=&quot;cha-13_footnote-ref-16&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-16&quot;&gt;16&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails generate uploader Picture
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Images uploaded with CarrierWave should be associated with a corresponding attribute in an Active Record model, which simply contains the name of the image file in a string field.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The resulting augmented data model for microposts appears in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_model_picture&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.19&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_model_picture&quot; data-tralics-id=&quot;uid1716&quot; data-number=&quot;13.19&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/micropost_model_picture.png&quot; alt=&quot;images/figures/micropost_model_picture&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.19: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The Micropost data model with a &lt;code&gt;picture&lt;/code&gt; attribute.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;To add the required &lt;code&gt;picture&lt;/code&gt; attribute to the Micropost model, we generate a migration and migrate the development database:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails generate migration add_picture_to_microposts picture:string
&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; rails db:migrate
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The way to tell CarrierWave to associate the image with a model is to use the &lt;code&gt;mount_uploader&lt;/code&gt; method, which takes as arguments a symbol representing the attribute and the class name of the generated uploader:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;n&quot;&gt;mount_uploader&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PictureUploader&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Here &lt;code&gt;PictureUploader&lt;/code&gt; is defined in the file &lt;code&gt;picture_uploader.rb&lt;/code&gt;, which we’ll start editing in &lt;a href=&quot;user_microposts_fragment.html#sec-image_validation&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.2&lt;/span&gt;&lt;/a&gt;, but for now the generated default is fine.)&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Adding the uploader to the Micropost model gives the code shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_model_picture&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.59&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_model_picture&quot; data-tralics-id=&quot;uid1717&quot; data-number=&quot;13.59&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.59:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding an image to the Micropost model.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;default_scope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;mount_uploader&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PictureUploader&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;maximum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;On some systems, you may need to restart the Rails server at this point to keep the test suite &lt;span style=&quot;color: ForestGreen&quot;&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;strong&gt;green&lt;/strong&gt;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (If you’re using Guard as described in &lt;a href=&quot;static_pages_fragment.html#sec-guard&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;3.6.2&lt;/span&gt;&lt;/a&gt;, you may need to restart that as well, and it may even be necessary to exit the terminal shell and re-run Guard in a new one.)&lt;/p&gt;
&lt;p&gt;To include the uploader on the Home page as in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_image_mockup&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.18&lt;/span&gt;&lt;/a&gt;, we need to include a &lt;code&gt;file_field&lt;/code&gt; tag in the micropost form, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_create_image_upload&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.60&lt;/span&gt;&lt;/a&gt;.&lt;sup id=&quot;cha-13_footnote-ref-17&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-17&quot;&gt;17&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_create_image_upload&quot; data-tralics-id=&quot;uid1719&quot; data-number=&quot;13.60&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.60:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding image upload to the micropost create form.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/shared/_micropost_form.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_area&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;placeholder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Compose new micropost...&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Post&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;picture&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Finally, we need to add &lt;code&gt;picture&lt;/code&gt; to the list of attributes permitted to be modified through the web.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This involves editing the &lt;code&gt;micropost_params&lt;/code&gt; method, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_params_picture&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.61&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_params_picture&quot; data-tralics-id=&quot;uid1720&quot; data-number=&quot;13.61&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.61:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding &lt;code&gt;picture&lt;/code&gt; to the list of permitted attributes.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/controllers/microposts_controller.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostsController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:logged_in_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:correct_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;ss&quot;&gt;only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;micropost_params&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;permit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;correct_user&lt;/span&gt;
      &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find_by&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;redirect_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_url&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Once the image has been uploaded, we can render it using the &lt;code&gt;image_tag&lt;/code&gt; helper in the micropost partial, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_partial_image_display&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.62&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Notice the use of the &lt;code&gt;picture?&lt;/code&gt; boolean method to prevent displaying an image tag when there isn’t an image.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; This method is created automatically by CarrierWave based on the name of the image attribute.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The result of making a successful submission by hand appears in &lt;a href=&quot;user_microposts_fragment.html#fig-micropost_with_image&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.20&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Writing an automated test for image upload is left as an exercise (&lt;a href=&quot;user_microposts_fragment.html#sec-exercises_basic_image_upload&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.1.1&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_partial_image_display&quot; data-tralics-id=&quot;uid1721&quot; data-number=&quot;13.62&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.62:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding image display to microposts.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/microposts/_micropost.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;li&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;micropost-&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gravatar_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image_tag&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picture?&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    Posted &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time_ago_in_words&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt; ago.
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current_user?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_to&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;delete&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                       &lt;span class=&quot;ss&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;confirm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;You sure?&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-micropost_with_image&quot; data-tralics-id=&quot;uid1722&quot; data-number=&quot;13.20&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/microposts_with_image_4th_ed.png&quot; alt=&quot;images/figures/microposts_with_image_4th_ed&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.20: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;The result of submitting a micropost with an image.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_basic_image_upload&quot; data-tralics-id=&quot;uid1723&quot; class=&quot;subsubsection&quot; data-number=&quot;13.4.1.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_basic_image_upload&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Upload a micropost with attached image.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Does the result look too big?&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (If so, don’t worry; we’ll fix it in &lt;a href=&quot;user_microposts_fragment.html#sec-image_resizing&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.3&lt;/span&gt;&lt;/a&gt;). &lt;span class=&quot;exercise&quot; id=&quot;ex-98ef20&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Following the template in &lt;a href=&quot;user_microposts_fragment.html#code-image_upload_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.63&lt;/span&gt;&lt;/a&gt;, write a test of the image uploader in &lt;a href=&quot;user_microposts_fragment.html#sec-micropost_images&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As preparation, you should add an image to the fixtures directory (using, e.g, &lt;code&gt;cp app/assets/images/rails.png&lt;/code&gt; &lt;code&gt;test/fixtures/&lt;/code&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The additional assertions in &lt;a href=&quot;user_microposts_fragment.html#code-image_upload_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.63&lt;/span&gt;&lt;/a&gt; check both for a file upload field on the Home page and for a valid image attribute on the micropost resulting from valid submission.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note the use of the special &lt;code&gt;fixture_file_upload&lt;/code&gt; method for uploading files as fixtures inside tests.&lt;sup id=&quot;cha-13_footnote-ref-18&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-18&quot;&gt;18&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;em&gt;Hint&lt;/em&gt;: To check for a valid &lt;code&gt;picture&lt;/code&gt; attribute, use the &lt;code&gt;assigns&lt;/code&gt; method mentioned in &lt;a href=&quot;account_activation_fragment.html#sec-activation_test_and_refactoring&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;11.3.3&lt;/span&gt;&lt;/a&gt; to access the micropost in the &lt;code&gt;create&lt;/code&gt; action after valid submission. &lt;span class=&quot;exercise&quot; id=&quot;ex-5b20bb&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-image_upload_test&quot; data-tralics-id=&quot;uid1727&quot; data-number=&quot;13.63&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.63:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;A template for testing image upload.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;test/integration/microposts_interface_test.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;test_helper&#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MicropostInterfaceTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActionDispatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IntegrationTest&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:michael&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;micropost interface&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;log_in_as&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root_path&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;div.pagination&#39;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;input[type=FILL_IN]&#39;&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;# Invalid submission&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;div#error_explanation&#39;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Valid submission&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;This micropost really ties the room together&quot;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;picture&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fixture_file_upload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;test/fixtures/rails.png&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;image/png&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;assert_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;microposts_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;/span&gt;                                      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;                                        &lt;span class=&quot;ss&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;FILL_IN&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;FILL_IN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picture?&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;follow_redirect!&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Delete a post.&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;a&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;delete&#39;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;first_micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;microposts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;paginate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_difference&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;Micropost.count&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;micropost_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# Visit a different user.&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:archer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assert_select&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;a&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;delete&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="850"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-basic_image_upload" data-tralics-id="uid1712" class="subsection" data-number="13.4.1">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-basic_image_upload" class="heading hyperref"><span class="number">13.4.1 </span>Basic image upload</a></h3>
<p>To handle an uploaded image and associate it with the Micropost model, we’ll use the <a href="https://github.com/carrierwaveuploader/carrierwave" target="_blank" rel="noopener">CarrierWave</a> image uploader.<span class="intersentencespace"></span> To get started, we need to include the <code class="tt">carrierwave</code> and <code class="tt">mini_magick</code> gems in the <code>Gemfile</code> (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-gemfile_carrierwave" class="hyperref">Listing&nbsp;<span class="ref">13.58</span></a>).<sup id="cha-13_footnote-ref-15" class="footnote intersentence"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-15" data-hasqtip="22">15</a></sup><span class="intersentencespace"></span> For completeness, <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-gemfile_carrierwave" class="hyperref">Listing&nbsp;<span class="ref">13.58</span></a> also includes the <code class="tt">fog</code> gem needed for image upload in production (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_upload_in_production" class="hyperref">Section&nbsp;<span class="ref">13.4.4</span></a>).</p>
<div class="codelisting" id="code-gemfile_carrierwave" data-tralics-id="uid1714" data-number="13.58">
<div class="heading">
<span class="number">Listing 13.58:</span> 

<span class="description">Adding CarrierWave to the <code>Gemfile</code>.</span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span>                   <span class="s1">'5.1.6'</span>
<span class="n">gem</span> <span class="s1">'bcrypt'</span><span class="p">,</span>                  <span class="s1">'3.1.12'</span>
<span class="n">gem</span> <span class="s1">'faker'</span><span class="p">,</span>                   <span class="s1">'1.7.3'</span>
<span class="hll"><span class="n">gem</span> <span class="s1">'carrierwave'</span><span class="p">,</span>             <span class="s1">'1.2.2'</span>
</span><span class="hll"><span class="n">gem</span> <span class="s1">'mini_magick'</span><span class="p">,</span>             <span class="s1">'4.7.0'</span>
</span><span class="n">gem</span> <span class="s1">'will_paginate'</span><span class="p">,</span>           <span class="s1">'3.1.6'</span>
<span class="n">gem</span> <span class="s1">'bootstrap-will_paginate'</span><span class="p">,</span> <span class="s1">'1.0.0'</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'pg'</span><span class="p">,</span>  <span class="s1">'0.20.0'</span>
<span class="hll">  <span class="n">gem</span> <span class="s1">'fog'</span><span class="p">,</span> <span class="s1">'1.42'</span>
</span><span class="k">end</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div></div>
</div>
<p>Then we install as usual:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div></div>
<p>CarrierWave adds a Rails generator for creating an image uploader, which we’ll use to make an uploader for an image called <code>picture</code>:<sup id="cha-13_footnote-ref-16" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-16" data-hasqtip="23">16</a></sup></p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate uploader Picture
</pre></div></div>
<p>Images uploaded with CarrierWave should be associated with a corresponding attribute in an Active Record model, which simply contains the name of the image file in a string field.<span class="intersentencespace"></span> The resulting augmented data model for microposts appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_model_picture" class="hyperref">Figure&nbsp;<span class="ref">13.19</span></a>.</p>
<div class="center figure" id="fig-micropost_model_picture" data-tralics-id="uid1716" data-number="13.19">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/micropost_model_picture.png" alt="images/figures/micropost_model_picture"></div>
<div class="caption">
<span class="header">Figure 13.19: </span><span class="description">The Micropost data model with a <code>picture</code> attribute.
</span>
</div>
</div>
<p>To add the required <code>picture</code> attribute to the Micropost model, we generate a migration and migrate the development database:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate migration add_picture_to_microposts picture:string
<span class="gp">$</span> rails db:migrate
</pre></div></div>
<p>The way to tell CarrierWave to associate the image with a model is to use the <code>mount_uploader</code> method, which takes as arguments a symbol representing the attribute and the class name of the generated uploader:</p>
<div class="code"><div class="highlight"><pre><span class="n">mount_uploader</span> <span class="ss">:picture</span><span class="p">,</span> <span class="no">PictureUploader</span>
</pre></div></div>
<p>(Here <code>PictureUploader</code> is defined in the file <code>picture_uploader.rb</code>, which we’ll start editing in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_validation" class="hyperref">Section&nbsp;<span class="ref">13.4.2</span></a>, but for now the generated default is fine.)<span class="intersentencespace"></span> Adding the uploader to the Micropost model gives the code shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_model_picture" class="hyperref">Listing&nbsp;<span class="ref">13.59</span></a>.</p>
<div class="codelisting" id="code-micropost_model_picture" data-tralics-id="uid1717" data-number="13.59">
<div class="heading">
<span class="number">Listing 13.59:</span> 

<span class="description">Adding an image to the Micropost model.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">default_scope</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">created_at</span><span class="p">:</span> <span class="ss">:desc</span><span class="p">)</span> <span class="p">}</span>
<span class="hll">  <span class="n">mount_uploader</span> <span class="ss">:picture</span><span class="p">,</span> <span class="no">PictureUploader</span>
</span>  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>On some systems, you may need to restart the Rails server at this point to keep the test suite <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>.<span class="intersentencespace"></span> (If you’re using Guard as described in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/static_pages#sec-guard" class="hyperref">Section&nbsp;<span class="ref">3.6.2</span></a>, you may need to restart that as well, and it may even be necessary to exit the terminal shell and re-run Guard in a new one.)</p>
<p>To include the uploader on the Home page as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_image_mockup" class="hyperref">Figure&nbsp;<span class="ref">13.18</span></a>, we need to include a <code>file_field</code> tag in the micropost form, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_create_image_upload" class="hyperref">Listing&nbsp;<span class="ref">13.60</span></a>.<sup id="cha-13_footnote-ref-17" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-17" data-hasqtip="24">17</a></sup></p>
<div class="codelisting" id="code-micropost_create_image_upload" data-tralics-id="uid1719" data-number="13.60">
<div class="heading">
<span class="number">Listing 13.60:</span> 

<span class="description">Adding image upload to the micropost create form.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/shared/_micropost_form.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@micropost</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"Compose new micropost..."</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Post"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"picture"</span><span class="nt">&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_field</span> <span class="ss">:picture</span> <span class="cp">%&gt;</span>
</span>  <span class="nt">&lt;/span&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div></div>
</div>
<p>Finally, we need to add <code>picture</code> to the list of attributes permitted to be modified through the web.<span class="intersentencespace"></span> This involves editing the <code>micropost_params</code> method, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_params_picture" class="hyperref">Listing&nbsp;<span class="ref">13.61</span></a>.</p>
<div class="codelisting" id="code-micropost_params_picture" data-tralics-id="uid1720" data-number="13.61">
<div class="heading">
<span class="number">Listing 13.61:</span> 

<span class="description">Adding <code>picture</code> to the list of permitted attributes.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/controllers/microposts_controller.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_action</span> <span class="ss">:logged_in_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
  <span class="n">before_action</span> <span class="ss">:correct_user</span><span class="p">,</span>   <span class="ss">only</span><span class="p">:</span> <span class="ss">:destroy</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">micropost_params</span>
<span class="hll">      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:micropost</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:content</span><span class="p">,</span> <span class="ss">:picture</span><span class="p">)</span>
</span>    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">correct_user</span>
      <span class="vi">@micropost</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="n">root_url</span> <span class="k">if</span> <span class="vi">@micropost</span><span class="o">.</span><span class="n">nil?</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>Once the image has been uploaded, we can render it using the <code>image_tag</code> helper in the micropost partial, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_partial_image_display" class="hyperref">Listing&nbsp;<span class="ref">13.62</span></a>.<span class="intersentencespace"></span> Notice the use of the <code>picture?</code> boolean method to prevent displaying an image tag when there isn’t an image.<span class="intersentencespace"></span> This method is created automatically by CarrierWave based on the name of the image attribute.<span class="intersentencespace"></span> The result of making a successful submission by hand appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-micropost_with_image" class="hyperref">Figure&nbsp;<span class="ref">13.20</span></a>.<span class="intersentencespace"></span> Writing an automated test for image upload is left as an exercise (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_basic_image_upload" class="hyperref">Section&nbsp;<span class="ref">13.4.1.1</span></a>).</p>
<div class="codelisting" id="code-micropost_partial_image_display" data-tralics-id="uid1721" data-number="13.62">
<div class="heading">
<span class="number">Listing 13.62:</span> 

<span class="description">Adding image display to microposts.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/microposts/_micropost.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">"micropost-</span><span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">gravatar_for</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="ss">size</span><span class="p">:</span> <span class="mi">50</span><span class="p">),</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"user"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">micropost</span><span class="o">.</span><span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">micropost</span><span class="o">.</span><span class="n">content</span> <span class="cp">%&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">micropost</span><span class="o">.</span><span class="n">picture</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">micropost</span><span class="o">.</span><span class="n">picture?</span> <span class="cp">%&gt;</span>
</span>  <span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"timestamp"</span><span class="nt">&gt;</span>
    Posted <span class="cp">&lt;%=</span> <span class="n">time_ago_in_words</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="cp">%&gt;</span> ago.
    <span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">current_user?</span><span class="p">(</span><span class="n">micropost</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"delete"</span><span class="p">,</span> <span class="n">micropost</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span>
                                       <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s2">"You sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</pre></div></div>
</div>
<div class="center figure" id="fig-micropost_with_image" data-tralics-id="uid1722" data-number="13.20">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/microposts_with_image_4th_ed.png" alt="images/figures/microposts_with_image_4th_ed"></div>
<div class="caption">
<span class="header">Figure 13.20: </span><span class="description">The result of submitting a micropost with an image.
</span>
</div>
</div>
<div id="sec-exercises_basic_image_upload" data-tralics-id="uid1723" class="subsubsection" data-number="13.4.1.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_basic_image_upload" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Upload a micropost with attached image.<span class="intersentencespace"></span> Does the result look too big?<span class="intersentencespace"></span> (If so, don’t worry; we’ll fix it in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_resizing" class="hyperref">Section&nbsp;<span class="ref">13.4.3</span></a>). <span class="exercise" id="ex-98ef20"></span>
</li>
<li>Following the template in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_upload_test" class="hyperref">Listing&nbsp;<span class="ref">13.63</span></a>, write a test of the image uploader in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-micropost_images" class="hyperref">Section&nbsp;<span class="ref">13.4</span></a>.<span class="intersentencespace"></span> As preparation, you should add an image to the fixtures directory (using, e.g, <code>cp app/assets/images/rails.png</code> <code>test/fixtures/</code>).<span class="intersentencespace"></span> The additional assertions in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_upload_test" class="hyperref">Listing&nbsp;<span class="ref">13.63</span></a> check both for a file upload field on the Home page and for a valid image attribute on the micropost resulting from valid submission.<span class="intersentencespace"></span> Note the use of the special <code>fixture_file_upload</code> method for uploading files as fixtures inside tests.<sup id="cha-13_footnote-ref-18" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-18" data-hasqtip="25">18</a></sup><span class="intersentencespace"></span> <em>Hint</em>: To check for a valid <code>picture</code> attribute, use the <code>assigns</code> method mentioned in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_test_and_refactoring" class="hyperref">Section&nbsp;<span class="ref">11.3.3</span></a> to access the micropost in the <code>create</code> action after valid submission. <span class="exercise" id="ex-5b20bb"></span>
</li>
</ol>
<div class="codelisting" id="code-image_upload_test" data-tralics-id="uid1727" data-number="13.63">
<div class="heading">
<span class="number">Listing 13.63:</span> 

<span class="description">A template for testing image upload.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">test/integration/microposts_interface_test.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">MicropostInterfaceTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">users</span><span class="p">(</span><span class="ss">:michael</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"micropost interface"</span> <span class="k">do</span>
    <span class="n">log_in_as</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span>
    <span class="n">get</span> <span class="n">root_path</span>
    <span class="n">assert_select</span> <span class="s1">'div.pagination'</span>
<span class="hll">    <span class="n">assert_select</span> <span class="s1">'input[type=FILL_IN]'</span>
</span>    <span class="c1"># Invalid submission</span>
    <span class="n">post</span> <span class="n">microposts_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">micropost</span><span class="p">:</span> <span class="p">{</span> <span class="ss">content</span><span class="p">:</span> <span class="s2">""</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">assert_select</span> <span class="s1">'div#error_explanation'</span>
    <span class="c1"># Valid submission</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s2">"This micropost really ties the room together"</span>
<span class="hll">    <span class="n">picture</span> <span class="o">=</span> <span class="n">fixture_file_upload</span><span class="p">(</span><span class="s1">'test/fixtures/rails.png'</span><span class="p">,</span> <span class="s1">'image/png'</span><span class="p">)</span>
</span>    <span class="n">assert_difference</span> <span class="s1">'Micropost.count'</span><span class="p">,</span> <span class="mi">1</span> <span class="k">do</span>
<span class="hll">      <span class="n">post</span> <span class="n">microposts_path</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="p">{</span> <span class="ss">micropost</span><span class="p">:</span>
</span>                                      <span class="p">{</span> <span class="ss">content</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
<span class="hll">                                        <span class="ss">picture</span><span class="p">:</span> <span class="no">FILL_IN</span> <span class="p">}</span> <span class="p">}</span>
</span>    <span class="k">end</span>
    <span class="n">assert</span> <span class="no">FILL_IN</span><span class="o">.</span><span class="n">picture?</span>
    <span class="n">follow_redirect!</span>
    <span class="n">assert_match</span> <span class="n">content</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
    <span class="c1"># Delete a post.</span>
    <span class="n">assert_select</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'delete'</span>
    <span class="n">first_micropost</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">microposts</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">page</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
    <span class="n">assert_difference</span> <span class="s1">'Micropost.count'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">do</span>
      <span class="n">delete</span> <span class="n">micropost_path</span><span class="p">(</span><span class="n">first_micropost</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="c1"># Visit a different user.</span>
    <span class="n">get</span> <span class="n">user_path</span><span class="p">(</span><span class="n">users</span><span class="p">(</span><span class="ss">:archer</span><span class="p">))</span>
    <span class="n">assert_select</span> <span class="s1">'a'</span><span class="p">,</span> <span class="p">{</span> <span class="ss">text</span><span class="p">:</span> <span class="s1">'delete'</span><span class="p">,</span> <span class="ss">count</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
</div>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-image_validation&quot; data-tralics-id=&quot;uid1728&quot; class=&quot;subsection&quot; data-number=&quot;13.4.2&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-image_validation&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.4.2 &lt;/span&gt;Image validation&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The uploader in &lt;a href=&quot;user_microposts_fragment.html#sec-basic_image_upload&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.1&lt;/span&gt;&lt;/a&gt; is a good start, but it has significant limitations.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In particular, it doesn’t enforce any constraints on the uploaded file, which can cause problems if users try to upload large files or invalid file types.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To remedy this defect, we’ll add validations for the image size and format, both on the server and on the client (i.e., in the browser).&lt;/p&gt;
&lt;p&gt;The first image validation, which restricts uploads to valid image types, appears in the CarrierWave uploader itself.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; The resulting code (which appears as a commented-out suggestion in the generated uploader) verifies that the image filename ends with a valid image extension (PNG, GIF, and both variants of JPEG), as shown in &lt;a href=&quot;user_microposts_fragment.html#code-validate_picture_format&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.64&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-validate_picture_format&quot; data-tralics-id=&quot;uid1729&quot; data-number=&quot;13.64&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.64:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The picture format validation.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/uploaders/picture_uploader.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PictureUploader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Uploader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:file&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Override the directory where uploaded files will be stored.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# This is a sensible default for uploaders that are meant to be mounted:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;store_dir&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;uploads/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;underscore&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mounted_as&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Add a white list of extensions which are allowed to be uploaded.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;extension_whitelist&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;sx&quot;&gt;%w(jpg jpeg gif png)&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The second validation, which controls the size of the image, appears in the Micropost model itself.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In contrast to previous model validations, file size validation doesn’t correspond to a built-in Rails validator.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; As a result, validating images requires defining a custom validation, which we’ll call &lt;code&gt;picture_size&lt;/code&gt; and define as shown in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_model_image_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.65&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Note the use of &lt;code&gt;validate&lt;/code&gt; (as opposed to &lt;code&gt;validates&lt;/code&gt;) to call a custom validation.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-micropost_model_image_validation&quot; data-tralics-id=&quot;uid1730&quot; data-number=&quot;13.65&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.65:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding validations to images.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/models/micropost.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Micropost&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;default_scope&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;created_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;mount_uploader&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PictureUploader&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;presence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;maximum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;validate&lt;/span&gt;  &lt;span class=&quot;ss&quot;&gt;:picture_size&lt;/span&gt;
&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;c1&quot;&gt;# Validates the size of an uploaded picture.&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;picture_size&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;megabytes&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;        &lt;span class=&quot;n&quot;&gt;errors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;should be less than 5MB&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This custom validation arranges to call the method corresponding to the given symbol (&lt;code&gt;:picture_size&lt;/code&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In &lt;code&gt;picture_size&lt;/code&gt; itself, we add a custom error message to the &lt;code&gt;errors&lt;/code&gt; collection (seen before briefly in &lt;a href=&quot;modeling_users_fragment.html#sec-presence_validation&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;6.2.2&lt;/span&gt;&lt;/a&gt;), in this case a limit of 5 megabytes (using a syntax seen before in &lt;a href=&quot;advanced_login_fragment.html#aside-time_helpers&quot; class=&quot;hyperref&quot;&gt;Box &lt;span class=&quot;ref&quot;&gt;9.1&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;To go along with the validations in &lt;a href=&quot;user_microposts_fragment.html#code-validate_picture_format&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.64&lt;/span&gt;&lt;/a&gt; and &lt;a href=&quot;user_microposts_fragment.html#code-micropost_model_image_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.65&lt;/span&gt;&lt;/a&gt;, we’ll add two client-side checks on the uploaded image.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll first mirror the format validation by using the &lt;code&gt;accept&lt;/code&gt; parameter in the &lt;code&gt;file_field&lt;/code&gt; input tag:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;image/jpeg,image/gif,image/png&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The valid formats consist of the &lt;a href=&quot;https://en.wikipedia.org/wiki/Internet_media_type&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MIME types&lt;/a&gt; accepted by the validation in &lt;a href=&quot;user_microposts_fragment.html#code-validate_picture_format&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.64&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Next, we’ll include a little JavaScript (or, more specifically, &lt;a href=&quot;http://jquery.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;jQuery&lt;/a&gt;) to issue an alert if a user tries to upload an image that’s too big (which prevents accidental time-consuming uploads and lightens the load on the server):&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;#micropost_picture&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;change&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;size_in_megabytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;size_in_megabytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Maximum file size is 5MB. Please choose a smaller file.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Although jQuery isn’t the focus of this book, you might be able to figure out that the code above monitors the page element containing the CSS id &lt;code&gt;micropost_picture&lt;/code&gt; (as indicated by the hash mark &lt;code&gt;#&lt;/code&gt;), which is the id of the micropost form in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_create_image_upload&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.60&lt;/span&gt;&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (The way to figure this out is to Ctrl-click and use your browser’s web inspector.)&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; When the element with that CSS id changes, the jQuery function fires and issues the &lt;code&gt;alert&lt;/code&gt; method if the file is too big.&lt;sup id=&quot;cha-13_footnote-ref-19&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-19&quot;&gt;19&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;The result of adding these additional checks appears in &lt;a href=&quot;user_microposts_fragment.html#code-jquery_file_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.66&lt;/span&gt;&lt;/a&gt;.&lt;sup id=&quot;cha-13_footnote-ref-20&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-20&quot;&gt;20&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-jquery_file_test&quot; data-tralics-id=&quot;uid1733&quot; data-number=&quot;13.66&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.66:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Checking the file size with jQuery.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/views/shared/_micropost_form.html.erb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form_for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vi&quot;&gt;@micropost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;shared/error_messages&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;field&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text_area&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;placeholder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Compose new micropost...&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Post&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;btn btn-primary&quot;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;picture&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_field&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:picture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;image/jpeg,image/gif,image/png&#39;&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;
&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;%&amp;gt;&lt;/span&gt;

&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;#micropost_picture&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;change&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;size_in_megabytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;size_in_megabytes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;      &lt;span class=&quot;nx&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;Maximum file size is 5MB. Please choose a smaller file.&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;As you can see by trying to upload a file that’s too big, the code in &lt;a href=&quot;user_microposts_fragment.html#code-jquery_file_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.66&lt;/span&gt;&lt;/a&gt; doesn’t actually clear the file input field, so a user can just dismiss the alert box and continue trying to upload the file.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; If this were a book on jQuery, we would probably polish this slight blemish by clearing the field, but it’s important to understand that front-end code like that shown in &lt;a href=&quot;user_microposts_fragment.html#code-jquery_file_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.66&lt;/span&gt;&lt;/a&gt; can’t prevent a user from trying to upload a file that’s too big.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Even if our code cleared the file input field, there would be no way to prevent a user from editing the JavaScript with a web inspector or issue a direct &lt;code class=&quot;tt&quot;&gt;POST&lt;/code&gt; request using, e.g., &lt;code&gt;curl&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To prevent users from uploading arbitrarily large files, it is thus essential to include a server-side validation, as in &lt;a href=&quot;user_microposts_fragment.html#code-micropost_model_image_validation&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.65&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div id=&quot;sec-exercises_image_validation&quot; data-tralics-id=&quot;uid1734&quot; class=&quot;subsubsection&quot; data-number=&quot;13.4.2.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_image_validation&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;What happens if you try uploading an image bigger than 5 megabytes? &lt;span class=&quot;exercise&quot; id=&quot;ex-8ab2dc&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;What happens if you try uploading a file with an invalid extension? &lt;span class=&quot;exercise&quot; id=&quot;ex-70fb50&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="851"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-image_validation" data-tralics-id="uid1728" class="subsection" data-number="13.4.2">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_validation" class="heading hyperref"><span class="number">13.4.2 </span>Image validation</a></h3>
<p>The uploader in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-basic_image_upload" class="hyperref">Section&nbsp;<span class="ref">13.4.1</span></a> is a good start, but it has significant limitations.<span class="intersentencespace"></span> In particular, it doesn’t enforce any constraints on the uploaded file, which can cause problems if users try to upload large files or invalid file types.<span class="intersentencespace"></span> To remedy this defect, we’ll add validations for the image size and format, both on the server and on the client (i.e., in the browser).</p>
<p>The first image validation, which restricts uploads to valid image types, appears in the CarrierWave uploader itself.<span class="intersentencespace"></span> The resulting code (which appears as a commented-out suggestion in the generated uploader) verifies that the image filename ends with a valid image extension (PNG, GIF, and both variants of JPEG), as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-validate_picture_format" class="hyperref">Listing&nbsp;<span class="ref">13.64</span></a>.</p>
<div class="codelisting" id="code-validate_picture_format" data-tralics-id="uid1729" data-number="13.64">
<div class="heading">
<span class="number">Listing 13.64:</span> 

<span class="description">The picture format validation.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/uploaders/picture_uploader.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PictureUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">storage</span> <span class="ss">:file</span>

  <span class="c1"># Override the directory where uploaded files will be stored.</span>
  <span class="c1"># This is a sensible default for uploaders that are meant to be mounted:</span>
  <span class="k">def</span> <span class="nf">store_dir</span>
    <span class="s2">"uploads/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">underscore</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">mounted_as</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="c1"># Add a white list of extensions which are allowed to be uploaded.</span>
  <span class="k">def</span> <span class="nf">extension_whitelist</span>
<span class="hll">    <span class="sx">%w(jpg jpeg gif png)</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p>The second validation, which controls the size of the image, appears in the Micropost model itself.<span class="intersentencespace"></span> In contrast to previous model validations, file size validation doesn’t correspond to a built-in Rails validator.<span class="intersentencespace"></span> As a result, validating images requires defining a custom validation, which we’ll call <code>picture_size</code> and define as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_model_image_validation" class="hyperref">Listing&nbsp;<span class="ref">13.65</span></a>.<span class="intersentencespace"></span> Note the use of <code>validate</code> (as opposed to <code>validates</code>) to call a custom validation.</p>
<div class="codelisting" id="code-micropost_model_image_validation" data-tralics-id="uid1730" data-number="13.65">
<div class="heading">
<span class="number">Listing 13.65:</span> 

<span class="description">Adding validations to images.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/models/micropost.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">default_scope</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">created_at</span><span class="p">:</span> <span class="ss">:desc</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">mount_uploader</span> <span class="ss">:picture</span><span class="p">,</span> <span class="no">PictureUploader</span>
  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">140</span> <span class="p">}</span>
<span class="hll">  <span class="n">validate</span>  <span class="ss">:picture_size</span>
</span>
  <span class="kp">private</span>

<span class="hll">    <span class="c1"># Validates the size of an uploaded picture.</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">picture_size</span>
</span><span class="hll">      <span class="k">if</span> <span class="n">picture</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">.</span><span class="n">megabytes</span>
</span><span class="hll">        <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:picture</span><span class="p">,</span> <span class="s2">"should be less than 5MB"</span><span class="p">)</span>
</span><span class="hll">      <span class="k">end</span>
</span><span class="hll">    <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div>
</div>
<p>This custom validation arranges to call the method corresponding to the given symbol (<code>:picture_size</code>).<span class="intersentencespace"></span> In <code>picture_size</code> itself, we add a custom error message to the <code>errors</code> collection (seen before briefly in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/modeling_users#sec-presence_validation" class="hyperref">Section&nbsp;<span class="ref">6.2.2</span></a>), in this case a limit of 5&nbsp;megabytes (using a syntax seen before in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/advanced_login#aside-time_helpers" class="hyperref">Box&nbsp;<span class="ref">9.1</span></a>).</p>
<p>To go along with the validations in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-validate_picture_format" class="hyperref">Listing&nbsp;<span class="ref">13.64</span></a> and <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_model_image_validation" class="hyperref">Listing&nbsp;<span class="ref">13.65</span></a>, we’ll add two client-side checks on the uploaded image.<span class="intersentencespace"></span> We’ll first mirror the format validation by using the <code>accept</code> parameter in the <code>file_field</code> input tag:</p>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_field</span> <span class="ss">:picture</span><span class="p">,</span> <span class="ss">accept</span><span class="p">:</span> <span class="s1">'image/jpeg,image/gif,image/png'</span> <span class="cp">%&gt;</span>
</pre></div></div>
<p>The valid formats consist of the <a href="https://en.wikipedia.org/wiki/Internet_media_type" target="_blank" rel="noopener">MIME types</a> accepted by the validation in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-validate_picture_format" class="hyperref">Listing&nbsp;<span class="ref">13.64</span></a>.</p>
<p>Next, we’ll include a little JavaScript (or, more specifically, <a href="http://jquery.com/" target="_blank" rel="noopener">jQuery</a>) to issue an alert if a user tries to upload an image that’s too big (which prevents accidental time-consuming uploads and lightens the load on the server):</p>
<div class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s1">'#micropost_picture'</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">size_in_megabytes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">size</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">size_in_megabytes</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">'Maximum file size is 5MB. Please choose a smaller file.'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div></div>
<p>Although jQuery isn’t the focus of this book, you might be able to figure out that the code above monitors the page element containing the CSS&nbsp;id <code>micropost_picture</code> (as indicated by the hash mark&nbsp;<code>#</code>), which is the id of the micropost form in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_create_image_upload" class="hyperref">Listing&nbsp;<span class="ref">13.60</span></a>.<span class="intersentencespace"></span> (The way to figure this out is to Ctrl-click and use your browser’s web inspector.)<span class="intersentencespace"></span> When the element with that CSS&nbsp;id changes, the jQuery function fires and issues the <code>alert</code> method if the file is too big.<sup id="cha-13_footnote-ref-19" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-19" data-hasqtip="26">19</a></sup></p>
<p>The result of adding these additional checks appears in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-jquery_file_test" class="hyperref">Listing&nbsp;<span class="ref">13.66</span></a>.<sup id="cha-13_footnote-ref-20" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-20" data-hasqtip="27">20</a></sup></p>
<div class="codelisting" id="code-jquery_file_test" data-tralics-id="uid1733" data-number="13.66">
<div class="heading">
<span class="number">Listing 13.66:</span> 

<span class="description">Checking the file size with jQuery.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/views/shared/_micropost_form.html.erb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="vi">@micropost</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'shared/error_messages'</span><span class="p">,</span> <span class="ss">object</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">object</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">placeholder</span><span class="p">:</span> <span class="s2">"Compose new micropost..."</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s2">"Post"</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn btn-primary"</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"picture"</span><span class="nt">&gt;</span>
<span class="hll">    <span class="cp">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_field</span> <span class="ss">:picture</span><span class="p">,</span> <span class="ss">accept</span><span class="p">:</span> <span class="s1">'image/jpeg,image/gif,image/png'</span> <span class="cp">%&gt;</span>
</span>  <span class="nt">&lt;/span&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="hll"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
</span><span class="hll">  <span class="nx">$</span><span class="p">(</span><span class="s1">'#micropost_picture'</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">    <span class="kd">var</span> <span class="nx">size_in_megabytes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">size</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">;</span>
</span><span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="nx">size_in_megabytes</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="nx">alert</span><span class="p">(</span><span class="s1">'Maximum file size is 5MB. Please choose a smaller file.'</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">  <span class="p">});</span>
</span><span class="hll"><span class="nt">&lt;/script&gt;</span>
</span></pre></div></div>
</div>
<p>As you can see by trying to upload a file that’s too big, the code in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-jquery_file_test" class="hyperref">Listing&nbsp;<span class="ref">13.66</span></a> doesn’t actually clear the file input field, so a user can just dismiss the alert box and continue trying to upload the file.<span class="intersentencespace"></span> If this were a book on jQuery, we would probably polish this slight blemish by clearing the field, but it’s important to understand that front-end code like that shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-jquery_file_test" class="hyperref">Listing&nbsp;<span class="ref">13.66</span></a> can’t prevent a user from trying to upload a file that’s too big.<span class="intersentencespace"></span> Even if our code cleared the file input field, there would be no way to prevent a user from editing the JavaScript with a web inspector or issue a direct <code class="tt">POST</code> request using, e.g., <code>curl</code>.<span class="intersentencespace"></span> To prevent users from uploading arbitrarily large files, it is thus essential to include a server-side validation, as in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-micropost_model_image_validation" class="hyperref">Listing&nbsp;<span class="ref">13.65</span></a>.</p>
<div id="sec-exercises_image_validation" data-tralics-id="uid1734" class="subsubsection" data-number="13.4.2.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_image_validation" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>What happens if you try uploading an image bigger than 5 megabytes? <span class="exercise" id="ex-8ab2dc"></span>
</li>
<li>What happens if you try uploading a file with an invalid extension? <span class="exercise" id="ex-70fb50"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-image_resizing&quot; data-tralics-id=&quot;uid1737&quot; class=&quot;subsection&quot; data-number=&quot;13.4.3&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-image_resizing&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.4.3 &lt;/span&gt;Image resizing&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The image size validations in &lt;a href=&quot;user_microposts_fragment.html#sec-image_validation&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.2&lt;/span&gt;&lt;/a&gt; are a good start, but they still allow the uploading of images large enough to break our site’s layout, sometimes with frightening results (&lt;a href=&quot;user_microposts_fragment.html#fig-large_uploaded_image&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.21&lt;/span&gt;&lt;/a&gt;).&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Thus, while it’s convenient to allow users to select fairly large images from their local disk, it’s also a good idea to resize the images before displaying them.&lt;sup id=&quot;cha-13_footnote-ref-21&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-21&quot;&gt;21&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-large_uploaded_image&quot; data-tralics-id=&quot;uid1739&quot; data-number=&quot;13.21&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/large_uploaded_image_4th_ed.png&quot; alt=&quot;images/figures/large_uploaded_image_4th_ed&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.21: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A frighteningly large uploaded image.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We’ll be resizing images using the image manipulation program &lt;a href=&quot;http://www.imagemagick.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ImageMagick&lt;/a&gt;, which we need to install on the development environment.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (As we’ll see in &lt;a href=&quot;user_microposts_fragment.html#sec-image_upload_in_production&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.4&lt;/span&gt;&lt;/a&gt;, when using Heroku for deployment ImageMagick comes pre-installed in production.)&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; On the cloud IDE, we can do this as follows:&lt;sup id=&quot;cha-13_footnote-ref-22&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-22&quot;&gt;22&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; sudo yum install -y ImageMagick
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(If you’re developing on your local machine, you may have to install ImageMagick a different way, such as using &lt;a href=&quot;http://brew.sh/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Homebrew&lt;/a&gt; on a Mac via &lt;code&gt;brew install imagemagick&lt;/code&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Use your technical sophistication (&lt;a href=&quot;beginning_fragment.html#aside-technical_sophistication&quot; class=&quot;hyperref&quot;&gt;Box &lt;span class=&quot;ref&quot;&gt;1.1&lt;/span&gt;&lt;/a&gt;) if you get stuck.)&lt;/p&gt;
&lt;p&gt;Next, we need to include CarrierWave’s &lt;a href=&quot;https://github.com/minimagick/minimagick&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MiniMagick&lt;/a&gt; interface for ImageMagick, together with a resizing command.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; For the resizing command, there are several possibilities listed in the &lt;a href=&quot;http://www.rdoc.info/github/jnicklas/carrierwave/CarrierWave/MiniMagick&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MiniMagick documentation&lt;/a&gt;, but the one we want is &lt;code&gt;resize_to_limit: [400, 400]&lt;/code&gt;, which resizes large images so that they aren’t any bigger than 400px in either dimension, while simultaneously leaving smaller images alone.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; (The other main possibilities listed in the &lt;a href=&quot;https://github.com/carrierwaveuploader/carrierwave#using-minimagick&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CarrierWave documentation on MiniMagick&lt;/a&gt; &lt;em&gt;stretch&lt;/em&gt; images if they’re too small, which isn’t what we want in this case.)&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; With the code as shown in &lt;a href=&quot;user_microposts_fragment.html#code-image_uploader_resizing&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.67&lt;/span&gt;&lt;/a&gt;, large images are now resized nicely (&lt;a href=&quot;user_microposts_fragment.html#fig-resized_image&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.22&lt;/span&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-image_uploader_resizing&quot; data-tralics-id=&quot;uid1741&quot; data-number=&quot;13.67&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.67:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Configuring the image uploader for image resizing.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/uploaders/picture_uploader.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PictureUploader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Uploader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;kp&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MiniMagick&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;resize_to_limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:file&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Override the directory where uploaded files will be stored.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# This is a sensible default for uploaders that are meant to be mounted:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;store_dir&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;uploads/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;underscore&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mounted_as&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Add a white list of extensions which are allowed to be uploaded.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;extension_whitelist&lt;/span&gt;
    &lt;span class=&quot;sx&quot;&gt;%w(jpg jpeg gif png)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-resized_image&quot; data-tralics-id=&quot;uid1742&quot; data-number=&quot;13.22&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/resized_image_4th_ed.png&quot; alt=&quot;images/figures/resized_image_4th_ed&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.22: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;A nicely resized image.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_image_resizing&quot; data-tralics-id=&quot;uid1743&quot; class=&quot;subsubsection&quot; data-number=&quot;13.4.3.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_image_resizing&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Upload a large image and confirm directly that the resizing is working.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Does the resizing work even if the image isn’t square? &lt;span class=&quot;exercise&quot; id=&quot;ex-be0762&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;If you completed the image upload test in &lt;a href=&quot;user_microposts_fragment.html#code-image_upload_test&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.63&lt;/span&gt;&lt;/a&gt;, at this point your test suite may be giving you a confusing error message.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Fix this issue by configuring CarrierWave to skip image resizing in tests using the initializer file shown in &lt;a href=&quot;user_microposts_fragment.html#code-skip_resize_initializer&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.68&lt;/span&gt;&lt;/a&gt;. &lt;span class=&quot;exercise&quot; id=&quot;ex-18159f&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-skip_resize_initializer&quot; data-tralics-id=&quot;uid1746&quot; data-number=&quot;13.68&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.68:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;An initializer to skip image resizing in tests.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;config/initializers/skip_image_resizing.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test?&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enable_processing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="852"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-image_resizing" data-tralics-id="uid1737" class="subsection" data-number="13.4.3">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_resizing" class="heading hyperref"><span class="number">13.4.3 </span>Image resizing</a></h3>
<p>The image size validations in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_validation" class="hyperref">Section&nbsp;<span class="ref">13.4.2</span></a> are a good start, but they still allow the uploading of images large enough to break our site’s layout, sometimes with frightening results (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-large_uploaded_image" class="hyperref">Figure&nbsp;<span class="ref">13.21</span></a>).<span class="intersentencespace"></span> Thus, while it’s convenient to allow users to select fairly large images from their local disk, it’s also a good idea to resize the images before displaying them.<sup id="cha-13_footnote-ref-21" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-21" data-hasqtip="28">21</a></sup></p>
<div class="center figure" id="fig-large_uploaded_image" data-tralics-id="uid1739" data-number="13.21">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/large_uploaded_image_4th_ed.png" alt="images/figures/large_uploaded_image_4th_ed"></div>
<div class="caption">
<span class="header">Figure 13.21: </span><span class="description">A frighteningly large uploaded image.
</span>
</div>
</div>
<p>We’ll be resizing images using the image manipulation program <a href="http://www.imagemagick.org/" target="_blank" rel="noopener">ImageMagick</a>, which we need to install on the development environment.<span class="intersentencespace"></span> (As we’ll see in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_upload_in_production" class="hyperref">Section&nbsp;<span class="ref">13.4.4</span></a>, when using Heroku for deployment ImageMagick comes pre-installed in production.)<span class="intersentencespace"></span> On the cloud IDE, we can do this as follows:<sup id="cha-13_footnote-ref-22" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-22" data-hasqtip="29">22</a></sup></p>
<div class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo yum install -y ImageMagick
</pre></div></div>
<p>(If you’re developing on your local machine, you may have to install ImageMagick a different way, such as using <a href="http://brew.sh/" target="_blank" rel="noopener">Homebrew</a> on a Mac via <code>brew install imagemagick</code>.<span class="intersentencespace"></span> Use your technical sophistication (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#aside-technical_sophistication" class="hyperref">Box&nbsp;<span class="ref">1.1</span></a>) if you get stuck.)</p>
<p>Next, we need to include CarrierWave’s <a href="https://github.com/minimagick/minimagick" target="_blank" rel="noopener">MiniMagick</a> interface for ImageMagick, together with a resizing command.<span class="intersentencespace"></span> For the resizing command, there are several possibilities listed in the <a href="http://www.rdoc.info/github/jnicklas/carrierwave/CarrierWave/MiniMagick" target="_blank" rel="noopener">MiniMagick documentation</a>, but the one we want is <code>resize_to_limit: [400, 400]</code>, which resizes large images so that they aren’t any bigger than 400px in either dimension, while simultaneously leaving smaller images alone.<span class="intersentencespace"></span> (The other main possibilities listed in the <a href="https://github.com/carrierwaveuploader/carrierwave#using-minimagick" target="_blank" rel="noopener">CarrierWave documentation on MiniMagick</a> <em>stretch</em> images if they’re too small, which isn’t what we want in this case.)<span class="intersentencespace"></span> With the code as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_uploader_resizing" class="hyperref">Listing&nbsp;<span class="ref">13.67</span></a>, large images are now resized nicely (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-resized_image" class="hyperref">Figure&nbsp;<span class="ref">13.22</span></a>).</p>
<div class="codelisting" id="code-image_uploader_resizing" data-tralics-id="uid1741" data-number="13.67">
<div class="heading">
<span class="number">Listing 13.67:</span> 

<span class="description">Configuring the image uploader for image resizing.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/uploaders/picture_uploader.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PictureUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">  <span class="kp">include</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">MiniMagick</span>
</span><span class="hll">  <span class="n">process</span> <span class="ss">resize_to_limit</span><span class="p">:</span> <span class="o">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="o">]</span>
</span>
  <span class="n">storage</span> <span class="ss">:file</span>

  <span class="c1"># Override the directory where uploaded files will be stored.</span>
  <span class="c1"># This is a sensible default for uploaders that are meant to be mounted:</span>
  <span class="k">def</span> <span class="nf">store_dir</span>
    <span class="s2">"uploads/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">underscore</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">mounted_as</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="c1"># Add a white list of extensions which are allowed to be uploaded.</span>
  <span class="k">def</span> <span class="nf">extension_whitelist</span>
    <span class="sx">%w(jpg jpeg gif png)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<div class="center figure" id="fig-resized_image" data-tralics-id="uid1742" data-number="13.22">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/resized_image_4th_ed.png" alt="images/figures/resized_image_4th_ed"></div>
<div class="caption">
<span class="header">Figure 13.22: </span><span class="description">A nicely resized image.
</span>
</div>
</div>
<div id="sec-exercises_image_resizing" data-tralics-id="uid1743" class="subsubsection" data-number="13.4.3.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_image_resizing" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Upload a large image and confirm directly that the resizing is working.<span class="intersentencespace"></span> Does the resizing work even if the image isn’t square? <span class="exercise" id="ex-be0762"></span>
</li>
<li>If you completed the image upload test in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_upload_test" class="hyperref">Listing&nbsp;<span class="ref">13.63</span></a>, at this point your test suite may be giving you a confusing error message.<span class="intersentencespace"></span> Fix this issue by configuring CarrierWave to skip image resizing in tests using the initializer file shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-skip_resize_initializer" class="hyperref">Listing&nbsp;<span class="ref">13.68</span></a>. <span class="exercise" id="ex-18159f"></span>
</li>
</ol>
<div class="codelisting" id="code-skip_resize_initializer" data-tralics-id="uid1746" data-number="13.68">
<div class="heading">
<span class="number">Listing 13.68:</span> 

<span class="description">An initializer to skip image resizing in tests.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">config/initializers/skip_image_resizing.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">test?</span>
  <span class="no">CarrierWave</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="n">config</span><span class="o">.</span><span class="n">enable_processing</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-image_upload_in_production&quot; data-tralics-id=&quot;uid1747&quot; class=&quot;subsection&quot; data-number=&quot;13.4.4&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-image_upload_in_production&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.4.4 &lt;/span&gt;Image upload in production&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The image uploader developed in &lt;a href=&quot;user_microposts_fragment.html#sec-image_resizing&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.3&lt;/span&gt;&lt;/a&gt; is good enough for development, but (as seen in the &lt;code&gt;storage :file&lt;/code&gt; line in &lt;a href=&quot;user_microposts_fragment.html#code-image_uploader_resizing&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.67&lt;/span&gt;&lt;/a&gt;) it uses the local filesystem for storing the images, which isn’t a good practice in production.&lt;sup id=&quot;cha-13_footnote-ref-23&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-23&quot;&gt;23&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Instead, we’ll use a cloud storage service to store images separately from our application.&lt;sup id=&quot;cha-13_footnote-ref-24&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-24&quot;&gt;24&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;To configure our application to use cloud storage in production, we’ll use the &lt;code class=&quot;tt&quot;&gt;fog&lt;/code&gt; gem, as shown in &lt;a href=&quot;user_microposts_fragment.html#code-image_uploader_production&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.69&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-image_uploader_production&quot; data-tralics-id=&quot;uid1750&quot; data-number=&quot;13.69&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.69:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Configuring the image uploader for production.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;app/uploaders/picture_uploader.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PictureUploader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Uploader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MiniMagick&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;resize_to_limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;production?&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:fog&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;    &lt;span class=&quot;n&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:file&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# Override the directory where uploaded files will be stored.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# This is a sensible default for uploaders that are meant to be mounted:&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;store_dir&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;uploads/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;underscore&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mounted_as&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;# Add a white list of extensions which are allowed to be uploaded.&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;extension_whitelist&lt;/span&gt;
    &lt;span class=&quot;sx&quot;&gt;%w(jpg jpeg gif png)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;user_microposts_fragment.html#code-image_uploader_production&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.69&lt;/span&gt;&lt;/a&gt; uses the &lt;code&gt;production?&lt;/code&gt; boolean from &lt;a href=&quot;sign_up_fragment.html#aside-rails_environments&quot; class=&quot;hyperref&quot;&gt;Box &lt;span class=&quot;ref&quot;&gt;7.1&lt;/span&gt;&lt;/a&gt; to switch storage method based on the environment:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;production?&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:fog&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;storage&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:file&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are many choices for cloud storage, but we’ll use one of the most popular and well-supported, Amazon.com’s &lt;a href=&quot;http://aws.amazon.com/s3/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Simple Storage Service (S3)&lt;/a&gt;.&lt;sup id=&quot;cha-13_footnote-ref-25&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-25&quot;&gt;25&lt;/a&gt;&lt;/sup&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Here are the essential steps to getting set up:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Sign up for an &lt;a href=&quot;http://aws.amazon.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Amazon Web Services&lt;/a&gt; account if you don’t have one already.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; If you signed up for the Cloud9 IDE in &lt;a href=&quot;beginning_fragment.html#sec-development_environment&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;1.2.1&lt;/span&gt;&lt;/a&gt;, you already have an AWS account and can skip this step.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Create a user via &lt;a href=&quot;http://aws.amazon.com/iam/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AWS Identity and Access Management (IAM)&lt;/a&gt; and record the access key and secret key.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;li&gt;Create an S3 bucket (with a name of your choice) using the &lt;a href=&quot;https://console.aws.amazon.com/s3&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AWS Console&lt;/a&gt;, and then grant read and write permission to the user created in the previous step.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;You will likely find setting up S3 to be a challenging exercise in technical sophistication (&lt;a href=&quot;beginning_fragment.html#aside-technical_sophistication&quot; class=&quot;hyperref&quot;&gt;Box &lt;span class=&quot;ref&quot;&gt;1.1&lt;/span&gt;&lt;/a&gt;); for further details on the steps above, consult the &lt;a href=&quot;http://aws.amazon.com/documentation/s3/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;S3 documentation&lt;/a&gt;&lt;sup id=&quot;cha-13_footnote-ref-26&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-26&quot;&gt;26&lt;/a&gt;&lt;/sup&gt; (and, if necessary, Google or Stack Overflow).&lt;/p&gt;
&lt;p&gt;Once you’ve created and configured your S3 account, you should create and fill the CarrierWave configuration file as shown in &lt;a href=&quot;user_microposts_fragment.html#code-carrier_wave_configuration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.70&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: If your setup isn’t working, your region location may be the issue.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Some users may have to add &lt;code&gt;:region =&amp;gt; ENV[&#39;S3_REGION&#39;]&lt;/code&gt; to the fog credentials, followed by &lt;code&gt;heroku config:set S3_REGION=&amp;lt;bucket&lt;/code&gt; &lt;code&gt;region&amp;gt;&lt;/code&gt; at the command line, where the bucket region should be something like &lt;code&gt;&#39;eu-central-1&#39;&lt;/code&gt;, depending on your location.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To determine the correct region, consult the list of &lt;a href=&quot;http://docs.aws.amazon.com/general/latest/gr/rande.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Regions and Endpoints&lt;/a&gt; at Amazon.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-carrier_wave_configuration&quot; data-tralics-id=&quot;uid1756&quot; data-number=&quot;13.70&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.70:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Configuring CarrierWave to use S3.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; &lt;span class=&quot;break&quot;&gt;&lt;/span&gt; &lt;code class=&quot;filepath&quot;&gt;config/initializers/carrier_wave.rb&lt;/code&gt;&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;production?&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;CarrierWave&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;configure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fog_credentials&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Configuration for Amazon S3&lt;/span&gt;
      &lt;span class=&quot;ss&quot;&gt;:provider&lt;/span&gt;              &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;AWS&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;ss&quot;&gt;:aws_access_key_id&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;S3_ACCESS_KEY&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;ss&quot;&gt;:aws_secret_access_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;S3_SECRET_KEY&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fog_directory&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;no&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;S3_BUCKET&#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: Some users have reported having to include the additional line&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fog_provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;fog/aws&#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As with production email configuration (&lt;a href=&quot;account_activation_fragment.html#code-sendgrid_config&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;11.41&lt;/span&gt;&lt;/a&gt;), &lt;a href=&quot;user_microposts_fragment.html#code-carrier_wave_configuration&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.70&lt;/span&gt;&lt;/a&gt; uses Heroku &lt;code&gt;ENV&lt;/code&gt; variables to avoid hard-coding sensitive information.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; In &lt;a href=&quot;account_activation_fragment.html#sec-activation_email_in_production&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;11.4&lt;/span&gt;&lt;/a&gt; and &lt;a href=&quot;password_reset_fragment.html#sec-reset_email_in_production&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;12.4&lt;/span&gt;&lt;/a&gt;, these variables were defined automatically via the SendGrid add-on, but in this case we need to define them explicitly, which we can accomplish using &lt;code&gt;heroku config:set&lt;/code&gt; as follows:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; heroku config:set &lt;span class=&quot;nv&quot;&gt;S3_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;access key&amp;gt;
&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; heroku config:set &lt;span class=&quot;nv&quot;&gt;S3_SECRET_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;secret key&amp;gt;
&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt; heroku config:set &lt;span class=&quot;nv&quot;&gt;S3_BUCKET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;bucket name&amp;gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the configuration above, we are ready to commit our changes and deploy.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; I recommend updating your &lt;code&gt;.gitignore&lt;/code&gt; file as shown in &lt;a href=&quot;user_microposts_fragment.html#code-gitignore_uploads&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.71&lt;/span&gt;&lt;/a&gt; so that the image uploads directory is ignored.&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-gitignore_uploads&quot; data-tralics-id=&quot;uid1757&quot; data-number=&quot;13.71&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.71:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;Adding the uploads directory to the &lt;code&gt;.gitignore&lt;/code&gt; file.&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;.
.
.
&lt;span class=&quot;hll&quot;&gt;# Ignore uploaded test images.
&lt;/span&gt;&lt;span class=&quot;hll&quot;&gt;/public/uploads
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;We’re now ready to commit the changes on our topic branch and merge back to master:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
$ git add -A
$ git commit -m &quot;Add user microposts&quot;
$ git checkout master
$ git merge user-microposts
$ git push
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then we deploy, reset the database, and reseed the sample data:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ git push heroku
$ heroku pg:reset DATABASE
$ heroku run rails db:migrate
$ heroku run rails db:seed
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because Heroku comes with an installation of ImageMagick, the result is successful image resizing and upload in production, as seen in &lt;a href=&quot;user_microposts_fragment.html#fig-image_upload_production&quot; class=&quot;hyperref&quot;&gt;Figure &lt;span class=&quot;ref&quot;&gt;13.23&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;center figure&quot; id=&quot;fig-image_upload_production&quot; data-tralics-id=&quot;uid1758&quot; data-number=&quot;13.23&quot;&gt;
&lt;div class=&quot;graphics image&quot;&gt;&lt;img src=&quot;images/figures/image_upload_production_4th_ed.png&quot; alt=&quot;images/figures/image_upload_production_4th_ed&quot;&gt;&lt;/div&gt;
&lt;div class=&quot;caption&quot;&gt;
&lt;span class=&quot;header&quot;&gt;Figure 13.23: &lt;/span&gt;&lt;span class=&quot;description&quot;&gt;An uploaded image in production.
&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&quot;sec-exercises_image_upload_in_production&quot; data-tralics-id=&quot;uid1759&quot; class=&quot;subsubsection&quot; data-number=&quot;13.4.4.1&quot;&gt;
&lt;h4&gt;&lt;a href=&quot;#sec-exercises_image_upload_in_production&quot; class=&quot;heading&quot;&gt;Exercises&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt; &lt;/p&gt;
&lt;div class=&quot;society-note&quot;&gt;
&lt;p&gt;Solutions to exercises are available for free with any Rails Tutorial &lt;a href=&quot;https://www.railstutorial.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;purchase&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; To see other people’s answers and to record your own, join the &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn Enough Society&lt;/a&gt; at &lt;a href=&quot;http://learnenough.com/society&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;learnenough.com/society&lt;/a&gt;.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt;  &lt;/p&gt;
&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Upload a large image and confirm directly that the resizing is working in production.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; Does the resizing work even if the image isn’t square? &lt;span class=&quot;exercise&quot; id=&quot;ex-f48355&quot;&gt;&lt;/span&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;" data-sub-section-id="853"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-image_upload_in_production" data-tralics-id="uid1747" class="subsection" data-number="13.4.4">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_upload_in_production" class="heading hyperref"><span class="number">13.4.4 </span>Image upload in production</a></h3>
<p>The image uploader developed in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_resizing" class="hyperref">Section&nbsp;<span class="ref">13.4.3</span></a> is good enough for development, but (as seen in the <code>storage :file</code> line in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_uploader_resizing" class="hyperref">Listing&nbsp;<span class="ref">13.67</span></a>) it uses the local filesystem for storing the images, which isn’t a good practice in production.<sup id="cha-13_footnote-ref-23" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-23" data-hasqtip="30">23</a></sup><span class="intersentencespace"></span> Instead, we’ll use a cloud storage service to store images separately from our application.<sup id="cha-13_footnote-ref-24" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-24" data-hasqtip="31">24</a></sup></p>
<p>To configure our application to use cloud storage in production, we’ll use the <code class="tt">fog</code> gem, as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_uploader_production" class="hyperref">Listing&nbsp;<span class="ref">13.69</span></a>.</p>
<div class="codelisting" id="code-image_uploader_production" data-tralics-id="uid1750" data-number="13.69">
<div class="heading">
<span class="number">Listing 13.69:</span> 

<span class="description">Configuring the image uploader for production.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">app/uploaders/picture_uploader.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PictureUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">MiniMagick</span>
  <span class="n">process</span> <span class="ss">resize_to_limit</span><span class="p">:</span> <span class="o">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="o">]</span>

<span class="hll">  <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
</span><span class="hll">    <span class="n">storage</span> <span class="ss">:fog</span>
</span><span class="hll">  <span class="k">else</span>
</span><span class="hll">    <span class="n">storage</span> <span class="ss">:file</span>
</span><span class="hll">  <span class="k">end</span>
</span>
  <span class="c1"># Override the directory where uploaded files will be stored.</span>
  <span class="c1"># This is a sensible default for uploaders that are meant to be mounted:</span>
  <span class="k">def</span> <span class="nf">store_dir</span>
    <span class="s2">"uploads/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">underscore</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">mounted_as</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="c1"># Add a white list of extensions which are allowed to be uploaded.</span>
  <span class="k">def</span> <span class="nf">extension_whitelist</span>
    <span class="sx">%w(jpg jpeg gif png)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-image_uploader_production" class="hyperref">Listing&nbsp;<span class="ref">13.69</span></a> uses the <code>production?</code> boolean from <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/sign_up#aside-rails_environments" class="hyperref">Box&nbsp;<span class="ref">7.1</span></a> to switch storage method based on the environment:</p>
<div class="code"><div class="highlight"><pre><span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
  <span class="n">storage</span> <span class="ss">:fog</span>
<span class="k">else</span>
  <span class="n">storage</span> <span class="ss">:file</span>
<span class="k">end</span>
</pre></div></div>
<p>There are many choices for cloud storage, but we’ll use one of the most popular and well-supported, Amazon.com’s <a href="http://aws.amazon.com/s3/" target="_blank" rel="noopener">Simple Storage Service (S3)</a>.<sup id="cha-13_footnote-ref-25" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-25" data-hasqtip="32">25</a></sup><span class="intersentencespace"></span> Here are the essential steps to getting set up:</p>
<ol>
<li>Sign up for an <a href="http://aws.amazon.com/" target="_blank" rel="noopener">Amazon Web Services</a> account if you don’t have one already.<span class="intersentencespace"></span> If you signed up for the Cloud9 IDE in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#sec-development_environment" class="hyperref">Section&nbsp;<span class="ref">1.2.1</span></a>, you already have an AWS account and can skip this step.<span class="intersentencespace"></span>
</li>
<li>Create a user via <a href="http://aws.amazon.com/iam/" target="_blank" rel="noopener">AWS Identity and Access Management (IAM)</a> and record the access key and secret key.<span class="intersentencespace"></span>
</li>
<li>Create an S3 bucket (with a name of your choice) using the <a href="https://console.aws.amazon.com/s3" target="_blank" rel="noopener">AWS Console</a>, and then grant read and write permission to the user created in the previous step.<span class="intersentencespace"></span>
</li>
</ol>
<p>You will likely find setting up S3 to be a challenging exercise in technical sophistication (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/beginning#aside-technical_sophistication" class="hyperref">Box&nbsp;<span class="ref">1.1</span></a>); for further details on the steps above, consult the <a href="http://aws.amazon.com/documentation/s3/" target="_blank" rel="noopener">S3 documentation</a><sup id="cha-13_footnote-ref-26" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-26" data-hasqtip="33">26</a></sup> (and, if necessary, Google or Stack Overflow).</p>
<p>Once you’ve created and configured your S3 account, you should create and fill the CarrierWave configuration file as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-carrier_wave_configuration" class="hyperref">Listing&nbsp;<span class="ref">13.70</span></a>.</p>
<p><em>Note</em>: If your setup isn’t working, your region location may be the issue.<span class="intersentencespace"></span> Some users may have to add <code>:region =&gt; ENV['S3_REGION']</code> to the fog credentials, followed by <code>heroku config:set S3_REGION=&lt;bucket</code> <code>region&gt;</code> at the command line, where the bucket region should be something like <code>'eu-central-1'</code>, depending on your location.<span class="intersentencespace"></span> To determine the correct region, consult the list of <a href="http://docs.aws.amazon.com/general/latest/gr/rande.html" target="_blank" rel="noopener">Regions and Endpoints</a> at Amazon.</p>
<div class="codelisting" id="code-carrier_wave_configuration" data-tralics-id="uid1756" data-number="13.70">
<div class="heading">
<span class="number">Listing 13.70:</span> 

<span class="description">Configuring CarrierWave to use S3.<span class="intersentencespace"></span> <span class="break"></span> <code class="filepath">config/initializers/carrier_wave.rb</code></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
  <span class="no">CarrierWave</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="n">config</span><span class="o">.</span><span class="n">fog_credentials</span> <span class="o">=</span> <span class="p">{</span>
      <span class="c1"># Configuration for Amazon S3</span>
      <span class="ss">:provider</span>              <span class="o">=&gt;</span> <span class="s1">'AWS'</span><span class="p">,</span>
      <span class="ss">:aws_access_key_id</span>     <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'S3_ACCESS_KEY'</span><span class="o">]</span><span class="p">,</span>
      <span class="ss">:aws_secret_access_key</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'S3_SECRET_KEY'</span><span class="o">]</span>
    <span class="p">}</span>
    <span class="n">config</span><span class="o">.</span><span class="n">fog_directory</span>     <span class="o">=</span>  <span class="no">ENV</span><span class="o">[</span><span class="s1">'S3_BUCKET'</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>
</div>
<p><em>Note</em>: Some users have reported having to include the additional line</p>
<div class="code"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">fog_provider</span> <span class="o">=</span> <span class="s1">'fog/aws'</span>
</pre></div></div>
<p>As with production email configuration (<a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#code-sendgrid_config" class="hyperref">Listing&nbsp;<span class="ref">11.41</span></a>), <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-carrier_wave_configuration" class="hyperref">Listing&nbsp;<span class="ref">13.70</span></a> uses Heroku <code>ENV</code> variables to avoid hard-coding sensitive information.<span class="intersentencespace"></span> In <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/account_activation#sec-activation_email_in_production" class="hyperref">Section&nbsp;<span class="ref">11.4</span></a> and <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/password_reset#sec-reset_email_in_production" class="hyperref">Section&nbsp;<span class="ref">12.4</span></a>, these variables were defined automatically via the SendGrid add-on, but in this case we need to define them explicitly, which we can accomplish using <code>heroku config:set</code> as follows:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku config:set <span class="nv">S3_ACCESS_KEY</span><span class="o">=</span>&lt;access key&gt;
<span class="gp">$</span> heroku config:set <span class="nv">S3_SECRET_KEY</span><span class="o">=</span>&lt;secret key&gt;
<span class="gp">$</span> heroku config:set <span class="nv">S3_BUCKET</span><span class="o">=</span>&lt;bucket name&gt;
</pre></div></div>
<p>With the configuration above, we are ready to commit our changes and deploy.<span class="intersentencespace"></span> I recommend updating your <code>.gitignore</code> file as shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-gitignore_uploads" class="hyperref">Listing&nbsp;<span class="ref">13.71</span></a> so that the image uploads directory is ignored.</p>
<div class="codelisting" id="code-gitignore_uploads" data-tralics-id="uid1757" data-number="13.71">
<div class="heading">
<span class="number">Listing 13.71:</span> 

<span class="description">Adding the uploads directory to the <code>.gitignore</code> file.</span>
</div>

<div class="code"><div class="highlight"><pre>.
.
.
<span class="hll"># Ignore uploaded test images.
</span><span class="hll">/public/uploads
</span></pre></div></div>
</div>
<p>We’re now ready to commit the changes on our topic branch and merge back to master:</p>
<div class="code"><div class="highlight"><pre>$ rails test
$ git add -A
$ git commit -m "Add user microposts"
$ git checkout master
$ git merge user-microposts
$ git push
</pre></div></div>
<p>Then we deploy, reset the database, and reseed the sample data:</p>
<div class="code"><div class="highlight"><pre>$ git push heroku
$ heroku pg:reset DATABASE
$ heroku run rails db:migrate
$ heroku run rails db:seed
</pre></div></div>
<p>Because Heroku comes with an installation of ImageMagick, the result is successful image resizing and upload in production, as seen in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#fig-image_upload_production" class="hyperref">Figure&nbsp;<span class="ref">13.23</span></a>.</p>
<div class="center figure" id="fig-image_upload_production" data-tralics-id="uid1758" data-number="13.23">
<div class="graphics image"><img src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/image_upload_production_4th_ed.png" alt="images/figures/image_upload_production_4th_ed"></div>
<div class="caption">
<span class="header">Figure 13.23: </span><span class="description">An uploaded image in production.
</span>
</div>
</div>
<div id="sec-exercises_image_upload_in_production" data-tralics-id="uid1759" class="subsubsection" data-number="13.4.4.1">
<h4><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-exercises_image_upload_in_production" class="heading">Exercises</a></h4>
<p> </p>
<div class="society-note">
<p>Solutions to exercises are available for free with any Rails Tutorial <a href="https://www.railstutorial.org/" target="_blank" rel="noopener">purchase</a>.<span class="intersentencespace"></span> To see other people’s answers and to record your own, join the <a href="http://learnenough.com/society" target="_blank" rel="noopener">Learn Enough Society</a> at <a href="http://learnenough.com/society" target="_blank" rel="noopener">learnenough.com/society</a>.<span class="intersentencespace"></span>  </p>
</div>
<ol>
<li>Upload a large image and confirm directly that the resizing is working in production.<span class="intersentencespace"></span> Does the resizing work even if the image isn’t square? <span class="exercise" id="ex-f48355"></span>
</li>
</ol>
</div>
</div></div></div></div>
<div class="j_sectionContent" data-html="&lt;div id=&quot;sec-user_microposts_conclusion&quot; data-tralics-id=&quot;cid78&quot; class=&quot;section&quot; data-number=&quot;13.5&quot;&gt;
&lt;h2&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-user_microposts_conclusion&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.5 &lt;/span&gt;Conclusion&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;With the addition of the Microposts resource, we are nearly finished with our sample application.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; All that remains is to add a social layer by letting users follow each other.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; We’ll learn how to model such user relationships, and see the implications for the microposts feed, in &lt;a href=&quot;following_users_fragment.html#cha-following_users&quot; class=&quot;hyperref&quot;&gt;Chapter &lt;span class=&quot;ref&quot;&gt;14&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you skipped &lt;a href=&quot;user_microposts_fragment.html#sec-image_upload_in_production&quot; class=&quot;hyperref&quot;&gt;Section &lt;span class=&quot;ref&quot;&gt;13.4.4&lt;/span&gt;&lt;/a&gt;, be sure to commit and merge your changes:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ rails test
$ git add -A
$ git commit -m &quot;Add user microposts&quot;
$ git checkout master
$ git merge user-microposts
$ git push
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then deploy to production:&lt;/p&gt;
&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;$ git push heroku
$ heroku pg:reset DATABASE
$ heroku run rails db:migrate
$ heroku run rails db:seed
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It’s worth noting that this chapter saw the last of the necessary gem installations.&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; For reference, the final &lt;code&gt;Gemfile&lt;/code&gt; is shown in &lt;a href=&quot;user_microposts_fragment.html#code-final_gemfile&quot; class=&quot;hyperref&quot;&gt;Listing &lt;span class=&quot;ref&quot;&gt;13.72&lt;/span&gt;&lt;/a&gt;.&lt;sup id=&quot;cha-13_footnote-ref-27&quot; class=&quot;footnote&quot;&gt;&lt;a href=&quot;#cha-13_footnote-27&quot;&gt;27&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;div class=&quot;codelisting&quot; id=&quot;code-final_gemfile&quot; data-tralics-id=&quot;uid1762&quot; data-number=&quot;13.72&quot;&gt;
&lt;div class=&quot;heading&quot;&gt;
&lt;span class=&quot;number&quot;&gt;Listing 13.72:&lt;/span&gt; 

&lt;span class=&quot;description&quot;&gt;The final &lt;code&gt;Gemfile&lt;/code&gt; for the sample application.&lt;/span&gt;
&lt;/div&gt;

&lt;div class=&quot;code&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;https://rubygems.org&#39;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;rails&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                   &lt;span class=&quot;s1&quot;&gt;&#39;5.1.6&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bcrypt&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                  &lt;span class=&quot;s1&quot;&gt;&#39;3.1.12&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;faker&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                   &lt;span class=&quot;s1&quot;&gt;&#39;1.7.3&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;carrierwave&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;             &lt;span class=&quot;s1&quot;&gt;&#39;1.2.2&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;mini_magick&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;             &lt;span class=&quot;s1&quot;&gt;&#39;4.7.0&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;will_paginate&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;s1&quot;&gt;&#39;3.1.6&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bootstrap-will_paginate&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;1.0.0&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;bootstrap-sass&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;s1&quot;&gt;&#39;3.3.7&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;puma&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                    &lt;span class=&quot;s1&quot;&gt;&#39;3.9.1&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;sass-rails&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;              &lt;span class=&quot;s1&quot;&gt;&#39;5.0.6&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;uglifier&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                &lt;span class=&quot;s1&quot;&gt;&#39;3.2.0&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;coffee-rails&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;            &lt;span class=&quot;s1&quot;&gt;&#39;4.2.2&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;jquery-rails&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;            &lt;span class=&quot;s1&quot;&gt;&#39;4.3.1&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;turbolinks&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;              &lt;span class=&quot;s1&quot;&gt;&#39;5.0.1&#39;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;jbuilder&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                &lt;span class=&quot;s1&quot;&gt;&#39;2.7.0&#39;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:development&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;sqlite3&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;1.3.13&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;byebug&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s1&quot;&gt;&#39;9.0.6&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;platform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:mri&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:development&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;web-console&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;s1&quot;&gt;&#39;3.5.1&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;listen&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                &lt;span class=&quot;s1&quot;&gt;&#39;3.1.5&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;spring&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                &lt;span class=&quot;s1&quot;&gt;&#39;2.0.2&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;spring-watcher-listen&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;2.0.1&#39;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;rails-controller-testing&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;1.0.2&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;minitest&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                 &lt;span class=&quot;s1&quot;&gt;&#39;5.10.3&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;minitest-reporters&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;&#39;1.1.14&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;guard&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                    &lt;span class=&quot;s1&quot;&gt;&#39;2.14.1&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;guard-minitest&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;s1&quot;&gt;&#39;2.4.6&#39;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:production&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;pg&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s1&quot;&gt;&#39;0.20.0&#39;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;fog&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;1.42&#39;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Windows does not include zoneinfo files, so bundle the tzinfo-data gem&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&#39;tzinfo-data&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;platforms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:mingw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:mswin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:x64_mingw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:jruby&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-user_microposts_conclusion" data-tralics-id="cid78" class="section" data-number="13.5">
<h2><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_microposts_conclusion" class="heading hyperref"><span class="number">13.5 </span>Conclusion</a></h2>
<p>With the addition of the Microposts resource, we are nearly finished with our sample application.<span class="intersentencespace"></span> All that remains is to add a social layer by letting users follow each other.<span class="intersentencespace"></span> We’ll learn how to model such user relationships, and see the implications for the microposts feed, in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/following_users#cha-following_users" class="hyperref">Chapter&nbsp;<span class="ref">14</span></a>.</p>
<p>If you skipped <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-image_upload_in_production" class="hyperref">Section&nbsp;<span class="ref">13.4.4</span></a>, be sure to commit and merge your changes:</p>
<div class="code"><div class="highlight"><pre>$ rails test
$ git add -A
$ git commit -m "Add user microposts"
$ git checkout master
$ git merge user-microposts
$ git push
</pre></div></div>
<p>Then deploy to production:</p>
<div class="code"><div class="highlight"><pre>$ git push heroku
$ heroku pg:reset DATABASE
$ heroku run rails db:migrate
$ heroku run rails db:seed
</pre></div></div>
<p>It’s worth noting that this chapter saw the last of the necessary gem installations.<span class="intersentencespace"></span> For reference, the final <code>Gemfile</code> is shown in <a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#code-final_gemfile" class="hyperref">Listing&nbsp;<span class="ref">13.72</span></a>.<sup id="cha-13_footnote-ref-27" class="footnote"><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#cha-13_footnote-27" data-hasqtip="34">27</a></sup></p>
<div class="codelisting" id="code-final_gemfile" data-tralics-id="uid1762" data-number="13.72">
<div class="heading">
<span class="number">Listing 13.72:</span> 

<span class="description">The final <code>Gemfile</code> for the sample application.</span>
</div>

<div class="code"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span>                   <span class="s1">'5.1.6'</span>
<span class="n">gem</span> <span class="s1">'bcrypt'</span><span class="p">,</span>                  <span class="s1">'3.1.12'</span>
<span class="n">gem</span> <span class="s1">'faker'</span><span class="p">,</span>                   <span class="s1">'1.7.3'</span>
<span class="n">gem</span> <span class="s1">'carrierwave'</span><span class="p">,</span>             <span class="s1">'1.2.2'</span>
<span class="n">gem</span> <span class="s1">'mini_magick'</span><span class="p">,</span>             <span class="s1">'4.7.0'</span>
<span class="n">gem</span> <span class="s1">'will_paginate'</span><span class="p">,</span>           <span class="s1">'3.1.6'</span>
<span class="n">gem</span> <span class="s1">'bootstrap-will_paginate'</span><span class="p">,</span> <span class="s1">'1.0.0'</span>
<span class="n">gem</span> <span class="s1">'bootstrap-sass'</span><span class="p">,</span>          <span class="s1">'3.3.7'</span>
<span class="n">gem</span> <span class="s1">'puma'</span><span class="p">,</span>                    <span class="s1">'3.9.1'</span>
<span class="n">gem</span> <span class="s1">'sass-rails'</span><span class="p">,</span>              <span class="s1">'5.0.6'</span>
<span class="n">gem</span> <span class="s1">'uglifier'</span><span class="p">,</span>                <span class="s1">'3.2.0'</span>
<span class="n">gem</span> <span class="s1">'coffee-rails'</span><span class="p">,</span>            <span class="s1">'4.2.2'</span>
<span class="n">gem</span> <span class="s1">'jquery-rails'</span><span class="p">,</span>            <span class="s1">'4.3.1'</span>
<span class="n">gem</span> <span class="s1">'turbolinks'</span><span class="p">,</span>              <span class="s1">'5.0.1'</span>
<span class="n">gem</span> <span class="s1">'jbuilder'</span><span class="p">,</span>                <span class="s1">'2.7.0'</span>

<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'sqlite3'</span><span class="p">,</span> <span class="s1">'1.3.13'</span>
  <span class="n">gem</span> <span class="s1">'byebug'</span><span class="p">,</span>  <span class="s1">'9.0.6'</span><span class="p">,</span> <span class="ss">platform</span><span class="p">:</span> <span class="ss">:mri</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'web-console'</span><span class="p">,</span>           <span class="s1">'3.5.1'</span>
  <span class="n">gem</span> <span class="s1">'listen'</span><span class="p">,</span>                <span class="s1">'3.1.5'</span>
  <span class="n">gem</span> <span class="s1">'spring'</span><span class="p">,</span>                <span class="s1">'2.0.2'</span>
  <span class="n">gem</span> <span class="s1">'spring-watcher-listen'</span><span class="p">,</span> <span class="s1">'2.0.1'</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rails-controller-testing'</span><span class="p">,</span> <span class="s1">'1.0.2'</span>
  <span class="n">gem</span> <span class="s1">'minitest'</span><span class="p">,</span>                 <span class="s1">'5.10.3'</span>
  <span class="n">gem</span> <span class="s1">'minitest-reporters'</span><span class="p">,</span>       <span class="s1">'1.1.14'</span>
  <span class="n">gem</span> <span class="s1">'guard'</span><span class="p">,</span>                    <span class="s1">'2.14.1'</span>
  <span class="n">gem</span> <span class="s1">'guard-minitest'</span><span class="p">,</span>           <span class="s1">'2.4.6'</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'pg'</span><span class="p">,</span>  <span class="s1">'0.20.0'</span>
  <span class="n">gem</span> <span class="s1">'fog'</span><span class="p">,</span> <span class="s1">'1.42'</span>
<span class="k">end</span>

<span class="c1"># Windows does not include zoneinfo files, so bundle the tzinfo-data gem</span>
<span class="n">gem</span> <span class="s1">'tzinfo-data'</span><span class="p">,</span> <span class="ss">platforms</span><span class="p">:</span> <span class="o">[</span><span class="ss">:mingw</span><span class="p">,</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:x64_mingw</span><span class="p">,</span> <span class="ss">:jruby</span><span class="o">]</span>
</pre></div></div>
</div>
</div></div></div></div>
<div class="j_sectionContent combined-sub-section" data-html="&lt;div id=&quot;sec-user_microposts_what_we_learned_in_this_chapter&quot; data-tralics-id=&quot;uid1763&quot; class=&quot;subsection&quot; data-number=&quot;13.5.1&quot;&gt;
&lt;h3&gt;&lt;a href=&quot;user_microposts_fragment.html#sec-user_microposts_what_we_learned_in_this_chapter&quot; class=&quot;heading hyperref&quot;&gt;&lt;span class=&quot;number&quot;&gt;13.5.1 &lt;/span&gt;What we learned in this chapter&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Microposts, like Users, are modeled as a resource backed by an Active Record model.
&lt;/li&gt;
&lt;li&gt;Rails supports multiple-key indices.
&lt;/li&gt;
&lt;li&gt;We can model a user having many microposts using the &lt;code&gt;has_many&lt;/code&gt; and &lt;code&gt;belongs_to&lt;/code&gt; methods in the User and Micropost models, respectively.
&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;has_many&lt;/code&gt;/&lt;code&gt;belongs_to&lt;/code&gt; combination gives rise to methods that work through the association.
&lt;/li&gt;
&lt;li&gt;The code &lt;code&gt;user.microposts.build(...)&lt;/code&gt;&lt;span class=&quot;intersentencespace&quot;&gt;&lt;/span&gt; returns a new Micropost object automatically associated with the given user.
&lt;/li&gt;
&lt;li&gt;Rails supports default ordering via &lt;code&gt;default_scope&lt;/code&gt;.
&lt;/li&gt;
&lt;li&gt;Scopes take anonymous functions as arguments.
&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;dependent: :destroy&lt;/code&gt; option causes objects to be destroyed at the same time as associated objects.
&lt;/li&gt;
&lt;li&gt;Pagination and object counts can both be performed through associations, leading to automatically efficient code.
&lt;/li&gt;
&lt;li&gt;Fixtures support the creation of associations.
&lt;/li&gt;
&lt;li&gt;It is possible to pass variables to Rails partials.
&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;where&lt;/code&gt; method can be used to perform Active Record selections.
&lt;/li&gt;
&lt;li&gt;We can enforce secure operations by always creating and destroying dependent objects through their association.
&lt;/li&gt;
&lt;li&gt;We can upload and resize images using CarrierWave.
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;" data-sub-section-id="854"><div><!--?xml version='1.0' encoding='UTF-8'?--><div class="book"><div id="sec-user_microposts_what_we_learned_in_this_chapter" data-tralics-id="uid1763" class="subsection" data-number="13.5.1">
<h3><a href="https://www.learnenough.com/ruby-on-rails-4th-edition-tutorial/user_microposts#sec-user_microposts_what_we_learned_in_this_chapter" class="heading hyperref"><span class="number">13.5.1 </span>What we learned in this chapter</a></h3>
<ul>
<li>Microposts, like Users, are modeled as a resource backed by an Active Record model.
</li>
<li>Rails supports multiple-key indices.
</li>
<li>We can model a user having many microposts using the <code>has_many</code> and <code>belongs_to</code> methods in the User and Micropost models, respectively.
</li>
<li>The <code>has_many</code>/<code>belongs_to</code> combination gives rise to methods that work through the association.
</li>
<li>The code <code>user.microposts.build(...)</code><span class="intersentencespace"></span> returns a new Micropost object automatically associated with the given user.
</li>
<li>Rails supports default ordering via <code>default_scope</code>.
</li>
<li>Scopes take anonymous functions as arguments.
</li>
<li>The <code>dependent: :destroy</code> option causes objects to be destroyed at the same time as associated objects.
</li>
<li>Pagination and object counts can both be performed through associations, leading to automatically efficient code.
</li>
<li>Fixtures support the creation of associations.
</li>
<li>It is possible to pass variables to Rails partials.
</li>
<li>The <code>where</code> method can be used to perform Active Record selections.
</li>
<li>We can enforce secure operations by always creating and destroying dependent objects through their association.
</li>
<li>We can upload and resize images using CarrierWave.
</li>
</ul>
</div></div></div></div>
</div>
</div>
<div id="exerciseAnswerTmpl" style="display:none">
<div class="j_exercise-answer">
<form action="https://www.learnenough.com/" class="j_exercise-answer-form" data-exercise-id="${exercise_id}" method="post">
<textarea name="text" rows="10">${answer_text}</textarea>
<div class="exercise-answer-edit">
<div class="exercise-answer-edit-controls">
<label class="fancyCheckLabel">
Share with other members
{{if make_public}}
<input checked="" id="make_public" name="make_public" type="checkbox">
{{else}}
<input id="make_public" name="make_public" type="checkbox">
{{/if}}
<label></label>
</label>
<a class="j_cancel" href="javascript:void(0)">
<button class="btn-small danger">Cancel</button>
</a>
<input class="btn-small" type="submit" value="save">
</div>
<div class="exercise-answer-edit-help">
Formatting:
<a target="_blank" href="https://help.github.com/articles/basic-writing-and-formatting-syntax/">Basic Help</a>
<a target="_blank" href="https://help.github.com/articles/creating-and-highlighting-code-blocks/">Advanced</a>
</div>
</div>
</form>
<div class="j_exercise-answer-text">
<h5>Your Answer</h5>
<div class="exercise-answer">{{html answer_html}}</div>
<div class="exercise-answer-actions">
{{if make_public}}
<span>PUBLIC</span>
{{/if}}
<a class="j_edit" href="javascript://">
<svg class="svg-inline--fa fa-edit fa-w-18" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="edit" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path></svg><!-- <i class="fas fa-edit"></i> -->
Edit Answer
</a>
<a href="https://www.learnenough.com/exercise_answers/$%7Btoken%7D">
<svg class="svg-inline--fa fa-link fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg><!-- <i class="fas fa-link"></i> -->
Link
</a>
</div>
</div>
<div class="exercise-answer-bar">
<a class="exercise-answer-all" href="https://www.learnenough.com/exercise_answers?book_id=216&amp;label=${exercise_id}" id="j_answer_public" style="display:{{if public_count == 0}}none{{/if}}">
<svg class="svg-inline--fa fa-users fa-w-20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="users" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path></svg><!-- <i class="fas fa-users"></i> -->
View all &nbsp;(
<span id="j_answer_public_count">${ public_count }</span>
)
</a>
<a class="j_exercise-answer-btn exercise-answer-add" href="javascript://">
<svg class="svg-inline--fa fa-plus fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="plus" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></svg><!-- <i class="fas fa-plus"></i> -->
Add Answer
</a>
</div>
</div>
</div>
<script>
  $(function(){
    Book.init({
      title: "Ruby on Rails Tutorial (Rails 5)",
      path: "",
      slug: "ruby-on-rails-4th-edition-tutorial",
      isCourse: true,
      customAnthologyDomain: false,
      singlePage: false,
      splitReadingSections: true,
      chapterPerPage: true,
      combineSubSections: true,
      hasSubscription: false,
      book_id: 216,
      location: {id:2026, type: "Chapter", path: "/ruby-on-rails-4th-edition-tutorial/user_microposts"},
      all_exercise_answer_view: false,
      chapter_id: 2026,
      labelLookup: {"sec-prerequisites":"beginning/introduction/prerequisites","sec-exercises_prerequisites":"beginning/introduction/prerequisites","ex-eae88d":"beginning/introduction/prerequisites","ex-2609a2":"beginning/introduction/prerequisites","ex-993750":"beginning/introduction/prerequisites","sec-conventions":"beginning/introduction/conventions","cha-1_footnote-ref-5":"beginning/introduction/conventions","sec-introduction":"beginning/introduction","sec-development_environment":"beginning/up_and_running/development_environment","cha-1_footnote-ref-6":"beginning/up_and_running/development_environment","fig-ide_anatomy":"beginning/up_and_running/development_environment","cha-1_footnote-ref-7":"beginning/up_and_running/development_environment","cha-1_footnote-ref-8":"beginning/up_and_running/development_environment","cha-1_footnote-ref-9":"beginning/up_and_running/development_environment","fig-cloud9_page_aws":"beginning/up_and_running/development_environment","fig-cloud9_new_workspace":"beginning/up_and_running/development_environment","fig-cloud9_ide_aws":"beginning/up_and_running/development_environment","fig-cloud9_two_spaces":"beginning/up_and_running/development_environment","sec-installing_rails":"beginning/up_and_running/installing_rails","cha-1_footnote-ref-10":"beginning/up_and_running/installing_rails","code-installing_rails":"beginning/up_and_running/installing_rails","sec-up_and_running":"beginning/up_and_running","sec-bundler":"beginning/the_hello_application/bundler","cha-1_footnote-ref-12":"beginning/the_hello_application/bundler","fig-cloud9_gemfile":"beginning/the_hello_application/bundler","code-default_gemfile":"beginning/the_hello_application/bundler","cha-1_footnote-ref-13":"beginning/the_hello_application/bundler","code-gemfile_sqlite_version":"beginning/the_hello_application/bundler","cha-1_footnote-ref-14":"beginning/the_hello_application/bundler","sec-rails_server":"beginning/the_hello_application/rails_server","code-local_server":"beginning/the_hello_application/rails_server","cha-1_footnote-ref-15":"beginning/the_hello_application/rails_server","fig-new_terminal_tab":"beginning/the_hello_application/rails_server","fig-rails_server_new_tab":"beginning/the_hello_application/rails_server","fig-share_workspace":"beginning/the_hello_application/rails_server","fig-full_browser_window_aws":"beginning/the_hello_application/rails_server","fig-riding_rails":"beginning/the_hello_application/rails_server","sec-exercises_rails_server":"beginning/the_hello_application/rails_server","ex-0b5e80":"beginning/the_hello_application/rails_server","ex-3be2f0":"beginning/the_hello_application/rails_server","sec-mvc":"beginning/the_hello_application/mvc","fig-MVC":"beginning/the_hello_application/mvc","sec-hello_world":"beginning/the_hello_application/hello_world","code-hello_action":"beginning/the_hello_application/hello_world","code-default_root_route":"beginning/the_hello_application/hello_world","code-hello_root_route":"beginning/the_hello_application/hello_world","cha-1_footnote-ref-16":"beginning/the_hello_application/hello_world","fig-hello_world_hello_app":"beginning/the_hello_application/hello_world","sec-exercises_hello_world":"beginning/the_hello_application/hello_world","ex-4587e4":"beginning/the_hello_application/hello_world","cha-1_footnote-ref-17":"beginning/the_hello_application/hello_world","ex-519a95":"beginning/the_hello_application/hello_world","ex-ce3907":"beginning/the_hello_application/hello_world","fig-hola_mundo":"beginning/the_hello_application/hello_world","fig-goodbye_world":"beginning/the_hello_application/hello_world","sec-the_hello_application":"beginning/the_hello_application","code-mkdir_rails_projects":"beginning/the_hello_application","aside-unix_commands":"beginning/the_hello_application","cha-1_footnote-ref-11":"beginning/the_hello_application","table-unix_commands":"beginning/the_hello_application","code-rails_command":"beginning/the_hello_application","fig-directory_structure_rails":"beginning/the_hello_application","table-rails_directory_structure":"beginning/the_hello_application","sec-git_setup":"beginning/version_control/git_setup","uid93":"beginning/version_control/git_setup","sec-first_time_setup":"beginning/version_control/git_setup","cha-1_footnote-ref-19":"beginning/version_control/git_setup","sec-what_good_does_git_do_you":"beginning/version_control/what_good_does_git_do_you","sec-bitbucket":"beginning/version_control/bitbucket","aside-github_bitbucket":"beginning/version_control/bitbucket","code-cat_public_key":"beginning/version_control/bitbucket","fig-add_public_key":"beginning/version_control/bitbucket","fig-create_first_repository":"beginning/version_control/bitbucket","fig-add_repository":"beginning/version_control/bitbucket","code-bitbucket_add_push":"beginning/version_control/bitbucket","cha-1_footnote-ref-20":"beginning/version_control/bitbucket","fig-bitbucket_repository_page":"beginning/version_control/bitbucket","sec-git_commands":"beginning/version_control/git_commands","cha-1_footnote-ref-21":"beginning/version_control/git_commands","cha-1_footnote-ref-22":"beginning/version_control/git_commands","fig-bitbucket_default_readme":"beginning/version_control/git_commands","sec-git_branch":"beginning/version_control/git_commands","cha-1_footnote-ref-23":"beginning/version_control/git_commands","sec-git_edit":"beginning/version_control/git_commands","code-new_readme":"beginning/version_control/git_commands","sec-git_commit":"beginning/version_control/git_commands","sec-git_merge":"beginning/version_control/git_commands","sec-git_push":"beginning/version_control/git_commands","fig-new_readme":"beginning/version_control/git_commands","sec-version_control":"beginning/version_control","cha-1_footnote-ref-18":"beginning/version_control","sec-heroku_setup":"beginning/deploying/heroku_setup","cha-1_footnote-ref-26":"beginning/deploying/heroku_setup","code-gemfile_pg_gem":"beginning/deploying/heroku_setup","code-bundle_without_production":"beginning/deploying/heroku_setup","cha-1_footnote-ref-27":"beginning/deploying/heroku_setup","code-heroku_setup":"beginning/deploying/heroku_setup","code-heroku_create":"beginning/deploying/heroku_setup","sec-heroku_step_one":"beginning/deploying/heroku_step_one","sec-heroku_step_two":"beginning/deploying/heroku_step_two","fig-heroku_app":"beginning/deploying/heroku_step_two","sec-exercises_heroku_step_two":"beginning/deploying/heroku_step_two","ex-cc4619":"beginning/deploying/heroku_step_two","ex-ff46d4":"beginning/deploying/heroku_step_two","sec-heroku_commands":"beginning/deploying/heroku_commands","cha-1_footnote-ref-28":"beginning/deploying/heroku_commands","cha-1_footnote-ref-29":"beginning/deploying/heroku_commands","sec-exercises_heroku_commands":"beginning/deploying/heroku_commands","ex-c8f6af":"beginning/deploying/heroku_commands","ex-c50fa6":"beginning/deploying/heroku_commands","sec-deploying":"beginning/deploying","cha-1_footnote-ref-24":"beginning/deploying","cha-1_footnote-ref-25":"beginning/deploying","sec-beginning_what_we_learned_in_this_chapter":"beginning/beginning_conclusion/beginning_what_we_learned_in_this_chapter","sec-beginning_conclusion":"beginning/beginning_conclusion","cha-1_footnote-ref-30":"beginning/beginning_conclusion","":"following_users","cha-beginning":"beginning","cha-1_footnote-ref-1":"beginning","cha-1_footnote-ref-2":"beginning","aside-technical_sophistication":"beginning","cha-1_footnote-ref-3":"beginning","cha-1_footnote-ref-4":"beginning","aside-scaffolding":"beginning","cha-1_footnotes":"beginning","cha-1_footnote-1":"beginning","cha-1_footnote-2":"beginning","cha-1_footnote-3":"beginning","cha-1_footnote-4":"beginning","cha-1_footnote-5":"beginning","cha-1_footnote-6":"beginning","cha-1_footnote-7":"beginning","cha-1_footnote-8":"beginning","cha-1_footnote-9":"beginning","cha-1_footnote-10":"beginning","cha-1_footnote-11":"beginning","cha-1_footnote-12":"beginning","cha-1_footnote-13":"beginning","cha-1_footnote-14":"beginning","cha-1_footnote-15":"beginning","cha-1_footnote-16":"beginning","cha-1_footnote-17":"beginning","cha-1_footnote-18":"beginning","cha-1_footnote-19":"beginning","cha-1_footnote-20":"beginning","cha-1_footnote-21":"beginning","cha-1_footnote-22":"beginning","cha-1_footnote-23":"beginning","cha-1_footnote-24":"beginning","cha-1_footnote-25":"beginning","cha-1_footnote-26":"beginning","cha-1_footnote-27":"beginning","cha-1_footnote-28":"beginning","cha-1_footnote-29":"beginning","cha-1_footnote-30":"beginning","sec-modeling_demo_users":"toy_app/planning_the_application/modeling_demo_users","fig-demo_user_model":"toy_app/planning_the_application/modeling_demo_users","sec-modeling_demo_microposts":"toy_app/planning_the_application/modeling_demo_microposts","cha-2_footnote-ref-1":"toy_app/planning_the_application/modeling_demo_microposts","fig-demo_micropost_model":"toy_app/planning_the_application/modeling_demo_microposts","sec-planning_the_application":"toy_app/planning_the_application","code-demo_gemfile_sqlite_version_redux":"toy_app/planning_the_application","fig-create_demo_repository":"toy_app/planning_the_application","code-hello_action_redux":"toy_app/planning_the_application","code-hello_root_route_redux":"toy_app/planning_the_application","sec-a_user_tour":"toy_app/demo_users_resource/a_user_tour","table-user_urls":"toy_app/demo_users_resource/a_user_tour","fig-demo_blank_user_index_rails_3":"toy_app/demo_users_resource/a_user_tour","fig-demo_new_user_rails_3":"toy_app/demo_users_resource/a_user_tour","fig-demo_show_user_rails_3":"toy_app/demo_users_resource/a_user_tour","fig-demo_edit_user_rails_3":"toy_app/demo_users_resource/a_user_tour","fig-demo_update_user_rails_3":"toy_app/demo_users_resource/a_user_tour","fig-demo_user_index_two_rails_3":"toy_app/demo_users_resource/a_user_tour","fig-demo_destroy_user":"toy_app/demo_users_resource/a_user_tour","sec-exercises_a_user_tour":"toy_app/demo_users_resource/a_user_tour","ex-2ab034":"toy_app/demo_users_resource/a_user_tour","ex-ec690f":"toy_app/demo_users_resource/a_user_tour","ex-6accd1":"toy_app/demo_users_resource/a_user_tour","ex-abc7bd":"toy_app/demo_users_resource/a_user_tour","sec-mvc_in_action":"toy_app/demo_users_resource/mvc_in_action","fig-mvc_detailed":"toy_app/demo_users_resource/mvc_in_action","cha-2_footnote-ref-3":"toy_app/demo_users_resource/mvc_in_action","code-rails_routes":"toy_app/demo_users_resource/mvc_in_action","code-rails_routes_root_route":"toy_app/demo_users_resource/mvc_in_action","code-demo_users_controller":"toy_app/demo_users_resource/mvc_in_action","cha-2_footnote-ref-4":"toy_app/demo_users_resource/mvc_in_action","table-demo_RESTful_users":"toy_app/demo_users_resource/mvc_in_action","aside-REST":"toy_app/demo_users_resource/mvc_in_action","code-demo_index_action":"toy_app/demo_users_resource/mvc_in_action","code-demo_user_model":"toy_app/demo_users_resource/mvc_in_action","code-demo_index_view":"toy_app/demo_users_resource/mvc_in_action","sec-exercises_mvc_in_action":"toy_app/demo_users_resource/mvc_in_action","ex-6ddbca":"toy_app/demo_users_resource/mvc_in_action","ex-2ab482":"toy_app/demo_users_resource/mvc_in_action","ex-d9449a":"toy_app/demo_users_resource/mvc_in_action","sec-weaknesses_of_this_users_resource":"toy_app/demo_users_resource/weaknesses_of_this_users_resource","sec-demo_users_resource":"toy_app/demo_users_resource","cha-2_footnote-ref-2":"toy_app/demo_users_resource","code-first_migration":"toy_app/demo_users_resource","aside-rake":"toy_app/demo_users_resource","sec-a_micropost_microtour":"toy_app/microposts_resource/a_micropost_microtour","cha-2_footnote-ref-5":"toy_app/microposts_resource/a_micropost_microtour","cha-2_footnote-ref-6":"toy_app/microposts_resource/a_micropost_microtour","code-demo_microposts_resource":"toy_app/microposts_resource/a_micropost_microtour","table-demo_RESTful_microposts":"toy_app/microposts_resource/a_micropost_microtour","code-demo_microposts_controller":"toy_app/microposts_resource/a_micropost_microtour","fig-demo_new_micropost":"toy_app/microposts_resource/a_micropost_microtour","fig-demo_micropost_index":"toy_app/microposts_resource/a_micropost_microtour","sec-exercises_a_micropost_microtour":"toy_app/microposts_resource/a_micropost_microtour","ex-4bdc33":"toy_app/microposts_resource/a_micropost_microtour","ex-f1eed6":"toy_app/microposts_resource/a_micropost_microtour","ex-df2990":"toy_app/microposts_resource/a_micropost_microtour","ex-afd85d":"toy_app/microposts_resource/a_micropost_microtour","sec-putting_the_micro_in_microposts":"toy_app/microposts_resource/putting_the_micro_in_microposts","code-demo_length_validation":"toy_app/microposts_resource/putting_the_micro_in_microposts","fig-micropost_length_error":"toy_app/microposts_resource/putting_the_micro_in_microposts","sec-exercises_putting_the_micro_in_microposts":"toy_app/microposts_resource/putting_the_micro_in_microposts","ex-c44144":"toy_app/microposts_resource/putting_the_micro_in_microposts","ex-c125dc":"toy_app/microposts_resource/putting_the_micro_in_microposts","sec-demo_user_has_many_microposts":"toy_app/microposts_resource/demo_user_has_many_microposts","code-demo_user_has_many_microposts":"toy_app/microposts_resource/demo_user_has_many_microposts","code-demo_micropost_belongs_to_user":"toy_app/microposts_resource/demo_user_has_many_microposts","fig-micropost_user_association":"toy_app/microposts_resource/demo_user_has_many_microposts","cha-2_footnote-ref-7":"toy_app/microposts_resource/demo_user_has_many_microposts","cha-2_footnote-ref-8":"toy_app/microposts_resource/demo_user_has_many_microposts","sec-exercises_demo_user_has_many_microposts":"toy_app/microposts_resource/demo_user_has_many_microposts","ex-dd981f":"toy_app/microposts_resource/demo_user_has_many_microposts","ex-f69a36":"toy_app/microposts_resource/demo_user_has_many_microposts","ex-eabbb1":"toy_app/microposts_resource/demo_user_has_many_microposts","code-validates_content_presence":"toy_app/microposts_resource/demo_user_has_many_microposts","fig-micropost_content_cant_be_blank":"toy_app/microposts_resource/demo_user_has_many_microposts","code-toy_user_presence_valications":"toy_app/microposts_resource/demo_user_has_many_microposts","fig-user_presence_validations":"toy_app/microposts_resource/demo_user_has_many_microposts","sec-inheritance_hierarchies":"toy_app/microposts_resource/inheritance_hierarchies","code-demo_user_class":"toy_app/microposts_resource/inheritance_hierarchies","code-demo_micropost_class":"toy_app/microposts_resource/inheritance_hierarchies","fig-demo_model_inheritance":"toy_app/microposts_resource/inheritance_hierarchies","code-demo_users_controller_class":"toy_app/microposts_resource/inheritance_hierarchies","code-demo_microposts_controller_class":"toy_app/microposts_resource/inheritance_hierarchies","code-toy_application_controller_class":"toy_app/microposts_resource/inheritance_hierarchies","fig-demo_controller_inheritance":"toy_app/microposts_resource/inheritance_hierarchies","sec-exercises_inheritance_hierarchies":"toy_app/microposts_resource/inheritance_hierarchies","ex-c8ba88":"toy_app/microposts_resource/inheritance_hierarchies","ex-dec71b":"toy_app/microposts_resource/inheritance_hierarchies","sec-deploying_the_toy_app":"toy_app/microposts_resource/deploying_the_toy_app","cha-2_footnote-ref-9":"toy_app/microposts_resource/deploying_the_toy_app","fig-toy_app_production":"toy_app/microposts_resource/deploying_the_toy_app","sec-exercises_deploying_the_toy_app":"toy_app/microposts_resource/deploying_the_toy_app","ex-f84295":"toy_app/microposts_resource/deploying_the_toy_app","ex-916144":"toy_app/microposts_resource/deploying_the_toy_app","ex-debcc6":"toy_app/microposts_resource/deploying_the_toy_app","sec-microposts_resource":"toy_app/microposts_resource","sec-toy_app_what_we_learned_in_this_chapter":"toy_app/toy_app_conclusion/toy_app_what_we_learned_in_this_chapter","sec-toy_app_conclusion":"toy_app/toy_app_conclusion","cha-a_toy_app":"toy_app","cha-2_footnotes":"toy_app","cha-2_footnote-1":"toy_app","cha-2_footnote-2":"toy_app","cha-2_footnote-3":"toy_app","cha-2_footnote-4":"toy_app","cha-2_footnote-5":"toy_app","cha-2_footnote-6":"toy_app","cha-2_footnote-7":"toy_app","cha-2_footnote-8":"toy_app","cha-2_footnote-9":"toy_app","sec-sample_app_setup":"static_pages/sample_app_setup","cha-3_footnote-ref-1":"static_pages/sample_app_setup","code-rails_new_sample_app":"static_pages/sample_app_setup","cha-3_footnote-ref-2":"static_pages/sample_app_setup","code-gemfile_sample_app":"static_pages/sample_app_setup","cha-3_footnote-ref-3":"static_pages/sample_app_setup","cha-3_footnote-ref-4":"static_pages/sample_app_setup","cha-3_footnote-ref-5":"static_pages/sample_app_setup","code-sample_app_readme":"static_pages/sample_app_setup","code-hello_action_redux_2":"static_pages/sample_app_setup","code-hello_root_route_redux_2":"static_pages/sample_app_setup","sec-exercises_sample_app_setup":"static_pages/sample_app_setup","ex-c2317d":"static_pages/sample_app_setup","ex-6a49d9":"static_pages/sample_app_setup","sec-generated_static_pages":"static_pages/static_pages/generated_static_pages","code-generating_pages":"static_pages/static_pages/generated_static_pages","cha-3_footnote-ref-7":"static_pages/static_pages/generated_static_pages","table-shortcuts":"static_pages/static_pages/generated_static_pages","aside-undoing_things":"static_pages/static_pages/generated_static_pages","fig-config_directory_rails":"static_pages/static_pages/generated_static_pages","code-pages_routes":"static_pages/static_pages/generated_static_pages","fig-raw_home_view":"static_pages/static_pages/generated_static_pages","aside-get_etc":"static_pages/static_pages/generated_static_pages","code-static_pages_controller":"static_pages/static_pages/generated_static_pages","code-raw_home_view":"static_pages/static_pages/generated_static_pages","code-raw_help_view":"static_pages/static_pages/generated_static_pages","sec-exercises_generated_static_pages":"static_pages/static_pages/generated_static_pages","ex-ef4a1d":"static_pages/static_pages/generated_static_pages","ex-b6b114":"static_pages/static_pages/generated_static_pages","sec-custom_static_pages":"static_pages/static_pages/custom_static_pages","code-custom_home_page":"static_pages/static_pages/custom_static_pages","code-custom_help_page":"static_pages/static_pages/custom_static_pages","fig-custom_home_page":"static_pages/static_pages/custom_static_pages","fig-custom_help_page":"static_pages/static_pages/custom_static_pages","sec-static_pages":"static_pages/static_pages","cha-3_footnote-ref-6":"static_pages/static_pages","sec-our_first_test":"static_pages/getting_started_with_testing/our_first_test","code-default_controller_test":"static_pages/getting_started_with_testing/our_first_test","uid328":"static_pages/getting_started_with_testing/our_first_test","sec-red":"static_pages/getting_started_with_testing/red","cha-3_footnote-ref-9":"static_pages/getting_started_with_testing/red","code-about_test":"static_pages/getting_started_with_testing/red","uid332":"static_pages/getting_started_with_testing/red","sec-green":"static_pages/getting_started_with_testing/green","uid334":"static_pages/getting_started_with_testing/green","code-about_route":"static_pages/getting_started_with_testing/green","uid336":"static_pages/getting_started_with_testing/green","code-adding_the_about_page":"static_pages/getting_started_with_testing/green","code-custom_about_page":"static_pages/getting_started_with_testing/green","uid339":"static_pages/getting_started_with_testing/green","fig-about_us":"static_pages/getting_started_with_testing/green","sec-refactor":"static_pages/getting_started_with_testing/refactor","sec-getting_started_with_testing":"static_pages/getting_started_with_testing","cha-3_footnote-ref-8":"static_pages/getting_started_with_testing","aside-when_to_test":"static_pages/getting_started_with_testing","sec-testing_titles":"static_pages/slightly_dynamic_pages/testing_titles","code-html_structure":"static_pages/slightly_dynamic_pages/testing_titles","cha-3_footnote-ref-10":"static_pages/slightly_dynamic_pages/testing_titles","cha-3_footnote-ref-11":"static_pages/slightly_dynamic_pages/testing_titles","code-title_tests":"static_pages/slightly_dynamic_pages/testing_titles","uid348":"static_pages/slightly_dynamic_pages/testing_titles","sec-adding_page_titles":"static_pages/slightly_dynamic_pages/adding_page_titles","code-home_view_full_html":"static_pages/slightly_dynamic_pages/adding_page_titles","cha-3_footnote-ref-12":"static_pages/slightly_dynamic_pages/adding_page_titles","fig-home_view_full_html":"static_pages/slightly_dynamic_pages/adding_page_titles","code-help_view_full_html":"static_pages/slightly_dynamic_pages/adding_page_titles","code-about_view_full_html":"static_pages/slightly_dynamic_pages/adding_page_titles","uid355":"static_pages/slightly_dynamic_pages/adding_page_titles","sec-exercises_adding_page_titles":"static_pages/slightly_dynamic_pages/adding_page_titles","ex-aa6d2c":"static_pages/slightly_dynamic_pages/adding_page_titles","code-base_title_test":"static_pages/slightly_dynamic_pages/adding_page_titles","sec-layouts_and_embedded_ruby":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-home_view_erb_title":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","cha-3_footnote-ref-13":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","cha-3_footnote-ref-14":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","cha-3_footnote-ref-15":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","uid367":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-help_view_erb_title":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-about_view_erb_title":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-application_layout":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-home_view_interior":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-help_view_interior":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-about_view_interior":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","uid374":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","sec-exercises_layouts_and_embedded_ruby":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","cha-3_footnote-ref-16":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","ex-1ce145":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","code-proposed_contact_page":"static_pages/slightly_dynamic_pages/layouts_and_embedded_ruby","sec-setting_the_root_route":"static_pages/slightly_dynamic_pages/setting_the_root_route","code-home_root_route":"static_pages/slightly_dynamic_pages/setting_the_root_route","fig-home_root_route":"static_pages/slightly_dynamic_pages/setting_the_root_route","sec-exercises_setting_the_root_route":"static_pages/slightly_dynamic_pages/setting_the_root_route","ex-daa97c":"static_pages/slightly_dynamic_pages/setting_the_root_route","ex-87bd31":"static_pages/slightly_dynamic_pages/setting_the_root_route","code-root_test":"static_pages/slightly_dynamic_pages/setting_the_root_route","code-home_root_route_commented_out":"static_pages/slightly_dynamic_pages/setting_the_root_route","sec-slightly_dynamic_pages":"static_pages/slightly_dynamic_pages","table-static_pages":"static_pages/slightly_dynamic_pages","sec-static_pages_what_we_learned_in_this_chapter":"static_pages/static_pages_conclusion/static_pages_what_we_learned_in_this_chapter","sec-static_pages_conclusion":"static_pages/static_pages_conclusion","cha-3_footnote-ref-17":"static_pages/static_pages_conclusion","sec-minitest_reporters":"static_pages/advanced_testing_setup/minitest_reporters","cha-3_footnote-ref-18":"static_pages/advanced_testing_setup/minitest_reporters","code-minitest_reporters":"static_pages/advanced_testing_setup/minitest_reporters","cha-3_footnote-ref-19":"static_pages/advanced_testing_setup/minitest_reporters","fig-red_to_green":"static_pages/advanced_testing_setup/minitest_reporters","sec-guard":"static_pages/advanced_testing_setup/guard","code-guardfile":"static_pages/advanced_testing_setup/guard","fig-file_navigator_gear_icon":"static_pages/advanced_testing_setup/guard","fig-show_hidden_files":"static_pages/advanced_testing_setup/guard","fig-gitignore":"static_pages/advanced_testing_setup/guard","code-gitignore_spring":"static_pages/advanced_testing_setup/guard","aside-processes":"static_pages/advanced_testing_setup/guard","sec-advanced_testing_setup":"static_pages/advanced_testing_setup","cha-static_pages":"static_pages","cha-3_footnotes":"static_pages","cha-3_footnote-1":"static_pages","cha-3_footnote-2":"static_pages","cha-3_footnote-3":"static_pages","cha-3_footnote-4":"static_pages","cha-3_footnote-5":"static_pages","cha-3_footnote-6":"static_pages","cha-3_footnote-7":"static_pages","cha-3_footnote-8":"static_pages","cha-3_footnote-9":"static_pages","cha-3_footnote-10":"static_pages","cha-3_footnote-11":"static_pages","cha-3_footnote-12":"static_pages","cha-3_footnote-13":"static_pages","cha-3_footnote-14":"static_pages","cha-3_footnote-15":"static_pages","cha-3_footnote-16":"static_pages","cha-3_footnote-17":"static_pages","cha-3_footnote-18":"static_pages","cha-3_footnote-19":"static_pages","sec-built_in_helpers":"rails_flavored_ruby/motivation/built_in_helpers","code-application_layout_redux":"rails_flavored_ruby/motivation/built_in_helpers","sec-custom_helpers":"rails_flavored_ruby/motivation/custom_helpers","cha-4_footnote-ref-1":"rails_flavored_ruby/motivation/custom_helpers","code-title_helper":"rails_flavored_ruby/motivation/custom_helpers","code-application_layout_full_title":"rails_flavored_ruby/motivation/custom_helpers","code-home_base_title_spec":"rails_flavored_ruby/motivation/custom_helpers","uid419":"rails_flavored_ruby/motivation/custom_helpers","code-home_page_base_title":"rails_flavored_ruby/motivation/custom_helpers","uid421":"rails_flavored_ruby/motivation/custom_helpers","sec-motivation":"rails_flavored_ruby/motivation","sec-comments":"rails_flavored_ruby/strings_and_methods/comments","sec-strings":"rails_flavored_ruby/strings_and_methods/strings","cha-4_footnote-ref-3":"rails_flavored_ruby/strings_and_methods/strings","cha-4_footnote-ref-4":"rails_flavored_ruby/strings_and_methods/strings","sec-printing":"rails_flavored_ruby/strings_and_methods/strings","sec-single_quoted_strings":"rails_flavored_ruby/strings_and_methods/strings","sec-exercises_strings":"rails_flavored_ruby/strings_and_methods/strings","ex-e3580c":"rails_flavored_ruby/strings_and_methods/strings","ex-768a74":"rails_flavored_ruby/strings_and_methods/strings","ex-54fc65":"rails_flavored_ruby/strings_and_methods/strings","ex-4820a5":"rails_flavored_ruby/strings_and_methods/strings","sec-objects_and_message_passing":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","cha-4_footnote-ref-5":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","sec-exercises_objects_and_message_passing":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","ex-4b8ae6":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","ex-fac1aa":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","ex-fd9e11":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","ex-519870":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","code-palindrome_if":"rails_flavored_ruby/strings_and_methods/objects_and_message_passing","sec-method_definitions":"rails_flavored_ruby/strings_and_methods/method_definitions","sec-exercises_method_definitions":"rails_flavored_ruby/strings_and_methods/method_definitions","ex-fad1fc":"rails_flavored_ruby/strings_and_methods/method_definitions","ex-2a365f":"rails_flavored_ruby/strings_and_methods/method_definitions","ex-5f2dec":"rails_flavored_ruby/strings_and_methods/method_definitions","code-palindrome_tester":"rails_flavored_ruby/strings_and_methods/method_definitions","sec-back_to_the_title_helper":"rails_flavored_ruby/strings_and_methods/back_to_the_title_helper","cha-4_footnote-ref-6":"rails_flavored_ruby/strings_and_methods/back_to_the_title_helper","code-annotated_title_helper":"rails_flavored_ruby/strings_and_methods/back_to_the_title_helper","cha-4_footnote-ref-7":"rails_flavored_ruby/strings_and_methods/back_to_the_title_helper","sec-strings_and_methods":"rails_flavored_ruby/strings_and_methods","cha-4_footnote-ref-2":"rails_flavored_ruby/strings_and_methods","code-irbrc":"rails_flavored_ruby/strings_and_methods","sec-arrays_and_ranges":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","cha-4_footnote-ref-8":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","sec-exercises_arrays_and_ranges":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","ex-d7f88d":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","ex-a85482":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","ex-e14ce5":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","ex-5e13ce":"rails_flavored_ruby/other_data_structures/arrays_and_ranges","sec-blocks":"rails_flavored_ruby/other_data_structures/blocks","cha-4_footnote-ref-9":"rails_flavored_ruby/other_data_structures/blocks","cha-4_footnote-ref-10":"rails_flavored_ruby/other_data_structures/blocks","sec-exercises_blocks":"rails_flavored_ruby/other_data_structures/blocks","ex-3f7a43":"rails_flavored_ruby/other_data_structures/blocks","ex-cb435f":"rails_flavored_ruby/other_data_structures/blocks","ex-3efef5":"rails_flavored_ruby/other_data_structures/blocks","ex-c4a6ed":"rails_flavored_ruby/other_data_structures/blocks","code-string_shuffle":"rails_flavored_ruby/other_data_structures/blocks","sec-hashes_and_symbols":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","cha-4_footnote-ref-11":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","cha-4_footnote-ref-12":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","code-nested_hashes":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","cha-4_footnote-ref-13":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","sec-exercises_hashes_and_symbols":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","ex-82a576":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","ex-bccfac":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","ex-b7241e":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","ex-bc0dd6":"rails_flavored_ruby/other_data_structures/hashes_and_symbols","sec-css_revisited":"rails_flavored_ruby/other_data_structures/css_revisited","cha-4_footnote-ref-14":"rails_flavored_ruby/other_data_structures/css_revisited","cha-4_footnote-ref-15":"rails_flavored_ruby/other_data_structures/css_revisited","code-scss_source":"rails_flavored_ruby/other_data_structures/css_revisited","sec-other_data_structures":"rails_flavored_ruby/other_data_structures","sec-constructors":"rails_flavored_ruby/ruby_classes/constructors","cha-4_footnote-ref-16":"rails_flavored_ruby/ruby_classes/constructors","sec-exercises_constructors":"rails_flavored_ruby/ruby_classes/constructors","ex-f6e2b3":"rails_flavored_ruby/ruby_classes/constructors","ex-73158e":"rails_flavored_ruby/ruby_classes/constructors","ex-4d8c3d":"rails_flavored_ruby/ruby_classes/constructors","sec-a_class_of_our_own":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","fig-string_inheritance_ruby_1_9":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","code-word_class":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","fig-word_inheritance_ruby_1_9":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","cha-4_footnote-ref-17":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","sec-exercises_a_class_of_our_own":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","ex-fcc2a5":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","ex-a30be5":"rails_flavored_ruby/ruby_classes/a_class_of_our_own","sec-modifying_built_in_classes":"rails_flavored_ruby/ruby_classes/modifying_built_in_classes","sec-exercises_modifying_built_in_classes":"rails_flavored_ruby/ruby_classes/modifying_built_in_classes","ex-090d04":"rails_flavored_ruby/ruby_classes/modifying_built_in_classes","ex-a751c8":"rails_flavored_ruby/ruby_classes/modifying_built_in_classes","ex-ee6b0d":"rails_flavored_ruby/ruby_classes/modifying_built_in_classes","code-string_shuffle_two":"rails_flavored_ruby/ruby_classes/modifying_built_in_classes","sec-a_controller_class":"rails_flavored_ruby/ruby_classes/a_controller_class","cha-4_footnote-ref-18":"rails_flavored_ruby/ruby_classes/a_controller_class","fig-static_pages_controller_inheritance":"rails_flavored_ruby/ruby_classes/a_controller_class","sec-exercises_a_controller_class":"rails_flavored_ruby/ruby_classes/a_controller_class","ex-c36562":"rails_flavored_ruby/ruby_classes/a_controller_class","ex-f1ad79":"rails_flavored_ruby/ruby_classes/a_controller_class","sec-a_user_class":"rails_flavored_ruby/ruby_classes/a_user_class","code-example_user":"rails_flavored_ruby/ruby_classes/a_user_class","sec-exercises_a_user_object":"rails_flavored_ruby/ruby_classes/a_user_class","ex-0249e7":"rails_flavored_ruby/ruby_classes/a_user_class","ex-1e3f00":"rails_flavored_ruby/ruby_classes/a_user_class","ex-04e9b1":"rails_flavored_ruby/ruby_classes/a_user_class","sec-ruby_classes":"rails_flavored_ruby/ruby_classes","sec-rails_flavored_ruby_what_we_learned_in_this_chapter":"rails_flavored_ruby/conclusion/rails_flavored_ruby_what_we_learned_in_this_chapter","sec-conclusion":"rails_flavored_ruby/conclusion","cha-rails_flavored_ruby":"rails_flavored_ruby","cha-4_footnotes":"rails_flavored_ruby","cha-4_footnote-1":"rails_flavored_ruby","cha-4_footnote-2":"rails_flavored_ruby","cha-4_footnote-3":"rails_flavored_ruby","cha-4_footnote-4":"rails_flavored_ruby","cha-4_footnote-5":"rails_flavored_ruby","cha-4_footnote-6":"rails_flavored_ruby","cha-4_footnote-7":"rails_flavored_ruby","cha-4_footnote-8":"rails_flavored_ruby","cha-4_footnote-9":"rails_flavored_ruby","cha-4_footnote-10":"rails_flavored_ruby","cha-4_footnote-11":"rails_flavored_ruby","cha-4_footnote-12":"rails_flavored_ruby","cha-4_footnote-13":"rails_flavored_ruby","cha-4_footnote-14":"rails_flavored_ruby","cha-4_footnote-15":"rails_flavored_ruby","cha-4_footnote-16":"rails_flavored_ruby","cha-4_footnote-17":"rails_flavored_ruby","cha-4_footnote-18":"rails_flavored_ruby","sec-adding_to_the_layout":"filling_in_the_layout/structure/adding_to_the_layout","code-layout_new_structure":"filling_in_the_layout/structure/adding_to_the_layout","cha-5_footnote-ref-3":"filling_in_the_layout/structure/adding_to_the_layout","cha-5_footnote-ref-4":"filling_in_the_layout/structure/adding_to_the_layout","cha-5_footnote-ref-5":"filling_in_the_layout/structure/adding_to_the_layout","code-signup_button":"filling_in_the_layout/structure/adding_to_the_layout","cha-5_footnote-ref-6":"filling_in_the_layout/structure/adding_to_the_layout","code-curl_rails_png":"filling_in_the_layout/structure/adding_to_the_layout","fig-layout_no_logo_or_custom_css":"filling_in_the_layout/structure/adding_to_the_layout","cha-5_footnote-ref-7":"filling_in_the_layout/structure/adding_to_the_layout","sec-exercises_adding_to_the_layout":"filling_in_the_layout/structure/adding_to_the_layout","cha-5_footnote-ref-8":"filling_in_the_layout/structure/adding_to_the_layout","ex-7a67af":"filling_in_the_layout/structure/adding_to_the_layout","ex-66f85b":"filling_in_the_layout/structure/adding_to_the_layout","ex-591749":"filling_in_the_layout/structure/adding_to_the_layout","fig-kitten":"filling_in_the_layout/structure/adding_to_the_layout","code-downloading_a_cat_pic":"filling_in_the_layout/structure/adding_to_the_layout","fig-kitten_on_home":"filling_in_the_layout/structure/adding_to_the_layout","sec-custom_css":"filling_in_the_layout/structure/custom_css","cha-5_footnote-ref-9":"filling_in_the_layout/structure/custom_css","cha-5_footnote-ref-10":"filling_in_the_layout/structure/custom_css","code-bootstrap_sass":"filling_in_the_layout/structure/custom_css","cha-5_footnote-ref-11":"filling_in_the_layout/structure/custom_css","code-bootstrap_css":"filling_in_the_layout/structure/custom_css","fig-sample_app_only_bootstrap":"filling_in_the_layout/structure/custom_css","code-universal_css":"filling_in_the_layout/structure/custom_css","fig-sample_app_universal":"filling_in_the_layout/structure/custom_css","code-typography_css":"filling_in_the_layout/structure/custom_css","fig-sample_app_typography":"filling_in_the_layout/structure/custom_css","code-logo_css":"filling_in_the_layout/structure/custom_css","fig-sample_app_logo":"filling_in_the_layout/structure/custom_css","sec-exercises_custom_css":"filling_in_the_layout/structure/custom_css","ex-d7f8e1":"filling_in_the_layout/structure/custom_css","ex-b39c95":"filling_in_the_layout/structure/custom_css","code-comment_out_image":"filling_in_the_layout/structure/custom_css","code-css_hide_image":"filling_in_the_layout/structure/custom_css","sec-partials":"filling_in_the_layout/structure/partials","code-layout_with_partials":"filling_in_the_layout/structure/partials","cha-5_footnote-ref-12":"filling_in_the_layout/structure/partials","code-stylesheets_partial":"filling_in_the_layout/structure/partials","code-header_partial":"filling_in_the_layout/structure/partials","cha-5_footnote-ref-13":"filling_in_the_layout/structure/partials","code-footer_partial":"filling_in_the_layout/structure/partials","code-layout_with_footer":"filling_in_the_layout/structure/partials","code-footer_css":"filling_in_the_layout/structure/partials","fig-site_with_footer":"filling_in_the_layout/structure/partials","sec-exercises_partials":"filling_in_the_layout/structure/partials","ex-eecfad":"filling_in_the_layout/structure/partials","ex-d6d37e":"filling_in_the_layout/structure/partials","ex-e89622":"filling_in_the_layout/structure/partials","code-rails_default_head":"filling_in_the_layout/structure/partials","sec-structure":"filling_in_the_layout/structure","cha-5_footnote-ref-2":"filling_in_the_layout/structure","fig-home_page_mockup":"filling_in_the_layout/structure","sec-the_asset_pipeline":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","cha-5_footnote-ref-14":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","uid583":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","uid587":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","code-app_css_manifest":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","uid589":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","uid590":"filling_in_the_layout/sass_and_the_asset_pipeline/the_asset_pipeline","sec-sass":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","cha-5_footnote-ref-15":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","uid593":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","uid594":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","code-refactored_scss":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","sec-exercises_sass":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","ex-4f280d":"filling_in_the_layout/sass_and_the_asset_pipeline/sass","sec-sass_and_the_asset_pipeline":"filling_in_the_layout/sass_and_the_asset_pipeline","sec-contact_page":"filling_in_the_layout/layout_links/contact_page","code-contact_page_test":"filling_in_the_layout/layout_links/contact_page","uid601":"filling_in_the_layout/layout_links/contact_page","code-contact_route":"filling_in_the_layout/layout_links/contact_page","code-contact_action":"filling_in_the_layout/layout_links/contact_page","code-contact_view":"filling_in_the_layout/layout_links/contact_page","uid605":"filling_in_the_layout/layout_links/contact_page","sec-rails_routes":"filling_in_the_layout/layout_links/rails_routes","code-static_page_routes":"filling_in_the_layout/layout_links/rails_routes","code-static_page_routes_test":"filling_in_the_layout/layout_links/rails_routes","sec-exercises_rails_routes":"filling_in_the_layout/layout_links/rails_routes","ex-f886e4":"filling_in_the_layout/layout_links/rails_routes","ex-b73fff":"filling_in_the_layout/layout_links/rails_routes","ex-57ab71":"filling_in_the_layout/layout_links/rails_routes","code-helf":"filling_in_the_layout/layout_links/rails_routes","sec-named_routes":"filling_in_the_layout/layout_links/named_routes","code-header_partial_links":"filling_in_the_layout/layout_links/named_routes","code-footer_partial_links":"filling_in_the_layout/layout_links/named_routes","fig-about_page":"filling_in_the_layout/layout_links/named_routes","sec-exercises_named_routes":"filling_in_the_layout/layout_links/named_routes","ex-86ac09":"filling_in_the_layout/layout_links/named_routes","ex-98fcd3":"filling_in_the_layout/layout_links/named_routes","sec-layout_link_tests":"filling_in_the_layout/layout_links/layout_link_tests","cha-5_footnote-ref-16":"filling_in_the_layout/layout_links/layout_link_tests","code-layout_links_test":"filling_in_the_layout/layout_links/layout_link_tests","table-assert_select":"filling_in_the_layout/layout_links/layout_link_tests","uid628":"filling_in_the_layout/layout_links/layout_link_tests","uid629":"filling_in_the_layout/layout_links/layout_link_tests","sec-exercises_layout_link_tests":"filling_in_the_layout/layout_links/layout_link_tests","ex-454224":"filling_in_the_layout/layout_links/layout_link_tests","ex-cfa831":"filling_in_the_layout/layout_links/layout_link_tests","code-test_helper_application_helper":"filling_in_the_layout/layout_links/layout_link_tests","code-layout_links_test_signup_full_title_helper":"filling_in_the_layout/layout_links/layout_link_tests","code-full_title_helper_tests":"filling_in_the_layout/layout_links/layout_link_tests","sec-layout_links":"filling_in_the_layout/layout_links","table-url_mapping":"filling_in_the_layout/layout_links","sec-users_controller":"filling_in_the_layout/user_signup/users_controller","code-generate_users_controller":"filling_in_the_layout/user_signup/users_controller","code-initial_users_controller":"filling_in_the_layout/user_signup/users_controller","code-initial_new_action":"filling_in_the_layout/user_signup/users_controller","code-user_new_test":"filling_in_the_layout/user_signup/users_controller","uid641":"filling_in_the_layout/user_signup/users_controller","sec-exercises_users_controller":"filling_in_the_layout/user_signup/users_controller","ex-e30705":"filling_in_the_layout/user_signup/users_controller","ex-b87c82":"filling_in_the_layout/user_signup/users_controller","sec-signup_url":"filling_in_the_layout/user_signup/signup_url","code-signup_route":"filling_in_the_layout/user_signup/signup_url","code-users_controller_test_signup_route":"filling_in_the_layout/user_signup/signup_url","code-home_page_signup_link":"filling_in_the_layout/user_signup/signup_url","code-initial_signup_page":"filling_in_the_layout/user_signup/signup_url","fig-new_signup_page":"filling_in_the_layout/user_signup/signup_url","sec-exercises_signup_url":"filling_in_the_layout/user_signup/signup_url","ex-de47e5":"filling_in_the_layout/user_signup/signup_url","ex-cba29a":"filling_in_the_layout/user_signup/signup_url","ex-cb38fe":"filling_in_the_layout/user_signup/signup_url","sec-user_signup":"filling_in_the_layout/user_signup","sec-filling_in_the_layout_what_we_learned_in_this_chapter":"filling_in_the_layout/layout_conclusion/filling_in_the_layout_what_we_learned_in_this_chapter","sec-layout_conclusion":"filling_in_the_layout/layout_conclusion","fig-layout_production":"filling_in_the_layout/layout_conclusion","cha-filling_in_the_layout":"filling_in_the_layout","cha-5_footnote-ref-1":"filling_in_the_layout","cha-5_footnotes":"filling_in_the_layout","cha-5_footnote-1":"filling_in_the_layout","cha-5_footnote-2":"filling_in_the_layout","cha-5_footnote-3":"filling_in_the_layout","cha-5_footnote-4":"filling_in_the_layout","cha-5_footnote-5":"filling_in_the_layout","cha-5_footnote-6":"filling_in_the_layout","cha-5_footnote-7":"filling_in_the_layout","cha-5_footnote-8":"filling_in_the_layout","cha-5_footnote-9":"filling_in_the_layout","cha-5_footnote-10":"filling_in_the_layout","cha-5_footnote-11":"filling_in_the_layout","cha-5_footnote-12":"filling_in_the_layout","cha-5_footnote-13":"filling_in_the_layout","cha-5_footnote-14":"filling_in_the_layout","cha-5_footnote-15":"filling_in_the_layout","cha-5_footnote-16":"filling_in_the_layout","sec-database_migrations":"modeling_users/user_model/database_migrations","cha-6_footnote-ref-3":"modeling_users/user_model/database_migrations","fig-users_table":"modeling_users/user_model/database_migrations","fig-user_model_sketch":"modeling_users/user_model/database_migrations","code-generate_user_model":"modeling_users/user_model/database_migrations","code-users_migration":"modeling_users/user_model/database_migrations","cha-6_footnote-ref-4":"modeling_users/user_model/database_migrations","fig-user_model_initial":"modeling_users/user_model/database_migrations","cha-6_footnote-ref-5":"modeling_users/user_model/database_migrations","fig-sqlite_download":"modeling_users/user_model/database_migrations","fig-sqlite_database_browser":"modeling_users/user_model/database_migrations","sec-exercises_database_migrations":"modeling_users/user_model/database_migrations","ex-35a9f1":"modeling_users/user_model/database_migrations","ex-f4bec3":"modeling_users/user_model/database_migrations","ex-86400a":"modeling_users/user_model/database_migrations","sec-the_model_file":"modeling_users/user_model/the_model_file","code-raw_user_model":"modeling_users/user_model/the_model_file","sec-exercises_the_model_file":"modeling_users/user_model/the_model_file","ex-88f89c":"modeling_users/user_model/the_model_file","ex-45a954":"modeling_users/user_model/the_model_file","sec-creating_user_objects":"modeling_users/user_model/creating_user_objects","cha-6_footnote-ref-6":"modeling_users/user_model/creating_user_objects","cha-6_footnote-ref-7":"modeling_users/user_model/creating_user_objects","sec-exercises_creating_user_objects":"modeling_users/user_model/creating_user_objects","ex-ffd724":"modeling_users/user_model/creating_user_objects","ex-840d5b":"modeling_users/user_model/creating_user_objects","sec-finding_user_objects":"modeling_users/user_model/finding_user_objects","cha-6_footnote-ref-8":"modeling_users/user_model/finding_user_objects","sec-exercises_finding_user_objects":"modeling_users/user_model/finding_user_objects","ex-a37224":"modeling_users/user_model/finding_user_objects","ex-b3c50e":"modeling_users/user_model/finding_user_objects","ex-087c14":"modeling_users/user_model/finding_user_objects","sec-updating_user_objects":"modeling_users/user_model/updating_user_objects","cha-6_footnote-ref-9":"modeling_users/user_model/updating_user_objects","sec-exercises_updating_user_objects":"modeling_users/user_model/updating_user_objects","ex-aca2fa":"modeling_users/user_model/updating_user_objects","ex-dc4b1e":"modeling_users/user_model/updating_user_objects","ex-61f14b":"modeling_users/user_model/updating_user_objects","sec-user_model":"modeling_users/user_model","fig-signup_mockup_preview":"modeling_users/user_model","cha-6_footnote-ref-1":"modeling_users/user_model","cha-6_footnote-ref-2":"modeling_users/user_model","sec-a_validity_test":"modeling_users/user_validations/a_validity_test","code-default_user_test":"modeling_users/user_validations/a_validity_test","code-valid_user_test":"modeling_users/user_validations/a_validity_test","uid709":"modeling_users/user_validations/a_validity_test","sec-exercises_a_validity_test":"modeling_users/user_validations/a_validity_test","ex-81b3d0":"modeling_users/user_validations/a_validity_test","ex-48a701":"modeling_users/user_validations/a_validity_test","sec-presence_validation":"modeling_users/user_validations/presence_validation","code-name_presence_test":"modeling_users/user_validations/presence_validation","uid715":"modeling_users/user_validations/presence_validation","code-validates_presence_of_name":"modeling_users/user_validations/presence_validation","cha-6_footnote-ref-10":"modeling_users/user_validations/presence_validation","uid718":"modeling_users/user_validations/presence_validation","code-email_presence_test":"modeling_users/user_validations/presence_validation","code-validates_presence_of_email":"modeling_users/user_validations/presence_validation","uid721":"modeling_users/user_validations/presence_validation","sec-exercises_presence_validation":"modeling_users/user_validations/presence_validation","ex-cc4567":"modeling_users/user_validations/presence_validation","ex-248e6d":"modeling_users/user_validations/presence_validation","sec-length_validation":"modeling_users/user_validations/length_validation","code-length_validation_test":"modeling_users/user_validations/length_validation","uid727":"modeling_users/user_validations/length_validation","code-length_validation":"modeling_users/user_validations/length_validation","uid729":"modeling_users/user_validations/length_validation","sec-exercises_length_validation":"modeling_users/user_validations/length_validation","ex-1a1a36":"modeling_users/user_validations/length_validation","ex-f985db":"modeling_users/user_validations/length_validation","sec-format_validation":"modeling_users/user_validations/format_validation","code-email_format_valid_tests":"modeling_users/user_validations/format_validation","code-email_format_validation_tests":"modeling_users/user_validations/format_validation","uid736":"modeling_users/user_validations/format_validation","cha-6_footnote-ref-11":"modeling_users/user_validations/format_validation","cha-6_footnote-ref-12":"modeling_users/user_validations/format_validation","table-valid_email_regex":"modeling_users/user_validations/format_validation","cha-6_footnote-ref-13":"modeling_users/user_validations/format_validation","fig-rubular":"modeling_users/user_validations/format_validation","code-validates_format_of_email":"modeling_users/user_validations/format_validation","uid743":"modeling_users/user_validations/format_validation","sec-exercises_format_validation":"modeling_users/user_validations/format_validation","ex-4a2e50":"modeling_users/user_validations/format_validation","ex-158e59":"modeling_users/user_validations/format_validation","ex-ca235a":"modeling_users/user_validations/format_validation","code-better_email_regex":"modeling_users/user_validations/format_validation","sec-uniqueness_validation":"modeling_users/user_validations/uniqueness_validation","cha-6_footnote-ref-14":"modeling_users/user_validations/uniqueness_validation","code-validates_uniqueness_of_email_test":"modeling_users/user_validations/uniqueness_validation","code-validates_uniqueness_of_email":"modeling_users/user_validations/uniqueness_validation","cha-6_footnote-ref-15":"modeling_users/user_validations/uniqueness_validation","code-validates_uniqueness_of_email_case_insensitive_test":"modeling_users/user_validations/uniqueness_validation","code-validates_uniqueness_of_email_case_insensitive":"modeling_users/user_validations/uniqueness_validation","uid756":"modeling_users/user_validations/uniqueness_validation","aside-database_indices":"modeling_users/user_validations/uniqueness_validation","cha-6_footnote-ref-16":"modeling_users/user_validations/uniqueness_validation","code-email_uniqueness_index":"modeling_users/user_validations/uniqueness_validation","code-default_fixtures":"modeling_users/user_validations/uniqueness_validation","code-empty_fixtures":"modeling_users/user_validations/uniqueness_validation","cha-6_footnote-ref-17":"modeling_users/user_validations/uniqueness_validation","code-email_downcase":"modeling_users/user_validations/uniqueness_validation","sec-exercises_uniqueness_validation":"modeling_users/user_validations/uniqueness_validation","ex-3727c0":"modeling_users/user_validations/uniqueness_validation","ex-21aeec":"modeling_users/user_validations/uniqueness_validation","code-email_downcase_test":"modeling_users/user_validations/uniqueness_validation","code-downcase_bang":"modeling_users/user_validations/uniqueness_validation","sec-user_validations":"modeling_users/user_validations","sec-a_hashed_password":"modeling_users/adding_a_secure_password/a_hashed_password","cha-6_footnote-ref-18":"modeling_users/adding_a_secure_password/a_hashed_password","cha-6_footnote-ref-19":"modeling_users/adding_a_secure_password/a_hashed_password","fig-user_model_password_digest":"modeling_users/adding_a_secure_password/a_hashed_password","code-password_migration":"modeling_users/adding_a_secure_password/a_hashed_password","cha-6_footnote-ref-20":"modeling_users/adding_a_secure_password/a_hashed_password","code-bcrypt_ruby":"modeling_users/adding_a_secure_password/a_hashed_password","sec-has_secure_password":"modeling_users/adding_a_secure_password/has_secure_password","code-has_secure_password":"modeling_users/adding_a_secure_password/has_secure_password","uid785":"modeling_users/adding_a_secure_password/has_secure_password","code-test_with_password_confirmation":"modeling_users/adding_a_secure_password/has_secure_password","uid787":"modeling_users/adding_a_secure_password/has_secure_password","sec-exercises_has_secure_password":"modeling_users/adding_a_secure_password/has_secure_password","ex-2a0eec":"modeling_users/adding_a_secure_password/has_secure_password","ex-61d09e":"modeling_users/adding_a_secure_password/has_secure_password","sec-minimum_password_standards":"modeling_users/adding_a_secure_password/minimum_password_standards","code-minimum_password_length_test":"modeling_users/adding_a_secure_password/minimum_password_standards","code-password_implementation":"modeling_users/adding_a_secure_password/minimum_password_standards","uid794":"modeling_users/adding_a_secure_password/minimum_password_standards","sec-exercises_minimum_password_length":"modeling_users/adding_a_secure_password/minimum_password_standards","ex-57db46":"modeling_users/adding_a_secure_password/minimum_password_standards","ex-782852":"modeling_users/adding_a_secure_password/minimum_password_standards","sec-creating_and_authenticating_a_user":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","cha-6_footnote-ref-21":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","fig-sqlite_user_row":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","cha-6_footnote-ref-22":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","sec-exercises_creating_and_authenticating_a_user":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","ex-5d5ccc":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","ex-e7c2df":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","ex-1a90c0":"modeling_users/adding_a_secure_password/creating_and_authenticating_a_user","sec-adding_a_secure_password":"modeling_users/adding_a_secure_password","sec-modeling_users_what_we_learned_in_this_chapter":"modeling_users/modeling_users_conclusion/modeling_users_what_we_learned_in_this_chapter","sec-modeling_users_conclusion":"modeling_users/modeling_users_conclusion","cha-modeling_users":"modeling_users","aside-roll_your_own":"modeling_users","cha-6_footnotes":"modeling_users","cha-6_footnote-1":"modeling_users","cha-6_footnote-2":"modeling_users","cha-6_footnote-3":"modeling_users","cha-6_footnote-4":"modeling_users","cha-6_footnote-5":"modeling_users","cha-6_footnote-6":"modeling_users","cha-6_footnote-7":"modeling_users","cha-6_footnote-8":"modeling_users","cha-6_footnote-9":"modeling_users","cha-6_footnote-10":"modeling_users","cha-6_footnote-11":"modeling_users","cha-6_footnote-12":"modeling_users","cha-6_footnote-13":"modeling_users","cha-6_footnote-14":"modeling_users","cha-6_footnote-15":"modeling_users","cha-6_footnote-16":"modeling_users","cha-6_footnote-17":"modeling_users","cha-6_footnote-18":"modeling_users","cha-6_footnote-19":"modeling_users","cha-6_footnote-20":"modeling_users","cha-6_footnote-21":"modeling_users","cha-6_footnote-22":"modeling_users","sec-rails_environments":"sign_up/showing_users/rails_environments","code-rails_debug":"sign_up/showing_users/rails_environments","cha-7_footnote-ref-3":"sign_up/showing_users/rails_environments","aside-rails_environments":"sign_up/showing_users/rails_environments","code-mixin_and_debug":"sign_up/showing_users/rails_environments","cha-7_footnote-ref-4":"sign_up/showing_users/rails_environments","fig-home_page_with_debug":"sign_up/showing_users/rails_environments","cha-7_footnote-ref-5":"sign_up/showing_users/rails_environments","sec-exercises_rails_environments":"sign_up/showing_users/rails_environments","ex-4fe125":"sign_up/showing_users/rails_environments","ex-ab8c3e":"sign_up/showing_users/rails_environments","sec-a_users_resource":"sign_up/showing_users/a_users_resource","fig-profile_routing_error":"sign_up/showing_users/a_users_resource","code-users_resource":"sign_up/showing_users/a_users_resource","cha-7_footnote-ref-6":"sign_up/showing_users/a_users_resource","table-RESTful_users":"sign_up/showing_users/a_users_resource","fig-user_show_unknown_action":"sign_up/showing_users/a_users_resource","cha-7_footnote-ref-7":"sign_up/showing_users/a_users_resource","code-stub_user_view":"sign_up/showing_users/a_users_resource","code-user_show_action":"sign_up/showing_users/a_users_resource","fig-user_show_rails":"sign_up/showing_users/a_users_resource","sec-exercises_a_users_resource":"sign_up/showing_users/a_users_resource","ex-3fb238":"sign_up/showing_users/a_users_resource","ex-da090a":"sign_up/showing_users/a_users_resource","sec-debugger":"sign_up/showing_users/debugger","code-debugger":"sign_up/showing_users/debugger","code-debugger_removed":"sign_up/showing_users/debugger","sec-exercises_debugger":"sign_up/showing_users/debugger","ex-8679b1":"sign_up/showing_users/debugger","ex-2302af":"sign_up/showing_users/debugger","sec-a_gravatar_image":"sign_up/showing_users/a_gravatar_image","cha-7_footnote-ref-8":"sign_up/showing_users/a_gravatar_image","code-user_show_view_with_gravatar":"sign_up/showing_users/a_gravatar_image","code-gravatar_for_helper":"sign_up/showing_users/a_gravatar_image","fig-profile_with_gravatar":"sign_up/showing_users/a_gravatar_image","fig-profile_custom_gravatar":"sign_up/showing_users/a_gravatar_image","code-user_show_with_sidebar":"sign_up/showing_users/a_gravatar_image","cha-7_footnote-ref-9":"sign_up/showing_users/a_gravatar_image","code-sidebar_css":"sign_up/showing_users/a_gravatar_image","fig-user_show_sidebar_css":"sign_up/showing_users/a_gravatar_image","sec-exercises_a_gravatar_image":"sign_up/showing_users/a_gravatar_image","ex-6e602e":"sign_up/showing_users/a_gravatar_image","ex-8214c8":"sign_up/showing_users/a_gravatar_image","ex-61914e":"sign_up/showing_users/a_gravatar_image","code-gravatar_option":"sign_up/showing_users/a_gravatar_image","code-gravatar_keyword":"sign_up/showing_users/a_gravatar_image","sec-showing_users":"sign_up/showing_users","cha-7_footnote-ref-1":"sign_up/showing_users","cha-7_footnote-ref-2":"sign_up/showing_users","fig-profile_mockup_profile_name":"sign_up/showing_users","fig-profile_mockup":"sign_up/showing_users","sec-using_form_for":"sign_up/signup_form/using_form_for","code-new_action_with_user":"sign_up/signup_form/using_form_for","code-signup_form":"sign_up/signup_form/using_form_for","code-form_css":"sign_up/signup_form/using_form_for","fig-signup_form":"sign_up/signup_form/using_form_for","sec-exercises_using_form_for":"sign_up/signup_form/using_form_for","ex-7224ab":"sign_up/signup_form/using_form_for","ex-d0bbfe":"sign_up/signup_form/using_form_for","sec-the_form_html":"sign_up/signup_form/the_form_html","code-signup_form_html":"sign_up/signup_form/the_form_html","fig-filled_in_form":"sign_up/signup_form/the_form_html","cha-7_footnote-ref-10":"sign_up/signup_form/the_form_html","sec-exercises_the_form_html":"sign_up/signup_form/the_form_html","ex-602989":"sign_up/signup_form/the_form_html","sec-signup_form":"sign_up/signup_form","fig-blank_signup_page_recap":"sign_up/signup_form","fig-signup_mockup":"sign_up/signup_form","sec-a_working_form":"sign_up/unsuccessful_signups/a_working_form","code-first_create_action":"sign_up/unsuccessful_signups/a_working_form","fig-signup_failure":"sign_up/unsuccessful_signups/a_working_form","fig-signup_failure_rails_debug":"sign_up/unsuccessful_signups/a_working_form","sec-strong_parameters":"sign_up/unsuccessful_signups/strong_parameters","code-create_action_strong_parameters":"sign_up/unsuccessful_signups/strong_parameters","fig-invalid_submission_no_feedback":"sign_up/unsuccessful_signups/strong_parameters","sec-exercises_a_working_form":"sign_up/unsuccessful_signups/strong_parameters","ex-b3c548":"sign_up/unsuccessful_signups/strong_parameters","sec-signup_error_messages":"sign_up/unsuccessful_signups/signup_error_messages","code-f_error_messages":"sign_up/unsuccessful_signups/signup_error_messages","code-errors_partial":"sign_up/unsuccessful_signups/signup_error_messages","code-error_messages_css":"sign_up/unsuccessful_signups/signup_error_messages","fig-signup_error_messages":"sign_up/unsuccessful_signups/signup_error_messages","sec-exercises_signup_error_messages":"sign_up/unsuccessful_signups/signup_error_messages","ex-6e3d33":"sign_up/unsuccessful_signups/signup_error_messages","ex-ad9fd0":"sign_up/unsuccessful_signups/signup_error_messages","sec-a_test_for_invalid_submission":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","code-a_test_for_invalid_submission":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","uid904":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","sec-exercises_a_test_for_invalid_submission":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","ex-adc77f":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","ex-4ee5ec":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","ex-0b38a0":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","ex-678d64":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","code-error_messages_test":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","code-post_signup":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","code-post_signup_form":"sign_up/unsuccessful_signups/a_test_for_invalid_submission","sec-unsuccessful_signups":"sign_up/unsuccessful_signups","fig-signup_failure_mockup":"sign_up/unsuccessful_signups","sec-the_finished_signup_form":"sign_up/successful_signups/the_finished_signup_form","fig-valid_submission_error":"sign_up/successful_signups/the_finished_signup_form","fig-no_create_template_error":"sign_up/successful_signups/the_finished_signup_form","code-user_create_action":"sign_up/successful_signups/the_finished_signup_form","sec-exercises_the_finished_signup_form":"sign_up/successful_signups/the_finished_signup_form","ex-ae6165":"sign_up/successful_signups/the_finished_signup_form","ex-3f0fab":"sign_up/successful_signups/the_finished_signup_form","sec-the_flash":"sign_up/successful_signups/the_flash","code-signup_flash":"sign_up/successful_signups/the_flash","code-flash_iteration":"sign_up/successful_signups/the_flash","cha-7_footnote-ref-11":"sign_up/successful_signups/the_flash","code-layout_flash":"sign_up/successful_signups/the_flash","sec-exercises_the_flash":"sign_up/successful_signups/the_flash","ex-46d5c1":"sign_up/successful_signups/the_flash","ex-77fcbe":"sign_up/successful_signups/the_flash","sec-the_first_signup":"sign_up/successful_signups/the_first_signup","fig-first_signup":"sign_up/successful_signups/the_first_signup","fig-signup_flash":"sign_up/successful_signups/the_first_signup","fig-signup_flash_reloaded":"sign_up/successful_signups/the_first_signup","sec-exercises_the_first_signup":"sign_up/successful_signups/the_first_signup","ex-478ab1":"sign_up/successful_signups/the_first_signup","ex-6d88e5":"sign_up/successful_signups/the_first_signup","code-user_created":"sign_up/successful_signups/the_first_signup","sec-a_test_for_valid_submission":"sign_up/successful_signups/a_test_for_valid_submission","code-a_test_for_valid_submission":"sign_up/successful_signups/a_test_for_valid_submission","sec-exercises_a_test_for_valid_submission":"sign_up/successful_signups/a_test_for_valid_submission","ex-714b39":"sign_up/successful_signups/a_test_for_valid_submission","ex-f0e99e":"sign_up/successful_signups/a_test_for_valid_submission","ex-d82d28":"sign_up/successful_signups/a_test_for_valid_submission","ex-98882d":"sign_up/successful_signups/a_test_for_valid_submission","code-flash_test":"sign_up/successful_signups/a_test_for_valid_submission","code-layout_flash_content_tag":"sign_up/successful_signups/a_test_for_valid_submission","sec-successful_signups":"sign_up/successful_signups","fig-signup_success_mockup":"sign_up/successful_signups","sec-ssl_in_production":"sign_up/professional_grade_deployment/ssl_in_production","cha-7_footnote-ref-12":"sign_up/professional_grade_deployment/ssl_in_production","code-ssl_in_production":"sign_up/professional_grade_deployment/ssl_in_production","sec-production_webserver":"sign_up/professional_grade_deployment/production_webserver","cha-7_footnote-ref-13":"sign_up/professional_grade_deployment/production_webserver","code-production_webserver_config":"sign_up/professional_grade_deployment/production_webserver","code-procfile":"sign_up/professional_grade_deployment/production_webserver","sec-production_database_configuration":"sign_up/professional_grade_deployment/production_database_configuration","code-database_yml":"sign_up/professional_grade_deployment/production_database_configuration","sec-production_deployment":"sign_up/professional_grade_deployment/production_deployment","cha-7_footnote-ref-14":"sign_up/professional_grade_deployment/production_deployment","fig-signup_in_production":"sign_up/professional_grade_deployment/production_deployment","sec-ruby_version_number":"sign_up/professional_grade_deployment/production_deployment","cha-7_footnote-ref-15":"sign_up/professional_grade_deployment/production_deployment","sec-exercises_puma_in_production":"sign_up/professional_grade_deployment/production_deployment","ex-00415c":"sign_up/professional_grade_deployment/production_deployment","ex-cbc029":"sign_up/professional_grade_deployment/production_deployment","sec-professional_grade_deployment":"sign_up/professional_grade_deployment","sec-sign_up_what_we_learned_in_this_chapter":"sign_up/sign_up_conclusion/sign_up_what_we_learned_in_this_chapter","sec-sign_up_conclusion":"sign_up/sign_up_conclusion","cha-sign_up":"sign_up","cha-7_footnotes":"sign_up","cha-7_footnote-1":"sign_up","cha-7_footnote-2":"sign_up","cha-7_footnote-3":"sign_up","cha-7_footnote-4":"sign_up","cha-7_footnote-5":"sign_up","cha-7_footnote-6":"sign_up","cha-7_footnote-7":"sign_up","cha-7_footnote-8":"sign_up","cha-7_footnote-9":"sign_up","cha-7_footnote-10":"sign_up","cha-7_footnote-11":"sign_up","cha-7_footnote-12":"sign_up","cha-7_footnote-13":"sign_up","cha-7_footnote-14":"sign_up","cha-7_footnote-15":"sign_up","sec-sessions_controller":"basic_login/sessions_and_failed_login/sessions_controller","code-generate_sessions_controller":"basic_login/sessions_and_failed_login/sessions_controller","fig-login_mockup":"basic_login/sessions_and_failed_login/sessions_controller","code-sessions_resource":"basic_login/sessions_and_failed_login/sessions_controller","code-users_controller_test_login_route":"basic_login/sessions_and_failed_login/sessions_controller","table-RESTful_sessions":"basic_login/sessions_and_failed_login/sessions_controller","sec-exercises_sessions_controller":"basic_login/sessions_and_failed_login/sessions_controller","ex-36ca59":"basic_login/sessions_and_failed_login/sessions_controller","ex-061c5c":"basic_login/sessions_and_failed_login/sessions_controller","sec-login_form":"basic_login/sessions_and_failed_login/login_form","fig-login_failure_mockup":"basic_login/sessions_and_failed_login/login_form","cha-8_footnote-ref-2":"basic_login/sessions_and_failed_login/login_form","code-login_form":"basic_login/sessions_and_failed_login/login_form","fig-login_form":"basic_login/sessions_and_failed_login/login_form","code-login_form_html":"basic_login/sessions_and_failed_login/login_form","sec-exercises_login_form":"basic_login/sessions_and_failed_login/login_form","ex-f0615e":"basic_login/sessions_and_failed_login/login_form","sec-finding_and_authenticating_a_user":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","code-initial_create_session":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","fig-initial_failed_login_rails_3":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","code-find_authenticate_user":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","table-user_and_and":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","sec-exercises_finding_and_authenticating_a_user":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","ex-b87d43":"basic_login/sessions_and_failed_login/finding_and_authenticating_a_user","sec-rendering_with_a_flash_message":"basic_login/sessions_and_failed_login/rendering_with_a_flash_message","code-failed_login_attempt":"basic_login/sessions_and_failed_login/rendering_with_a_flash_message","fig-failed_login_flash":"basic_login/sessions_and_failed_login/rendering_with_a_flash_message","fig-flash_persistence":"basic_login/sessions_and_failed_login/rendering_with_a_flash_message","sec-a_flash_test":"basic_login/sessions_and_failed_login/a_flash_test","code-flash_persistence_test":"basic_login/sessions_and_failed_login/a_flash_test","uid1012":"basic_login/sessions_and_failed_login/a_flash_test","code-correct_login_failure":"basic_login/sessions_and_failed_login/a_flash_test","uid1014":"basic_login/sessions_and_failed_login/a_flash_test","sec-exercises_a_flash_test":"basic_login/sessions_and_failed_login/a_flash_test","ex-2e6353":"basic_login/sessions_and_failed_login/a_flash_test","sec-sessions_and_failed_login":"basic_login/sessions_and_failed_login","cha-8_footnote-ref-1":"basic_login/sessions_and_failed_login","sec-a_working_log_in_method":"basic_login/logging_in/a_working_log_in_method","code-log_in_function":"basic_login/logging_in/a_working_log_in_method","cha-8_footnote-ref-4":"basic_login/logging_in/a_working_log_in_method","code-log_in_success":"basic_login/logging_in/a_working_log_in_method","sec-exercises_a_working_log_in_method":"basic_login/logging_in/a_working_log_in_method","ex-f3b33f":"basic_login/logging_in/a_working_log_in_method","ex-2f4f14":"basic_login/logging_in/a_working_log_in_method","sec-current_user":"basic_login/logging_in/current_user","cha-8_footnote-ref-5":"basic_login/logging_in/current_user","aside-or_equals":"basic_login/logging_in/current_user","code-current_user":"basic_login/logging_in/current_user","sec-exercises_current_user":"basic_login/logging_in/current_user","ex-3b50ae":"basic_login/logging_in/current_user","ex-cdb219":"basic_login/logging_in/current_user","code-console_session_simulation":"basic_login/logging_in/current_user","sec-changing_the_layout_links":"basic_login/logging_in/changing_the_layout_links","cha-8_footnote-ref-6":"basic_login/logging_in/changing_the_layout_links","fig-login_success_mockup":"basic_login/logging_in/changing_the_layout_links","code-logged_in_p":"basic_login/logging_in/changing_the_layout_links","cha-8_footnote-ref-7":"basic_login/logging_in/changing_the_layout_links","code-layout_login_logout_links":"basic_login/logging_in/changing_the_layout_links","cha-8_footnote-ref-8":"basic_login/logging_in/changing_the_layout_links","cha-8_footnote-ref-9":"basic_login/logging_in/changing_the_layout_links","code-bootstrap_js":"basic_login/logging_in/changing_the_layout_links","cha-8_footnote-ref-10":"basic_login/logging_in/changing_the_layout_links","cha-8_footnote-ref-11":"basic_login/logging_in/changing_the_layout_links","fig-profile_with_logout_link":"basic_login/logging_in/changing_the_layout_links","sec-exercises_changing_the_layout_links":"basic_login/logging_in/changing_the_layout_links","ex-86a90a":"basic_login/logging_in/changing_the_layout_links","ex-df67d8":"basic_login/logging_in/changing_the_layout_links","sec-testing_layout_changes":"basic_login/logging_in/testing_layout_changes","code-digest_method":"basic_login/logging_in/testing_layout_changes","cha-8_footnote-ref-12":"basic_login/logging_in/testing_layout_changes","code-real_user_fixture":"basic_login/logging_in/testing_layout_changes","code-user_login_test_valid_information":"basic_login/logging_in/testing_layout_changes","uid1059":"basic_login/logging_in/testing_layout_changes","sec-exercises_testing_layout_changes":"basic_login/logging_in/testing_layout_changes","ex-55faf3":"basic_login/logging_in/testing_layout_changes","ex-2f5db3":"basic_login/logging_in/testing_layout_changes","sec-login_upon_signup":"basic_login/logging_in/login_upon_signup","cha-8_footnote-ref-13":"basic_login/logging_in/login_upon_signup","code-login_upon_signup":"basic_login/logging_in/login_upon_signup","cha-8_footnote-ref-14":"basic_login/logging_in/login_upon_signup","code-test_helper_sessions":"basic_login/logging_in/login_upon_signup","code-login_after_signup_test":"basic_login/logging_in/login_upon_signup","uid1069":"basic_login/logging_in/login_upon_signup","sec-exercises_login_upon_signup":"basic_login/logging_in/login_upon_signup","ex-c5176d":"basic_login/logging_in/login_upon_signup","ex-2ef552":"basic_login/logging_in/login_upon_signup","sec-logging_in":"basic_login/logging_in","cha-8_footnote-ref-3":"basic_login/logging_in","code-sessions_helper_include":"basic_login/logging_in","sec-logging_out":"basic_login/logging_out","cha-8_footnote-ref-15":"basic_login/logging_out","cha-8_footnote-ref-16":"basic_login/logging_out","code-log_out_method":"basic_login/logging_out","code-destroy_session":"basic_login/logging_out","code-user_logout_test":"basic_login/logging_out","uid1078":"basic_login/logging_out","sec-exercises_logging_out":"basic_login/logging_out","ex-0ed3ee":"basic_login/logging_out","ex-9fb8a3":"basic_login/logging_out","sec-basic_login_what_we_learned_in_this_chapter":"basic_login/basic_login_conclusion/basic_login_what_we_learned_in_this_chapter","sec-basic_login_conclusion":"basic_login/basic_login_conclusion","cha-basic_login":"basic_login","cha-8_footnotes":"basic_login","cha-8_footnote-1":"basic_login","cha-8_footnote-2":"basic_login","cha-8_footnote-3":"basic_login","cha-8_footnote-4":"basic_login","cha-8_footnote-5":"basic_login","cha-8_footnote-6":"basic_login","cha-8_footnote-7":"basic_login","cha-8_footnote-8":"basic_login","cha-8_footnote-9":"basic_login","cha-8_footnote-10":"basic_login","cha-8_footnote-11":"basic_login","cha-8_footnote-12":"basic_login","cha-8_footnote-13":"basic_login","cha-8_footnote-14":"basic_login","cha-8_footnote-15":"basic_login","cha-8_footnote-16":"basic_login","sec-remember_token":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-1":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-2":"advanced_login/remember_me/remember_token","fig-user_model_remember_digest":"advanced_login/remember_me/remember_token","code-add_remember_digest_to_users_generated":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-3":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-4":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-5":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-6":"advanced_login/remember_me/remember_token","cha-9_footnote-ref-7":"advanced_login/remember_me/remember_token","code-token_method":"advanced_login/remember_me/remember_token","code-user_model_remember":"advanced_login/remember_me/remember_token","sec-exercises_remember_token":"advanced_login/remember_me/remember_token","ex-edf2eb":"advanced_login/remember_me/remember_token","ex-b22c3e":"advanced_login/remember_me/remember_token","code-token_digest_self":"advanced_login/remember_me/remember_token","code-token_digest_class_self":"advanced_login/remember_me/remember_token","sec-login_with_remembering":"advanced_login/remember_me/login_with_remembering","aside-time_helpers":"advanced_login/remember_me/login_with_remembering","cha-9_footnote-ref-8":"advanced_login/remember_me/login_with_remembering","cha-9_footnote-ref-9":"advanced_login/remember_me/login_with_remembering","code-authenticated_p":"advanced_login/remember_me/login_with_remembering","code-log_in_with_remember":"advanced_login/remember_me/login_with_remembering","code-remember_method":"advanced_login/remember_me/login_with_remembering","cha-9_footnote-ref-10":"advanced_login/remember_me/login_with_remembering","code-persistent_current_user":"advanced_login/remember_me/login_with_remembering","cha-9_footnote-ref-11":"advanced_login/remember_me/login_with_remembering","cha-9_footnote-ref-12":"advanced_login/remember_me/login_with_remembering","fig-cookie_in_browser":"advanced_login/remember_me/login_with_remembering","uid1128":"advanced_login/remember_me/login_with_remembering","sec-exercises_login_with_remembering":"advanced_login/remember_me/login_with_remembering","ex-24db9d":"advanced_login/remember_me/login_with_remembering","ex-b9298f":"advanced_login/remember_me/login_with_remembering","sec-forgetting_users":"advanced_login/remember_me/forgetting_users","code-user_model_forget":"advanced_login/remember_me/forgetting_users","code-log_out_with_forget":"advanced_login/remember_me/forgetting_users","uid1135":"advanced_login/remember_me/forgetting_users","sec-exercises_forgetting_users":"advanced_login/remember_me/forgetting_users","ex-66308a":"advanced_login/remember_me/forgetting_users","sec-two_subtle_bugs":"advanced_login/remember_me/two_subtle_bugs","cha-9_footnote-ref-13":"advanced_login/remember_me/two_subtle_bugs","cha-9_footnote-ref-14":"advanced_login/remember_me/two_subtle_bugs","code-test_double_logout":"advanced_login/remember_me/two_subtle_bugs","uid1142":"advanced_login/remember_me/two_subtle_bugs","code-destroy_forget":"advanced_login/remember_me/two_subtle_bugs","code-test_authenticated_invalid_token":"advanced_login/remember_me/two_subtle_bugs","uid1145":"advanced_login/remember_me/two_subtle_bugs","code-authenticated_p_fixed":"advanced_login/remember_me/two_subtle_bugs","uid1147":"advanced_login/remember_me/two_subtle_bugs","sec-exercises_two_subtle_bugs":"advanced_login/remember_me/two_subtle_bugs","ex-9e210e":"advanced_login/remember_me/two_subtle_bugs","ex-38d59c":"advanced_login/remember_me/two_subtle_bugs","ex-cf8af9":"advanced_login/remember_me/two_subtle_bugs","sec-remember_me":"advanced_login/remember_me","sec-remember_me_checkbox":"advanced_login/remember_me_checkbox","fig-login_remember_me_mockup":"advanced_login/remember_me_checkbox","code-remember_me_checkbox":"advanced_login/remember_me_checkbox","code-remember_me_css":"advanced_login/remember_me_checkbox","fig-login_form_remember_me":"advanced_login/remember_me_checkbox","cha-9_footnote-ref-15":"advanced_login/remember_me_checkbox","cha-9_footnote-ref-16":"advanced_login/remember_me_checkbox","code-remember_me_ternary":"advanced_login/remember_me_checkbox","aside-ternary_operator":"advanced_login/remember_me_checkbox","sec-exercises_remember_me":"advanced_login/remember_me_checkbox","ex-0c1e96":"advanced_login/remember_me_checkbox","ex-63ac73":"advanced_login/remember_me_checkbox","sec-testing_the_remember_me_box":"advanced_login/remember_tests/testing_the_remember_me_box","code-test_helper_log_in":"advanced_login/remember_tests/testing_the_remember_me_box","code-remember_me_test":"advanced_login/remember_tests/testing_the_remember_me_box","uid1166":"advanced_login/remember_tests/testing_the_remember_me_box","sec-exercises_testing_the_remember_me_box":"advanced_login/remember_tests/testing_the_remember_me_box","ex-4c19e7":"advanced_login/remember_tests/testing_the_remember_me_box","code-login_create_user_instance":"advanced_login/remember_tests/testing_the_remember_me_box","code-improved_remember_me_test":"advanced_login/remember_tests/testing_the_remember_me_box","sec-testing_the_remember_branch":"advanced_login/remember_tests/testing_the_remember_branch","code-branch_raise":"advanced_login/remember_tests/testing_the_remember_branch","uid1173":"advanced_login/remember_tests/testing_the_remember_branch","code-persistent_sessions_test":"advanced_login/remember_tests/testing_the_remember_branch","uid1178":"advanced_login/remember_tests/testing_the_remember_branch","code-branch_no_raise":"advanced_login/remember_tests/testing_the_remember_branch","uid1180":"advanced_login/remember_tests/testing_the_remember_branch","sec-exercises_testing_the_remember_branch":"advanced_login/remember_tests/testing_the_remember_branch","ex-35a6a6":"advanced_login/remember_tests/testing_the_remember_branch","sec-remember_tests":"advanced_login/remember_tests","sec-advanced_login_what_we_learned_in_this_chapter":"advanced_login/advanced_login_conclusion/advanced_login_what_we_learned_in_this_chapter","sec-advanced_login_conclusion":"advanced_login/advanced_login_conclusion","cha-advanced_login":"advanced_login","cha-9_footnotes":"advanced_login","cha-9_footnote-1":"advanced_login","cha-9_footnote-2":"advanced_login","cha-9_footnote-3":"advanced_login","cha-9_footnote-4":"advanced_login","cha-9_footnote-5":"advanced_login","cha-9_footnote-6":"advanced_login","cha-9_footnote-7":"advanced_login","cha-9_footnote-8":"advanced_login","cha-9_footnote-9":"advanced_login","cha-9_footnote-10":"advanced_login","cha-9_footnote-11":"advanced_login","cha-9_footnote-12":"advanced_login","cha-9_footnote-13":"advanced_login","cha-9_footnote-14":"advanced_login","cha-9_footnote-15":"advanced_login","cha-9_footnote-16":"advanced_login","sec-edit_form":"updating_and_deleting_users/updating_users/edit_form","cha-10_footnote-ref-1":"updating_and_deleting_users/updating_users/edit_form","fig-edit_user_mockup":"updating_and_deleting_users/updating_users/edit_form","code-initial_edit_action":"updating_and_deleting_users/updating_users/edit_form","code-user_edit_view":"updating_and_deleting_users/updating_users/edit_form","fig-edit_page":"updating_and_deleting_users/updating_users/edit_form","code-edit_form_html":"updating_and_deleting_users/updating_users/edit_form","cha-10_footnote-ref-2":"updating_and_deleting_users/updating_users/edit_form","code-settings_link":"updating_and_deleting_users/updating_users/edit_form","sec-exercises_edit_form":"updating_and_deleting_users/updating_users/edit_form","ex-33137d":"updating_and_deleting_users/updating_users/edit_form","cha-10_footnote-ref-3":"updating_and_deleting_users/updating_users/edit_form","ex-3ebe17":"updating_and_deleting_users/updating_users/edit_form","code-new_edit_partial":"updating_and_deleting_users/updating_users/edit_form","code-new_user_with_partial":"updating_and_deleting_users/updating_users/edit_form","code-edit_user_with_partial":"updating_and_deleting_users/updating_users/edit_form","sec-unsuccessful_edits":"updating_and_deleting_users/updating_users/unsuccessful_edits","code-user_update_action_unsuccessful":"updating_and_deleting_users/updating_users/unsuccessful_edits","fig-buggy_edit_with_invalid_information":"updating_and_deleting_users/updating_users/unsuccessful_edits","sec-exercises_unssuccessful_edits":"updating_and_deleting_users/updating_users/unsuccessful_edits","ex-1e592f":"updating_and_deleting_users/updating_users/unsuccessful_edits","sec-testing_unsuccessful_edits":"updating_and_deleting_users/updating_users/testing_unsuccessful_edits","code-unsuccessful_edit_test":"updating_and_deleting_users/updating_users/testing_unsuccessful_edits","uid1213":"updating_and_deleting_users/updating_users/testing_unsuccessful_edits","sec-exercises_testing_unsuccessful_edits":"updating_and_deleting_users/updating_users/testing_unsuccessful_edits","ex-faa5fa":"updating_and_deleting_users/updating_users/testing_unsuccessful_edits","sec-successful_edits":"updating_and_deleting_users/updating_users/successful_edits","fig-gravatar_cropper":"updating_and_deleting_users/updating_users/successful_edits","code-successful_edit_test":"updating_and_deleting_users/updating_users/successful_edits","code-user_update_action":"updating_and_deleting_users/updating_users/successful_edits","code-allow_blank_password":"updating_and_deleting_users/updating_users/successful_edits","uid1221":"updating_and_deleting_users/updating_users/successful_edits","fig-edit_form_working":"updating_and_deleting_users/updating_users/successful_edits","sec-exercises_enabling_edits":"updating_and_deleting_users/updating_users/successful_edits","ex-b12fb2":"updating_and_deleting_users/updating_users/successful_edits","ex-05aa0f":"updating_and_deleting_users/updating_users/successful_edits","sec-updating_users":"updating_and_deleting_users/updating_users","sec-requiring_logged_in_users":"updating_and_deleting_users/authorization/requiring_logged_in_users","cha-10_footnote-ref-4":"updating_and_deleting_users/authorization/requiring_logged_in_users","code-authorize_before_filter":"updating_and_deleting_users/authorization/requiring_logged_in_users","fig-protected_log_in":"updating_and_deleting_users/authorization/requiring_logged_in_users","uid1231":"updating_and_deleting_users/authorization/requiring_logged_in_users","code-edit_tests_logged_in":"updating_and_deleting_users/authorization/requiring_logged_in_users","uid1233":"updating_and_deleting_users/authorization/requiring_logged_in_users","code-commented_out_before_filter":"updating_and_deleting_users/authorization/requiring_logged_in_users","code-edit_update_redirect_tests":"updating_and_deleting_users/authorization/requiring_logged_in_users","code-uncommented_before_filter":"updating_and_deleting_users/authorization/requiring_logged_in_users","uid1237":"updating_and_deleting_users/authorization/requiring_logged_in_users","sec-exercises_requiring_logged_in_users":"updating_and_deleting_users/authorization/requiring_logged_in_users","ex-5d0fb5":"updating_and_deleting_users/authorization/requiring_logged_in_users","sec-requiring_the_right_user":"updating_and_deleting_users/authorization/requiring_the_right_user","code-fixture_second_user":"updating_and_deleting_users/authorization/requiring_the_right_user","code-edit_update_wrong_user_tests":"updating_and_deleting_users/authorization/requiring_the_right_user","code-correct_user_before_filter":"updating_and_deleting_users/authorization/requiring_the_right_user","uid1244":"updating_and_deleting_users/authorization/requiring_the_right_user","code-current_user_p":"updating_and_deleting_users/authorization/requiring_the_right_user","code-correct_user_before_filter_boolean":"updating_and_deleting_users/authorization/requiring_the_right_user","sec-exercises_requiring_the_right_user":"updating_and_deleting_users/authorization/requiring_the_right_user","ex-c0afd2":"updating_and_deleting_users/authorization/requiring_the_right_user","ex-5f2a07":"updating_and_deleting_users/authorization/requiring_the_right_user","sec-friendly_forwarding":"updating_and_deleting_users/authorization/friendly_forwarding","code-friendly_forwarding_test":"updating_and_deleting_users/authorization/friendly_forwarding","cha-10_footnote-ref-5":"updating_and_deleting_users/authorization/friendly_forwarding","code-friendly_forwarding_code":"updating_and_deleting_users/authorization/friendly_forwarding","cha-10_footnote-ref-6":"updating_and_deleting_users/authorization/friendly_forwarding","code-add_store_location":"updating_and_deleting_users/authorization/friendly_forwarding","code-friendly_session_create":"updating_and_deleting_users/authorization/friendly_forwarding","uid1257":"updating_and_deleting_users/authorization/friendly_forwarding","sec-exercises_friendly_forwarding":"updating_and_deleting_users/authorization/friendly_forwarding","ex-6ae96b":"updating_and_deleting_users/authorization/friendly_forwarding","ex-3a6af3":"updating_and_deleting_users/authorization/friendly_forwarding","sec-authorization":"updating_and_deleting_users/authorization","fig-login_page_protected_mockup":"updating_and_deleting_users/authorization","sec-users_index":"updating_and_deleting_users/showing_all_users/users_index","cha-10_footnote-ref-8":"updating_and_deleting_users/showing_all_users/users_index","code-index_action_redirected_test":"updating_and_deleting_users/showing_all_users/users_index","code-logged_in_user_index":"updating_and_deleting_users/showing_all_users/users_index","code-user_index":"updating_and_deleting_users/showing_all_users/users_index","code-user_index_view":"updating_and_deleting_users/showing_all_users/users_index","code-gravatar_option_redux":"updating_and_deleting_users/showing_all_users/users_index","code-user_index_css":"updating_and_deleting_users/showing_all_users/users_index","code-users_link":"updating_and_deleting_users/showing_all_users/users_index","uid1272":"updating_and_deleting_users/showing_all_users/users_index","fig-user_index_only_one":"updating_and_deleting_users/showing_all_users/users_index","sec-exercises_user_index":"updating_and_deleting_users/showing_all_users/users_index","ex-143f12":"updating_and_deleting_users/showing_all_users/users_index","sec-sample_users":"updating_and_deleting_users/showing_all_users/sample_users","cha-10_footnote-ref-9":"updating_and_deleting_users/showing_all_users/sample_users","code-faker_gemfile":"updating_and_deleting_users/showing_all_users/sample_users","code-db_seed":"updating_and_deleting_users/showing_all_users/sample_users","cha-10_footnote-ref-10":"updating_and_deleting_users/showing_all_users/sample_users","fig-user_index_all":"updating_and_deleting_users/showing_all_users/sample_users","sec-exercises_sample_users":"updating_and_deleting_users/showing_all_users/sample_users","ex-41e0bf":"updating_and_deleting_users/showing_all_users/sample_users","sec-pagination":"updating_and_deleting_users/showing_all_users/pagination","cha-10_footnote-ref-11":"updating_and_deleting_users/showing_all_users/pagination","code-will_paginate_gem":"updating_and_deleting_users/showing_all_users/pagination","code-will_paginate_index_view":"updating_and_deleting_users/showing_all_users/pagination","code-will_paginate_index_action":"updating_and_deleting_users/showing_all_users/pagination","fig-user_index_pagination":"updating_and_deleting_users/showing_all_users/pagination","fig-user_index_page_two_rails_3":"updating_and_deleting_users/showing_all_users/pagination","sec-exercises_pagination":"updating_and_deleting_users/showing_all_users/pagination","ex-35d060":"updating_and_deleting_users/showing_all_users/pagination","ex-05e085":"updating_and_deleting_users/showing_all_users/pagination","sec-users_index_test":"updating_and_deleting_users/showing_all_users/users_index_test","code-users_fixtures_extra_users":"updating_and_deleting_users/showing_all_users/users_index_test","code-user_index_test":"updating_and_deleting_users/showing_all_users/users_index_test","uid1297":"updating_and_deleting_users/showing_all_users/users_index_test","sec-exercises_user_index_test":"updating_and_deleting_users/showing_all_users/users_index_test","ex-874ecc":"updating_and_deleting_users/showing_all_users/users_index_test","ex-8edf5d":"updating_and_deleting_users/showing_all_users/users_index_test","sec-partial_refactoring":"updating_and_deleting_users/showing_all_users/partial_refactoring","code-index_view_first_refactoring":"updating_and_deleting_users/showing_all_users/partial_refactoring","cha-10_footnote-ref-12":"updating_and_deleting_users/showing_all_users/partial_refactoring","code-user_partial":"updating_and_deleting_users/showing_all_users/partial_refactoring","code-index_final_refactoring":"updating_and_deleting_users/showing_all_users/partial_refactoring","uid1306":"updating_and_deleting_users/showing_all_users/partial_refactoring","sec-exercises_partial_refactoring":"updating_and_deleting_users/showing_all_users/partial_refactoring","ex-d0d59d":"updating_and_deleting_users/showing_all_users/partial_refactoring","sec-showing_all_users":"updating_and_deleting_users/showing_all_users","cha-10_footnote-ref-7":"updating_and_deleting_users/showing_all_users","fig-user_index_mockup":"updating_and_deleting_users/showing_all_users","sec-administrative_users":"updating_and_deleting_users/deleting_users/administrative_users","fig-user_model_admin":"updating_and_deleting_users/deleting_users/administrative_users","code-admin_migration":"updating_and_deleting_users/deleting_users/administrative_users","code-populator_with_admin":"updating_and_deleting_users/deleting_users/administrative_users","sec-revisiting_strong_parameters":"updating_and_deleting_users/deleting_users/administrative_users","cha-10_footnote-ref-13":"updating_and_deleting_users/deleting_users/administrative_users","sec-exercises_administrative_users":"updating_and_deleting_users/deleting_users/administrative_users","ex-11d303":"updating_and_deleting_users/deleting_users/administrative_users","code-forbidden_admin_test":"updating_and_deleting_users/deleting_users/administrative_users","sec-the_destroy_action":"updating_and_deleting_users/deleting_users/the_destroy_action","code-delete_links":"updating_and_deleting_users/deleting_users/the_destroy_action","cha-10_footnote-ref-14":"updating_and_deleting_users/deleting_users/the_destroy_action","fig-index_delete_links_rails_3":"updating_and_deleting_users/deleting_users/the_destroy_action","code-destroy_action":"updating_and_deleting_users/deleting_users/the_destroy_action","code-admin_destroy_before_filter":"updating_and_deleting_users/deleting_users/the_destroy_action","sec-exercises_the_destroy_action":"updating_and_deleting_users/deleting_users/the_destroy_action","ex-6dd2ae":"updating_and_deleting_users/deleting_users/the_destroy_action","sec-user_destroy_tests":"updating_and_deleting_users/deleting_users/user_destroy_tests","code-fixture_user_admin":"updating_and_deleting_users/deleting_users/user_destroy_tests","code-action_tests_admin":"updating_and_deleting_users/deleting_users/user_destroy_tests","code-delete_link_integration_test":"updating_and_deleting_users/deleting_users/user_destroy_tests","uid1331":"updating_and_deleting_users/deleting_users/user_destroy_tests","sec-exercises_user_destroy_tests":"updating_and_deleting_users/deleting_users/user_destroy_tests","ex-1069ae":"updating_and_deleting_users/deleting_users/user_destroy_tests","sec-deleting_users":"updating_and_deleting_users/deleting_users","fig-user_index_delete_links_mockup":"updating_and_deleting_users/deleting_users","sec-updating_what_we_learned_in_this_chapter":"updating_and_deleting_users/updating_and_deleting_users_conclusion/updating_what_we_learned_in_this_chapter","sec-updating_and_deleting_users_conclusion":"updating_and_deleting_users/updating_and_deleting_users_conclusion","fig-heroku_sample_users":"updating_and_deleting_users/updating_and_deleting_users_conclusion","cha-updating_showing_and_deleting_users":"updating_and_deleting_users","cha-10_footnotes":"updating_and_deleting_users","cha-10_footnote-1":"updating_and_deleting_users","cha-10_footnote-2":"updating_and_deleting_users","cha-10_footnote-3":"updating_and_deleting_users","cha-10_footnote-4":"updating_and_deleting_users","cha-10_footnote-5":"updating_and_deleting_users","cha-10_footnote-6":"updating_and_deleting_users","cha-10_footnote-7":"updating_and_deleting_users","cha-10_footnote-8":"updating_and_deleting_users","cha-10_footnote-9":"updating_and_deleting_users","cha-10_footnote-10":"updating_and_deleting_users","cha-10_footnote-11":"updating_and_deleting_users","cha-10_footnote-12":"updating_and_deleting_users","cha-10_footnote-13":"updating_and_deleting_users","cha-10_footnote-14":"updating_and_deleting_users","sec-account_activations_controller":"account_activation/account_activations_resource/account_activations_controller","cha-11_footnote-ref-4":"account_activation/account_activations_resource/account_activations_controller","code-account_activations_route":"account_activation/account_activations_resource/account_activations_controller","table-RESTful_account_activations":"account_activation/account_activations_resource/account_activations_controller","sec-exercises_account_activations_controller":"account_activation/account_activations_resource/account_activations_controller","ex-4955e7":"account_activation/account_activations_resource/account_activations_controller","ex-a02b35":"account_activation/account_activations_resource/account_activations_controller","sec-account_activation_data_model":"account_activation/account_activations_resource/account_activation_data_model","cha-11_footnote-ref-5":"account_activation/account_activations_resource/account_activation_data_model","fig-user_model_account_activation":"account_activation/account_activations_resource/account_activation_data_model","code-add_activation_to_users_migration":"account_activation/account_activations_resource/account_activation_data_model","sec-activation_token_callback":"account_activation/account_activations_resource/account_activation_data_model","code-user_model_activation_code":"account_activation/account_activations_resource/account_activation_data_model","sec-seed_and_fixture_users":"account_activation/account_activations_resource/account_activation_data_model","code-seed_users_activated":"account_activation/account_activations_resource/account_activation_data_model","code-fixture_users_activated":"account_activation/account_activations_resource/account_activation_data_model","sec-exercises_account_activation_data_model":"account_activation/account_activations_resource/account_activation_data_model","ex-e1cdee":"account_activation/account_activations_resource/account_activation_data_model","ex-09d340":"account_activation/account_activations_resource/account_activation_data_model","ex-ffb351":"account_activation/account_activations_resource/account_activation_data_model","sec-account_activations_resource":"account_activation/account_activations_resource","sec-mailer_templates":"account_activation/account_activation_emails/mailer_templates","code-generate_user_mailer":"account_activation/account_activation_emails/mailer_templates","code-generated_account_activation_view_text":"account_activation/account_activation_emails/mailer_templates","code-generated_account_activation_view_html":"account_activation/account_activation_emails/mailer_templates","code-generated_application_mailer":"account_activation/account_activation_emails/mailer_templates","code-generated_user_mailer":"account_activation/account_activation_emails/mailer_templates","code-application_mailer":"account_activation/account_activation_emails/mailer_templates","code-mail_account_activation":"account_activation/account_activation_emails/mailer_templates","cha-11_footnote-ref-6":"account_activation/account_activation_emails/mailer_templates","code-account_activation_view_text":"account_activation/account_activation_emails/mailer_templates","code-account_activation_view_html":"account_activation/account_activation_emails/mailer_templates","sec-exercises_mailer_templates":"account_activation/account_activation_emails/mailer_templates","ex-bb787b":"account_activation/account_activation_emails/mailer_templates","code-cgi_escape":"account_activation/account_activation_emails/mailer_templates","sec-email_previews":"account_activation/account_activation_emails/email_previews","code-development_email_settings":"account_activation/account_activation_emails/email_previews","code-generated_user_mailer_previews":"account_activation/account_activation_emails/email_previews","code-account_activation_preview":"account_activation/account_activation_emails/email_previews","fig-account_activation_html_preview":"account_activation/account_activation_emails/email_previews","fig-account_activation_text_preview":"account_activation/account_activation_emails/email_previews","sec-exercises_email_previews":"account_activation/account_activation_emails/email_previews","ex-be4a4e":"account_activation/account_activation_emails/email_previews","sec-email_tests":"account_activation/account_activation_emails/email_tests","code-generated_user_mailer_test":"account_activation/account_activation_emails/email_tests","cha-11_footnote-ref-7":"account_activation/account_activation_emails/email_tests","code-real_account_activation_test":"account_activation/account_activation_emails/email_tests","code-test_domain_host":"account_activation/account_activation_emails/email_tests","uid1404":"account_activation/account_activation_emails/email_tests","sec-exercises_email_tests":"account_activation/account_activation_emails/email_tests","ex-b429e6":"account_activation/account_activation_emails/email_tests","ex-9ed121":"account_activation/account_activation_emails/email_tests","sec-updating_create":"account_activation/account_activation_emails/updating_create","code-user_signup_with_account_activation":"account_activation/account_activation_emails/updating_create","code-comment_out_failing_tests":"account_activation/account_activation_emails/updating_create","code-account_activation_email":"account_activation/account_activation_emails/updating_create","fig-redirected_not_activated":"account_activation/account_activation_emails/updating_create","sec-exercises_updating_create":"account_activation/account_activation_emails/updating_create","ex-f1397e":"account_activation/account_activation_emails/updating_create","ex-0e32b6":"account_activation/account_activation_emails/updating_create","sec-account_activation_emails":"account_activation/account_activation_emails","sec-generalizing_the_authenticated_method":"account_activation/activating_the_account/generalizing_the_authenticated_method","code-generalized_authenticated_p":"account_activation/activating_the_account/generalizing_the_authenticated_method","uid1418":"account_activation/activating_the_account/generalizing_the_authenticated_method","code-generalized_current_user":"account_activation/activating_the_account/generalizing_the_authenticated_method","code-test_authenticated_invalid_token_updated":"account_activation/activating_the_account/generalizing_the_authenticated_method","uid1421":"account_activation/activating_the_account/generalizing_the_authenticated_method","sec-exercises_generalizing_the_authenticated_method":"account_activation/activating_the_account/generalizing_the_authenticated_method","ex-6fc4f1":"account_activation/activating_the_account/generalizing_the_authenticated_method","ex-fdc50d":"account_activation/activating_the_account/generalizing_the_authenticated_method","sec-activation_edit_action":"account_activation/activating_the_account/activation_edit_action","cha-11_footnote-ref-8":"account_activation/activating_the_account/activation_edit_action","code-account_activation_edit_action":"account_activation/activating_the_account/activation_edit_action","fig-activated_user":"account_activation/activating_the_account/activation_edit_action","code-preventing_unactivated_logins":"account_activation/activating_the_account/activation_edit_action","fig-not_activated_warning":"account_activation/activating_the_account/activation_edit_action","sec-exercises_activation_edit_action":"account_activation/activating_the_account/activation_edit_action","ex-5595f3":"account_activation/activating_the_account/activation_edit_action","ex-32e5f6":"account_activation/activating_the_account/activation_edit_action","sec-activation_test_and_refactoring":"account_activation/activating_the_account/activation_test_and_refactoring","code-signup_with_account_activation_test":"account_activation/activating_the_account/activation_test_and_refactoring","uid1436":"account_activation/activating_the_account/activation_test_and_refactoring","code-user_activation_methods":"account_activation/activating_the_account/activation_test_and_refactoring","code-user_signup_refactored":"account_activation/activating_the_account/activation_test_and_refactoring","code-account_activation_refactored":"account_activation/activating_the_account/activation_test_and_refactoring","uid1440":"account_activation/activating_the_account/activation_test_and_refactoring","sec-exercises_activation_test_and_refactoring":"account_activation/activating_the_account/activation_test_and_refactoring","ex-be2f50":"account_activation/activating_the_account/activation_test_and_refactoring","cha-11_footnote-ref-9":"account_activation/activating_the_account/activation_test_and_refactoring","ex-6dc5ff":"account_activation/activating_the_account/activation_test_and_refactoring","ex-935d6f":"account_activation/activating_the_account/activation_test_and_refactoring","code-update_columns":"account_activation/activating_the_account/activation_test_and_refactoring","code-show_only_active_users_exercise":"account_activation/activating_the_account/activation_test_and_refactoring","sec-activating_the_account":"account_activation/activating_the_account","sec-activation_email_in_production":"account_activation/activation_email_in_production","code-sendgrid_config":"account_activation/activation_email_in_production","fig-activation_email_production":"account_activation/activation_email_in_production","fig-activated_in_production":"account_activation/activation_email_in_production","sec-exercises_activation_email_in_production":"account_activation/activation_email_in_production","ex-010ba6":"account_activation/activation_email_in_production","ex-8b6970":"account_activation/activation_email_in_production","sec-activation_what_we_learned_in_this_chapter":"account_activation/activation_conclusion/activation_what_we_learned_in_this_chapter","sec-activation_conclusion":"account_activation/activation_conclusion","cha-account_activation":"account_activation","cha-11_footnote-ref-1":"account_activation","cha-11_footnote-ref-2":"account_activation","cha-11_footnote-ref-3":"account_activation","table-password_token_digest":"account_activation","cha-11_footnotes":"account_activation","cha-11_footnote-1":"account_activation","cha-11_footnote-2":"account_activation","cha-11_footnote-3":"account_activation","cha-11_footnote-4":"account_activation","cha-11_footnote-5":"account_activation","cha-11_footnote-6":"account_activation","cha-11_footnote-7":"account_activation","cha-11_footnote-8":"account_activation","cha-11_footnote-9":"account_activation","sec-password_resets_controller":"password_reset/password_resets_resource/password_resets_controller","code-password_resets_resource":"password_reset/password_resets_resource/password_resets_controller","table-RESTful_password_resets":"password_reset/password_resets_resource/password_resets_controller","code-log_in_password_reset":"password_reset/password_resets_resource/password_resets_controller","fig-forgot_password_link":"password_reset/password_resets_resource/password_resets_controller","sec-exercises_password_resets_controller":"password_reset/password_resets_resource/password_resets_controller","ex-4d9267":"password_reset/password_resets_resource/password_resets_controller","ex-17b50e":"password_reset/password_resets_resource/password_resets_controller","sec-new_password_resets":"password_reset/password_resets_resource/new_password_resets","fig-user_model_password_reset":"password_reset/password_resets_resource/new_password_resets","code-login_form_redux":"password_reset/password_resets_resource/new_password_resets","code-new_password_reset":"password_reset/password_resets_resource/new_password_resets","fig-forgot_password_form":"password_reset/password_resets_resource/new_password_resets","sec-exercises_new_password_resets":"password_reset/password_resets_resource/new_password_resets","ex-3421f4":"password_reset/password_resets_resource/new_password_resets","sec-password_reset_create_action":"password_reset/password_resets_resource/password_reset_create_action","cha-12_footnote-ref-2":"password_reset/password_resets_resource/password_reset_create_action","code-create_password_reset":"password_reset/password_resets_resource/password_reset_create_action","code-user_model_password_reset":"password_reset/password_resets_resource/password_reset_create_action","fig-invalid_email_password_reset":"password_reset/password_resets_resource/password_reset_create_action","sec-exercises_password_reset_create_action":"password_reset/password_resets_resource/password_reset_create_action","ex-2f9a24":"password_reset/password_resets_resource/password_reset_create_action","ex-6eac27":"password_reset/password_resets_resource/password_reset_create_action","sec-password_resets_resource":"password_reset/password_resets_resource","sec-password_reset_mailer":"password_reset/password_reset_emails/password_reset_mailer","code-mail_password_reset":"password_reset/password_reset_emails/password_reset_mailer","code-password_reset_text":"password_reset/password_reset_emails/password_reset_mailer","code-password_reset_html":"password_reset/password_reset_emails/password_reset_mailer","code-password_reset_preview":"password_reset/password_reset_emails/password_reset_mailer","fig-password_reset_html_preview":"password_reset/password_reset_emails/password_reset_mailer","fig-password_reset_text_preview":"password_reset/password_reset_emails/password_reset_mailer","fig-valid_email_password_reset":"password_reset/password_reset_emails/password_reset_mailer","code-password_reset_email":"password_reset/password_reset_emails/password_reset_mailer","sec-exercises_password_reset_mailer":"password_reset/password_reset_emails/password_reset_mailer","ex-eafd2c":"password_reset/password_reset_emails/password_reset_mailer","ex-2da441":"password_reset/password_reset_emails/password_reset_mailer","ex-e45e7a":"password_reset/password_reset_emails/password_reset_mailer","sec-reset_email_tests":"password_reset/password_reset_emails/reset_email_tests","code-password_reset_mailer_test":"password_reset/password_reset_emails/reset_email_tests","uid1510":"password_reset/password_reset_emails/reset_email_tests","sec-exercises_reset_email_tests":"password_reset/password_reset_emails/reset_email_tests","ex-902b57":"password_reset/password_reset_emails/reset_email_tests","ex-ff6506":"password_reset/password_reset_emails/reset_email_tests","sec-password_reset_emails":"password_reset/password_reset_emails","sec-reset_edit_action":"password_reset/resetting_the_password/reset_edit_action","code-password_reset_form":"password_reset/resetting_the_password/reset_edit_action","code-password_reset_edit_action":"password_reset/resetting_the_password/reset_edit_action","fig-password_reset_form":"password_reset/resetting_the_password/reset_edit_action","sec-exercises_reset_edit_action":"password_reset/resetting_the_password/reset_edit_action","ex-d39746":"password_reset/resetting_the_password/reset_edit_action","ex-fdabd9":"password_reset/resetting_the_password/reset_edit_action","sec-updating_the_reset":"password_reset/resetting_the_password/updating_the_reset","cha-12_footnote-ref-3":"password_reset/resetting_the_password/updating_the_reset","cha-12_footnote-ref-4":"password_reset/resetting_the_password/updating_the_reset","code-password_reset_update_action":"password_reset/resetting_the_password/updating_the_reset","code-user_model_password_reset_expired":"password_reset/resetting_the_password/updating_the_reset","fig-password_reset_failure":"password_reset/resetting_the_password/updating_the_reset","fig-password_reset_success":"password_reset/resetting_the_password/updating_the_reset","sec-exercises_updating_the_reset":"password_reset/resetting_the_password/updating_the_reset","ex-a3e543":"password_reset/resetting_the_password/updating_the_reset","ex-140f50":"password_reset/resetting_the_password/updating_the_reset","sec-password_reset_test":"password_reset/resetting_the_password/password_reset_test","code-password_reset_integration_test":"password_reset/resetting_the_password/password_reset_test","uid1537":"password_reset/resetting_the_password/password_reset_test","sec-exercises_password_reset_test":"password_reset/resetting_the_password/password_reset_test","ex-697d08":"password_reset/resetting_the_password/password_reset_test","ex-06cd0f":"password_reset/resetting_the_password/password_reset_test","cha-12_footnote-ref-5":"password_reset/resetting_the_password/password_reset_test","ex-680ffb":"password_reset/resetting_the_password/password_reset_test","ex-52ff2f":"password_reset/resetting_the_password/password_reset_test","code-update_columns_redux":"password_reset/resetting_the_password/password_reset_test","code-password_reset_expire_test":"password_reset/resetting_the_password/password_reset_test","code-update_clear_reset":"password_reset/resetting_the_password/password_reset_test","sec-resetting_the_password":"password_reset/resetting_the_password","sec-reset_email_in_production":"password_reset/reset_email_in_production","code-sendgrid_config_redux":"password_reset/reset_email_in_production","code-merge_password_reset":"password_reset/reset_email_in_production","fig-reset_email_production":"password_reset/reset_email_in_production","sec-exercises_reset_email_in_production":"password_reset/reset_email_in_production","ex-6c5c45":"password_reset/reset_email_in_production","ex-59f9aa":"password_reset/reset_email_in_production","ex-f449af":"password_reset/reset_email_in_production","sec-activation_resets_what_we_learned_in_this_chapter":"password_reset/resets_conclusion/activation_resets_what_we_learned_in_this_chapter","sec-resets_conclusion":"password_reset/resets_conclusion","sec-expiration_proof":"password_reset/expiration_proof","cha-12_footnote-ref-6":"password_reset/expiration_proof","eq-time_delta":"password_reset/expiration_proof","eq-delta_p":"password_reset/expiration_proof","eq-delta_e":"password_reset/expiration_proof","eq-time_comparison":"password_reset/expiration_proof","cha-password_reset":"password_reset","cha-12_footnote-ref-1":"password_reset","fig-login_forgot_password_mockup":"password_reset","fig-forgot_password_form_mockup":"password_reset","fig-reset_password_form_mockup":"password_reset","cha-12_footnotes":"password_reset","cha-12_footnote-1":"password_reset","cha-12_footnote-2":"password_reset","cha-12_footnote-3":"password_reset","cha-12_footnote-4":"password_reset","cha-12_footnote-5":"password_reset","cha-12_footnote-6":"password_reset","sec-the_basic_model":"user_microposts/a_micropost_model/the_basic_model","fig-micropost_model":"user_microposts/a_micropost_model/the_basic_model","cha-13_footnote-ref-2":"user_microposts/a_micropost_model/the_basic_model","code-generate_micropost_model":"user_microposts/a_micropost_model/the_basic_model","code-micropost_model":"user_microposts/a_micropost_model/the_basic_model","cha-13_footnote-ref-3":"user_microposts/a_micropost_model/the_basic_model","code-micropost_migration":"user_microposts/a_micropost_model/the_basic_model","sec-exercises_the_basic_model":"user_microposts/a_micropost_model/the_basic_model","ex-e34987":"user_microposts/a_micropost_model/the_basic_model","ex-4d1441":"user_microposts/a_micropost_model/the_basic_model","ex-7d471e":"user_microposts/a_micropost_model/the_basic_model","sec-micropost_validations":"user_microposts/a_micropost_model/micropost_validations","code-micropost_validity_test":"user_microposts/a_micropost_model/micropost_validations","code-micropost_user_id_validation":"user_microposts/a_micropost_model/micropost_validations","uid1583":"user_microposts/a_micropost_model/micropost_validations","code-micropost_validations_tests":"user_microposts/a_micropost_model/micropost_validations","code-micropost_validations":"user_microposts/a_micropost_model/micropost_validations","uid1586":"user_microposts/a_micropost_model/micropost_validations","sec-exercises_micropost_validations":"user_microposts/a_micropost_model/micropost_validations","ex-0b976b":"user_microposts/a_micropost_model/micropost_validations","ex-9e9f2b":"user_microposts/a_micropost_model/micropost_validations","sec-user_micropost_associations":"user_microposts/a_micropost_model/user_micropost_associations","fig-micropost_belongs_to_user":"user_microposts/a_micropost_model/user_micropost_associations","fig-user_has_many_microposts":"user_microposts/a_micropost_model/user_micropost_associations","table-association_methods":"user_microposts/a_micropost_model/user_micropost_associations","code-micropost_belongs_to_user":"user_microposts/a_micropost_model/user_micropost_associations","code-user_has_many_microposts":"user_microposts/a_micropost_model/user_micropost_associations","code-micropost_validity_test_idiomatic":"user_microposts/a_micropost_model/user_micropost_associations","uid1597":"user_microposts/a_micropost_model/user_micropost_associations","sec-exercises_user_micropost_associations":"user_microposts/a_micropost_model/user_micropost_associations","ex-e4a0bb":"user_microposts/a_micropost_model/user_micropost_associations","ex-481476":"user_microposts/a_micropost_model/user_micropost_associations","ex-90cee5":"user_microposts/a_micropost_model/user_micropost_associations","sec-ordering_and_dependency":"user_microposts/a_micropost_model/ordering_and_dependency","sec-default_scope":"user_microposts/a_micropost_model/ordering_and_dependency","cha-13_footnote-ref-4":"user_microposts/a_micropost_model/ordering_and_dependency","code-micropost_order_test":"user_microposts/a_micropost_model/ordering_and_dependency","code-micropost_fixtures":"user_microposts/a_micropost_model/ordering_and_dependency","uid1607":"user_microposts/a_micropost_model/ordering_and_dependency","cha-13_footnote-ref-5":"user_microposts/a_micropost_model/ordering_and_dependency","code-micropost_ordering":"user_microposts/a_micropost_model/ordering_and_dependency","uid1610":"user_microposts/a_micropost_model/ordering_and_dependency","sec-dependent_destroy":"user_microposts/a_micropost_model/ordering_and_dependency","code-micropost_dependency":"user_microposts/a_micropost_model/ordering_and_dependency","code-dependent_destroy_test":"user_microposts/a_micropost_model/ordering_and_dependency","uid1614":"user_microposts/a_micropost_model/ordering_and_dependency","sec-exercises_ordering_and_dependency":"user_microposts/a_micropost_model/ordering_and_dependency","ex-3816f5":"user_microposts/a_micropost_model/ordering_and_dependency","ex-e34fbc":"user_microposts/a_micropost_model/ordering_and_dependency","ex-ec2e6b":"user_microposts/a_micropost_model/ordering_and_dependency","sec-a_micropost_model":"user_microposts/a_micropost_model","sec-rendering_microposts":"user_microposts/showing_microposts/rendering_microposts","code-micropost_partial":"user_microposts/showing_microposts/rendering_microposts","code-user_show_microposts_instance":"user_microposts/showing_microposts/rendering_microposts","code-user_show_microposts":"user_microposts/showing_microposts/rendering_microposts","fig-user_profile_no_microposts":"user_microposts/showing_microposts/rendering_microposts","sec-exercises_rendering_microposts":"user_microposts/showing_microposts/rendering_microposts","ex-15ca47":"user_microposts/showing_microposts/rendering_microposts","ex-df8fbd":"user_microposts/showing_microposts/rendering_microposts","sec-sample_microposts":"user_microposts/showing_microposts/sample_microposts","cha-13_footnote-ref-6":"user_microposts/showing_microposts/sample_microposts","code-sample_microposts":"user_microposts/showing_microposts/sample_microposts","cha-13_footnote-ref-7":"user_microposts/showing_microposts/sample_microposts","fig-user_profile_microposts_no_styling":"user_microposts/showing_microposts/sample_microposts","cha-13_footnote-ref-8":"user_microposts/showing_microposts/sample_microposts","code-micropost_css":"user_microposts/showing_microposts/sample_microposts","fig-user_profile_with_microposts":"user_microposts/showing_microposts/sample_microposts","fig-other_profile_with_microposts":"user_microposts/showing_microposts/sample_microposts","fig-user_profile_microposts":"user_microposts/showing_microposts/sample_microposts","sec-exercises_sample_microposts":"user_microposts/showing_microposts/sample_microposts","ex-fd82f0":"user_microposts/showing_microposts/sample_microposts","ex-a83797":"user_microposts/showing_microposts/sample_microposts","ex-c6f975":"user_microposts/showing_microposts/sample_microposts","sec-profile_micropost_tests":"user_microposts/showing_microposts/profile_micropost_tests","code-updated_micropost_fixtures":"user_microposts/showing_microposts/profile_micropost_tests","cha-13_footnote-ref-9":"user_microposts/showing_microposts/profile_micropost_tests","code-user_profile_test":"user_microposts/showing_microposts/profile_micropost_tests","uid1647":"user_microposts/showing_microposts/profile_micropost_tests","sec-exercises_profile_micropost_tests":"user_microposts/showing_microposts/profile_micropost_tests","ex-339c33":"user_microposts/showing_microposts/profile_micropost_tests","ex-7c1373":"user_microposts/showing_microposts/profile_micropost_tests","sec-showing_microposts":"user_microposts/showing_microposts","fig-user_microposts_mockup":"user_microposts/showing_microposts","sec-micropost_access_control":"user_microposts/manipulating_microposts/micropost_access_control","code-create_destroy_micropost_tests":"user_microposts/manipulating_microposts/micropost_access_control","cha-13_footnote-ref-10":"user_microposts/manipulating_microposts/micropost_access_control","code-sessions_helper_authenticate":"user_microposts/manipulating_microposts/micropost_access_control","code-users_controller_remove_logged_in_filter":"user_microposts/manipulating_microposts/micropost_access_control","code-microposts_controller_access_control":"user_microposts/manipulating_microposts/micropost_access_control","uid1659":"user_microposts/manipulating_microposts/micropost_access_control","sec-exercises_access_control":"user_microposts/manipulating_microposts/micropost_access_control","ex-12f331":"user_microposts/manipulating_microposts/micropost_access_control","sec-creating_microposts":"user_microposts/manipulating_microposts/creating_microposts","fig-home_page_with_micropost_form_mockup":"user_microposts/manipulating_microposts/creating_microposts","code-microposts_create_action":"user_microposts/manipulating_microposts/creating_microposts","code-microposts_home_page":"user_microposts/manipulating_microposts/creating_microposts","code-user_info":"user_microposts/manipulating_microposts/creating_microposts","code-micropost_form":"user_microposts/manipulating_microposts/creating_microposts","code-micropost_instance_variable":"user_microposts/manipulating_microposts/creating_microposts","code-updated_error_messages_partial":"user_microposts/manipulating_microposts/creating_microposts","uid1670":"user_microposts/manipulating_microposts/creating_microposts","code-signup_errors_updated":"user_microposts/manipulating_microposts/creating_microposts","code-edit_errors_updated":"user_microposts/manipulating_microposts/creating_microposts","code-password_reset_updated":"user_microposts/manipulating_microposts/creating_microposts","fig-home_with_form":"user_microposts/manipulating_microposts/creating_microposts","fig-home_form_errors":"user_microposts/manipulating_microposts/creating_microposts","sec-exercises_creating_microposts":"user_microposts/manipulating_microposts/creating_microposts","ex-9fa8e4":"user_microposts/manipulating_microposts/creating_microposts","sec-a_proto_feed":"user_microposts/manipulating_microposts/a_proto_feed","fig-proto_feed_mockup":"user_microposts/manipulating_microposts/a_proto_feed","cha-13_footnote-ref-11":"user_microposts/manipulating_microposts/a_proto_feed","code-proto_status_feed":"user_microposts/manipulating_microposts/a_proto_feed","code-feed_instance_variable":"user_microposts/manipulating_microposts/a_proto_feed","code-feed_partial":"user_microposts/manipulating_microposts/a_proto_feed","code-home_with_feed":"user_microposts/manipulating_microposts/a_proto_feed","fig-home_with_proto_feed":"user_microposts/manipulating_microposts/a_proto_feed","fig-micropost_created":"user_microposts/manipulating_microposts/a_proto_feed","code-microposts_create_action_with_feed":"user_microposts/manipulating_microposts/a_proto_feed","sec-exercises_a_proto_feed":"user_microposts/manipulating_microposts/a_proto_feed","ex-31697d":"user_microposts/manipulating_microposts/a_proto_feed","ex-e4ef4b":"user_microposts/manipulating_microposts/a_proto_feed","sec-destroying_microposts":"user_microposts/manipulating_microposts/destroying_microposts","fig-micropost_delete_links_mockup":"user_microposts/manipulating_microposts/destroying_microposts","code-micropost_partial_with_delete":"user_microposts/manipulating_microposts/destroying_microposts","code-microposts_destroy_action":"user_microposts/manipulating_microposts/destroying_microposts","cha-13_footnote-ref-12":"user_microposts/manipulating_microposts/destroying_microposts","cha-13_footnote-ref-13":"user_microposts/manipulating_microposts/destroying_microposts","fig-home_post_delete":"user_microposts/manipulating_microposts/destroying_microposts","sec-exercises_destroying_microposts":"user_microposts/manipulating_microposts/destroying_microposts","ex-48d333":"user_microposts/manipulating_microposts/destroying_microposts","ex-f7f907":"user_microposts/manipulating_microposts/destroying_microposts","sec-micropost_tests":"user_microposts/manipulating_microposts/micropost_tests","code-add_micropost_different_owner":"user_microposts/manipulating_microposts/micropost_tests","code-micropost_user_mismatch_test":"user_microposts/manipulating_microposts/micropost_tests","code-microposts_interface_test":"user_microposts/manipulating_microposts/micropost_tests","uid1705":"user_microposts/manipulating_microposts/micropost_tests","sec-exercises_micropost_tests":"user_microposts/manipulating_microposts/micropost_tests","ex-6a791b":"user_microposts/manipulating_microposts/micropost_tests","ex-0a7044":"user_microposts/manipulating_microposts/micropost_tests","code-sidebar_micropost_count":"user_microposts/manipulating_microposts/micropost_tests","sec-manipulating_microposts":"user_microposts/manipulating_microposts","code-microposts_resource":"user_microposts/manipulating_microposts","table-RESTful_microposts":"user_microposts/manipulating_microposts","sec-basic_image_upload":"user_microposts/micropost_images/basic_image_upload","cha-13_footnote-ref-15":"user_microposts/micropost_images/basic_image_upload","code-gemfile_carrierwave":"user_microposts/micropost_images/basic_image_upload","cha-13_footnote-ref-16":"user_microposts/micropost_images/basic_image_upload","fig-micropost_model_picture":"user_microposts/micropost_images/basic_image_upload","code-micropost_model_picture":"user_microposts/micropost_images/basic_image_upload","cha-13_footnote-ref-17":"user_microposts/micropost_images/basic_image_upload","code-micropost_create_image_upload":"user_microposts/micropost_images/basic_image_upload","code-micropost_params_picture":"user_microposts/micropost_images/basic_image_upload","code-micropost_partial_image_display":"user_microposts/micropost_images/basic_image_upload","fig-micropost_with_image":"user_microposts/micropost_images/basic_image_upload","sec-exercises_basic_image_upload":"user_microposts/micropost_images/basic_image_upload","ex-98ef20":"user_microposts/micropost_images/basic_image_upload","cha-13_footnote-ref-18":"user_microposts/micropost_images/basic_image_upload","ex-5b20bb":"user_microposts/micropost_images/basic_image_upload","code-image_upload_test":"user_microposts/micropost_images/basic_image_upload","sec-image_validation":"user_microposts/micropost_images/image_validation","code-validate_picture_format":"user_microposts/micropost_images/image_validation","code-micropost_model_image_validation":"user_microposts/micropost_images/image_validation","cha-13_footnote-ref-19":"user_microposts/micropost_images/image_validation","cha-13_footnote-ref-20":"user_microposts/micropost_images/image_validation","code-jquery_file_test":"user_microposts/micropost_images/image_validation","sec-exercises_image_validation":"user_microposts/micropost_images/image_validation","ex-8ab2dc":"user_microposts/micropost_images/image_validation","ex-70fb50":"user_microposts/micropost_images/image_validation","sec-image_resizing":"user_microposts/micropost_images/image_resizing","cha-13_footnote-ref-21":"user_microposts/micropost_images/image_resizing","fig-large_uploaded_image":"user_microposts/micropost_images/image_resizing","cha-13_footnote-ref-22":"user_microposts/micropost_images/image_resizing","code-image_uploader_resizing":"user_microposts/micropost_images/image_resizing","fig-resized_image":"user_microposts/micropost_images/image_resizing","sec-exercises_image_resizing":"user_microposts/micropost_images/image_resizing","ex-be0762":"user_microposts/micropost_images/image_resizing","ex-18159f":"user_microposts/micropost_images/image_resizing","code-skip_resize_initializer":"user_microposts/micropost_images/image_resizing","sec-image_upload_in_production":"user_microposts/micropost_images/image_upload_in_production","cha-13_footnote-ref-23":"user_microposts/micropost_images/image_upload_in_production","cha-13_footnote-ref-24":"user_microposts/micropost_images/image_upload_in_production","code-image_uploader_production":"user_microposts/micropost_images/image_upload_in_production","cha-13_footnote-ref-25":"user_microposts/micropost_images/image_upload_in_production","cha-13_footnote-ref-26":"user_microposts/micropost_images/image_upload_in_production","code-carrier_wave_configuration":"user_microposts/micropost_images/image_upload_in_production","code-gitignore_uploads":"user_microposts/micropost_images/image_upload_in_production","fig-image_upload_production":"user_microposts/micropost_images/image_upload_in_production","sec-exercises_image_upload_in_production":"user_microposts/micropost_images/image_upload_in_production","ex-f48355":"user_microposts/micropost_images/image_upload_in_production","sec-micropost_images":"user_microposts/micropost_images","cha-13_footnote-ref-14":"user_microposts/micropost_images","fig-micropost_image_mockup":"user_microposts/micropost_images","sec-user_microposts_what_we_learned_in_this_chapter":"user_microposts/user_microposts_conclusion/user_microposts_what_we_learned_in_this_chapter","sec-user_microposts_conclusion":"user_microposts/user_microposts_conclusion","cha-13_footnote-ref-27":"user_microposts/user_microposts_conclusion","code-final_gemfile":"user_microposts/user_microposts_conclusion","cha-user_microposts":"user_microposts","cha-13_footnote-ref-1":"user_microposts","cha-13_footnotes":"user_microposts","cha-13_footnote-1":"user_microposts","cha-13_footnote-2":"user_microposts","cha-13_footnote-3":"user_microposts","cha-13_footnote-4":"user_microposts","cha-13_footnote-5":"user_microposts","cha-13_footnote-6":"user_microposts","cha-13_footnote-7":"user_microposts","cha-13_footnote-8":"user_microposts","cha-13_footnote-9":"user_microposts","cha-13_footnote-10":"user_microposts","cha-13_footnote-11":"user_microposts","cha-13_footnote-12":"user_microposts","cha-13_footnote-13":"user_microposts","cha-13_footnote-14":"user_microposts","cha-13_footnote-15":"user_microposts","cha-13_footnote-16":"user_microposts","cha-13_footnote-17":"user_microposts","cha-13_footnote-18":"user_microposts","cha-13_footnote-19":"user_microposts","cha-13_footnote-20":"user_microposts","cha-13_footnote-21":"user_microposts","cha-13_footnote-22":"user_microposts","cha-13_footnote-23":"user_microposts","cha-13_footnote-24":"user_microposts","cha-13_footnote-25":"user_microposts","cha-13_footnote-26":"user_microposts","cha-13_footnote-27":"user_microposts","sec-a_problem_with_the_data_model":"following_users/the_relationship_model/a_problem_with_the_data_model","cha-14_footnote-ref-2":"following_users/the_relationship_model/a_problem_with_the_data_model","fig-naive_user_has_many_following":"following_users/the_relationship_model/a_problem_with_the_data_model","cha-14_footnote-ref-3":"following_users/the_relationship_model/a_problem_with_the_data_model","fig-user_has_many_following":"following_users/the_relationship_model/a_problem_with_the_data_model","fig-relationship_model":"following_users/the_relationship_model/a_problem_with_the_data_model","code-relationships_migration":"following_users/the_relationship_model/a_problem_with_the_data_model","sec-exercises_a_problem_with_the_data_model":"following_users/the_relationship_model/a_problem_with_the_data_model","ex-a7cab2":"following_users/the_relationship_model/a_problem_with_the_data_model","ex-47cec8":"following_users/the_relationship_model/a_problem_with_the_data_model","sec-relationship_user_associations":"following_users/the_relationship_model/relationship_user_associations","cha-14_footnote-ref-4":"following_users/the_relationship_model/relationship_user_associations","cha-14_footnote-ref-5":"following_users/the_relationship_model/relationship_user_associations","code-user_relationships_association":"following_users/the_relationship_model/relationship_user_associations","code-relationship_belongs_to":"following_users/the_relationship_model/relationship_user_associations","table-association_methods_relationships":"following_users/the_relationship_model/relationship_user_associations","sec-exercises_relationship_user_associations":"following_users/the_relationship_model/relationship_user_associations","ex-158b52":"following_users/the_relationship_model/relationship_user_associations","ex-bc5326":"following_users/the_relationship_model/relationship_user_associations","sec-relationship_validations":"following_users/the_relationship_model/relationship_validations","code-relationship_validation_tests":"following_users/the_relationship_model/relationship_validations","code-relationship_validations":"following_users/the_relationship_model/relationship_validations","code-empty_relationship_fixture":"following_users/the_relationship_model/relationship_validations","uid1807":"following_users/the_relationship_model/relationship_validations","sec-exercises_relationship_validations":"following_users/the_relationship_model/relationship_validations","ex-0003a9":"following_users/the_relationship_model/relationship_validations","sec-following":"following_users/the_relationship_model/following","code-has_many_following_through_active_relationships":"following_users/the_relationship_model/following","cha-14_footnote-ref-6":"following_users/the_relationship_model/following","code-utility_method_tests":"following_users/the_relationship_model/following","code-follow_unfollow_following":"following_users/the_relationship_model/following","uid1815":"following_users/the_relationship_model/following","sec-exercises_following":"following_users/the_relationship_model/following","ex-c750b5":"following_users/the_relationship_model/following","ex-0876ac":"following_users/the_relationship_model/following","sec-followers":"following_users/the_relationship_model/followers","fig-user_has_many_followers":"following_users/the_relationship_model/followers","code-has_many_following_through_passive_relationships":"following_users/the_relationship_model/followers","code-followers_test":"following_users/the_relationship_model/followers","sec-exercises_followers":"following_users/the_relationship_model/followers","ex-a97f17":"following_users/the_relationship_model/followers","ex-61e463":"following_users/the_relationship_model/followers","ex-c79c64":"following_users/the_relationship_model/followers","sec-the_relationship_model":"following_users/the_relationship_model","sec-sample_following_data":"following_users/a_web_interface_for_following_and_followers/sample_following_data","code-sample_relationships":"following_users/a_web_interface_for_following_and_followers/sample_following_data","sec-exercises_sample_following_data":"following_users/a_web_interface_for_following_and_followers/sample_following_data","ex-a7b803":"following_users/a_web_interface_for_following_and_followers/sample_following_data","ex-b4bbb0":"following_users/a_web_interface_for_following_and_followers/sample_following_data","sec-stats_and_a_follow_form":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","fig-stats_partial_mockup":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-following_followers_actions_routes":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","cha-14_footnote-ref-7":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","table-following_routes":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-stats_partial":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-home_page_stats":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-stats_css":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","fig-home_page_follow_stats":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-follow_form_partial":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-relationships_resource":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-follow_form":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-unfollow_form":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","code-user_follow_form_profile_stats":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","fig-profile_follow_button":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","fig-profile_unfollow_button":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","sec-exercises_stats_and_a_follow_form":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","ex-2a6762":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","ex-62859b":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","ex-0bb8bf":"following_users/a_web_interface_for_following_and_followers/stats_and_a_follow_form","sec-following_and_followers_pages":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","fig-following_mockup":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","fig-followers_mockup":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","code-following_followers_authorization_test":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","code-following_followers_actions":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","code-show_follow_view":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","fig-user_following":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","fig-user_followers":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","fig-different_user_followers":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","uid1861":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","code-relationships_fixtures":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","code-following_tests":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","uid1864":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","sec-exercises_":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","ex-64cc1d":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","ex-68811a":"following_users/a_web_interface_for_following_and_followers/following_and_followers_pages","sec-a_working_follow_button_the_standard_way":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","code-relationships_access_control":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","code-relationships_controller":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","code-relationships_controller_following":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","fig-unfollowed_user":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","fig-followed_user":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","sec-exercises_a_working_follow_button_the_standard_way":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","ex-b57314":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","ex-04f8d5":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_the_standard_way","sec-a_working_follow_button_with_ajax":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","cha-14_footnote-ref-8":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","code-follow_form_ajax":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","code-unfollow_form_ajax":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","code-relationships_controller_ajax":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","code-degrade_gracefully":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","code-create_js_erb":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","code-destroy_js_erb":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","sec-exercises_a_working_follow_button_with_ajax":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","ex-8991b6":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","ex-d7e936":"following_users/a_web_interface_for_following_and_followers/a_working_follow_button_with_ajax","sec-following_tests":"following_users/a_web_interface_for_following_and_followers/following_tests","code-follow_button_tests":"following_users/a_web_interface_for_following_and_followers/following_tests","uid1890":"following_users/a_web_interface_for_following_and_followers/following_tests","sec-exercises_following_tests":"following_users/a_web_interface_for_following_and_followers/following_tests","ex-96d361":"following_users/a_web_interface_for_following_and_followers/following_tests","ex-90699b":"following_users/a_web_interface_for_following_and_followers/following_tests","sec-a_web_interface_for_following_and_followers":"following_users/a_web_interface_for_following_and_followers","sec-motivation_and_strategy":"following_users/the_status_feed/motivation_and_strategy","fig-user_feed":"following_users/the_status_feed/motivation_and_strategy","code-full_feed_test":"following_users/the_status_feed/motivation_and_strategy","uid1898":"following_users/the_status_feed/motivation_and_strategy","sec-exercises_motivation_and_strategy":"following_users/the_status_feed/motivation_and_strategy","ex-da79ac":"following_users/the_status_feed/motivation_and_strategy","sec-a_first_feed_implementation":"following_users/the_status_feed/a_first_feed_implementation","cha-14_footnote-ref-9":"following_users/the_status_feed/a_first_feed_implementation","code-initial_working_feed":"following_users/the_status_feed/a_first_feed_implementation","uid1904":"following_users/the_status_feed/a_first_feed_implementation","sec-exercises_a_first_feed_implementation":"following_users/the_status_feed/a_first_feed_implementation","ex-aef112":"following_users/the_status_feed/a_first_feed_implementation","ex-5f14ae":"following_users/the_status_feed/a_first_feed_implementation","ex-102e2b":"following_users/the_status_feed/a_first_feed_implementation","sec-scopes_subselects_and_a_lambda":"following_users/the_status_feed/scopes_subselects_and_a_lambda","code-feed_second_cut":"following_users/the_status_feed/scopes_subselects_and_a_lambda","code-feed_final":"following_users/the_status_feed/scopes_subselects_and_a_lambda","uid1912":"following_users/the_status_feed/scopes_subselects_and_a_lambda","fig-home_page_with_feed":"following_users/the_status_feed/scopes_subselects_and_a_lambda","fig-live_status_feed":"following_users/the_status_feed/scopes_subselects_and_a_lambda","sec-exercises_scopes_subselects_and_a_lambda":"following_users/the_status_feed/scopes_subselects_and_a_lambda","ex-1d34e5":"following_users/the_status_feed/scopes_subselects_and_a_lambda","ex-05d0df":"following_users/the_status_feed/scopes_subselects_and_a_lambda","code-home_feed_test":"following_users/the_status_feed/scopes_subselects_and_a_lambda","sec-the_status_feed":"following_users/the_status_feed","fig-home_page_feed_mockup":"following_users/the_status_feed","sec-guide_to_further_resources":"following_users/following_conclusion/guide_to_further_resources","sec-following_users_what_we_learned_in_this_chapter":"following_users/following_conclusion/following_users_what_we_learned_in_this_chapter","sec-following_conclusion":"following_users/following_conclusion","cha-following_users":"following_users","cha-14_footnote-ref-1":"following_users","fig-page_flow_profile_mockup":"following_users","fig-page_flow_user_index_mockup":"following_users","fig-page_flow_other_profile_follow_button":"following_users","fig-page_flow_other_profile_unfollow_button_mockup":"following_users","fig-page_flow_home_page_feed_mockup":"following_users","cha-14_footnotes":"following_users","cha-14_footnote-1":"following_users","cha-14_footnote-2":"following_users","cha-14_footnote-3":"following_users","cha-14_footnote-4":"following_users","cha-14_footnote-5":"following_users","cha-14_footnote-6":"following_users","cha-14_footnote-7":"following_users","cha-14_footnote-8":"following_users","cha-14_footnote-9":"following_users"},
      footnotes: {"cha-0_footnote-1":"This is not typical!\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Getting through the entire book usually takes \u003cem\u003emuch\u003c/em\u003e longer than three days. ","cha-1_footnote-1":" learnenough.com/story","cha-1_footnote-2":" learnenough.com/command-line","cha-1_footnote-3":" The most up-to-date version of the \u003cem\u003eRuby on Rails Tutorial\u003c/em\u003e can be found on the book’s website at \u003ca href=\"https://www.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.railstutorial.org/\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e If you are reading this book offline, be sure to check the \u003ca href=\"https://www.railstutorial.org/book\" target=\"_blank\" rel=\"noopener\"\u003eonline version of the Rails Tutorial book\u003c/a\u003e at \u003ca href=\"https://www.railstutorial.org/book\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.railstutorial.org/book\u003c/a\u003e for the latest updates.","cha-1_footnote-4":" \u003cem\u003eURI\u003c/em\u003e stands for Uniform Resource Identifier, while the slightly less general \u003cem\u003eURL\u003c/em\u003e stands for Uniform Resource Locator.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In practice, the URL is usually equivalent to “the thing you see in the address bar of your browser”.","cha-1_footnote-5":" railstutorial.org/help","cha-1_footnote-6":" For example, to find the definition of a function called \u003ccode\u003efoo\u003c/code\u003e, you can do a global search for “def foo”.","cha-1_footnote-7":" Due to the constantly evolving nature of sites like AWS, details may vary; use your technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e) to resolve any discrepancies.","cha-1_footnote-8":" https://aws.amazon.com/","cha-1_footnote-9":" https://www.railstutorial.org/cloud9-signup","cha-1_footnote-10":" If you’re curious, you can learn about more \u003ccode\u003eprintf\u003c/code\u003e using \u003ccode\u003eman printf\u003c/code\u003e, as described in \u003ca href=\"https://www.learnenough.com/command-line\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eLearn Enough Command Line to Be Dangerous\u003c/em\u003e\u003c/a\u003e.","cha-1_footnote-11":" learnenough.com/command-line","cha-1_footnote-12":" This is a typical example of technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e).","cha-1_footnote-13":" Similarly, \u003ccode\u003e~\u0026gt; 4.0\u003c/code\u003e would install version \u003ccode\u003e4.9\u003c/code\u003e of a gem but not \u003ccode\u003e5.0\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is especially useful if the project in question uses \u003ca href=\"https://semver.org/\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003esemantic versioning\u003c/em\u003e\u003c/a\u003e (also called “semver”), which is a convention for numbering releases designed to minimize the chances of breaking software dependencies.","cha-1_footnote-14":" As noted in \u003ca href=\"static_pages_fragment.html#table-shortcuts\" class=\"hyperref\"\u003eTable \u003cspan class=\"ref\"\u003e3.1\u003c/span\u003e\u003c/a\u003e, you can even leave off \u003ccode\u003einstall\u003c/code\u003e, as the \u003ccode\u003ebundle\u003c/code\u003e command by itself is an alias for \u003ccode\u003ebundle install\u003c/code\u003e.","cha-1_footnote-15":" Here “C” refers to the character on the keyboard, not the capital letter, so there’s no need to hold down the Shift key to get a capital “C”.","cha-1_footnote-16":" The base URL for the Rails Tutorial Cloud9 shared URLs has changed from rails-tutorial-c9-mhartl.c9.io to one on Amazon Web Services, but in many cases the screenshots are identical, so the browser address bar will show old-style URLs in some figures (such as \u003ca href=\"beginning_fragment.html#fig-hello_world_hello_app\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e1.14\u003c/span\u003e\u003c/a\u003e).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is the sort of minor discrepancy you can resolve using your technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e).","cha-1_footnote-17":" Your editor may display a message like “invalid multibyte character”, but this is not a cause for concern.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e You can \u003ca href=\"https://www.google.com/search?q=invalid+multibyte+character\" target=\"_blank\" rel=\"noopener\"\u003eGoogle the error message\u003c/a\u003e if you want to learn how to make it go away.","cha-1_footnote-18":" learnenough.com/git","cha-1_footnote-19":" Although we’ll never need to edit it in the main tutorial, an example of adding a rule to the \u003ccode\u003e.gitignore\u003c/code\u003e file appears in \u003ca href=\"static_pages_fragment.html#sec-guard\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e3.6.2\u003c/span\u003e\u003c/a\u003e, which is part of the optional advanced testing setup in \u003ca href=\"static_pages_fragment.html#sec-advanced_testing_setup\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e3.6\u003c/span\u003e\u003c/a\u003e.","cha-1_footnote-20":" Because of how my public keys are set up on Cloud9, I created the repository as railstutorial and then added my main account, mhartl, as a collaborator.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e As a result, I can make commits under either account name.","cha-1_footnote-21":" See \u003ca href=\"https://www.learnenough.com/text-editor\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eLearn Enough Text Editor to Be Dangerous\u003c/em\u003e\u003c/a\u003e and \u003ca href=\"https://www.learnenough.com/git\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eLearn Enough Git to Be Dangerous\u003c/em\u003e\u003c/a\u003e for more information about Markdown.","cha-2_footnote-1":" Because microposts are short by design, the \u003ccode\u003estring\u003c/code\u003e type is actually big enough to contain them, but using \u003ccode\u003etext\u003c/code\u003e better expresses our intent, while also giving us greater flexibility should we ever wish to relax the length constraint.","cha-2_footnote-2":" The name of the scaffold follows the convention of \u003cem\u003emodels\u003c/em\u003e, which are singular, rather than resources and controllers, which are plural.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thus, we have \u003ccode\u003eUser\u003c/code\u003e instead of \u003ccode\u003eUsers\u003c/code\u003e.","cha-2_footnote-3":" Some references indicate that the view returns the HTML directly to the browser (via a webserver such as Apache or Nginx).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Regardless of the implementation details, I find it helpful to think of the controller as a central hub through which all the application’s information flows.","cha-2_footnote-4":" Fielding, Roy Thomas.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e \u003cem\u003eArchitectural Styles and the Design of Network-based Software Architectures\u003c/em\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Doctoral dissertation, University of California, Irvine, 2000.","cha-2_footnote-5":" As with the User scaffold, the scaffold generator for microposts follows the singular convention of Rails models; thus, we have \u003ccode\u003egenerate Micropost\u003c/code\u003e.","cha-2_footnote-6":" The scaffold code may have extra blank lines compared to \u003ca href=\"toy_app_fragment.html#code-demo_microposts_resource\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e2.11\u003c/span\u003e\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is not a cause for concern, as Ruby ignores such extra space.","cha-2_footnote-7":" Your console prompt might be something like \u003ccode class=\"tt\"\u003e2.1.1 :001 \u0026gt;\u003c/code\u003e, but the examples use \u003ccode class=\"inline_verbatim\"\u003e\u0026gt;\u0026gt;\u003c/code\u003e since Ruby versions will vary.","cha-2_footnote-8":" As with “Ctrl-C”, the capital “D” refers to the key on the keyboard, not the capital letter, so you don’t have to hold down the Shift key along with the Ctrl key.","cha-2_footnote-9":" The production database should work without any additional configuration, but in fact some configuration is recommended by the \u003ca href=\"https://devcenter.heroku.com/articles/getting-started-with-rails5\" target=\"_blank\" rel=\"noopener\"\u003eofficial Heroku documentation\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e We’ll take care of this detail in \u003ca href=\"sign_up_fragment.html#sec-production_database_configuration\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e7.5.3\u003c/span\u003e\u003c/a\u003e.","cha-2_footnote-10":"As with “Ctrl-C”, the capital “D” refers to the key on the keyboard, not the capital letter, so you don’t have to hold down the Shift key along with the Ctrl key. ","cha-2_footnote-11":"As with “Ctrl-C”, the capital “D” refers to the key on the keyboard, not the capital letter, so you don’t have to hold down the Shift key along with the Ctrl key. ","cha-1_footnote-22":" For a convenient way to visualize Git repositories, take a look at \u003ca href=\"https://www.sourcetreeapp.com/\" target=\"_blank\" rel=\"noopener\"\u003eAtlassian’s SourceTree app\u003c/a\u003e.","cha-1_footnote-23":" See, for example, the section on \u003ca href=\"https://www.learnenough.com/r/learn_enough_git/collaborating\" target=\"_blank\" rel=\"noopener\"\u003eCollaborating\u003c/a\u003e in \u003ca href=\"https://www.learnenough.com/git\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eLearn Enough Git to Be Dangerous\u003c/em\u003e\u003c/a\u003e.","cha-3_footnote-1":" If you’re using the cloud IDE, it’s often useful to use the “Goto Anything” command, which makes it easy to navigate the filesystem by typing in partial filenames.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In this context, having the hello, toy, and sample apps present in the same project can be inconvenient due to the many common filenames.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, when searching for a file called “Gemfile”, six possibilities will show up, because each project has matching files called \u003ccode\u003eGemfile\u003c/code\u003e and \u003ccode\u003eGemfile.lock\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thus, you may want to consider removing the first two apps before proceeding, which you can do by navigating to the \u003ccode\u003eenvironment\u003c/code\u003e directory and running \u003ccode\u003erm -rf hello_app/ toy_app/\u003c/code\u003e (\u003ca href=\"beginning_fragment.html#table-unix_commands\" class=\"hyperref\"\u003eTable \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (As long as you pushed the corresponding repositories up to Bitbucket, you can always recover them later.)","cha-3_footnote-2":" bitbucket.org/railstutorial/sample_app_4th_ed","cha-3_footnote-3":" It’s worth noting that \u003ccode\u003e--without production\u003c/code\u003e is a “remembered option”, which means it will be included automatically the next time we run \u003ccode\u003ebundle install\u003c/code\u003e.","cha-3_footnote-4":" Generally speaking, it’s a good idea for the development and production environments to match as closely as possible, which includes using the same database, so I recommend eventually learning how to install and configure PostgreSQL in development—but now is not that time.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e When the time comes, Google “install configure postgresql \u0026lt;your system\u0026gt;” and “rails postgresql setup”, and prepare for a challenge.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (On the cloud IDE, \u0026lt;your system\u0026gt; is Linux.)","cha-3_footnote-5":" The README also makes reference to a LICENSE file, which I’ve added by hand to the official \u003ca href=\"https://bitbucket.org/railstutorial/sample_app_4th_ed\" target=\"_blank\" rel=\"noopener\"\u003ereference implementation\u003c/a\u003e, but it isn’t present by default.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e You can \u003ca href=\"https://bitbucket.org/railstutorial/sample_app_4th_ed/raw/c1582bec74354124650524a45ebb72388e5a299e/LICENSE.md\" target=\"_blank\" rel=\"noopener\"\u003edownload a copy\u003c/a\u003e from the reference implementation repo if you want it for completeness, but it’s not necessary for completing the tutorial.","cha-3_footnote-6":" Our method for making static pages is probably the simplest, but it’s not the only way.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The optimal method really depends on your needs; if you expect a \u003cem\u003elarge\u003c/em\u003e number of static pages, using a Static Pages controller can get quite cumbersome, but in our sample app we’ll only need a few.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e If you do need a lot of static pages, take a look at the \u003ca href=\"https://github.com/thoughtbot/high_voltage\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode class=\"tt\"\u003ehigh_voltage\u003c/code\u003e\u003c/a\u003e gem.","cha-3_footnote-7":" In fact, many Rails developers also add an \u003cem\u003ealias\u003c/em\u003e (as \u003ca href=\"https://www.learnenough.com/r/learn_enough_text_editor/vim/saving_and_quitting_files#sec-saving_and_quitting_files\" target=\"_blank\" rel=\"noopener\"\u003edescribed\u003c/a\u003e in \u003ca href=\"https://www.learnenough.com/text-editor\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eLearn Enough Text Editor to Be Dangerous\u003c/em\u003e\u003c/a\u003e) for the \u003ccode\u003erails\u003c/code\u003e command, typically shortening it to just \u003ccode\u003er\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This allows us to run, e.g., a Rails server using the compact command \u003ccode\u003er s\u003c/code\u003e.","cha-3_footnote-8":" See, e.g., “\u003ca href=\"http://david.heinemeierhansson.com/2014/tdd-is-dead-long-live-testing.html\" target=\"_blank\" rel=\"noopener\"\u003eTDD is dead. Long live testing.\u003c/a\u003e” by Rails creator David Heinemeier Hansson.","cha-3_footnote-9":" By default, \u003ccode\u003erails test\u003c/code\u003e shows red when the tests fail, but doesn’t show green when the tests pass.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e To arrange for a true Red–Green cycle, see \u003ca href=\"static_pages_fragment.html#sec-minitest_reporters\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e3.6.1\u003c/span\u003e\u003c/a\u003e.","cha-3_footnote-10":" HTML changes with time; by explicitly making a doctype declaration we make it likelier that browsers will render our pages properly in the future.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The simple doctype \u003ccode\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/code\u003e is characteristic of the latest HTML standard, HTML5.","cha-3_footnote-11":" For a list of common minitest assertions, see the \u003ca href=\"http://guides.rubyonrails.org/testing.html#available-assertions\" target=\"_blank\" rel=\"noopener\"\u003etable of available assertions in the Rails Guides testing article\u003c/a\u003e.","cha-3_footnote-12":" Most of the screenshots in this book use Google Chrome, but \u003ca href=\"static_pages_fragment.html#fig-home_view_full_html\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e3.6\u003c/span\u003e\u003c/a\u003e uses Safari because Chrome doesn’t display the full page title.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (As of this writing, Safari displays the page title only if you include an additional tab, which explains the second tab shown in \u003ca href=\"static_pages_fragment.html#fig-home_view_full_html\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e3.6\u003c/span\u003e\u003c/a\u003e.)\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Also note that the URL in \u003ca href=\"static_pages_fragment.html#fig-home_view_full_html\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e3.6\u003c/span\u003e\u003c/a\u003e is actually /static_pages/home, but Safari displays only the base URL, which in this case is my development server at Cloud9.","cha-3_footnote-13":" There is a second popular template system called \u003ca href=\"http://haml.info/\" target=\"_blank\" rel=\"noopener\"\u003eHaml\u003c/a\u003e (note: not “HAML”), which I personally love, but it’s not \u003cem\u003equite\u003c/em\u003e standard enough for use in an introductory tutorial.","cha-3_footnote-14":" Experienced Rails developers might have expected the use of \u003ccode\u003econtent_for\u003c/code\u003e at this point, but it doesn’t work well with the asset pipeline.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The \u003ccode\u003eprovide\u003c/code\u003e function is its replacement.","cha-3_footnote-15":" If you’ve studied Ruby before, you might suspect that Rails is \u003cem\u003eyielding\u003c/em\u003e the contents to a block, and your suspicion would be correct.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e But you don’t need to know this to develop applications with Rails.","cha-3_footnote-16":" This exercise is solved in \u003ca href=\"filling_in_the_layout_fragment.html#sec-contact_page\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e5.3.1\u003c/span\u003e\u003c/a\u003e.","cha-3_footnote-17":" If you get an error message saying that the Spring process id (pid) file would be overwritten by the merge, just remove the file using \u003ccode\u003erm -f *.pid\u003c/code\u003e at the command line.","cha-3_footnote-18":" The code in \u003ca href=\"static_pages_fragment.html#code-minitest_reporters\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e3.44\u003c/span\u003e\u003c/a\u003e mixes single- and double-quoted strings.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is because \u003ccode\u003erails new\u003c/code\u003e generates single-quoted strings, whereas the \u003ca href=\"https://github.com/kern/minitest-reporters\" target=\"_blank\" rel=\"noopener\"\u003eminitest reporters documentation\u003c/a\u003e uses double-quoted strings.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This mixing of the two string types is common in Ruby; see \u003ca href=\"rails_flavored_ruby_fragment.html#sec-strings\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e4.2.2\u003c/span\u003e\u003c/a\u003e for more information.","cha-4_footnote-1":" If a helper is specific to a particular controller, you should put it in the corresponding helper file; for example, helpers for the Static Pages controller generally go in \u003ccode\u003eapp/helpers/static_pages_helper.rb\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In our case, we expect the \u003ccode\u003efull_title\u003c/code\u003e helper to be used on all the site’s pages, and Rails has a special helper file for this case: \u003ccode\u003eapp/helpers/application_helper.rb\u003c/code\u003e.","cha-4_footnote-2":" The \u003ccode\u003enano\u003c/code\u003e editor is easier for beginners, but for this sort of short edit I would almost always use the Vim editor instead.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e To learn Minimum Viable Vim, see \u003ca href=\"https://www.learnenough.com/text-editor\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eLearn Enough Text Editor to Be Dangerous\u003c/em\u003e\u003c/a\u003e.","cha-4_footnote-3":" For more on the origins of “foo” and “bar”—and, in particular, the possible \u003cem\u003enon\u003c/em\u003e-relation of “foobar” to “FUBAR”—see the \u003ca href=\"http://www.catb.org/jargon/html/F/foo.html\" target=\"_blank\" rel=\"noopener\"\u003eJargon File entry on “foo”\u003c/a\u003e.","cha-4_footnote-4":" Programmers familiar with Perl or PHP should compare this to the automatic interpolation of dollar sign variables in expressions like \u003ccode\u003e\"foo $bar\"\u003c/code\u003e.","cha-4_footnote-5":" Apologies in advance for switching haphazardly between \u003cem\u003efunction\u003c/em\u003e and \u003cem\u003emethod\u003c/em\u003e throughout this chapter; in Ruby, they’re the same thing: all methods are functions, and all functions are methods, because everything is an object.","cha-4_footnote-6":" Well, there will still be \u003cem\u003eone\u003c/em\u003e thing left that we don’t understand, which is how Rails ties this all together: mapping URLs to actions, making the \u003ccode\u003efull_title\u003c/code\u003e helper available in views, etc.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is an interesting subject, and I encourage you to investigate it further, but knowing exactly \u003cem\u003ehow\u003c/em\u003e Rails works is not necessary when \u003cem\u003eusing\u003c/em\u003e Rails.","cha-4_footnote-7":" It’s tempting to use string interpolation instead—indeed, this was the technique used in all previous versions of the tutorial—but in fact the call to \u003ccode\u003eprovide\u003c/code\u003e converts the string into a so-called SafeBuffer object instead of an ordinary string.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Interpolating and inserting into a view template then over-escapes any inserted HTML, so a title such as “Help’s on the way” would be converted to “Help\u0026amp;amp;#39;s on the way”.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (Thanks to reader Jeremy Fleischman for pointing out this subtle issue.)","cha-4_footnote-8":" The \u003ccode\u003esecond\u003c/code\u003e method used here isn’t currently part of Ruby itself, but rather is added by Rails.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e It works in this case because the Rails console automatically includes the Rails extensions to Ruby.","cha-4_footnote-9":" Programming experts, on the other hand, might benefit from knowing that blocks are \u003cem\u003eclosures\u003c/em\u003e, which are one-shot anonymous functions with data attached.","cha-4_footnote-10":" As noted in \u003ca href=\"beginning_fragment.html#cha-beginning\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e1\u003c/span\u003e\u003c/a\u003e, in this case the code \u003ccode\u003e('a'..'z').to_a.sample(8).join\u003c/code\u003e is an even more compact way of getting the same result.","cha-4_footnote-11":" Ruby versions 1.9 and later actually guarantee that hashes keep their elements in the same order entered, but it would be unwise ever to count on a particular ordering.","cha-4_footnote-12":" As a result of having less baggage, symbols are easier to compare to each other; strings need to be compared character by character, while symbols can be compared all in one go.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This makes them ideal for use as hash keys.","cha-4_footnote-13":" There’s actually a subtle difference, which is that \u003ccode\u003ep\u003c/code\u003e returns the object being printed while \u003ccode\u003eputs\u003c/code\u003e always returns \u003ccode\u003enil\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (Thanks to reader Katarzyna Siwek for pointing this out.)","cha-4_footnote-14":" A newline is what comes at the end of a line, thereby starting a new line.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e As noted in \u003ca href=\"rails_flavored_ruby_fragment.html#sec-printing\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e4.2.2.1\u003c/span\u003e\u003c/a\u003e, it is typically represented by the character \u003ccode class=\"inline_verbatim\"\u003e\\n\u003c/code\u003e.","cha-4_footnote-15":" Constantly having to check the column number is rather inconvenient, so many text editors have a visual aid to help you.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, if you take a look back at \u003ca href=\"beginning_fragment.html#fig-cloud9_gemfile\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e1.7\u003c/span\u003e\u003c/a\u003e, you may be able to make out the small vertical line on the right side of the screen, which is designed to help keep code under 80 characters.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (It’s very subtle, so you may not be able to see it in the screenshot.)\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The cloud IDE (\u003ca href=\"beginning_fragment.html#sec-development_environment\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e1.2.1\u003c/span\u003e\u003c/a\u003e) includes such a line by default.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In Sublime Text, you can use \u003ccode class=\"tt\"\u003eView \u0026gt; Ruler \u0026gt; 78\u003c/code\u003e or \u003ccode class=\"tt\"\u003eView \u0026gt; Ruler \u0026gt; 80\u003c/code\u003e.","cha-4_footnote-16":" These results will vary based on the version of Ruby you are using.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This example assumes you are using Ruby 1.9.3 or later.","cha-4_footnote-17":" For more on Ruby classes and the \u003ccode\u003eself\u003c/code\u003e keyword, see the \u003ca href=\"http://railstips.org/\" target=\"_blank\" rel=\"noopener\"\u003eRailsTips\u003c/a\u003e post “\u003ca href=\"http://railstips.org/blog/archives/2006/11/18/class-and-instance-variables-in-ruby/\" target=\"_blank\" rel=\"noopener\"\u003eClass and Instance Variables in Ruby\u003c/a\u003e”.","cha-1_footnote-24":" Though it shouldn’t matter for the example applications in the \u003cem\u003eRails Tutorial\u003c/em\u003e, if you’re worried about accidentally making your app public too soon there are several options; see \u003ca href=\"beginning_fragment.html#sec-heroku_commands\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e1.5.4\u003c/span\u003e\u003c/a\u003e for one.","cha-5_footnote-1":" Thanks to reader \u003ca href=\"https://twitter.com/colmtuite\" target=\"_blank\" rel=\"noopener\"\u003eColm Tuite\u003c/a\u003e for his excellent work in helping to convert the sample application over to the Bootstrap CSS framework.","cha-5_footnote-2":" The mockups in the \u003cem\u003eRuby on Rails Tutorial\u003c/em\u003e are made with an excellent online mockup application called \u003ca href=\"http://gomockingbird.com\" target=\"_blank\" rel=\"noopener\"\u003eMockingbird\u003c/a\u003e.","cha-5_footnote-3":" The words \u003cem\u003eshim\u003c/em\u003e and \u003cem\u003eshiv\u003c/em\u003e are used interchangably in this context; the former is the proper term, based on the English word whose meaning is “a washer or thin strip of material used to align parts, make them fit, or reduce wear”, while the latter (meaning “a knife or razor used as a weapon”) is apparently a play on the name of the shim’s original author, Sjoerd Visscher.","cha-5_footnote-4":" These are completely unrelated to Ruby classes.","cha-5_footnote-5":" The spacing might look slightly different, which is fine because (as noted in \u003ca href=\"static_pages_fragment.html#sec-testing_titles\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e3.4.1\u003c/span\u003e\u003c/a\u003e) HTML is insensitive to whitespace.","cha-5_footnote-6":" This image is actually the old Rails logo, but the new one is a scalable vector graphics (SVG) image and is less suitable for our present purposes.","cha-5_footnote-7":" You might notice that the \u003ccode\u003eimg\u003c/code\u003e tag, rather than looking like \u003ccode class=\"inline_verbatim\"\u003e\u0026lt;img\u0026gt;...\u0026lt;/img\u0026gt;\u003c/code\u003e, instead looks like \u003ccode class=\"inline_verbatim\"\u003e\u0026lt;img ... /\u0026gt;\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Tags that follow this form are known as \u003cem\u003eself-closing\u003c/em\u003e tags.","cha-5_footnote-8":" Image retrieved from https://www.flickr.com/photos/deborah_s_perspective/14144861329 on 2016-01-09.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2009 by \u003ca href=\"https://www.flickr.com/photos/deborah_s_perspective/\" target=\"_blank\" rel=\"noopener\"\u003eDeborah\u003c/a\u003e and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.","cha-5_footnote-9":" As always, you should use the version numbers listed at \u003ca href=\"https://gemfiles-4th-ed.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003egemfiles-4th-ed.railstutorial.org\u003c/a\u003e instead of the ones listed here.","cha-5_footnote-10":" It is also possible to use Less with the asset pipeline; see the \u003ca href=\"http://rubygems.org/gems/less-rails-bootstrap\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode class=\"tt\"\u003eless-rails-bootstrap\u003c/code\u003e gem\u003c/a\u003e for details.","cha-5_footnote-11":" If these steps seem mysterious, take heart: I’m just following the instructions from the \u003ca href=\"https://github.com/twbs/bootstrap-sass#bootstrap-for-sass---\" target=\"_blank\" rel=\"noopener\"\u003ebootstrap-sass README file\u003c/a\u003e.","cha-5_footnote-12":" Many Rails developers use a \u003ccode\u003eshared\u003c/code\u003e directory for partials shared across different views.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e I prefer to use the \u003ccode\u003eshared\u003c/code\u003e folder for utility partials that are useful on multiple views, while putting partials that are literally on every page (as part of the site layout) in the \u003ccode\u003elayouts\u003c/code\u003e directory.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (We’ll create the \u003ccode\u003eshared\u003c/code\u003e directory starting in \u003ca href=\"sign_up_fragment.html#cha-sign_up\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e7\u003c/span\u003e\u003c/a\u003e.)\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e That seems to me a logical division, but putting them all in the \u003ccode\u003eshared\u003c/code\u003e folder certainly works fine, too.","cha-5_footnote-13":" You may wonder why we use both the \u003ccode\u003efooter\u003c/code\u003e tag and \u003ccode\u003e.footer\u003c/code\u003e class.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The answer is that the tag has a clear meaning to human readers, and the class is used by Bootstrap.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Using a \u003ccode\u003ediv\u003c/code\u003e tag in place of \u003ccode\u003efooter\u003c/code\u003e would work as well.","cha-5_footnote-14":" The structure of this section is based on the excellent blog post “The Rails 3 Asset Pipeline in (about) 5 Minutes” by Michael Erasmus.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For more details, see the \u003ca href=\"http://guides.rubyonrails.org/asset_pipeline.html\" target=\"_blank\" rel=\"noopener\"\u003eRails Guide on the Asset Pipeline\u003c/a\u003e.","cha-6_footnote-1":" The name comes from the “\u003ca href=\"https://en.wikipedia.org/wiki/Active_record_pattern\" target=\"_blank\" rel=\"noopener\"\u003eactive record pattern\u003c/a\u003e”, identified and named in \u003cem\u003ePatterns of Enterprise Application Architecture\u003c/em\u003e by Martin Fowler.","cha-6_footnote-2":" Officially pronounced “ess-cue-ell”, though the alternate pronunciation “sequel” is also common.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e You can differentiate an individual author’s preference by the choice of indefinite article: those who write “a SQL database” prefer “sequel”, whereas those who write “an SQL database” prefer “ess-cue-ell”.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e As you’ll soon see, I prefer the latter.","cha-6_footnote-3":" By using an email address as the username, we open the possibility of communicating with our users at a future date (\u003ca href=\"account_activation_fragment.html#cha-account_activation\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e11\u003c/span\u003e\u003c/a\u003e and \u003ca href=\"password_reset_fragment.html#cha-password_reset\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e12\u003c/span\u003e\u003c/a\u003e).","cha-6_footnote-4":" Don’t worry about exactly how the \u003ccode\u003et\u003c/code\u003e object manages to do this; the beauty of \u003cem\u003eabstraction layers\u003c/em\u003e is that we don’t have to know.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e We can just trust the \u003ccode\u003et\u003c/code\u003e object to do its job.","cha-6_footnote-5":" Officially pronounced “ess-cue-ell-ite”, although the (mis)pronunciation “sequel-ite” is also common.","cha-6_footnote-6":" The only exception is in \u003ca href=\"following_users_fragment.html#sec-scopes_subselects_and_a_lambda\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e14.3.3\u003c/span\u003e\u003c/a\u003e.","cha-6_footnote-7":" The timestamps are recorded in \u003ca href=\"https://en.wikipedia.org/wiki/Coordinated_Universal_Time\" target=\"_blank\" rel=\"noopener\"\u003eCoordinated Universal Time\u003c/a\u003e (UTC), which for most practical purposes is the same as \u003ca href=\"https://en.wikipedia.org/wiki/Greenwich_Mean_Time\" target=\"_blank\" rel=\"noopener\"\u003eGreenwich Mean Time\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e But why call it UTC?\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e From the \u003ca href=\"https://www.nist.gov/pml/time-and-frequency-division/nist-time-frequently-asked-questions-faq#cut\" target=\"_blank\" rel=\"noopener\"\u003eNIST Time and Frequency FAQ\u003c/a\u003e: \u003cstrong\u003eQ:\u003c/strong\u003e Why is UTC used as the acronym for Coordinated Universal Time instead of CUT? \u003cstrong\u003eA:\u003c/strong\u003e In 1970 the Coordinated Universal Time system was devised by an international advisory group of technical experts within the International Telecommunication Union (ITU).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The ITU felt it was best to designate a single abbreviation for use in all languages in order to minimize confusion.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Since unanimous agreement could not be achieved on using either the English word order, CUT, or the French word order, TUC, the acronym UTC was chosen as a compromise.","cha-6_footnote-8":" Exceptions and exception handling are somewhat advanced Ruby subjects, and we won’t need them much in this book.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e They are important, though, and I suggest learning about them using one of the Ruby books recommended in \u003ca href=\"following_users_fragment.html#sec-guide_to_further_resources\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e14.4.1\u003c/span\u003e\u003c/a\u003e.","cha-6_footnote-9":" The \u003ccode\u003eupdate_attributes\u003c/code\u003e method is an alias for the shorter \u003ccode\u003eupdate\u003c/code\u003e method, but I prefer the longer version because of its similarity to the singular version of the method, \u003ccode\u003eupdate_attribute\u003c/code\u003e.","cha-6_footnote-10":" I’ll omit the output of console commands when they are not particularly instructive—for example, the results of \u003ccode\u003eUser.new\u003c/code\u003e.","cha-6_footnote-11":" For example, did you know that \u003ccode\u003e\"Michael Hartl\"@example.com\u003c/code\u003e, with quotation marks and a space in the middle, is a valid email address according to the standard?\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Incredibly, it is—but it’s absurd.","cha-6_footnote-12":" Note that, in \u003ca href=\"modeling_users_fragment.html#table-valid_email_regex\" class=\"hyperref\"\u003eTable \u003cspan class=\"ref\"\u003e6.1\u003c/span\u003e\u003c/a\u003e, “letter” really means “lower-case letter”, but the \u003ccode\u003ei\u003c/code\u003e at the end of the regex enforces case-insensitive matching.","cha-6_footnote-13":" If you find it as useful as I do, I encourage you to \u003ca href=\"http://bit.ly/donate-to-rubular\" target=\"_blank\" rel=\"noopener\"\u003edonate to Rubular\u003c/a\u003e to reward developer \u003ca href=\"http://lovitt.net/\" target=\"_blank\" rel=\"noopener\"\u003eMichael Lovitt\u003c/a\u003e for his wonderful work.","cha-6_footnote-14":" As noted briefly in the introduction to this section, there is a dedicated test database, \u003ccode\u003edb/test.sqlite3\u003c/code\u003e, for this purpose.","cha-6_footnote-15":" Technically, only the domain part of the email address is case-insensitive: \u003cem\u003efoo@bar.com\u003c/em\u003e is actually different from \u003cem\u003eFoo@bar.com\u003c/em\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In practice, though, it is a bad idea to rely on this fact; as noted at \u003ca href=\"http://email.about.com/od/emailbehindthescenes/f/email_case_sens.htm\" target=\"_blank\" rel=\"noopener\"\u003eabout.com\u003c/a\u003e, “Since the case sensitivity of email addresses can create a lot of confusion, interoperability problems and widespread headaches, it would be foolish to require email addresses to be typed with the correct case.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Hardly any email service or ISP does enforce case sensitive email addresses, returning messages whose recipient’s email address was not typed correctly (in all upper case, for example).”\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thanks to reader Riley Moses for pointing this out.","cha-6_footnote-16":" Of course, we could just edit the migration file for the \u003ccode\u003eusers\u003c/code\u003e table in \u003ca href=\"modeling_users_fragment.html#code-users_migration\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e6.2\u003c/span\u003e\u003c/a\u003e, but that would require rolling back and then migrating back up.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The Rails Way™ is to use migrations every time we discover that our data model needs to change.","cha-6_footnote-17":" See the \u003ca href=\"http://api.rubyonrails.org/v5.0.1/classes/ActiveRecord/Callbacks.html\" target=\"_blank\" rel=\"noopener\"\u003eRails API entry on callbacks\u003c/a\u003e for more information on which callbacks Rails supports.","cha-6_footnote-18":" In this context, \u003cem\u003evirtual\u003c/em\u003e means that the attributes exist on the model object but do not correspond to columns in the database.","cha-6_footnote-19":" Hashed password digests are often erroneously referred to as \u003cem\u003eencrypted passwords\u003c/em\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, the \u003ca href=\"https://github.com/rails/rails/blob/master/activemodel/lib/active_model/secure_password.rb\" target=\"_blank\" rel=\"noopener\"\u003esource code\u003c/a\u003e of \u003ccode\u003ehas_secure_password\u003c/code\u003e makes this mistake, as did the first two editions of this tutorial.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This terminology is wrong because by design encryption is \u003cem\u003ereversible\u003c/em\u003e—the ability to encrypt implies the ability to \u003cem\u003edecrypt\u003c/em\u003e as well.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In contrast, the whole point of calculating a password’s hash digest is to be \u003cem\u003eirreversible\u003c/em\u003e, so that it is computationally intractable to infer the original password from the digest.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (Thanks to reader Andy Philips for pointing out this issue and for encouraging me to fix the broken terminology.)","cha-6_footnote-20":" As always, you should use the version numbers listed at \u003ca href=\"https://gemfiles-4th-ed.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003egemfiles-4th-ed.railstutorial.org\u003c/a\u003e instead of the ones listed here.","cha-6_footnote-21":"\u003cp\u003e If for any reason something went wrong, you can always reset the database as follows:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eQuit the console.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003e$ rm -f development.sqlite3\u003c/code\u003e at the command line to remove the database.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (We’ll learn a more elegant method for doing this in \u003ca href=\"sign_up_fragment.html#cha-sign_up\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e7\u003c/span\u003e\u003c/a\u003e.)\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003cli\u003eRe-run the migrations using \u003ccode\u003e$ rails db:migrate\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003cli\u003eRestart the console.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","cha-6_footnote-22":" By design, the bcrypt algorithm produces a \u003ca href=\"https://en.wikipedia.org/wiki/Salt_(cryptography)\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003esalted hash\u003c/em\u003e\u003c/a\u003e, which protects against two important classes of attacks (\u003ca href=\"https://en.wikipedia.org/wiki/Dictionary_attack\" target=\"_blank\" rel=\"noopener\"\u003edictionary attacks\u003c/a\u003e and \u003ca href=\"https://en.wikipedia.org/wiki/Rainbow_table\" target=\"_blank\" rel=\"noopener\"\u003erainbow table attacks\u003c/a\u003e).","cha-5_footnote-15":" Sass also supports an alternate syntax that does define a new language, which is less verbose (and has fewer curly braces) but is less convenient for existing projects and is harder to learn for those already familiar with CSS.","cha-7_footnote-1":" \u003ca href=\"http://gomockingbird.com/\" target=\"_blank\" rel=\"noopener\"\u003eMockingbird\u003c/a\u003e doesn’t support custom images like the profile photo in \u003ca href=\"sign_up_fragment.html#fig-profile_mockup_profile_name\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e7.1\u003c/span\u003e\u003c/a\u003e; I put that in by hand using \u003ca href=\"http://www.gimp.org/\" target=\"_blank\" rel=\"noopener\"\u003eGIMP\u003c/a\u003e.","cha-7_footnote-2":" Image retrieved from http://www.flickr.com/photos/43803060@N00/24308857/ on 2014-06-16.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2002 by Shaun Wallin and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.","cha-7_footnote-3":" You can define your own custom environments as well; see the \u003ca href=\"http://railscasts.com/episodes/72-adding-an-environment\" target=\"_blank\" rel=\"noopener\"\u003eRailsCast on adding an environment\u003c/a\u003e for details.","cha-7_footnote-4":" The exact appearance of the Rails debug information is slightly version-dependent.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, as of Rails 5 the debug information shows the \u003ccode\u003epermitted\u003c/code\u003e status of the information, a subject we’ll cover in \u003ca href=\"sign_up_fragment.html#sec-strong_parameters\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e7.3.2\u003c/span\u003e\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Use your technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e) to resolve such minor discrepancies.","cha-7_footnote-5":" The Rails \u003ccode\u003edebug\u003c/code\u003e information is shown as \u003ca href=\"http://www.yaml.org/\" target=\"_blank\" rel=\"noopener\"\u003eYAML\u003c/a\u003e (a \u003ca href=\"http://catb.org/jargon/html/R/recursive-acronym.html\" target=\"_blank\" rel=\"noopener\"\u003erecursive acronym\u003c/a\u003e standing for “YAML Ain’t Markup Language”), which is a friendly data format designed to be both machine- \u003cem\u003eand\u003c/em\u003e human-readable.","cha-7_footnote-6":" This means that the \u003cem\u003erouting\u003c/em\u003e works, but the corresponding pages don’t necessarily work at this point.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, /users/1/edit gets routed properly to the \u003ccode\u003eedit\u003c/code\u003e action of the Users controller, but since the \u003ccode\u003eedit\u003c/code\u003e action doesn’t exist yet actually hitting that URL will return an error.","cha-7_footnote-7":" Using, e.g., \u003ccode\u003etouch app/views/users/show.html.erb\u003c/code\u003e.","cha-7_footnote-8":" In Hinduism, an avatar is the manifestation of a deity in human or animal form.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e By extension, the term \u003cem\u003eavatar\u003c/em\u003e is commonly used to mean some kind of personal representation, especially in a virtual environment.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (In the context of Twitter and other social media, the term \u003cem\u003eavi\u003c/em\u003e has gained currency, which is likely a mutated form of \u003cem\u003eavatar\u003c/em\u003e.)","cha-7_footnote-9":" \u003ca href=\"sign_up_fragment.html#code-sidebar_css\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e7.11\u003c/span\u003e\u003c/a\u003e includes the \u003ccode\u003e.gravatar_edit\u003c/code\u003e class, which we’ll put to work in \u003ca href=\"updating_and_deleting_users_fragment.html#cha-updating_showing_and_deleting_users\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e10\u003c/span\u003e\u003c/a\u003e.","cha-7_footnote-10":" See the \u003ca href=\"http://stackoverflow.com/questions/941594/understand-rails-authenticity-token\" target=\"_blank\" rel=\"noopener\"\u003eStack Overflow entry on the Rails authenticity token\u003c/a\u003e if you’re interested in the details of how this works.","cha-7_footnote-11":" Actually, we’ll use the closely related \u003ccode\u003eflash.now\u003c/code\u003e, but we’ll defer that subtlety until we need it.","cha-7_footnote-12":" Technically, SSL is now TLS, for Transport Layer Security, but everyone I know still says “SSL”.","cha-7_footnote-13":" \u003ca href=\"sign_up_fragment.html#code-production_webserver_config\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e7.37\u003c/span\u003e\u003c/a\u003e changes the formatting slightly so that the code fits in the standard 80 columns.","cha-7_footnote-14":" We haven’t changed the data model in this chapter, so running the migration at Heroku shouldn’t be necessary, but only if you followed the steps in \u003ca href=\"modeling_users_fragment.html#sec-modeling_users_conclusion\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e6.4\u003c/span\u003e\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Because several readers reported having trouble, I’ve added \u003ccode\u003eheroku run rails db:migrate\u003c/code\u003e as a final step just to be safe.","cha-7_footnote-15":" For example, at one point Heroku required Ruby 2.1.4, so I spent several hours trying unsuccessfully to install Ruby 2.1.4 on my local machine—only to discover that Ruby 2.1.5 had been released the previous day.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Attempts to install Ruby 2.1.5 then also failed.","cha-7_footnote-16":"For example, at one point Heroku required Ruby 2.1.4, so I spent several hours trying unsuccessfully to install Ruby 2.1.4 on my local machine—only to discover that Ruby 2.1.5 had been released the previous day.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Attempts to install Ruby 2.1.5 then also failed. ","cha-8_footnote-1":" Some browsers offer an option to restore such sessions via a “continue where you left off” feature, but of course Rails has no control over this behavior.","cha-8_footnote-2":" A second option is to use \u003ccode\u003eform_tag\u003c/code\u003e in place of \u003ccode\u003eform_for\u003c/code\u003e, which might be even more idiomatically correct Rails, but it has less in common with the signup form, and at this stage I want to emphasize the parallel structure.","cha-8_footnote-3":" I like this technique because it connects to the pure Ruby way of including modules, but Rails 4 introduced a technique called \u003cem\u003econcerns\u003c/em\u003e that can also be used for this purpose.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e To learn how to use concerns, run a search for “\u003ca href=\"https://www.google.com/search?q=how+to+use+concerns+in+rails\" target=\"_blank\" rel=\"noopener\"\u003ehow to use concerns in Rails\u003c/a\u003e”.","cha-8_footnote-4":" The \u003ccode\u003elog_in\u003c/code\u003e method is available in the Sessions controller because of the module inclusion in \u003ca href=\"basic_login_fragment.html#code-sessions_helper_include\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e8.13\u003c/span\u003e\u003c/a\u003e.","cha-8_footnote-5":" This practice of remembering variable assignments from one method invocation to the next is known as \u003ca href=\"https://en.wikipedia.org/wiki/Memoization\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003ememoization\u003c/em\u003e\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (Note that this is a technical term; in particular, it’s \u003cem\u003enot\u003c/em\u003e a misspelling of “memorization”—a subtlety lost on the hapless copyeditor of a previous edition of this book.)","cha-8_footnote-6":" Image retrieved from https://www.flickr.com/photos/elevy/14730820387 on 2016-06-03.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2014 by Elias Levy and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.","cha-8_footnote-7":" Web browsers can’t actually issue \u003ccode class=\"tt\"\u003eDELETE\u003c/code\u003e requests; Rails fakes it with JavaScript.","cha-8_footnote-8":" See the \u003ca href=\"http://getbootstrap.com/components/\" target=\"_blank\" rel=\"noopener\"\u003eBootstrap components page\u003c/a\u003e for more information.","cha-8_footnote-9":" Earlier versions of Rails included jQuery automatically, but it was removed as a dependency in Rails 5.1.","cha-8_footnote-10":" You may have to restart the webserver to get this to work (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e).","cha-8_footnote-11":" If you’re using the cloud IDE, I recommend using a different browser to test the login behavior so that you don’t have to close down the browser running the IDE.","cha-8_footnote-12":" It’s worth noting that indentation in fixture files must take the form of spaces, not tabs, so take care when copying code like that shown in \u003ca href=\"basic_login_fragment.html#code-real_user_fixture\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e8.22\u003c/span\u003e\u003c/a\u003e.","cha-8_footnote-13":" As with the Sessions controller, the \u003ccode\u003elog_in\u003c/code\u003e method is available in the Users controller because of the module inclusion in \u003ca href=\"basic_login_fragment.html#code-sessions_helper_include\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e8.13\u003c/span\u003e\u003c/a\u003e.","cha-8_footnote-14":" For example, I once had a test suite that was \u003cspan style=\"color: ForestGreen\"\u003e\u003cspan class=\"sc\"\u003e\u003c/span\u003e\u003cspan class=\"sc\"\u003e\u003cstrong\u003egreen\u003c/strong\u003e\u003c/span\u003e\u003cspan class=\"sc\"\u003e\u003c/span\u003e\u003c/span\u003e even after accidentally deleting the main \u003ccode\u003elog_in\u003c/code\u003e method in the Sessions helper.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The reason is that the tests were happily using a test helper with the same name, thereby passing even though the application was completely broken.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e As with \u003ccode\u003eis_logged_in?\u003c/code\u003e, we’ll avoid this issue by defining the test helper \u003ccode\u003elog_in_as\u003c/code\u003e in \u003ca href=\"advanced_login_fragment.html#code-test_helper_log_in\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e9.24\u003c/span\u003e\u003c/a\u003e.","cha-9_footnote-1":" Session hijacking was widely publicized by the \u003ca href=\"http://codebutler.com/firesheep\" target=\"_blank\" rel=\"noopener\"\u003eFiresheep\u003c/a\u003e application, which showed that remember tokens at many high-profile sites were visible when connected to public Wi-Fi networks.","cha-9_footnote-2":" Rails 5 introduced a \u003ccode\u003ehas_secure_token\u003c/code\u003e method that automatically generates random tokens, but it stores the \u003cem\u003eunhashed\u003c/em\u003e values in the database, and hence is unsuitable for our present purposes.","cha-9_footnote-3":" This choice is based on the \u003ca href=\"http://railscasts.com/episodes/274-remember-me-reset-password\" target=\"_blank\" rel=\"noopener\"\u003eRailsCast on remember me\u003c/a\u003e.","cha-9_footnote-4":" In any case, with bcrypt’s \u003ca href=\"https://en.wikipedia.org/wiki/Salt_%28cryptography%29\" target=\"_blank\" rel=\"noopener\"\u003esalted hashes\u003c/a\u003e there’s no way for us to tell if two users’ passwords match.","cha-9_footnote-5":" With unique remember tokens, an attacker always needs \u003cem\u003eboth\u003c/em\u003e the user id and the remember token cookies to hijack the session.","cha-9_footnote-6":" This hasn’t stopped some developers from adding a check to verify that no collision has occurred, but such efforts result from failing to grasp just how small \u003cspan class=\"inline_math\"\u003e\\( 10^{-40} \\)\u003c/span\u003e is.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, if we generated a billion tokens a second for the entire age of the Universe, the expected number of collisions would still be on the order of \u003cspan class=\"inline_math\"\u003e\\( 10^{-23} \\)\u003c/span\u003e.","cha-9_footnote-7":" As a general rule, if a method doesn’t need an instance of an object, it should be a class method.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Indeed, this decision will prove to be wise in \u003ca href=\"account_activation_fragment.html#sec-account_activation_emails\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e11.2\u003c/span\u003e\u003c/a\u003e.","cha-9_footnote-8":" \u003ca href=\"https://en.wikipedia.org/wiki/Digital_signature\" target=\"_blank\" rel=\"noopener\"\u003eSigning\u003c/a\u003e and \u003ca href=\"https://en.wikipedia.org/wiki/Encryption\" target=\"_blank\" rel=\"noopener\"\u003eencrypting\u003c/a\u003e are different operations in general, but as of Rails 4 the \u003ccode\u003esigned\u003c/code\u003e method \u003ca href=\"http://api.rubyonrails.org/classes/ActionDispatch/Session/CookieStore.html\" target=\"_blank\" rel=\"noopener\"\u003edoes both\u003c/a\u003e by default.","cha-9_footnote-9":" As noted in \u003ca href=\"modeling_users_fragment.html#sec-a_hashed_password\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e6.3.1\u003c/span\u003e\u003c/a\u003e, “unencrypted password” is a misnomer, as the secure password is \u003cem\u003ehashed\u003c/em\u003e, not encrypted.","cha-9_footnote-10":" I generally use the convention of putting such assignments in parentheses, which is a visual reminder that it’s not a comparison.","cha-9_footnote-11":"\u003cp\u003e Alert reader Jack Fahnestock has noted that there is an edge case that isn’t covered by the current design:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eLog in with “remember me” checked in browser A (saving hashed remember token A to \u003ccode\u003eremember_digest\u003c/code\u003e).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003cli\u003eLog in with “remember me” checked in browser B (saving hashed \u003ccode\u003eremember_token\u003c/code\u003e B to \u003ccode\u003eremember_digest\u003c/code\u003e, overwriting remember token A saved in browser A).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003cli\u003eClose browser A (now relying on permanent cookies for login—second conditional in \u003ccode\u003ecurrent_user\u003c/code\u003e method).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e\n\u003c/li\u003e\n\u003cli\u003eReopen browser A (\u003ccode\u003elogged_in?\u003c/code\u003e returns false, even though permanent cookies are on the browser).\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eAlthough this is a arguably a more secure design than remembering the user in multiple places, it violates the expectation that users can be permanently remembered on more than one browser.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The solution, which is substantially more complicated than the present design, is to factor the remember digest into a separate table, where each row has a user id and a digest.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Checking for the current user would then look through the table for a digest corresponding to a particular remember token.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Furthermore, the \u003ccode\u003eforget\u003c/code\u003e in \u003ca href=\"advanced_login_fragment.html#code-user_model_forget\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e9.11\u003c/span\u003e\u003c/a\u003e method would delete only the row corresponding to the digest of the current browser.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For security purposes, logging out would remove all digests for that user.\u003c/p\u003e\n","cha-9_footnote-12":" Google “\u0026lt;your browser name\u0026gt; inspect cookies” to learn how to inspect the cookies on your system.","cha-9_footnote-13":" Thanks to reader Paulo Célio Júnior for pointing this out.","cha-9_footnote-14":" Thanks to reader Niels de Ron for pointing this out.","cha-10_footnote-1":" Image retrieved from http://www.flickr.com/photos/sashawolff/4598355045/ on 2014-08-25.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2010 by Sasha Wolff and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.","cha-10_footnote-2":" Don’t worry about how this works; the details are of interest to developers of the Rails framework itself, and by design are not important for Rails application developers.","cha-10_footnote-3":" Thanks to Jose Carlos Montero Gómez for a suggestion that further reduced duplication in the \u003ccode\u003enew\u003c/code\u003e and \u003ccode\u003eedit\u003c/code\u003e partials.","cha-10_footnote-4":" The command for before filters used to be called \u003ccode\u003ebefore_filter\u003c/code\u003e, but the Rails core team decided to rename it to emphasize that the filter takes place before particular controller actions.","cha-10_footnote-5":" The code in this section is adapted from the \u003ca href=\"http://github.com/thoughtbot/clearance\" target=\"_blank\" rel=\"noopener\"\u003eClearance\u003c/a\u003e gem by \u003ca href=\"http://thoughtbot.com/\" target=\"_blank\" rel=\"noopener\"\u003ethoughtbot\u003c/a\u003e.","cha-10_footnote-6":" Thanks to reader Yoel Adler for pointing out this subtle issue, and for discovering the solution.","cha-10_footnote-7":" Image retrieved from http://www.flickr.com/photos/glasgows/338937124/ on 2014-08-25.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2008 by M\u0026amp;R Glasgow and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.","cha-10_footnote-8":" This is the same authorization model used by Twitter.","cha-10_footnote-9":" As always, you should use the version numbers listed at \u003ca href=\"https://gemfiles-4th-ed.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003egemfiles-4th-ed.railstutorial.org\u003c/a\u003e instead of the ones listed here.","cha-10_footnote-10":" In principle, these two tasks can be combined in \u003ccode\u003erails db:reset\u003c/code\u003e, but as of this writing this command doesn’t work with the latest version of Rails.","cha-10_footnote-11":" As always, you should use the version numbers listed at \u003ca href=\"https://gemfiles-4th-ed.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003egemfiles-4th-ed.railstutorial.org\u003c/a\u003e instead of the ones listed here.","cha-10_footnote-12":" The name \u003ccode\u003euser\u003c/code\u003e is immaterial—we could have written \u003ccode\u003e@users.each do |foobar|\u003c/code\u003e and then used \u003ccode\u003erender foobar\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The key is the \u003cem\u003eclass\u003c/em\u003e of the object—in this case, \u003ccode\u003eUser\u003c/code\u003e.","cha-11_footnote-1":" This chapter is independent of the others, apart from the mailer generation in \u003ca href=\"account_activation_fragment.html#code-generate_user_mailer\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e11.6\u003c/span\u003e\u003c/a\u003e, which is used in \u003ca href=\"password_reset_fragment.html#cha-password_reset\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e12\u003c/span\u003e\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Readers can skip to \u003ca href=\"password_reset_fragment.html#cha-password_reset\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e12\u003c/span\u003e\u003c/a\u003e or to \u003ca href=\"user_microposts_fragment.html#cha-user_microposts\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e13\u003c/span\u003e\u003c/a\u003e with minimal discontinuity, although the former will be substantially more challenging due to substantial overlap with this chapter.","cha-11_footnote-2":" In addition to this basic sequence, another nice feature to have is the ability to resend account activation emails in case the initial confirmation gets lost, marked as spam, etc.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Adding such a feature should be within your capabilities by the time you finish this tutorial.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e You might also considering using a solution such as \u003ca href=\"https://github.com/plataformatec/devise\" target=\"_blank\" rel=\"noopener\"\u003eDevise\u003c/a\u003e, already includes the ability to resend confirmation emails.","cha-11_footnote-3":" We could use the user’s id instead, since it’s already exposed in the URLs of our application, but using email addresses is more future-proof in case we want to obfuscate user ids for any reason (such as to prevent competitors from knowing how many users our application has, for example).","cha-11_footnote-4":" Because we’ll be using an \u003ccode\u003eedit\u003c/code\u003e action, we could include \u003ccode\u003eedit\u003c/code\u003e on the command line, but this would also generate both an edit view and a test, neither of which we’ll turn out to need.","cha-11_footnote-5":" It’s mainly for this reason that we won’t be using the (perhaps slightly misnamed) \u003ccode\u003ehas_secure_token\u003c/code\u003e facility added in Rails 5, which stores the corresponding token in the database as unhashed \u003ca href=\"https://en.wikipedia.org/wiki/Cleartext\" target=\"_blank\" rel=\"noopener\"\u003ecleartext\u003c/a\u003e.","cha-11_footnote-6":" URLs can contain multiple query parameters, consisting of multiple key-value pairs separated by the ampersand character \u003ccode\u003e\u0026amp;\u003c/code\u003e, as in \u003ccode\u003e/edit?name=Foo%20Bar\u0026amp;email=foo%40example.com\u003c/code\u003e.","cha-11_footnote-7":" When I originally wrote this chapter, I couldn’t recall offhand how to escape URLs in Rails, and figuring it out was pure technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e What I did was Google “\u003ca href=\"https://www.google.com/search?q=ruby+rails+escape+url\" target=\"_blank\" rel=\"noopener\"\u003eruby rails escape url\u003c/a\u003e”, which led me to \u003ca href=\"http://stackoverflow.com/questions/6714196/ruby-url-encoding-string\" target=\"_blank\" rel=\"noopener\"\u003efind two main possibilities\u003c/a\u003e, \u003ccode\u003eURI.encode(str)\u003c/code\u003e and \u003ccode\u003eCGI.escape(str)\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Trying them both revealed that the latter works.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (It turns out there’s a third possibility: the \u003ccode\u003eERB::Util\u003c/code\u003e library supplies a \u003ca href=\"http://apidock.com/ruby/ERB/Util/url_encode\" target=\"_blank\" rel=\"noopener\"\u003eurl_encode\u003c/a\u003e method that has the same effect.)","cha-11_footnote-8":" Here we use two calls to \u003ccode\u003eupdate_attribute\u003c/code\u003e rather than a single call to \u003ccode\u003eupdate_attributes\u003c/code\u003e because (per \u003ca href=\"modeling_users_fragment.html#sec-updating_user_objects\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e6.1.5\u003c/span\u003e\u003c/a\u003e) the latter would run the validations.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Lacking in this case the user password, these validations would fail.","cha-12_footnote-1":" This chapter is independent of the others apart from using the mailer generation in \u003ca href=\"account_activation_fragment.html#code-generate_user_mailer\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e11.6\u003c/span\u003e\u003c/a\u003e, but it closely parallels \u003ca href=\"account_activation_fragment.html#cha-account_activation\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e11\u003c/span\u003e\u003c/a\u003e, so it’s much easier if you’ve followed that chapter first.","cha-12_footnote-2":" Security concerns about revealing the absence of the given email address are commonly misplaced.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The reason is that this property is already present in every website that won’t let you sign up with an email address that’s already in use, which is practically all of them.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thus, indicating that a given email address isn’t available for password resets gives potential attackers no additional information.","cha-12_footnote-3":" We need only handle the case where the password is empty because if the confirmation is empty, the confirmation validation (which is skipped if the password is empty) will catch the problem and supply a relevant error message.","cha-12_footnote-4":" Alert reader Khaled Teilab has noted that one advantage of using \u003ccode\u003eerrors.add(:password, :blank)\u003c/code\u003e is that the resulting message is automatically rendered in the correct language when using the \u003ccode class=\"tt\"\u003erails-i18n\u003c/code\u003e gem.","cha-13_footnote-1":" The name is motivated by the common description of Twitter as a \u003cem\u003emicroblog\u003c/em\u003e; since blogs have posts, microblogs should have microposts.","cha-13_footnote-2":" www.postgresql.org/docs/9.1/static/datatype-character.html","cha-13_footnote-3":" The foreign key reference is a database-level constraint indicating that the user id in the microposts table refers to the id column in the users table.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This detail will never be important in this tutorial, and the foreign key constraint isn’t even supported by all databases.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (It’s supported by PostgreSQL, which we use in production, but not by the development SQLite database adapter.)\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e We’ll learn more about foreign keys in \u003ca href=\"following_users_fragment.html#sec-relationship_user_associations\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e14.1.2\u003c/span\u003e\u003c/a\u003e.","cha-13_footnote-4":" We briefly encountered a similar issue in \u003ca href=\"updating_and_deleting_users_fragment.html#sec-updating_and_deleting_users_conclusion\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e10.5\u003c/span\u003e\u003c/a\u003e in the context of the users index.","cha-13_footnote-5":" SQL is case-insensitive, but it is conventional to write SQL keywords (such as \u003ccode\u003eDESC\u003c/code\u003e) in all-caps.","cha-13_footnote-6":" \u003ccode\u003eFaker::Lorem.sentence\u003c/code\u003e returns \u003cem\u003elorem ipsum\u003c/em\u003e text; as noted in \u003ca href=\"modeling_users_fragment.html#cha-modeling_users\" class=\"hyperref\"\u003eChapter \u003cspan class=\"ref\"\u003e6\u003c/span\u003e\u003c/a\u003e, \u003cem\u003elorem ipsum\u003c/em\u003e has a \u003ca href=\"http://www.straightdope.com/columns/read/2290/what-does-the-filler-text-lorem-ipsum-mean\" target=\"_blank\" rel=\"noopener\"\u003efascinating back story\u003c/a\u003e.","cha-13_footnote-7":" By design, the Faker gem’s \u003cem\u003elorem ipsum\u003c/em\u003e text is randomized, so the contents of your sample microposts will differ.","cha-13_footnote-8":" For convenience, \u003ca href=\"user_microposts_fragment.html#code-micropost_css\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e13.26\u003c/span\u003e\u003c/a\u003e actually has \u003cem\u003eall\u003c/em\u003e the CSS needed for this chapter.","cha-13_footnote-9":" If you’d like to refactor other tests to use \u003ccode\u003efull_title\u003c/code\u003e (such as those in \u003ca href=\"static_pages_fragment.html#code-base_title_test\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e3.30\u003c/span\u003e\u003c/a\u003e), you should include the Application Helper in \u003ccode\u003etest_helper.rb\u003c/code\u003e instead.","cha-13_footnote-10":" Note that, unlike the behavior in languages like Java or C++, private methods in Ruby \u003ca href=\"http://stackoverflow.com/questions/3534449/why-does-ruby-have-both-private-and-protected-methods/3534581#3534581\" target=\"_blank\" rel=\"noopener\"\u003ecan be called\u003c/a\u003e from derived classes.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thanks to reader Vishal Antony for bringing this difference to my attention.","cha-13_footnote-11":" See the Rails Guide on the \u003ca href=\"http://guides.rubyonrails.org/active_record_querying.html\" target=\"_blank\" rel=\"noopener\"\u003eActive Record Query Interface\u003c/a\u003e for more on \u003ccode\u003ewhere\u003c/code\u003e and related methods.","cha-13_footnote-12":" This corresponds to \u003ccode class=\"tt\"\u003eHTTP_REFERER\u003c/code\u003e, as defined by the specification for HTTP.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Note that “referer” is not a typo—the word is actually misspelled in the spec.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Rails corrects this error by writing “referrer” instead.","cha-13_footnote-13":" I didn’t remember offhand how to get this URL inside a Rails application, so I Googled “rails request previous url” and found a \u003ca href=\"http://stackoverflow.com/questions/4652084/ruby-on-rails-how-do-you-get-the-previous-url\" target=\"_blank\" rel=\"noopener\"\u003eStack Overflow thread\u003c/a\u003e with the answer.","cha-13_footnote-14":" Image retrieved from https://www.flickr.com/photos/grungepunk/14026922186 on 2014-09-19.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2014 by Jussie D. Brito and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by-sa/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution-ShareAlike 2.0 Generic\u003c/a\u003e license.","cha-13_footnote-15":" As always, you should use the version numbers listed at \u003ca href=\"https://gemfiles-4th-ed.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003egemfiles-4th-ed.railstutorial.org\u003c/a\u003e instead of the ones listed here.","cha-13_footnote-16":" Initially, I called the new attribute \u003ccode\u003eimage\u003c/code\u003e, but that name was so generic it ended up being confusing.","cha-13_footnote-17":" When using \u003ccode\u003eform_tag\u003c/code\u003e (discussed briefly in \u003ca href=\"basic_login_fragment.html#sec-login_form\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e8.1.2\u003c/span\u003e\u003c/a\u003e), it’s necessary to add the option \u003ccode\u003ehtml: { multipart: true }\u003c/code\u003e to handle file uploads, but when using \u003ccode\u003eform_for\u003c/code\u003e the necessary \u003ca href=\"http://stackoverflow.com/questions/4526273/what-does-enctype-multipart-form-data-mean\" target=\"_blank\" rel=\"noopener\"\u003emultipart form-data encoding type\u003c/a\u003e is \u003ca href=\"http://stackoverflow.com/a/26320725\" target=\"_blank\" rel=\"noopener\"\u003eautomatically added\u003c/a\u003e by Rails.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thanks to reader Alan Cruz for bringing this detail to my attention.","cha-13_footnote-18":" Windows users should add a \u003ccode\u003e:binary\u003c/code\u003e parameter: \u003ccode\u003efixture_file_upload(file, type, :binary)\u003c/code\u003e.","cha-13_footnote-19":" To learn how to do things like this, you can do what I did: Google around for things like “javascript maximum file size” until you find something on Stack Overflow.","cha-13_footnote-20":" More advanced users of jQuery would probably put the size check in its own JavaScript function, but since this isn’t a JavaScript tutorial the code in \u003ca href=\"user_microposts_fragment.html#code-jquery_file_test\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e13.66\u003c/span\u003e\u003c/a\u003e is fine for our purposes.","cha-13_footnote-21":" It’s possible to constrain the \u003cem\u003edisplay\u003c/em\u003e size with CSS, but this doesn’t change the image size.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In particular, large images would still take a while to load.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (You’ve probably visited websites where “small” images seemingly take forever to load.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is why.)","cha-13_footnote-22":" If you’re not using the cloud IDE or an equivalent Linux system, do a Google search for “imagemagick \u0026lt;your platform\u0026gt;”.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e On macOS, \u003ccode\u003ebrew install imagemagick\u003c/code\u003e should work if you have \u003ca href=\"http://brew.sh/\" target=\"_blank\" rel=\"noopener\"\u003eHomebrew\u003c/a\u003e installed.","cha-13_footnote-23":" Among other things, file storage on Heroku is temporary, so uploaded images will be deleted every time you deploy.","cha-14_footnote-1":" Image of child retrieved from http://www.flickr.com/photos/john_lustig/2518452221/ on 2013-12-16.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2008 by John Lustig and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Image of tiger retrieved from https://www.flickr.com/photos/renemensen/9187111340 on 2014-08-15.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Copyright © 2013 by Rene Mesen and used unaltered under the terms of the \u003ca href=\"https://creativecommons.org/licenses/by/2.0/\" target=\"_blank\" rel=\"noopener\"\u003eCreative Commons Attribution 2.0 Generic\u003c/a\u003e license.","cha-14_footnote-2":" For simplicity, \u003ca href=\"following_users_fragment.html#fig-naive_user_has_many_following\" class=\"hyperref\"\u003eFigure \u003cspan class=\"ref\"\u003e14.6\u003c/span\u003e\u003c/a\u003e omits the \u003ccode\u003efollowing\u003c/code\u003e table’s \u003ccode\u003eid\u003c/code\u003e column.","cha-14_footnote-3":" Thanks to reader Paul Fioravanti for suggesting this terminology.","cha-14_footnote-4":" Technically, Rails converts the argument of \u003ccode\u003ehas_many\u003c/code\u003e to a class name using the \u003ccode\u003eclassify\u003c/code\u003e method, which converts \u003ccode\u003e\"foo_bars\"\u003c/code\u003e to \u003ccode\u003e\"FooBar\"\u003c/code\u003e.","cha-14_footnote-5":" Technically, Rails uses the \u003ccode\u003eunderscore\u003c/code\u003e method to convert the class name to an id.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e For example, \u003ccode\u003e\"FooBar\".underscore\u003c/code\u003e is \u003ccode\u003e\"foo_bar\"\u003c/code\u003e, so the foreign key for a \u003ccode\u003eFooBar\u003c/code\u003e object would be \u003ccode\u003efoo_bar_id\u003c/code\u003e.","cha-14_footnote-6":" Once you have a lot of experience modeling a particular domain, you can often guess such utility methods in advance, and even when you can’t you’ll often find yourself writing them to make the tests cleaner.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In this case, though, it’s OK if you wouldn’t have guessed them.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Software development is usually an iterative process—you write code until it starts getting ugly, and then you refactor it—but for brevity the tutorial presentation is streamlined a bit.","cha-14_footnote-7":" For more details on such routing options, see the \u003ca href=\"http://guides.rubyonrails.org/routing.html\" target=\"_blank\" rel=\"noopener\"\u003eRails Guides article on “Rails Routing from the Outside In”\u003c/a\u003e.","cha-14_footnote-8":" Because it is nominally an acronym for \u003cem\u003easynchronous JavaScript and XML\u003c/em\u003e, Ajax is sometimes misspelled “AJAX”, even though the \u003ca href=\"http://www.adaptivepath.org/ideas/ajax-new-approach-web-applications/\" target=\"_blank\" rel=\"noopener\"\u003eoriginal Ajax article\u003c/a\u003e spells it as “Ajax” throughout.","cha-14_footnote-9":" The main requirement is that enumerable objects must implement an \u003ccode\u003eeach\u003c/code\u003e method to iterate through the collection.","cha-1_footnote-25":" Pronounced “Engine X”.","cha-1_footnote-26":" SQLite is widely used as an embedded database—for instance, it’s ubiquitous in mobile phones—and Rails uses it locally by default because it’s so easy to set up, but it’s not designed for database-backed web applications, so we’ll be using PostgreSQL in production instead.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e See \u003ca href=\"static_pages_fragment.html#sec-sample_app_setup\" class=\"hyperref\"\u003eSection \u003cspan class=\"ref\"\u003e3.1\u003c/span\u003e\u003c/a\u003e for more information.","cha-1_footnote-27":" toolbelt.heroku.com","cha-5_footnote-16":" Some developers insist that a single test shouldn’t contain multiple assertions.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e I find this practice to be unnecessarily complicated, while also incurring an extra overhead if there are common setup tasks needed before each test.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e In addition, a well-written test tells a coherent story, and breaking it up into individual pieces disrupts the narrative.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e I thus have a strong preference for including multiple assertions in a test, relying on Ruby (via minitest) to tell me the exact lines of any failed assertions.","cha-10_footnote-13":" Command-line tools such as \u003ccode class=\"tt\"\u003ecurl\u003c/code\u003e can issue \u003ccode class=\"tt\"\u003ePATCH\u003c/code\u003e requests of this form.","cha-10_footnote-14":" See the RailsCast on “\u003ca href=\"http://railscasts.com/episodes/77-destroy-without-javascript\" target=\"_blank\" rel=\"noopener\"\u003eDestroy Without JavaScript\u003c/a\u003e” for details.","cha-13_footnote-24":" This is a challenging section and can be skipped without loss of continuity.","cha-13_footnote-25":" S3 is a paid service, but the storage needed to set up and test the Rails Tutorial sample application costs less than a cent per month.","cha-1_footnote-28":" This solution, known as “security through obscurity”, is fine for hobby projects, but for sites that require greater initial security I recommend using \u003ca href=\"https://www.google.com/search?q=HTTP+basic+authentication\" target=\"_blank\" rel=\"noopener\"\u003eRails HTTP basic authentication\u003c/a\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is a much more advanced technique, though, and requires significantly more technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e) to implement.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e (Thanks to Alfie Pates for raising this issue.)","cha-8_footnote-15":" Some browsers offer a “\u003ca href=\"http://stackoverflow.com/questions/20449641/rails-4-session-value-never-expires-or-dies-when-browser-closes\" target=\"_blank\" rel=\"noopener\"\u003eremember where I left off\u003c/a\u003e” feature, which restores the session automatically, so be sure to disable any such feature before trying to log out.","cha-3_footnote-19":" The screenshot was taken using Rails 4.2, which as noted in \u003ca href=\"toy_app_fragment.html#aside-rake\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e2.1\u003c/span\u003e\u003c/a\u003e uses \u003ccode\u003erake test\u003c/code\u003e in place of \u003ccode\u003erails test\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Resolving such minor discrepancies is a good exercise in technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e).","cha-9_footnote-15":" Note that this means unchecking the box will log out the user on all browsers on all computers.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The alternate design of remembering user login sessions on each browser independently is potentially more convenient for users, but it’s less secure, and is also more complicated to implement.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Ambitious readers are invited to try their hand at implementing it.","cha-1_footnote-29":" As is often the case, this code can be made even \u003cem\u003emore\u003c/em\u003e compact using a built-in part of Ruby, in this case something called \u003ccode\u003esample\u003c/code\u003e: \u003ccode\u003e('a'..'z').to_a.sample(8).join\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Thanks to alert reader Stefan Pochmann for pointing this out—I didn’t even know about \u003ccode\u003esample\u003c/code\u003e until he told me!","cha-3_footnote-20":"The screenshot was taken using Rails 4.2, which as noted in \u003ca href=\"toy_app_fragment.html#aside-rake\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e2.1\u003c/span\u003e\u003c/a\u003e uses \u003ccode\u003erake test\u003c/code\u003e in place of \u003ccode\u003erails test\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Resolving such minor discrepancies is a good exercise in technical sophistication (\u003ca href=\"beginning_fragment.html#aside-technical_sophistication\" class=\"hyperref\"\u003eBox \u003cspan class=\"ref\"\u003e1.1\u003c/span\u003e\u003c/a\u003e). ","cha-9_footnote-16":" Before we wrote \u003ccode\u003eremember user\u003c/code\u003e without parentheses, but when used with the ternary operator omitting them results in a syntax error.","cha-11_footnote-9":" Note that \u003ca href=\"account_activation_fragment.html#code-show_only_active_users_exercise\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e11.40\u003c/span\u003e\u003c/a\u003e uses \u003ccode\u003eand\u003c/code\u003e in place of \u003ccode\u003e\u0026amp;\u0026amp;\u003c/code\u003e.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e The two are nearly identical, but the latter operator has a higher \u003ca href=\"https://en.wikipedia.org/wiki/Order_of_operations#Programming_languages\" target=\"_blank\" rel=\"noopener\"\u003e\u003cem\u003eprecedence\u003c/em\u003e\u003c/a\u003e, which binds too tightly to \u003ccode\u003eroot_url\u003c/code\u003e in this case.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e We could fix the problem by putting \u003ccode\u003eroot_url\u003c/code\u003e in parentheses, but the idiomatically correct way to do it is to use \u003ccode\u003eand\u003c/code\u003e instead.","cha-12_footnote-5":" Thanks to reader Tristan Ludowyk for suggesting this feature and for providing both a detailed description and a suggested implementation.","cha-13_footnote-26":" aws.amazon.com/documentation/s3/","cha-13_footnote-27":" As always, you should use the version numbers listed at \u003ca href=\"https://gemfiles-4th-ed.railstutorial.org/\" target=\"_blank\" rel=\"noopener\"\u003egemfiles-4th-ed.railstutorial.org\u003c/a\u003e instead of the ones listed here.","cha-12_footnote-6":" This proof is the price you pay for reading a web development tutorial written by a Ph.D. physicist.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e Just be grateful I couldn’t find a way to work \u003cspan class=\"inline_math\"\u003e\\( \\left(-\\frac{\\hbar^2}{2m}\\nabla^2 + V\\right)\\psi = E\\psi \\)\u003c/span\u003e or \u003cspan class=\"inline_math\"\u003e\\( G^{\\mu\\nu} = 8\\pi T^{\\mu\\nu} (=4\\tau T^{\\mu\\nu}) \\)\u003c/span\u003e into the exposition.","cha-8_footnote-16":" Setting \u003ccode\u003e@current_user\u003c/code\u003e to \u003ccode\u003enil\u003c/code\u003e would only matter if \u003ccode\u003e@current_user\u003c/code\u003e were created before the \u003ccode\u003edestroy\u003c/code\u003e action (which it isn’t) \u003cem\u003eand\u003c/em\u003e if we didn’t issue an immediate redirect (which we do).\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This is an unlikely combination of events, and with the application as presently constructed it isn’t necessary, but because it’s security-related I include it for completeness.","cha-1_footnote-30":" railstutorial.org/email","cha-4_footnote-18":" You don’t have to know what each class in this hierarchy does.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e \u003cem\u003eI\u003c/em\u003e don’t know what they all do, and I’ve been programming in Ruby on Rails since 2005.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e This means either that (a) I’m grossly incompetent or (b) you can be a skilled Rails developer without knowing all its innards.\u003cspan class=\"intersentencespace\"\u003e\u003c/span\u003e I hope for both our sakes that it’s the latter.","cha-1_footnote-31":" railstutorial.org/email","cha-1_footnote-32":" railstutorial.org/email","cha-9_footnote-17":" The \u003ccode\u003eassigns\u003c/code\u003e method is deprecated as of Rails 5, but I still find it useful in many contexts, and it’s available via the \u003ccode class=\"tt\"\u003erails-controller-testing\u003c/code\u003e gem we included in \u003ca href=\"static_pages_fragment.html#code-gemfile_sample_app\" class=\"hyperref\"\u003eListing \u003cspan class=\"ref\"\u003e3.2\u003c/span\u003e\u003c/a\u003e."},
      s3_path_prefix: "636/ruby_on_rails_tutorial_4th_edition",
      custom_math: "\"failing\": \"\\\\coloredtext{red}{\\\\textsc{\\\\textbf{red}}}\",\n\"passing\": \"\\\\coloredtext{ForestGreen}{\\\\textsc{\\\\textbf{green}}}\",\n\"rt\": \"\\\\emph{Rails Tutorial}\",\n\"letbd\": \"\\\\href{https://www.learnenough.com/story}{Learn Enough to Be Dangerous}\",\n\"lesite\": \"\\\\href{https://www.learnenough.com/}{Learn Enough}\",\n\"lecl\": \"\\\\href{https://www.learnenough.com/command-line}{\\\\emph{Learn Enough Command Line to Be Dangerous}}\",\n\"leg\": \"\\\\href{https://www.learnenough.com/git}{\\\\emph{Learn Enough Git to Be Dangerous}}\",\n\"leh\": \"\\\\href{https://www.learnenough.com/html}{\\\\emph{Learn Enough HTML to Be Dangerous}}\",\n\"ler\": \"\\\\href{https://www.learnenough.com/ruby}{\\\\emph{Learn Enough Ruby to Be Dangerous}}\",\n\"lete\": \"\\\\href{https://www.learnenough.com/text-editor}{\\\\emph{Learn Enough Text Editor to Be Dangerous}}\",\n\"rort\": \"\\\\href{https://www.railstutorial.org/}{Ruby on Rails Tutorial}\",\n\"rortb\": \"\\\\href{https://www.railstutorial.org/book}{\\\\emph{Ruby on Rails Tutorial}}\",\n\"lev\": \"\\\\href{https://www.learnenough.com/vim}{\\\\emph{Learn Enough Vim to Be Dangerous}}\",\n\"les\": \"\\\\href{https://www.learnenough.com/sinatra}{\\\\emph{Learn Enough Sinatra to Be Dangerous}}\",\n\"lera\": \"\\\\href{https://www.learnenough.com/ruby-on-rails}{\\\\emph{Learn Enough Rails to Be Dangerous}}\",\n\"lecss\": \"\\\\href{https://www.learnenough.com/css-and-layout}{\\\\emph{Learn Enough CSS \\\\& Layout to Be Dangerous}}\",\n\"ledev\": \"\\\\href{https://www.learnenough.com/dev-environment}{\\\\emph{Learn Enough Dev Environment to Be Dangerous}}\",\n\"ccby\": \"\\\\href{https://creativecommons.org/licenses/by/2.0/}{Creative Commons Attribution 2.0 Generic}\",\n\"ccbysa\": \"\\\\href{https://creativecommons.org/licenses/by-sa/2.0/}{Creative Commons Attribution-ShareAlike 2.0 Generic}\",\n\"ccbync\": \"\\\\href{https://creativecommons.org/licenses/by-nc/2.0/}{Creative Commons Attribution-NonCommercial 2.0 Generic}\",\n\"ccbynd\": \"\\\\href{https://creativecommons.org/licenses/by-nd/2.0/}{Creative Commons Attribution-NoDerivs 2.0 Generic}\",\n\"xkcduse\": \"Copyright © Randall Munroe and used unaltered under the terms of the \\\\href{https://creativecommons.org/licenses/by-nc/2.5/}{Creative Commons Attribution-NonCommercial 2.5 Generic} license.\",\n\"gemfilenote\": \"\\\\textbf{Important note: For all the Gemfiles in this book, you should use the version numbers listed at \\\\href{https://gemfiles-4th-ed.railstutorial.org/}{gemfiles-4th-ed.rails\\\\-tutorial.org} instead of the ones listed below (although they should be identical if you are reading this online).}\",\n\"secondgemfilenote\": \"As always, you should use the version numbers listed at \\\\href{https://gemfiles-4th-ed.railstutorial.org/}{gemfiles-4th-ed.rails\\\\-tutorial.org} instead of the ones listed here.\""
    });
  });
  
  $(document).ready(function() {
    bookScroll();
  });
</script>


<div class="authorSignup">
<div class="dialog">
<h3 id="email">Join the Mailing List</h3>
<p>Sign up for the Learn Enough mailing list to get notified when new tutorials are released, when new video guides are posted, and to receive special offers and discounts. We won't ever share your email with anyone.</p>
<script src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/CKJS4.js.下載"></script>
<div class="ck_form ck_minimal ck_horizontal">
<div class="ck_form_fields">
<div id="ck_success_msg" style="display:none;">
<p>Success! Thanks for joining the list.</p>
</div>
<form action="https://app.convertkit.com/landing_pages/4858/subscribe" class="ck_subscribe_form" data-remote="true" id="ck_subscribe_form">
<input id="ck_form_options" type="hidden" value="{&amp;quot;form_style&amp;quot;:&amp;quot;minimal&amp;quot;,&amp;quot;embed_style&amp;quot;:&amp;quot;inline&amp;quot;,&amp;quot;embed_trigger&amp;quot;:&amp;quot;scroll_percentage&amp;quot;,&amp;quot;scroll_percentage&amp;quot;:&amp;quot;70&amp;quot;,&amp;quot;delay_seconds&amp;quot;:&amp;quot;10&amp;quot;,&amp;quot;display_position&amp;quot;:&amp;quot;br&amp;quot;,&amp;quot;display_devices&amp;quot;:&amp;quot;all&amp;quot;,&amp;quot;days_no_show&amp;quot;:&amp;quot;15&amp;quot;,&amp;quot;converted_behavior&amp;quot;:&amp;quot;show&amp;quot;}">
<input id="landing_page_id" name="id" type="hidden" value="4858">
<div class="ck_errorArea">
<div id="ck_error_msg" style="display:none;">
<p>There was an error submitting your subscription. Please try again.</p>
</div>
</div>
<div class="field ck_control_group ck_email_field_group">
<label class="ck_label" for="ck_emailField" style="display: none">Email Address</label>
<input class="ck_email_address" id="ck_emailField" name="email" placeholder="Email Address" required="required" type="email">
<button class="subscribe_button ck_subscribe_button btn fields" id="ck_subscribe_button">Subscribe</button>
</div>
</form>
</div>
</div>

</div>
</div>
<footer class="footer">
<nav class="footer-social-menu">
<ul class="footer-sub-menu">
<li>
Learn Enough:
<a class="footer-social-icon" target="_blank" href="https://www.youtube.com/c/LearnEnough"><svg class="svg-inline--fa fa-youtube-square fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M186.8 202.1l95.2 54.1-95.2 54.1V202.1zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-42 176.3s0-59.6-7.6-88.2c-4.2-15.8-16.5-28.2-32.2-32.4C337.9 128 224 128 224 128s-113.9 0-142.2 7.7c-15.7 4.2-28 16.6-32.2 32.4-7.6 28.5-7.6 88.2-7.6 88.2s0 59.6 7.6 88.2c4.2 15.8 16.5 27.7 32.2 31.9C110.1 384 224 384 224 384s113.9 0 142.2-7.7c15.7-4.2 28-16.1 32.2-31.9 7.6-28.5 7.6-88.1 7.6-88.1z"></path></svg><!-- <i class="fab fa-youtube-square"></i> -->
</a></li>
<li>
Learn Enough:
<a class="footer-social-icon" target="_blank" href="https://twitter.com/learnenough"><svg class="svg-inline--fa fa-twitter-square fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg><!-- <i class="fab fa-twitter-square"></i> -->
</a></li>
<li>
Rails Tutorial:
<a class="footer-social-icon" target="_blank" href="https://twitter.com/railstutorial"><svg class="svg-inline--fa fa-twitter-square fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg><!-- <i class="fab fa-twitter-square"></i> -->
</a></li>
</ul>
</nav>
<nav class="footer-nav">
<div class="footer_logo_wr">
<a class="logoLink artLogo" href="http://www.learnenough.com//"><div class="svg le-logo"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 801 1041" style="enable-background:new 0 0 801 1041;" xml:space="preserve">
<path d="M569.9,478.6l3.5-3.5v-41.7l-1-2.5l-24.3-24.3l-2.5-1H410.5l-3.5,3.5v358.6l1,2.5l24.3,24.3l1.9,0.5l0.5,0.5h135.1l3.5-3.5v-41.7l-1-2.5l-24.3-24.3l-2.5-1H488v-89.9h77l3.5-3.5v-41.7l-1-2.5l-24.3-24.3l-2.5-1H488v-81H569.9z M544.2,412.6l17.3,17.3H436.2L419,412.6H544.2z M414,417.6l17.3,17.3v348.7L414,766.3V417.6z M544.2,729.5l17.3,17.3H488v-17.3H544.2z M539.2,566.6l17.3,17.3H488v-17.3H539.2z M484.5,471.6l-3.5,3.5v112.3l3.5,3.5h77v34.7h-77l-3.5,3.5v121.2l3.5,3.5h81.9v34.7H438.3V436.9h128.1v34.7H484.5z"></path>
<path d="M401.5,747.8l-24.3-24.3l-2.5-1h-55.7V433.4l-0.2-0.2l-0.8-2.3l-24.3-24.3l-2.5-1h-49.7l-3.5,3.5v358.6l1,2.5l24.3,24.3l1.9,0.5l0.6,0.6H399l3.5-3.5v-41.7L401.5,747.8z M373.3,729.5l17.3,17.3h-71.5v-17.3H373.3z M307.1,429.9h-39.8l-17.3-17.3h39.8L307.1,429.9z M245.1,417.6l17.3,17.3v348.7l-17.3-17.3V417.6z M395.5,788.5H269.4V436.9h42.7v313.4l3.5,3.5h79.9V788.5z"></path>
<path d="M691.8,600.3c0-77.2-30-149.7-84.6-204.3c-47.3-47.3-108.2-76.2-173.9-83c0.4-22.2,0.6-35.3,0.6-35.7l-2.6-3.8c-1.8-0.6-3.5-2.2-5.1-4.2l5.1,0c1.8,0.1,22.1,0.8,33.2-11.2c5.5-6,8.5-14,8.5-23.4l0.1-13.3l-3.5-3.5l-16-0.1l-3.5,3.5l-0.1,13.3c0,3.3-0.7,5.5-2.4,7.3c-3.7,4-12.4,4.9-15.4,4.9l-11.9,0c1.4-13.4,3.7-39.7,3.9-72.2c0.1-34.4-5.7-68.9-6.6-73.7c4.9-5.8,7.6-13.5,7.6-21.6C425.2,62,413,47.9,398,47.8c0,0-0.1,0-0.1,0c-15,0-27.2,14-27.3,31.2c0,8.1,2.6,15.8,7.5,21.7c-0.9,4.8-7,39.3-7.2,73.6c-0.1,32.5,2,58.9,3.3,72.3l-11.1,0c-1.8-0.1-22.1-0.8-33.2,11.2c-5.5,6-8.5,14-8.5,23.4l-0.1,13.3l3.5,3.5l16.2,0.1l3.5-3.5l0.1-13.3c0-3.3,0.7-5.5,2.4-7.3c3.7-4,12.3-4.9,15.3-4.9l5.9,0c-1.6,1.9-3.4,3.5-5.2,4.1l-2.6,3.8c0,0.5,0.2,14.2,0.6,37.4c-61.2,8.9-117.8,37.1-162.3,81.6C144.1,450.6,114,523.1,114,600.3s30,149.7,84.6,204.3c49,49,112.4,78.2,180.7,83.7c6.4,96.9,11.7,103.7,14.1,106.6l3.3,2.6l2.9-2.6c2.4-2.9,7.8-9.7,14.3-105.9c73-2.7,141.3-32.4,193.2-84.4C661.8,750,691.8,677.5,691.8,600.3z M377.6,79.1c0.1-13.4,9.1-24.2,20.3-24.2c0,0,0,0,0.1,0c7.7,0,14.5,5.3,17.8,13l-10.6-4.3c1.1,1.6,2.1,3.4,2.8,5.5l9.4,3.8c0.5,2,0.7,4.2,0.7,6.4c0,0.2,0,0.5,0,0.7l-8.4-3.4c0.1,0.8,0.1,1.7,0.1,2.5c0,0.6,0,1.2-0.1,1.8l8,3.2c-0.4,2.1-1,4.2-1.8,6.1l-7.3-2.9c-0.4,1.3-0.9,2.6-1.4,3.7l6.8,2.8c-0.6,1-1.3,1.9-2,2.8c-0.7,0.8-1.5,1.6-2.3,2.3l-0.8-0.3l-5.3-2.2c-1.1,1.2-2.3,2.1-3.6,2.9l5.7,2.3c-2.5,1.2-5.1,1.9-7.9,1.9c-5.3,0-10.3-2.5-14.1-7C379.8,91.9,377.6,85.7,377.6,79.1z M377.9,174.4c0.1-28.2,4.4-57,6.3-68.1c4.1,2.7,8.7,4.2,13.5,4.2c0,0,0.1,0,0.1,0c4.8,0,9.4-1.4,13.5-4.1c0.2,1.3,0.5,2.9,0.7,4.7l-2.1-0.9l-2.9,3.1l5.7,2.3c0.3,2.2,0.6,4.6,1,7.3l-17.4-7.1c0.2,1.4,0.4,3,0.6,4.6l17.3,7c0.3,2.3,0.5,4.7,0.8,7.2l-17.2-7c0.2,1.5,0.3,3,0.5,4.5l17.2,7c0.2,2.3,0.4,4.7,0.6,7.1l-19.6-8c-1.7,0.1-3.7-0.4-3.7-0.4s0.8,1.7,1.9,4l21.7,8.8c0.2,2.3,0.3,4.7,0.4,7l-18.3-7.4c0.9,2.1,1.5,3.9,1.7,5l16.8,6.8c0.1,2.3,0.1,4.6,0.2,6.9l-16.6-6.7c0.1,1.5,0.1,2.9,0.1,4.4l16.5,6.7c0,0.4,0,0.8,0,1.2c0,1.9,0,3.8,0,5.7l-16.7-6.8c-1.1,1.7-5.8-0.2-5.8-0.2s0.4,1,0.9,2.5l21.6,8.7c0,2.3-0.1,4.6-0.2,6.8l-18.6-7.5c0.6,1.8,1.2,3.6,1.6,5l16.9,6.8c-0.1,2.3-0.2,4.6-0.3,6.8l-16.2-6.6c0,1.5-0.1,2.9-0.2,4.3l16.2,6.6c-0.1,2.3-0.2,4.5-0.4,6.7l-16.1-6.5c0,0.7-0.1,1.4-0.1,2.1c0,0.9-0.4,1.4-0.8,1.8l16.8,6.8c-0.1,2.3-0.3,4.5-0.5,6.7l-20-8.1c0.3,1.4,0.7,3.1,1.1,4.7l18.6,7.6c-0.2,2.3-0.4,4.6-0.6,6.6l-16.6-6.8c0.3,1.8,0.4,3.3,0.4,4.1c0,0.1,0,0.2,0,0.3l15.9,6.5c-0.2,2.5-0.5,4.7-0.7,6.6l-15.9-6.4c-0.1,1.5-0.3,2.9-0.4,4.2l8,3.2l-23.7-0.1C380,233.6,377.8,207,377.9,174.4z M362.3,262.1c-1.4,0-14,0.2-20.4,7.1c-2.8,3-4.2,7-4.2,12l0,9.8l-9.2,0l0-9.8c0-7.5,2.3-14,6.6-18.6l0,0c9.1-9.8,27.6-9,27.8-9l69.2,0.2c1.4,0,14.1-0.2,20.6-7.1c2.8-3,4.2-7,4.2-12l0-9.8l9,0l0,9.8c0,7.5-2.3,14-6.6,18.6c-9.1,9.8-27.6,9-27.8,9L362.3,262.1z M407.6,348.5l1.1,0.4h-1.1L407.6,348.5z M403.6,348.9h-5.3l-3.5-79.8l17.2,0.1L403.6,348.9z M408.1,344.3l0.7-6.6l15.9,6.4c0,1.6-0.1,3.1-0.1,4.7h-5.2L408.1,344.3z M409.2,333.6l0.7-6.6l15,6.1c0,2.2-0.1,4.5-0.1,6.8L409.2,333.6z M410.3,322.9l0.7-6.6l14.1,5.7c0,2.2-0.1,4.5-0.1,6.8L410.3,322.9z M411.5,312.2l0.7-6.6l13.1,5.3c0,2.2-0.1,4.5-0.1,6.8L411.5,312.2z M412.6,301.4l0.7-6.6l12.2,4.9c0,2.1-0.1,4.4-0.1,6.8L412.6,301.4z M413.7,290.7l0.7-6.6l11.3,4.6c0,2-0.1,4.3-0.1,6.8L413.7,290.7z M414.9,280l0.7-6.6l5.5,2.2c1.5,1.6,3.1,3,4.8,4c0,1.2,0,2.8-0.1,4.8L414.9,280z M416,269.3L416,269.3l0.3,0c0,0.1,0.1,0.1,0.1,0.2L416,269.3z M390.3,348.9h-20.7c-0.7-36.5-1.1-61.7-1.2-69.5c3.9-2.4,7.2-6.4,9.6-10.3l8.8,0L390.3,348.9z M392.6,951.2c-2-18-4.2-44.3-6.4-82.7c-0.3-5.2-0.6-10.6-0.9-16.2h7.4l2.5,115.9L392.6,951.2z M400.7,959.3l-0.1-20.9l1,0.2C401.4,940.3,400.8,957.7,400.7,959.3z M401.6,934.5l-1-0.4v-6.9l1.7,0.7C402.1,930.2,401.8,932.4,401.6,934.5z M402.7,923.8l-2.2-0.9v-6.9l2.8,1.1C403.2,919.4,403,921.6,402.7,923.8z M403.8,913l-3.2-1.3l0-6.9l3.8,1.6C404.2,908.7,404,910.9,403.8,913z M404.8,902.3l-4.2-1.7v-6.9l4.8,1.9C405.2,897.8,405,900.1,404.8,902.3z M405.7,891.4l-5.1-2.1l0-6.9l5.6,2.3C406,887,405.9,889.2,405.7,891.4z M406.5,880.6l-5.9-2.4l0-6.9l6.4,2.6C406.8,876.1,406.6,878.4,406.5,880.6z M407.3,868.6c0,0.4,0,0.7-0.1,1.1l-6.6-2.7l0-6.9l7,2.8C407.5,864.9,407.4,866.8,407.3,868.6z M407.9,858.8l-7.3-2.9l0-3.5h7.6C408.1,854.5,408,856.6,407.9,858.8z M414.5,880.9c0.6-8.8,1.2-18.3,1.7-28.6h27v-7h-91v7h25c0.6,10,1.1,19.2,1.6,27.8c-66-5.6-127.2-33.9-174.6-81.2C151.2,745.9,122,675.3,122,600.3s29.2-145.6,82.3-198.6c43.1-43.1,97.6-70.4,156.8-79.2c0.1,7.9,0.3,16.8,0.5,26.4h-16.1v7h109.8v-7h-22.7c0.2-10.2,0.4-19.6,0.5-27.9c63.6,6.8,122.6,34.8,168.4,80.7c53.1,53.1,82.3,123.6,82.3,198.6s-29.2,145.6-82.3,198.6C551.2,849.2,485.2,878.1,414.5,880.9z"></path>
</svg>
</div>
<span>LEARN ENOUGH</span>
</a></div>
<ul class="footer-sub-menu">
<li><a href="http://www.learnenough.com/courses">Courses</a></li>
<li><a href="http://www.learnenough.com/pricing">Pricing</a></li>
<li><a href="http://www.learnenough.com/scholarship">Scholarship</a></li>
<li><a href="http://www.learnenough.com/teams/new">For Teams</a></li>
<li><a href="http://www.learnenough.com/login">Log In</a></li>
</ul>
<ul class="footer-sub-menu">
<li><a href="http://www.learnenough.com/all-access">All Access</a></li>
<li><a href="http://www.learnenough.com/ruby-on-rails-6th-edition">The Rails Tutorial</a></li>
<li><a href="http://www.learnenough.com/our-philosophy">Our Philosophy</a></li>
<li><a href="http://www.learnenough.com/about">About</a></li>
<li><a href="http://news.learnenough.com/">News</a></li>
</ul>
<ul class="footer-sub-menu">
<li><a href="http://www.learnenough.com/why-rails">Why Use Ruby on Rails?</a></li>
<li><a href="http://www.learnenough.com/why-ruby">Why Use the Ruby Language?</a></li>
<li><a href="http://www.learnenough.com/why-program">Why Program?</a></li>
<li><a href="http://www.learnenough.com/understand-devs">Why Understand Devs?</a></li>
<li><a href="http://www.learnenough.com/for-beginners">For Beginners</a></li>
</ul>
<ul class="footer-sub-menu">
<li><a href="http://www.learnenough.com/legal">Legal</a></li>
<li><a href="mailto:support@learnenough.com">Contact</a></li>
</ul>
</nav>
</footer>
<!-- MODALS ----------------------- -->
<div class="le-modal le-modal_landing-video">
<div class="le-modal_bg" onclick="leModalVideoClose()"></div>
<a onclick="leModalVideoClose()" class="modal_close" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a><div class="le-modal_video" id="le-modal_video">
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen" class="le-modal_video-embed" frameborder="0" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/saved_resource.html"></iframe>
</div>
</div>
<div class="le-modal le-modal_yourcourses-guide">
<div class="le-modal_bg" onclick="leModalClose(&#39;leYourCoursesGuide&#39;)"></div>
<div class="modal_content">
<a onclick="leModalClose(&#39;leYourCoursesGuide&#39;)" class="modal_close" href="javascript://"><svg class="svg-inline--fa fa-times fa-w-11" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" data-fa-i2svg=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg><!-- <i class="fas fa-times"></i> -->
</a><div class="courses_guide">
<h2>
<div class="sub-title">A quick guide to</div>
Your Courses
<div class="sub-title">Welcome to Learn Enough!</div>
</h2>
<img class="courses_guide-img" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/yourcourses_guide-79857ef1cde8e99bff9372c34d275f04f1674e1e6c1fda78e38664803ca0d3fb.png" alt="Yourcourses guide">
</div>

</div>
</div>

</div>
</div>
<script>
  if (localStorage['headPush'] == 'yes') {
    $('.header-push').addClass('header-push-closed');
  };
</script>
<script>
  if (localStorage['sideOpen'] == 'no') {
    $('body').addClass('side-menu-closed');
  };
  bookCheckMobile();
</script>


<iframe frameborder="0" allowtransparency="true" scrolling="no" name="__privateStripeMetricsController0" allowpaymentrequest="true" src="./Ruby on Rails Tutorial (Rails 5) _ Learn Enough to Be Dangerous_files/outer.html" aria-hidden="true" tabindex="-1" style="border: none !important; margin: 0px !important; padding: 0px !important; width: 1px !important; min-width: 100% !important; overflow: hidden !important; display: block !important; visibility: hidden !important; position: fixed !important; height: 1px !important; pointer-events: none !important; user-select: none !important;"></iframe></body></html>